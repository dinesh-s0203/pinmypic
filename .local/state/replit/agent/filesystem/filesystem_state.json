{"file_contents":{"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"faiss-cpu>=1.11.0\",\n    \"flask>=3.1.1\",\n    \"insightface>=0.7.3\",\n    \"numpy>=2.3.1\",\n    \"onnxruntime>=1.22.0\",\n    \"opencv-python>=4.11.0.86\",\n    \"requests>=2.32.4\",\n]\n","size_bytes":318},"replit.md":{"content":"# PinMyPic - Photography Portfolio & Booking Platform\n\n## Project Overview\nA modern photography portfolio and booking platform with AI-powered face recognition features. The platform allows photographers to showcase their work, manage events, handle bookings, and provide clients with an innovative \"FindMyFace\" service to locate their photos.\n\n## Architecture\n- **Frontend**: React with TypeScript, Tailwind CSS, Radix UI components\n- **Backend**: Express.js with TypeScript\n- **Database**: Firebase Realtime Database\n- **Authentication**: Firebase Auth (Google OAuth)\n- **Deployment**: Replit environment\n\n## Key Features\n- Photography portfolio showcase\n- Event gallery management\n- AI-powered face recognition (FindMyFace)\n- Online booking system with packages\n- Admin dashboard\n- Contact form management\n- Firebase Google authentication\n\n## Recent Changes\n- **2024-12-23**: Successfully migrated from Lovable to Replit environment\n- **2024-12-23**: Implemented Firebase authentication with Google OAuth\n- **2024-12-23**: Created comprehensive database schema with users, events, bookings, packages, contact messages\n- **2024-12-23**: Built full-stack API with authentication middleware\n- **2024-12-23**: Updated frontend to use database data instead of static content\n- **2024-12-23**: Simplified authentication to Google-only (removed email/password forms)\n- **2024-12-23**: Integrated Google sign-in directly into navigation header\n- **2024-12-23**: Removed separate login/register pages for streamlined UX\n- **2024-12-23**: Added editable profile with custom photo URL support\n- **2024-12-23**: Implemented default gradient avatar fallback with user initials\n- **2024-12-23**: Fixed user sync route to handle existing users properly\n- **2025-01-24**: Fixed database connection issue - created PostgreSQL database and pushed schema\n- **2025-01-24**: Fixed profile avatar visibility in navigation bar (both desktop and mobile)\n- **2025-01-24**: Resolved AdminDashboard recentBookings errors - updated to use correct database schema\n- **2025-01-24**: Added search functionality and empty state handling for admin bookings table\n- **2025-01-24**: Fixed booking submission date validation error - converted string dates to Date objects\n- **2025-01-24**: Implemented complete booking management system with accept/reject/delete functionality\n- **2025-01-24**: Added working \"New Booking\" navigation buttons in admin dashboard\n- **2025-01-24**: Fixed client name display using correct database field names\n- **2025-01-24**: Created comprehensive event management system with dual PIN access control\n- **2025-01-24**: Added CreateEventDialog with Public PIN and Bride-Groom PIN generation\n- **2025-01-24**: Implemented Events tab in admin dashboard with full CRUD operations\n- **2025-01-24**: Fixed database schema by manually adding public_pin and bride_groom_pin columns\n- **2025-01-24**: Configured .env file with actual Neon database credentials for proper secret management\n- **2025-01-24**: Fixed admin events visibility issue by creating separate endpoint for all events\n- **2025-01-24**: Added beautiful PinMyPic logo to navigation header (both desktop and mobile views)\n- **2025-01-24**: Fixed DATABASE_URL environment variable loading issue with fallback reading\n- **2025-01-24**: Cleared all demo data from database (events, bookings, packages, photos, contact messages)\n- **2025-01-24**: Migrated from Neon PostgreSQL to Firebase Realtime Database\n- **2025-01-24**: Replaced Drizzle ORM with Firebase Admin SDK for database operations\n- **2025-01-24**: Updated all data types and schemas for Firebase compatibility\n- **2025-01-24**: Removed PostgreSQL dependencies and configuration files\n- **2025-01-24**: Fixed blank landing page by implementing mock Firebase database for development\n- **2025-01-17**: Comprehensive performance optimizations implemented:\n  - Added debounced search with 300ms delay to reduce API calls\n  - Implemented lazy loading for all images with intersection observer\n  - Added compression middleware for server responses\n  - Optimized image serving with proper caching headers and ETag support\n  - Created reusable LazyImage component for consistent loading behavior\n  - Added skeleton loading states for better perceived performance\n  - Optimized batch photo uploads with sequential processing\n  - Enhanced error handling for image loading failures\n- **2025-01-17**: Fixed admin dashboard packages filtering issue:\n  - Changed `/api/packages` endpoint to return all packages (active and inactive)\n  - Added `getAllPackages()` method to storage for comprehensive package retrieval\n  - Updated admin dashboard to default to showing all packages instead of only active ones\n  - Packages filter now works correctly on frontend for active/inactive status\n- **2025-01-24**: Fixed booking submission validation errors with proper data type handling\n- **2025-01-24**: Added international country code selector to booking form phone field\n- **2025-01-24**: Connected to real Firebase Realtime Database at faceai-799e4-default-rtdb.firebaseio.com\n- **2025-01-24**: Fixed admin access for dond2674@gmail.com and booking retrieval errors\n- **2025-01-24**: Updated authentication to handle missing user data gracefully\n- **2025-06-25**: Updated Firebase configuration with correct pinmypic-3c170 project credentials\n- **2025-07-18**: Enhanced face recognition dialog with camera selfie functionality:\n  - Added camera access for taking selfies directly in the app\n  - Users can now choose between file upload or camera capture\n  - Implemented live camera preview with proper stream management\n  - Added capture, retake, and remove photo controls\n  - Fixed camera cleanup when dialog closes\n- **2025-07-18**: Fixed profile page and booking history functionality:\n  - Fixed profile update API endpoint with proper Firebase authentication\n  - Created dedicated `/api/user/bookings` endpoint for user-specific booking history\n  - Added booking statistics dashboard showing total bookings, confirmed/pending counts, and total spent\n  - Enhanced booking history display with detailed information and status badges\n  - Fixed authentication issues preventing profile updates\n  - Added proper token verification for secure profile and booking operations\n- **2025-07-19**: Fixed duplicate user creation issue during first-time login:\n  - Identified race condition between `loginWithGoogle` and `onAuthStateChanged` causing dual user sync calls\n  - Added `syncInProgress` state to prevent concurrent sync operations\n  - Removed duplicate call to `syncUserWithDatabase` from `loginWithGoogle` function\n  - Enhanced `findOrCreateUserByEmail` to prioritize Firebase UID lookup over email lookup\n  - Improved `createUser` method with parallel existence checks for both email and Firebase UID\n  - Added comprehensive logging for user creation and deduplication tracking\n  - Created `scripts/deduplicate-users.js` utility for cleaning up existing duplicate accounts\n  - Implemented robust user deduplication with data merging capabilities\n  - Fixed users tab refresh issue in admin dashboard by implementing `refreshTrigger` prop system\n  - Connected admin dashboard refresh button to trigger users data refresh in AdminRoleManagement component\n- **2025-07-19**: Implemented comprehensive slideshow functionality for full-screen photo viewing:\n  - **Added navigation buttons**: Large left/right arrow buttons positioned on sides of full-screen viewer for easy photo browsing\n  - **Keyboard navigation support**: Arrow keys (left/right) for photo navigation, ESC key to close slideshow, with full keyboard event handling\n  - **Photo counter display**: Shows current photo position (e.g., \"3 of 12\") in header for better user orientation\n  - **Navigation dots for small galleries**: Interactive dots below photos for galleries with 10 or fewer images, allowing direct photo selection\n  - **Smooth transitions**: Added CSS transitions for seamless photo switching experience\n  - **Circular navigation**: Photos loop from last to first and vice versa for continuous browsing\n  - **Enhanced both Events page and Admin EventDetailsDialog**: Consistent slideshow experience across public Events page and admin photo management\n  - **Auto-index tracking**: Automatically tracks current photo index when opening slideshow from any photo in gallery\n  - **Improved user instructions**: Updated footer text to guide users on navigation options (arrow keys, buttons, ESC)\n  - **Fixed admin navigation flow**: Updated EventDetailsDialog slideshow to show \"Back to Event Gallery\" instead of \"Back to Gallery\" for clearer navigation context\n  - **Fixed tab state preservation**: Ensured that returning from full-screen photo viewer maintains the Photo Gallery tab active state in EventDetailsDialog\n  - **Fixed slideshow header button functionality**: Resolved click event issues with \"Back to Event Gallery\", Download, and Close buttons by removing excessive event propagation prevention\n- **2025-07-23**: Optimized photo upload system for large batch processing (100+ photos):\n  - **Implemented intelligent batching**: Created UploadOptimizer utility to dynamically adjust batch sizes based on browser capabilities and file count\n  - **Added memory monitoring**: Integrated MemoryMonitor to detect critical memory usage and prevent browser crashes\n  - **Enhanced UI performance**: Optimized file list rendering with virtual scrolling for large uploads, showing only key files to prevent DOM overload\n  - **Improved upload algorithm**: Sequential processing for 100+ files with intelligent delays between batches to prevent browser freezing\n  - **Added upload limits**: 500 file maximum with 2GB total size limit to prevent system overload\n  - **Enhanced progress tracking**: Overall progress bar for large uploads with detailed status breakdown (uploading, completed, failed, pending)\n  - **Memory cleanup**: Automatic garbage collection triggers and object URL cleanup to prevent memory leaks\n  - **Upload time estimation**: Intelligent time estimates based on file sizes and network conditions\n  - **Browser capability detection**: Dynamic batch size adjustment (4-8 files per batch) based on total upload size and browser memory\n  - **Error resilience**: Batch-level error handling with recovery mechanisms for failed uploads\n- **2025-07-19**: Enhanced saved photos functionality in Profile page with comprehensive photo management:\n  - **Added interactive photo overlays**: View, download, and unsave buttons appear on hover for each saved photo\n  - **Implemented full-screen photo viewer**: Complete slideshow functionality with navigation arrows, keyboard controls (arrow keys, ESC), and photo counter\n  - **Created unsave photo functionality**: Users can remove photos from their saved collection with proper API integration and cache invalidation\n  - **Added download functionality**: Direct download capability for saved photos with proper filename handling\n  - **Enhanced UX with visual feedback**: Hover effects, loading states, and toast notifications for all photo management actions\n  - **Integrated keyboard navigation**: Arrow keys for photo navigation and ESC to close full-screen viewer\n  - **Added navigation dots**: Interactive dots for small galleries (≤10 photos) allowing direct photo selection\n  - **Implemented proper error handling**: Comprehensive error states and user feedback for photo operations\n- **2025-06-25**: Conducted comprehensive error analysis and fixed critical issues:\n  - Fixed type mismatches (bookingId and eventId from number to string)\n  - Removed PostgreSQL-specific error handling for Firebase compatibility\n  - Fixed toast import paths and null safety in date handling\n  - Added missing Firebase environment variables\n  - Corrected data type consistency across booking and event systems\n  - Resolved blank page issue by removing auth loading gate\n  - Fixed admin dashboard loading by improving authentication flow\n  - Added fallback user data when database sync fails\n  - Fixed admin authentication to set user data immediately for dond2674@gmail.com\n  - Removed auth loading blocks that prevented access to booking and admin pages\n  - Implemented development authentication bypass to fix booking submission issues\n  - Added fallback authentication for Firebase Admin SDK connection problems\n- **2025-06-26**: Completed full website functionality implementation:\n  - Fixed Firebase duplicate app initialization errors\n  - Implemented proper error handling for auth/unauthorized-domain issues\n  - Fixed booking form AbortError timeouts by removing unnecessary abort controllers\n  - Updated package display to use correct property names (isPopular vs popular)\n  - Added automatic package seeding with Basic/Premium/Deluxe options\n  - Ensured event creation works with PIN generation system\n  - Fixed all TypeScript errors and data type inconsistencies\n  - Verified booking submission saves to Firebase database successfully\n  - Implemented development fallback authentication for domain authorization issues\n  - Resolved Firebase Admin SDK authentication issues using REST API approach\n  - Fixed database save operations - data now persists to Firebase console\n  - Updated admin dashboard to properly load and display booking data from database\n  - Confirmed booking management system displays real Firebase data with proper filtering\n  - Fixed booking accept/reject/delete functionality with proper REST API integration\n  - Added editable amount field for booking management with real-time updates\n  - Implemented user booking history filtering in Profile page\n  - Confirmed all CRUD operations working with Firebase database persistence\n  - **Enhanced booking view dialog**: Created comprehensive popup component with detailed client information, event details, booking information, and prominent accept/decline buttons\n  - **Improved admin booking management**: Large, user-friendly dialog with organized card layout, real-time amount editing, and clear action buttons for pending bookings\n  - **Added status dropdown controls**: Replaced static status badges with interactive dropdowns for quick status changes\n  - **Implemented comprehensive sorting and filtering**: Added clickable column headers for sorting by client, event type, date, status, and amount with visual indicators\n  - **Enhanced search functionality**: Improved search to include client names, event types, emails, and locations with status filtering options\n  - **Created dynamic package management system**: Built comprehensive CRUD operations for photography packages in admin dashboard\n  - **Implemented beautiful sliding package cards**: Added interactive carousel on booking page with smooth animations and visual selection feedback\n  - **Fixed package management page reloads**: Replaced window.location.reload() calls with proper state management to maintain tab position during package operations\n  - **Added complete package API endpoints**: Implemented POST, PATCH, and DELETE routes for full package lifecycle management\n  - **Enhanced package UI/UX**: Added popular badges, selection indicators, responsive design, and hover animations for optimal user experience\n  - **Updated currency display**: Changed all pricing displays from dollars ($) to Indian rupees (₹) throughout the application including packages, bookings, and admin interface\n  - **Secured admin access**: Restricted admin functionality to only dond2674@gmail.com email address by removing development fallback authentication and hardcoded admin privileges from all components\n  - **Implemented complete photo upload system**: Created PhotoUploadDialog component with drag-and-drop functionality, progress tracking, batch uploads, and Firebase storage integration\n  - **Added photo management APIs**: Built comprehensive backend photo upload, retrieval, and deletion endpoints with automatic event photo count updates\n  - **Enhanced event management**: Added photo upload buttons to events table in admin dashboard with real-time photo count updates after uploads\n  - **Simplified admin dashboard interface**: Removed overview and users sections from admin dashboard tabs to streamline the interface, focusing on core business functions (events, bookings, packages, and photo requests)\n  - **Restructured Contact page layout**: Reorganized Contact page with \"Send us a Message\" at the top, \"Contact Details\" in the middle, and \"Get in Touch\" at the bottom for improved user flow and better information hierarchy\n  - **Fixed photo upload functionality**: Resolved file upload issues by implementing proper multer middleware for multipart/form-data handling, added drag-and-drop interface with visual feedback, and verified complete photo upload workflow from frontend to Firebase storage\n  - **Resolved photo upload eventId issue**: Fixed critical bug where events returned from Firebase lacked proper id fields, causing photo uploads to fail with \"undefined\" eventId - updated Firebase storage methods to properly map Firebase keys to id fields for all entity types (events, bookings, etc.)\n- **2025-06-26**: Enhanced admin dashboard event management with comprehensive event details system:\n  - **Created EventDetailsDialog component**: Built comprehensive event management interface with tabbed layout for event details and photo gallery\n  - **Implemented editable event details**: Added in-place editing for all event properties including title, description, date, location, category, privacy settings, and PIN codes\n  - **Added photo gallery with back navigation**: Created full-featured photo gallery viewer with grid layout, hover effects, view/download actions, and proper back navigation\n  - **Enhanced events page with PIN access**: Implemented comprehensive events gallery system showing all events (private and public) with proper access controls - private events require PIN entry, public events use face scanning simulation\n  - **Added admin dashboard refresh button**: Created prominent refresh button in admin header with spinning animation and comprehensive data refresh functionality\n  - **Integrated complete event access workflow**: Connected PIN verification system that checks both public PIN and bride-groom PIN for private event access, with photo gallery display after successful authentication\n- **2025-01-27**: Enhanced booking page photography package selection system:\n  - **Added package selection field to booking form**: Created prominent package dropdown field in booking form with required validation\n  - **Implemented seamless package-to-form integration**: When user selects a package card, it automatically populates the booking form and scrolls to it\n  - **Added two-way package synchronization**: Package selection updates whether chosen from cards or dropdown, maintaining consistency\n  - **Enhanced visual feedback**: Selected packages show green border and success confirmation message in form\n  - **Included package price in booking data**: Booking submission now includes the selected package price (amount field)\n  - **Added package validation**: Form validates that a package is selected before submission with clear error messaging\n- **2025-01-27**: Enhanced event management with comprehensive photo gallery features:\n  - **Fixed event editing functionality**: Auto-enables editing mode when dialog opens for seamless user experience\n  - **Added complete photo management system**: Integrated photo upload, view, download, and delete functionality in event details\n  - **Implemented photo deletion**: Added delete button to each photo with confirmation dialog and loading states\n  - **Enhanced error handling**: Improved error messages and response handling for event updates\n  - **Added photo upload integration**: Embedded PhotoUploadDialog directly in event details gallery tab\n  - **Real-time updates**: Photo count updates automatically after upload/delete operations\n- **2025-01-27**: Fixed event management issues and added thumbnail functionality:\n  - **Fixed event editing**: Removed auto-enable edit mode to resolve edit button functionality\n  - **Added thumbnail selection**: Added \"Set as Thumbnail\" button to each photo in gallery with visual feedback\n  - **Created thumbnail display section**: Added dedicated thumbnail preview in event details with instructions\n  - **Enhanced photo gallery**: Added current thumbnail indicator and better hover effects for photo actions\n  - **Fixed edit button issue**: Resolved conflict between two event detail dialogs - disabled the simple dialog in favor of the comprehensive EventDetailsDialog component\n  - **Added initialEditMode support**: Edit button now directly opens EventDetailsDialog in edit mode without requiring an additional click\n- **2025-01-27**: Implemented complete FindMyFace functionality:\n  - **Created face recognition API endpoints**: Built `/api/face-recognition/find-my-face` and `/api/face-recognition/save-photos` endpoints\n  - **Added webcam capture**: Integrated real-time camera capture with video preview and photo capture functionality\n  - **Implemented photo upload**: Added file upload option with preview for face recognition\n  - **Built photo matching system**: Created demo face matching algorithm returning 30-60% of event photos as matches\n  - **Designed results gallery**: Built comprehensive photo gallery with:\n    - Grid layout with hover effects and match percentage badges\n    - Multi-select functionality with checkboxes\n    - Bulk download and save to profile features\n    - Full-size photo viewer with download option\n  - **Added passcode validation**: Connected event passcode verification using publicPin and brideGroomPin\n  - **Integrated authentication**: Save to profile feature requires user authentication\n  - **Enhanced UX**: Added loading states, error handling, and success notifications throughout the flow\n- **2025-06-30**: Fixed event management and photo handling issues:\n  - **Fixed event editing API endpoint**: Changed server route from PUT to PATCH to match frontend requests, resolving \"Unexpected token '<'\" JSON parse\n- **2025-07-18**: Removed PostgreSQL database dependency:\n  - **Cleaned up PostgreSQL configuration**: Removed unused PostgreSQL database setup from server/db.ts\n  - **Removed PostgreSQL packages**: Uninstalled @neondatabase/serverless, drizzle-orm, connect-pg-simple, and related type definitions\n  - **Kept MongoDB and Firebase**: Maintained existing MongoDB GridFS for photo storage and Firebase Realtime Database for application data\n  - **Streamlined architecture**: Project now uses only Firebase (authentication + database) and MongoDB (photo storage) without PostgreSQL complexity\n  - **Fixed duplicate user issue**: Implemented user deduplication system that removes duplicate user accounts with same Firebase UID\n  - **Enhanced auth sync logic**: Improved user sync process to prevent future duplicates by using Firebase UID as primary identifier\n  - **Added admin deduplication endpoint**: Created `/api/admin/deduplicate-users` endpoint for manual cleanup of duplicate accounts errors\n  - **Increased payload size limits**: Added 50MB limit for JSON and URL-encoded data to handle base64 image uploads without PayloadTooLargeError\n  - **Unified thumbnail upload**: Changed event creation to use file upload instead of URL input, matching the edit functionality\n  - **Fixed photo count accuracy**: Implemented automatic photo count recalculation based on actual photos in database during event fetching\n  - **Added event photos endpoint**: Created GET /api/events/:id/photos endpoint with automatic photo count synchronization\n  - **Enhanced photo upload storage**: Photos are stored as base64 data URLs in Firebase for immediate availability\n- **2025-06-30**: Performance optimizations for event page and admin dashboard:\n  - **Implemented in-memory caching**: Created CacheManager with 30-second TTL to reduce Firebase REST API calls\n  - **Added cache to Firebase REST client**: All GET requests now check cache first, significantly reducing API latency\n  - **Optimized Events page data fetching**: Created lightweight /api/events/all endpoint returning only essential fields\n  - **Parallel data fetching in Admin Dashboard**: Changed sequential API calls to Promise.all for 3-5x faster loading\n  - **Added loading skeletons**: Implemented skeleton loading states on Events page for better perceived performance\n  - **Automatic cache invalidation**: Write operations (PUT, POST, PATCH, DELETE) automatically clear relevant cache entries\n  - **Photo count optimization**: Events now calculate photo counts efficiently without separate API calls\n  - **Enhanced photo count storage**: Added automatic Firebase photo count synchronization - photo counts are now stored and updated directly in Firebase database whenever photos are created or deleted, ensuring data accuracy and eliminating calculation overhead\n- **2025-07-17**: Fixed package deletion functionality in admin dashboard:\n  - Changed DELETE /api/packages/:id endpoint from deactivation (isActive: false) to actual deletion from Firebase database\n  - Added deletePackage method to storage interface for true package removal\n  - Fixed cache invalidation in Firebase REST client DELETE method to clear both item and parent collection cache\n  - Package deletion now removes packages completely from database and admin dashboard reflects changes immediately\n  - Verified deletion works: reduced package count from 14 to 9 packages through successful deletions\n- **2025-06-30**: Implemented differentiated PIN access flows for events:\n  - **Public events**: Direct access to full gallery without PIN or face scan requirement\n  - **Private events with Public PIN**: Requires face recognition after PIN entry - shows only photos matching the uploaded face\n  - **Private events with Bride-Groom PIN**: Direct access to full gallery after PIN entry without face scan\n  - **Updated UI elements**: Added clear indicators for PIN types, updated button text, and improved dialog descriptions to guide users through the appropriate access flow\n- **2025-06-30**: Enhanced FindMyFace section on main page:\n  - **Removed non-functional demo**: Replaced static demo component with working call-to-action button\n  - **Added proper navigation**: Created direct link to actual FindMyFace page (/findmyface) with clear instructions\n  - **Improved user experience**: Users now get directed to the fully functional face recognition system instead of a static demo\n  - **Updated styling**: Enhanced visual design with better gradients and clear action buttons\n- **2025-07-03**: Simplified FindMyFace page to informational content only:\n  - **Removed all interactive functionality**: Eliminated photo upload, camera access, passcode input, and face recognition features\n  - **Streamlined to \"How It Works\"**: Page now shows only the informational content explaining the process\n  - **Added features section**: Displays benefits of AI technology (Lightning Fast, Privacy First, High Accuracy)\n  - **Maintained visual design**: Kept beautiful gradients and modern styling without complex functionality\n  - **Clean user experience**: Informational page explaining the technology without implementation details\n- **2025-07-03**: Changed photo storage from Firebase to server file system:\n  - **Updated multer configuration**: Changed from memory storage to disk storage\n  - **File structure**: Photos stored in `uploads/eventname/photoid` format\n  - **Updated photo upload**: Files saved to disk with unique filenames\n  - **Static file serving**: Added Express static middleware to serve photos from uploads directory\n  - **Database storage**: Store file paths instead of base64 data URLs\n  - **Photo deletion**: Updated to delete physical files from disk when photos are deleted\n  - **Thumbnail handling**: Kept unchanged as requested (using same URL for both photo and thumbnail)\n- **2025-07-03**: Integrated real face recognition system with ArcFace and InsightFace:\n  - **Added Python face recognition service**: Created Flask API running on port 5001 for face processing\n  - **Installed face recognition dependencies**: Added insightface, faiss-cpu, opencv-python, numpy, flask, onnxruntime\n  - **Enhanced Photo schema**: Added faceData field to store face embeddings, bounding boxes, and confidence scores\n  - **Implemented background face processing**: Photos are processed asynchronously after upload to extract face embeddings\n  - **Created face recognition service**: Node.js service that spawns Python process and communicates via HTTP\n  - **Added updatePhoto method**: New storage method to update photos with face data after processing\n  - **Updated face matching endpoint**: Replaced demo implementation with actual face comparison using cosine similarity\n  - **Process flow**: Admin uploads → Background face extraction → Store embeddings → User uploads selfie → Compare embeddings → Return matches\n- **2025-07-23**: Created comprehensive alert message component system:\n  - **Built ConfirmationAlert component**: Created flexible confirmation dialog with multiple variants (destructive, warning, info, success, default)\n  - **Added DeleteConfirmation shortcut**: Pre-configured component for delete operations with red destructive styling\n  - **Added RemoveConfirmation shortcut**: Pre-configured component for reversible remove/unsave actions with amber warning styling\n  - **Implemented icon variants**: Each alert type includes contextual icons (Trash2, AlertTriangle, Info, CheckCircle)\n  - **Enhanced user experience**: Added proper dark mode support, responsive design, and keyboard accessibility\n  - **Created demo page**: Built comprehensive examples page at /alerts route showcasing all variants and usage patterns\n  - **Added practical examples**: Includes real-world scenarios for photo deletion, event management, and user actions\n  - **Enhanced styling**: Uses Tailwind CSS with proper color theming and hover states for professional appearance\n- **2025-07-23**: Implemented comprehensive event URL sharing system:\n  - **Added event URL sharing functionality**: Created /event/:eventId route for direct event access via shareable URLs\n  - **Built EventShareDialog component**: Comprehensive sharing interface with copy/paste and external link options\n  - **Enhanced Events page with share buttons**: Added compact share icon buttons next to Enter PIN/View Gallery buttons on each event card\n  - **Implemented URL generation API**: Created backend endpoint for generating shareable event URLs with proper authentication\n  - **Added share functionality to admin dashboard**: EventDetailsDialog now includes share button for admin users\n  - **Streamlined share dialog**: Removed passcode details from public share dialog, showing only the URL for clean user experience\n  - **Added proper authentication**: All share operations require user authentication with Firebase token verification\n  - **Enhanced UX with tooltips**: Share buttons include helpful tooltips and loading states for better user feedback\n- **2025-07-16**: Implemented MongoDB GridFS for image storage with fallback system:\n  - **Added MongoDB integration**: Installed mongodb package and created MongoDB service for image storage\n  - **Implemented GridFS storage**: Created MongoStorage class with GridFS bucket for efficient image handling\n  - **Built hybrid storage system**: MongoDB GridFS for images with Firebase for metadata, providing best of both worlds\n- **2025-07-17**: Enhanced homepage Recent Events section and navigation:\n  - **Made \"View Events\" button transparent**: Updated hero section button styling to be fully transparent with visible border\n  - **Removed demo data from homepage**: Updated EventsPreview component to fetch real events from database instead of static demo content\n  - **Added public events filtering**: Homepage now shows only public events (private events hidden from public view)\n  - **Implemented seamless navigation**: Added sessionStorage-based navigation from homepage event cards to specific event galleries\n  - **Enhanced user experience**: \"View Event\" buttons now directly open individual event photo galleries in the Events page\n  - **Added loading states**: Comprehensive loading, error, and empty states for Recent Events section\n  - **Automatic event sorting**: Events displayed by most recent date with limit of 3 events on homepage\n  - **Added graceful fallback**: System automatically falls back to local file storage when MongoDB is unavailable\n  - **Updated photo upload workflow**: Images are stored in MongoDB GridFS first, with automatic fallback to file system\n  - **Enhanced image serving**: Created /api/images/:fileId endpoint to serve images directly from GridFS with proper caching\n  - **Improved deletion logic**: Photo deletion now handles both GridFS and local file removal based on storage type\n  - **Optimized performance**: GridFS provides better scalability and performance for large image collections\n  - **Maintained compatibility**: Existing local file storage continues to work seamlessly alongside MongoDB\n  - **Clean logging**: Removed all credential and detailed MongoDB connection logs, keeping only essential error handling\n  - **Removed all debug console logs**: Eliminated all detailed Firebase data logging, package data output, and verbose debug statements throughout the application - server now shows only clean Express request logs without exposing sensitive data or cluttering console output\n- **2025-07-17**: Enhanced photo upload system and face recognition integration:\n  - **Increased file size limits**: Raised multer limit from 10MB to 50MB per file and total payload from 50MB to 100MB to handle larger photo uploads\n  - **Fixed face recognition GridFS integration**: Updated Python Flask service to download images from GridFS via HTTP instead of trying to read file IDs as local paths\n  - **Added requests library**: Installed Python requests package for HTTP communication between face recognition service and main server\n  - **Enhanced GridFS file detection**: Face recognition service now detects GridFS file IDs (24-character hex strings) and downloads images via /api/images endpoint\n  - **Fixed React key warnings**: Updated package selection dropdown to use unique keys combining pkg.id and index to prevent duplicate key warnings\n  - **Improved error handling**: Enhanced batch upload error logging with detailed error messages instead of empty objects\n  - **Fixed JSON serialization**: Converted numpy int64 values to Python native int types to prevent serialization errors in face data\n  - **Verified complete workflow**: Successfully tested face recognition pipeline - GridFS images download correctly, face detection extracts embeddings with 84% confidence, and structured data returns properly with bounding boxes and landmarks\n  - **Optimized face processing workflow**: Face recognition now properly handles both GridFS files and local file paths seamlessly\n- **2025-07-17**: Comprehensive photo gallery performance optimizations:\n  - **Created OptimizedPhotoGallery component**: Built virtualized scrolling gallery with intersection observer for lazy loading, skeleton states, and progressive image loading\n  - **Added AdminPhotoGallery component**: Enhanced admin interface with thumbnail selection, delete functionality, and optimized batch operations\n  - **Implemented image preloading system**: Created utility for batch image preloading, WebP/AVIF format optimization, and performance monitoring\n  - **Enhanced API endpoints**: Added pagination to photo endpoints with lightweight mode, thumbnail support, and optimized caching headers\n  - **Added performance monitoring**: Integrated timing utilities and image optimization with format detection and quality controls\n  - **Improved user experience**: Added loading skeletons, error states, hover animations, and smooth transitions throughout photo galleries\n  - **Optimized server responses**: Enhanced image serving with modern format support, better caching, and compression optimization\n\n## User Preferences\n- Primary authentication method: Google OAuth only (integrated in nav header)\n- Database-driven content (no static/mock data)\n- Modern, clean UI design\n- Secure client/server separation\n- Streamlined UX with minimal authentication steps\n\n## Technical Stack\n- Node.js 20\n- React 18\n- TypeScript\n- Firebase Auth\n- Firebase Realtime Database\n- Express.js\n- Firebase Admin SDK\n- Tailwind CSS\n- Radix UI\n\n## Database Schema\n- Users (Firebase UID integration)\n- Events (photography sessions)\n- Bookings (client reservations)\n- Packages (service offerings)\n- Photos (event images)\n- Contact Messages (client inquiries)\n\n## Current Status\n✅ Migration completed\n✅ Authentication implemented\n✅ Database schema deployed\n✅ API endpoints functional\n✅ Frontend updated for database integration\n✅ Google OAuth authentication active\n✅ Profile page with booking history and settings created\n✅ Admin panel setup for dond2674@gmail.com\n✅ Navigation updated with profile dropdown and logout\n✅ Event creation with dual PIN system working\n✅ Booking submission with international phone codes functional\n✅ Package system with automatic seeding operational\n✅ Firebase Realtime Database fully integrated\n✅ MongoDB GridFS image storage implemented\n✅ Python Flask face recognition service operational\n- **2025-07-18**: Fixed admin dashboard access issue for new admins created by owner:\n  - Added `refreshUserData()` function to AuthContext to refresh user authentication data\n  - Created `AdminStatusNotification` component to detect and notify users of admin status changes\n  - Updated admin user management to call `refreshUserData()` when promoting/demoting users\n  - Enhanced `ProtectedRoute` component to use proper admin access checking via `hasAdminDashboardAccess()` utility\n  - Modified Header component to show admin dashboard link based on actual admin status instead of hardcoded email\n  - Added admin role badges and proper admin status indicators in navigation\n  - Created comprehensive admin utility functions for access control and role management\n  - Fixed authentication middleware to properly fetch latest user data from database\n  - Added automatic notification system when admin privileges are granted or revoked\n  - Enhanced authentication middleware to ensure owner (dond2674@gmail.com) always has admin status\n  - Fixed user management API routes to properly handle admin access and owner protection\n  - Added debugging to requireAdmin middleware to track access issues\n  - **FINAL SOLUTION**: Implemented automatic page refresh when users are promoted to admin to update authentication context\n  - Added periodic authentication refresh every 10 seconds to check for admin status changes\n  - Enhanced sync-user endpoint to return fresh user data with current admin status\n  - Admin dashboard now properly accessible to promoted users after automatic session refresh\n- **2025-07-18**: Comprehensive security improvements - moved all hardcoded secrets to environment variables:\n  - Updated Firebase configuration to use environment variables for all API keys, project IDs, and database URLs\n  - Replaced hardcoded admin email (dond2674@gmail.com) with ADMIN_EMAIL environment variable throughout codebase\n  - Updated MongoDB connection string to use environment variables for credentials and database name\n  - Fixed client-side Firebase configuration to use VITE_ prefixed environment variables\n  - Updated server-side Firebase REST client and admin SDK to use environment variables\n  - Enhanced auth middleware to use configurable admin email from environment\n  - Updated all route handlers to use environment variables for admin privilege checking\n  - Added comprehensive environment variable documentation in .env file with proper categorization\n  - Ensured all hardcoded credentials are now properly externalized for better security practices\n- **2025-07-18**: Enhanced face recognition service with automatic model downloading and dependency management:\n  - **Added automatic model downloading**: Created download_models.py script that downloads InsightFace models before server starts\n  - **Implemented dependency auto-installation**: Face recognition service now automatically installs Python dependencies from requirements.txt\n  - **Enhanced service initialization**: Updated face-recognition-service.ts to handle model downloading and dependency installation before starting Python Flask service\n  - **Added model caching**: Models are downloaded once and cached for subsequent server starts, improving startup performance\n  - **Created deployment build scripts**: Added build.sh and install-python-deps.sh scripts for Render deployment automation\n  - **Improved error handling**: Enhanced error handling for model download failures and dependency installation issues\n  - **Added Python requirements file**: Created server/face-recognition/requirements.txt with all necessary dependencies for face recognition\n  - **Optimized for production**: Face recognition service now properly prepares all dependencies and models before accepting requests\n- **2025-07-19**: Implemented comprehensive role-based access control system for admin dashboard:\n  - **Created three-tier role hierarchy**: Owner (full access), Admin (most features except user management), Moderator (limited core functions)\n  - **Implemented permission-based tab visibility**: Admin dashboard now shows only tabs and features users have permission to access\n  - **Added admin role badges and indicators**: Visual role indicators in dashboard header showing current user's admin level\n  - **Built comprehensive AdminRoleManagement component**: Complete user promotion/demotion system with custom permission management\n  - **Added permission utility functions**: Created adminUtils.ts with hasPermission(), getAdminPermissions(), and role checking functions\n  - **Enhanced quick actions section**: Made permission-aware to show only allowed administrative tasks\n  - **Created API endpoints for role management**: Added promote, demote, and permission update endpoints with owner-only restrictions\n  - **Integrated owner protection**: Owner account cannot be modified or demoted by any other user\n  - **Added permission categories**: Events, bookings, packages, photos, contacts, users_view, users_manage with granular access control\n  - **Enhanced security**: Only owners can promote/demote users and modify admin permissions\n- **2025-07-19**: Fixed comprehensive cache synchronization issues affecting saved photos functionality:\n  - **Resolved Firebase REST cache invalidation**: Fixed cache clearing in update() method to ensure fresh user data retrieval\n  - **Enhanced backend cache management**: Added cache clearing mechanisms in savePhotoToProfile() and getUserSavedPhotos() storage methods\n  - **Implemented HTTP cache control headers**: Added no-cache headers to /api/user/saved-photos endpoint to prevent browser caching\n  - **Fixed React Query cache invalidation**: Events page already had proper queryClient.invalidateQueries implementation\n  - **Added comprehensive debug logging**: Enhanced logging throughout save process to track photo counts and cache states\n  - **Verified cache fix effectiveness**: User saved photos count increased from 3 to 6 photos, demonstrating successful real-time synchronization\n  - **Optimized user sync behavior**: Replaced 10-second polling with smart sync triggers (login, page refresh, tab focus) for better performance\n- **2025-07-19**: Enforced email uniqueness at application level with comprehensive duplicate prevention:\n  - **Removed manual duplicate cleanup functionality**: Eliminated \"Clean Duplicate Users\" button and related endpoints per user preference\n  - **Enhanced findOrCreateUserByEmail method**: Improved email-based user management to prevent duplicates at creation time\n  - **Strengthened createUser validation**: Added email uniqueness checking that throws errors when duplicate emails are attempted\n  - **Updated auth sync workflow**: All user creation now flows through email-based uniqueness validation\n  - **Cleaned up legacy deduplication code**: Removed deduplicateUsers() and cleanupDuplicateUsersByEmail() methods from storage interface\n  - **Simplified admin dashboard**: Removed owner-only cleanup controls in favor of automatic prevention system\n  - **Enhanced error handling**: Clear error messages when duplicate email registration is attempted\n- **2025-07-22**: Optimized save photo functionality with comprehensive performance improvements:\n  - **Enhanced save photo API routes**: Added intelligent caching for user and photo data with 5-10 minute cache TTL\n  - **Implemented performance monitoring**: Response time tracking, cache hit metrics, and optimization statistics\n  - **Added batch save operations**: Optimized for multiple photo saves with reduced database calls\n  - **Smart cache invalidation**: Automatic cache clearing for saved photos when user saves/removes photos\n  - **Performance headers**: Added response time and photo count headers for frontend optimization\n  - **Connection-aware preloading**: Adaptive image loading based on user's network connection speed\n  - **Created SavePhotoOptimizationDemo component**: Real-time performance dashboard showing save times, cache status, and connection info\n  - **Enhanced error handling**: Comprehensive error responses with performance metrics\n  - **Memory optimization**: Smart cache management with LRU eviction and size limits\n- **2025-07-21**: Implemented comprehensive image compression system with lossless display and original quality downloads:\n  - **Fixed fullscreen download inconsistency**: Updated Events.tsx and Profile.tsx fullscreen download buttons to use getDownloadImageUrl() instead of direct URLs, ensuring original quality downloads across all components\n  - **Added Sharp image processing**: Installed Sharp library for server-side image compression and optimization\n  - **Created dual-quality image serving**: Images served at compressed quality for display (400px thumbnails, 800px regular) and original quality for downloads\n  - **Implemented WebP conversion**: Automatic WebP format conversion for browsers that support it, with JPEG fallback\n  - **Enhanced image serving route**: Added quality parameters, thumbnail generation, and download flag support to `/api/images/:fileId` endpoint\n  - **Updated all photo galleries**: OptimizedPhotoGallery, AdminPhotoGallery, and Profile page now use compressed thumbnails for display\n  - **Fixed download functionality**: All download buttons now fetch original quality images while gallery displays use optimized versions\n  - **Added image utility functions**: Created `getDisplayImageUrl()` and `getDownloadImageUrl()` helpers for consistent image optimization across components\n  - **Performance optimizations**: Progressive JPEG encoding, proper caching headers, and format-specific compression settings\n  - **Fixed EXIF orientation issues**: Implemented explicit EXIF orientation handling (orientations 1-8) with proper rotations and flips during both image upload and serving to ensure portrait photos display correctly as portrait, not landscape\n  - **Enhanced thumbnail compression**: Added lossless WebP compression for thumbnails (400px) and high-quality JPEG fallback (95% quality) for maximum visual fidelity in gallery previews\n  - **Original quality downloads**: Download buttons now serve completely unprocessed original files with proper filenames, bypassing all compression and rotation for authentic file delivery\n  - **Bandwidth reduction**: Gallery images now load 60-80% smaller while maintaining visual quality, with full resolution available on-demand\n- **2025-07-22**: Implemented pagination system with 10 photos per page for improved performance:\n  - **Created PaginatedPhotoGallery component**: Built comprehensive pagination system with 10 photos per page display\n  - **Added intelligent pagination controls**: Previous/Next buttons, numbered page selection, and page jumping functionality\n  - **Implemented photo grid layout**: Responsive grid with 2-5 columns based on screen size for optimal viewing\n  - **Enhanced loading states**: Added skeleton loading for each page with proper photo loading indicators\n  - **Updated Events page**: Replaced virtualized gallery with paginated system for better user experience\n  - **Updated Profile page**: Applied pagination to saved photos section with consistent navigation\n  - **Added page information display**: Shows current page position and total photo count for better orientation\n  - **Optimized image loading**: Each page loads only 10 photos with progressive loading and error handling\n  - **Fixed fullscreen responsiveness**: Reduced image quality to 60-65% for display while maintaining download quality\n- **2025-07-22**: Implemented comprehensive client-side rendering performance optimizations:\n  - **Added lazy loading for all pages**: Implemented React.lazy() and Suspense for all pages to reduce initial bundle size\n  - **Created virtualized photo galleries**: Built VirtualizedGallery component for handling large image collections efficiently\n  - **Optimized query client configuration**: Added 5-minute stale time and 10-minute cache time for better performance\n  - **Enhanced image compression**: Reduced thumbnail sizes from 400px to 300px with 60% quality for faster loading\n  - **Reduced server payload limits**: Lowered from 100MB to 25MB for better memory management and faster processing\n  - **Fixed fullscreen preview responsiveness**: Optimized fullscreen image viewer with progressive loading and quality parameters (60-65% quality for display)\n  - **Added performance monitoring**: Created PerformanceMonitor utility for tracking loading times and memory usage\n  - **Implemented connection-aware preloading**: Reduced preload batches and adapted to network connection speed\n  - **Enhanced image lazy loading**: Created useImageLazyLoading hook with intersection observer for better performance\n  - **Added loading skeletons**: Implemented progressive loading with visual feedback for better user experience\n- **2025-07-22**: Enhanced QR-based event access system with streamlined user experience:\n  - **Implemented 24-hour QR expiration**: QR codes generated with expiration timestamp (1 day validity) for enhanced security\n  - **Added QR expiration validation**: QRAccess component validates QR expiration before allowing access, shows clear error message if expired\n  - **Streamlined QR workflow**: QR scan now redirects directly to Events page and immediately opens face recognition dialog\n  - **Removed intermediate QR page**: QRAccess component now validates event and redirects immediately for seamless user experience\n  - **Enhanced Events page auto-scan**: Added autoScan parameter support to automatically trigger face recognition dialog from QR access\n  - **Updated QR generation API**: Server generates QR URLs with expiration timestamps and enhanced security parameters\n  - **Improved loading states**: QRAccess shows clear loading message during validation and redirect process\n- **2025-07-22**: Fixed QR code validation system and enhanced management UI:\n  - **Added QR code status validation**: QR codes now properly validate active status and deletion state before allowing access\n  - **Created QR validation API endpoint**: Added `/api/qr-codes/:qrCodeId/validate` endpoint to check QR code status, expiration, and active state\n  - **Enhanced QR URL generation**: QR codes now include QR code ID in URL for proper validation tracking\n  - **Integrated search in QR creation**: Moved search functionality inside the event selection dropdown with sticky search bar\n  - **Improved event selection UX**: Streamlined QR creation dialog with integrated search, event count display, and enhanced layout\n  - **Fixed deactivated QR access**: Deactivated or deleted QR codes now properly reject access with appropriate error messages\n  - **Added authentication to QR management**: All QR code operations now use proper Firebase authentication headers\n- **2025-07-23**: Added new \"QR Share\" role to role-based access control system:\n  - **Created QR Share role**: New admin role with limited permissions focused on QR code management and event viewing\n  - **Updated role hierarchy**: Added \"qr_share\" to admin role types with purple badge styling (📱 QR Share)\n  - **Defined QR Share permissions**: Role has access to events_view and qr_codes permissions only\n  - **Enhanced admin utilities**: Updated permission checking to allow QR Share users to access Events tab (read-only) and QR Codes tab\n  - **Updated role management UI**: Added QR Share option to admin promotion dialog with appropriate description\n  - **Integrated with existing system**: QR Share role works seamlessly with current admin dashboard tab visibility and permission system\n- **2025-07-18**: Implemented comprehensive \"Save to Profile\" feature for photo management:\n  - **Added savedPhotos field to User schema**: Extended User type with savedPhotos array to store photo IDs without image duplication\n  - **Created photo management API endpoints**: Built `/api/user/save-photo`, `/api/user/remove-photo`, and `/api/user/saved-photos` endpoints\n  - **Enhanced OptimizedPhotoGallery component**: Added save/remove photo buttons with heart icons, loading states, and authentication checks\n  - **Updated Events page with save functionality**: Face recognition results now include save/remove photo buttons for authenticated users\n  - **Added Profile page saved photos section**: Users can view all their saved photos with proper empty states and messaging\n  - **Implemented photo ID storage system**: Photos are referenced by ID rather than duplicated, ensuring efficient storage and preventing data redundancy\n  - **Added comprehensive error handling**: Toast notifications for save/remove operations with proper authentication requirements\n  - **Enhanced user experience**: Visual feedback with heart icons (filled for saved, outlined for unsaved) and loading spinners during operations\n  - **Fixed saved photos cache synchronization**: Resolved React Query caching issues to ensure Profile page shows all saved photos immediately\n  - **Implemented comprehensive duplicate prevention**: Added frontend and backend checks to prevent duplicate photo saves with specific user feedback\n  - **Enhanced save photo API responses**: Backend now returns detailed status about duplicate attempts vs new saves for better user experience\n✅ Complete photo upload and face processing workflow functional\n✅ FindMyFace feature working with real facial embeddings\n✅ Save to Profile feature implemented with photo ID storage system\n✅ Role-based access control system implemented\n✅ All major functionality verified and working\n\n## Development Notes\n- Firebase authentication configured with project faceai-799e4\n- Admin access granted to dond2674@gmail.com (automatic on login)\n- Google OAuth fully functional with Firebase backend","size_bytes":55128},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2787},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n});\n","size_bytes":894},"attached_assets/app_1751515490684.py":{"content":"\"\"\"\nFlask web application for face recognition system.\n\"\"\"\nimport os\nimport shutil\nfrom flask import Flask, render_template, request, jsonify, send_file\nfrom werkzeug.utils import secure_filename\nimport tempfile\nfrom pathlib import Path\n\n# Import our face recognition system\nfrom main import FaceRecognitionSystem\n\napp = Flask(__name__)\napp.config['MAX_CONTENT_LENGTH'] = 500 * 1024 * 1024  # 500MB max file size\napp.config['UPLOAD_FOLDER'] = 'uploads'\napp.config['MAX_CONTENT_PATH'] = None\n\n# Create upload folder if it doesn't exist\nos.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)\nos.makedirs(os.path.join(app.config['UPLOAD_FOLDER'], 'events'), exist_ok=True)\nos.makedirs(os.path.join(app.config['UPLOAD_FOLDER'], 'results'), exist_ok=True)\n\n# Allowed file extensions\nALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif', 'bmp'}\n\ndef allowed_file(filename):\n    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS\n\n@app.route('/')\ndef index():\n    \"\"\"Render the main page.\"\"\"\n    return render_template('index.html')\n\n@app.route('/upload', methods=['POST'])\ndef upload_files():\n    \"\"\"Handle file uploads and process face recognition.\"\"\"\n    try:\n        # Check if files were uploaded\n        if 'eventPhotos' not in request.files or 'selfie' not in request.files:\n            return jsonify({'error': 'Missing files'}), 400\n        \n        event_photos = request.files.getlist('eventPhotos')\n        selfie = request.files['selfie']\n        \n        # Validate selfie\n        if selfie.filename == '':\n            return jsonify({'error': 'No selfie selected'}), 400\n        \n        if not allowed_file(selfie.filename):\n            return jsonify({'error': 'Invalid selfie file type'}), 400\n        \n        # Create temporary directory for this session\n        session_id = tempfile.mktemp().split('/')[-1]\n        session_dir = os.path.join(app.config['UPLOAD_FOLDER'], 'events', session_id)\n        os.makedirs(session_dir, exist_ok=True)\n        \n        # Save selfie\n        selfie_filename = secure_filename(selfie.filename)\n        selfie_path = os.path.join(app.config['UPLOAD_FOLDER'], f'selfie_{session_id}.jpg')\n        selfie.save(selfie_path)\n        \n        # Save event photos\n        saved_photos = []\n        for photo in event_photos:\n            if photo and allowed_file(photo.filename):\n                filename = secure_filename(photo.filename)\n                filepath = os.path.join(session_dir, filename)\n                photo.save(filepath)\n                saved_photos.append(filename)\n        \n        if not saved_photos:\n            return jsonify({'error': 'No valid event photos uploaded'}), 400\n        \n        # Initialize face recognition system\n        print(\"Initializing face recognition system...\")\n        system = FaceRecognitionSystem()\n        \n        # Process event photos\n        print(f\"Processing {len(saved_photos)} event photos...\")\n        faces_found = system.load_images_from_folder(session_dir)\n        \n        if faces_found == 0:\n            # Clean up\n            shutil.rmtree(session_dir)\n            os.remove(selfie_path)\n            return jsonify({\n                'matches': [],\n                'message': 'No faces detected in the event photos'\n            })\n        \n        # Find matches\n        print(\"Finding matches...\")\n        matches = system.find_matches(selfie_path, max_matches=100, threshold=0.4)\n        \n        # Prepare results\n        results = []\n        for match in matches:\n            filename = os.path.basename(match['image_path'])\n            results.append({\n                'filename': filename,\n                'similarity': round(match['similarity'], 3),\n                'url': f'/image/{session_id}/{filename}'\n            })\n        \n        # Clean up\n        system.cleanup()\n        os.remove(selfie_path)\n        \n        return jsonify({\n            'matches': results,\n            'totalPhotos': len(saved_photos),\n            'facesFound': faces_found,\n            'sessionId': session_id\n        })\n        \n    except Exception as e:\n        print(f\"Error: {str(e)}\")\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/image/<session_id>/<filename>')\ndef serve_image(session_id, filename):\n    \"\"\"Serve an uploaded image.\"\"\"\n    filepath = os.path.join(app.config['UPLOAD_FOLDER'], 'events', session_id, filename)\n    if os.path.exists(filepath):\n        return send_file(filepath)\n    return \"Image not found\", 404\n\n@app.route('/cleanup/<session_id>', methods=['POST'])\ndef cleanup_session(session_id):\n    \"\"\"Clean up session files.\"\"\"\n    session_dir = os.path.join(app.config['UPLOAD_FOLDER'], 'events', session_id)\n    if os.path.exists(session_dir):\n        shutil.rmtree(session_dir)\n    return jsonify({'status': 'cleaned'})\n\n@app.errorhandler(413)\ndef request_entity_too_large(error):\n    \"\"\"Handle file too large error.\"\"\"\n    return jsonify({'error': 'File too large. Maximum total upload size is 500MB.'}), 413\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000, debug=True)","size_bytes":5068},"attached_assets/config_1751515490689.py":{"content":"\"\"\"\nConfiguration settings for the face recognition system.\n\"\"\"\n\nimport os\n\n# Model configuration\nARCFACE_MODEL_NAME = 'buffalo_l'\nEMBEDDING_DIMENSION = 512  # buffalo_l produces 512-dimensional embeddings\nSIMILARITY_THRESHOLD = 0.6  # Minimum similarity score for matches\n\n# GPU configuration\nFORCE_CPU = os.getenv(\"FORCE_CPU\", \"false\").lower() == \"true\"\nGPU_DEVICE_ID = int(os.getenv(\"GPU_DEVICE_ID\", \"0\"))\n\n# Processing configuration\nBATCH_SIZE = 32  # Images to process in a single batch\nMAX_IMAGE_SIZE = 1024  # Maximum image dimension for processing\nMIN_FACE_SIZE = 50  # Minimum face size for detection\n\n# File handling\nSUPPORTED_IMAGE_FORMATS = ['.jpg', '.jpeg', '.png', '.bmp', '.tiff', '.webp']\nMAX_IMAGES_TO_PROCESS = 1000\n\n# Logging configuration\nLOG_LEVEL = os.getenv(\"LOG_LEVEL\", \"INFO\")\nSHOW_PROGRESS = True\n","size_bytes":823},"attached_assets/database_1751515490687.py":{"content":"\"\"\"\nIn-memory database for storing face embeddings and metadata.\n\"\"\"\n\nimport numpy as np\nfrom typing import List, Dict, Optional, Tuple\nimport logging\nfrom dataclasses import dataclass\nfrom datetime import datetime\n\nlogger = logging.getLogger(__name__)\n\n@dataclass\nclass FaceRecord:\n    \"\"\"Data class for storing face information.\"\"\"\n    id: int\n    image_path: str\n    embedding: np.ndarray\n    face_bbox: Tuple[int, int, int, int]  # x, y, width, height\n    confidence: float\n    timestamp: datetime\n    \n    def to_dict(self) -> Dict:\n        \"\"\"Convert to dictionary representation.\"\"\"\n        return {\n            'id': self.id,\n            'image_path': self.image_path,\n            'embedding_shape': self.embedding.shape,\n            'face_bbox': self.face_bbox,\n            'confidence': self.confidence,\n            'timestamp': self.timestamp.isoformat()\n        }\n\nclass FaceDatabase:\n    \"\"\"In-memory database for face embeddings and metadata.\"\"\"\n    \n    def __init__(self):\n        \"\"\"Initialize the database.\"\"\"\n        self.records: List[FaceRecord] = []\n        self.next_id = 1\n        self._embedding_matrix: Optional[np.ndarray] = None\n        self._needs_rebuild = True\n        \n        logger.info(\"Initialized face database\")\n    \n    def add_face(self, image_path: str, embedding: np.ndarray, \n                 face_bbox: Tuple[int, int, int, int], confidence: float) -> int:\n        \"\"\"\n        Add a face record to the database.\n        \n        Args:\n            image_path: Path to the source image\n            embedding: Face embedding vector\n            face_bbox: Bounding box coordinates (x, y, width, height)\n            confidence: Detection confidence score\n            \n        Returns:\n            Record ID\n        \"\"\"\n        record = FaceRecord(\n            id=self.next_id,\n            image_path=image_path,\n            embedding=embedding.copy(),\n            face_bbox=face_bbox,\n            confidence=confidence,\n            timestamp=datetime.now()\n        )\n        \n        self.records.append(record)\n        self.next_id += 1\n        self._needs_rebuild = True\n        \n        logger.debug(f\"Added face record {record.id} for {image_path}\")\n        return record.id\n    \n    def get_record(self, record_id: int) -> Optional[FaceRecord]:\n        \"\"\"\n        Get a record by ID.\n        \n        Args:\n            record_id: Record ID to retrieve\n            \n        Returns:\n            FaceRecord or None if not found\n        \"\"\"\n        for record in self.records:\n            if record.id == record_id:\n                return record\n        return None\n    \n    def get_all_embeddings(self) -> np.ndarray:\n        \"\"\"\n        Get all embeddings as a matrix.\n        \n        Returns:\n            Matrix of embeddings (n_records x embedding_dim)\n        \"\"\"\n        if not self.records:\n            return np.array([]).reshape(0, 512)  # Empty array with correct shape\n        \n        if self._needs_rebuild or self._embedding_matrix is None:\n            embeddings = [record.embedding for record in self.records]\n            self._embedding_matrix = np.vstack(embeddings)\n            self._needs_rebuild = False\n            logger.debug(f\"Rebuilt embedding matrix: {self._embedding_matrix.shape}\")\n        \n        return self._embedding_matrix\n    \n    def get_image_paths(self) -> List[str]:\n        \"\"\"\n        Get all image paths in order.\n        \n        Returns:\n            List of image paths\n        \"\"\"\n        return [record.image_path for record in self.records]\n    \n    def clear(self):\n        \"\"\"Clear all records from the database.\"\"\"\n        self.records.clear()\n        self.next_id = 1\n        self._embedding_matrix = None\n        self._needs_rebuild = True\n        logger.info(\"Cleared face database\")\n    \n    def size(self) -> int:\n        \"\"\"Get the number of records in the database.\"\"\"\n        return len(self.records)\n    \n    def get_statistics(self) -> Dict:\n        \"\"\"\n        Get database statistics.\n        \n        Returns:\n            Dictionary with statistics\n        \"\"\"\n        if not self.records:\n            return {\n                'total_records': 0,\n                'unique_images': 0,\n                'avg_confidence': 0.0,\n                'embedding_dimension': 0\n            }\n        \n        unique_images = len(set(record.image_path for record in self.records))\n        avg_confidence = np.mean([record.confidence for record in self.records])\n        embedding_dim = self.records[0].embedding.shape[0] if self.records else 0\n        \n        return {\n            'total_records': len(self.records),\n            'unique_images': unique_images,\n            'avg_confidence': float(avg_confidence),\n            'embedding_dimension': embedding_dim\n        }\n    \n    def print_summary(self):\n        \"\"\"Print a summary of the database contents.\"\"\"\n        stats = self.get_statistics()\n        \n        print(\"\\n\" + \"=\"*50)\n        print(\"FACE DATABASE SUMMARY\")\n        print(\"=\"*50)\n        print(f\"Total Records: {stats['total_records']}\")\n        print(f\"Unique Images: {stats['unique_images']}\")\n        print(f\"Average Confidence: {stats['avg_confidence']:.3f}\")\n        print(f\"Embedding Dimension: {stats['embedding_dimension']}\")\n        \n        if self.records:\n            print(f\"\\nRecent Records:\")\n            for record in self.records[-3:]:  # Show last 3 records\n                filename = record.image_path.split('/')[-1]\n                print(f\"  ID {record.id}: {filename} (conf: {record.confidence:.3f})\")\n        \n        print(\"=\"*50)\n","size_bytes":5566},"attached_assets/face_processor_1751515490690.py":{"content":"\"\"\"\nFace processing module using InsightFace and ArcFace embeddings.\n\"\"\"\n\nimport numpy as np\nimport cv2\nfrom typing import List, Tuple, Optional, Dict\nimport logging\nimport os\nfrom config import (\n    ARCFACE_MODEL_NAME, FORCE_CPU, GPU_DEVICE_ID, \n    MIN_FACE_SIZE, BATCH_SIZE\n)\nfrom utils import check_gpu_availability\n\nlogger = logging.getLogger(__name__)\n\nclass FaceProcessor:\n    \"\"\"Face detection and embedding extraction using InsightFace.\"\"\"\n    \n    def __init__(self):\n        \"\"\"Initialize the face processor.\"\"\"\n        self.app = None\n        self.model_loaded = False\n        self.using_gpu = False\n        self._initialize_model()\n    \n    def _initialize_model(self):\n        \"\"\"Initialize the InsightFace model.\"\"\"\n        try:\n            import insightface\n            \n            # Check GPU availability\n            gpu_available, gpu_info = check_gpu_availability()\n            \n            # Determine which context to use\n            if FORCE_CPU or not gpu_available:\n                ctx_id = -1  # CPU\n                device_info = \"CPU (forced)\" if FORCE_CPU else f\"CPU (fallback: {gpu_info})\"\n                self.using_gpu = False\n            else:\n                ctx_id = GPU_DEVICE_ID  # GPU\n                device_info = f\"GPU {GPU_DEVICE_ID}\"\n                self.using_gpu = True\n            \n            logger.info(f\"Initializing InsightFace model on {device_info}\")\n            \n            # Initialize the face analysis app\n            self.app = insightface.app.FaceAnalysis(\n                name=ARCFACE_MODEL_NAME,\n                providers=['CUDAExecutionProvider', 'CPUExecutionProvider'] if self.using_gpu else ['CPUExecutionProvider']\n            )\n            \n            # Prepare the model with context\n            self.app.prepare(ctx_id=ctx_id, det_size=(640, 640))\n            \n            self.model_loaded = True\n            logger.info(f\"Successfully initialized {ARCFACE_MODEL_NAME} model on {device_info}\")\n            \n        except ImportError as e:\n            logger.error(f\"InsightFace not available: {str(e)}\")\n            raise RuntimeError(\"InsightFace library is required but not installed\")\n        except Exception as e:\n            logger.error(f\"Failed to initialize face model: {str(e)}\")\n            raise RuntimeError(f\"Model initialization failed: {str(e)}\")\n    \n    def detect_faces(self, image: np.ndarray) -> List[Dict]:\n        \"\"\"\n        Detect faces in an image.\n        \n        Args:\n            image: Input image in RGB format\n            \n        Returns:\n            List of face detection results\n        \"\"\"\n        if not self.model_loaded:\n            raise RuntimeError(\"Face model not loaded\")\n        \n        try:\n            # Detect faces\n            faces = self.app.get(image)\n            \n            # Filter faces by minimum size\n            valid_faces = []\n            for face in faces:\n                bbox = face.bbox.astype(int)\n                width = bbox[2] - bbox[0]\n                height = bbox[3] - bbox[1]\n                \n                if width >= MIN_FACE_SIZE and height >= MIN_FACE_SIZE:\n                    face_info = {\n                        'bbox': (bbox[0], bbox[1], width, height),\n                        'confidence': float(face.det_score),\n                        'embedding': face.embedding,\n                        'landmarks': face.kps if hasattr(face, 'kps') else None\n                    }\n                    valid_faces.append(face_info)\n                else:\n                    logger.debug(f\"Filtered out small face: {width}x{height}\")\n            \n            return valid_faces\n            \n        except Exception as e:\n            logger.error(f\"Face detection failed: {str(e)}\")\n            return []\n    \n    def extract_embedding(self, image: np.ndarray) -> Optional[np.ndarray]:\n        \"\"\"\n        Extract face embedding from an image containing a single face.\n        \n        Args:\n            image: Input image in RGB format\n            \n        Returns:\n            Face embedding vector or None if no face found\n        \"\"\"\n        faces = self.detect_faces(image)\n        \n        if not faces:\n            return None\n        \n        if len(faces) > 1:\n            logger.warning(f\"Multiple faces detected, using the largest one\")\n            # Select the face with largest area\n            faces.sort(key=lambda x: x['bbox'][2] * x['bbox'][3], reverse=True)\n        \n        return faces[0]['embedding']\n    \n    def process_image(self, image_path: str) -> List[Dict]:\n        \"\"\"\n        Process a single image and extract face information.\n        \n        Args:\n            image_path: Path to the image file\n            \n        Returns:\n            List of face information dictionaries\n        \"\"\"\n        from utils import load_and_preprocess_image\n        \n        # Load and preprocess image\n        image = load_and_preprocess_image(image_path)\n        if image is None:\n            logger.warning(f\"Could not load image: {image_path}\")\n            return []\n        \n        # Detect faces\n        faces = self.detect_faces(image)\n        \n        # Add image path to each face info\n        for face in faces:\n            face['image_path'] = image_path\n        \n        logger.debug(f\"Processed {image_path}: found {len(faces)} faces\")\n        return faces\n    \n    def process_batch(self, image_paths: List[str]) -> List[Dict]:\n        \"\"\"\n        Process a batch of images efficiently.\n        \n        Args:\n            image_paths: List of image file paths\n            \n        Returns:\n            List of all face information dictionaries\n        \"\"\"\n        all_faces = []\n        \n        logger.info(f\"Processing batch of {len(image_paths)} images\")\n        \n        for i, image_path in enumerate(image_paths):\n            if i % 10 == 0:  # Log progress every 10 images\n                logger.info(f\"Processing image {i+1}/{len(image_paths)}\")\n            \n            faces = self.process_image(image_path)\n            all_faces.extend(faces)\n        \n        logger.info(f\"Batch processing complete: {len(all_faces)} faces found in {len(image_paths)} images\")\n        return all_faces\n    \n    def get_model_info(self) -> Dict:\n        \"\"\"\n        Get information about the loaded model.\n        \n        Returns:\n            Dictionary with model information\n        \"\"\"\n        return {\n            'model_name': ARCFACE_MODEL_NAME,\n            'model_loaded': self.model_loaded,\n            'using_gpu': self.using_gpu,\n            'gpu_device_id': GPU_DEVICE_ID if self.using_gpu else None,\n            'embedding_dimension': 512  # buffalo_l produces 512-dim embeddings\n        }\n    \n    def cleanup(self):\n        \"\"\"Clean up resources.\"\"\"\n        if self.app is not None:\n            # InsightFace doesn't have explicit cleanup, but we can clear the reference\n            self.app = None\n            self.model_loaded = False\n            logger.info(\"Face processor cleaned up\")\n","size_bytes":6979},"attached_assets/main_1751515490692.py":{"content":"#!/usr/bin/env python3\n\"\"\"\nGPU-accelerated Python face recognition script using ArcFace embeddings and FAISS-GPU.\n\nThis script provides batch processing of face images, efficient similarity matching,\nand GPU acceleration with automatic CPU fallback.\n\"\"\"\n\nimport os\nimport sys\nimport argparse\nimport time\nfrom typing import List, Dict, Optional\nimport logging\n\n# Import our modules\nfrom config import (\n    SIMILARITY_THRESHOLD, MAX_IMAGES_TO_PROCESS, SHOW_PROGRESS,\n    EMBEDDING_DIMENSION\n)\nfrom utils import (\n    setup_logging, get_image_files, load_and_preprocess_image,\n    print_system_info, create_progress_bar\n)\nfrom database import FaceDatabase\nfrom face_processor import FaceProcessor\nfrom similarity_matcher import SimilarityMatcher\n\nlogger = logging.getLogger(__name__)\n\nclass FaceRecognitionSystem:\n    \"\"\"Main face recognition system orchestrating all components.\"\"\"\n    \n    def __init__(self):\n        \"\"\"Initialize the face recognition system.\"\"\"\n        self.database = FaceDatabase()\n        self.face_processor = None\n        self.similarity_matcher = None\n        self._initialized = False\n    \n    def initialize(self):\n        \"\"\"Initialize all system components.\"\"\"\n        if self._initialized:\n            return\n        \n        logger.info(\"Initializing Face Recognition System...\")\n        \n        try:\n            # Initialize face processor\n            print(\"🔄 Initializing face detection and embedding extraction...\")\n            self.face_processor = FaceProcessor()\n            \n            # Initialize similarity matcher\n            print(\"🔄 Initializing similarity matching system...\")\n            self.similarity_matcher = SimilarityMatcher(EMBEDDING_DIMENSION)\n            \n            self._initialized = True\n            logger.info(\"System initialization complete\")\n            \n            # Print system information\n            self._print_initialization_summary()\n            \n        except Exception as e:\n            logger.error(f\"System initialization failed: {str(e)}\")\n            raise RuntimeError(f\"Failed to initialize system: {str(e)}\")\n    \n    def _print_initialization_summary(self):\n        \"\"\"Print system initialization summary.\"\"\"\n        face_info = self.face_processor.get_model_info()\n        matcher_info = self.similarity_matcher.get_index_info()\n        \n        print(\"\\n\" + \"=\"*60)\n        print(\"🚀 SYSTEM INITIALIZATION COMPLETE\")\n        print(\"=\"*60)\n        print(f\"Face Model: {face_info['model_name']}\")\n        print(f\"Face Processing: {'GPU' if face_info['using_gpu'] else 'CPU'}\")\n        print(f\"Similarity Matching: {'GPU' if matcher_info['using_gpu'] else 'CPU'}\")\n        print(f\"Embedding Dimension: {face_info['embedding_dimension']}\")\n        print(f\"Similarity Threshold: {SIMILARITY_THRESHOLD}\")\n        print(\"=\"*60)\n    \n    def load_images_from_folder(self, folder_path: str, max_images: int = None) -> int:\n        \"\"\"\n        Load and process all images from a folder.\n        \n        Args:\n            folder_path: Path to folder containing images\n            max_images: Maximum number of images to process\n            \n        Returns:\n            Number of faces added to database\n        \"\"\"\n        if not self._initialized:\n            self.initialize()\n        \n        # Get image files\n        image_files = get_image_files(folder_path)\n        if not image_files:\n            print(f\"❌ No supported image files found in {folder_path}\")\n            return 0\n        \n        # Limit number of images if specified\n        if max_images:\n            image_files = image_files[:max_images]\n        \n        # Limit to maximum allowed\n        if len(image_files) > MAX_IMAGES_TO_PROCESS:\n            logger.warning(f\"Limiting to {MAX_IMAGES_TO_PROCESS} images (found {len(image_files)})\")\n            image_files = image_files[:MAX_IMAGES_TO_PROCESS]\n        \n        print(f\"\\n📁 Processing {len(image_files)} images from {folder_path}\")\n        \n        # Process images\n        total_faces = 0\n        processed_images = 0\n        start_time = time.time()\n        \n        for i, image_path in enumerate(image_files):\n            try:\n                # Show progress\n                if SHOW_PROGRESS and (i % 10 == 0 or i == len(image_files) - 1):\n                    progress = create_progress_bar(i + 1, len(image_files), \"Processing\")\n                    print(f\"\\r{progress}\", end=\"\", flush=True)\n                \n                # Process image\n                faces = self.face_processor.process_image(image_path)\n                \n                # Add faces to database\n                for face in faces:\n                    self.database.add_face(\n                        image_path=face['image_path'],\n                        embedding=face['embedding'],\n                        face_bbox=face['bbox'],\n                        confidence=face['confidence']\n                    )\n                    total_faces += 1\n                \n                processed_images += 1\n                \n            except Exception as e:\n                logger.error(f\"Error processing {image_path}: {str(e)}\")\n                continue\n        \n        if SHOW_PROGRESS:\n            print()  # New line after progress bar\n        \n        # Update similarity matcher with all embeddings\n        if total_faces > 0:\n            print(\"🔄 Building similarity search index...\")\n            embeddings = self.database.get_all_embeddings()\n            self.similarity_matcher.add_embeddings(embeddings)\n        \n        # Print summary\n        elapsed_time = time.time() - start_time\n        print(f\"\\n✅ Processing complete!\")\n        print(f\"   📊 Processed: {processed_images}/{len(image_files)} images\")\n        print(f\"   👥 Found: {total_faces} faces\")\n        print(f\"   ⏱️  Time: {elapsed_time:.2f} seconds\")\n        print(f\"   🚀 Speed: {processed_images/elapsed_time:.1f} images/sec\")\n        \n        return total_faces\n    \n    def find_matches(self, selfie_path: str, max_matches: int = 10, \n                    threshold: float = None) -> List[Dict]:\n        \"\"\"\n        Find matching faces for a selfie image.\n        \n        Args:\n            selfie_path: Path to the selfie image\n            max_matches: Maximum number of matches to return\n            threshold: Similarity threshold (uses config default if None)\n            \n        Returns:\n            List of matching results\n        \"\"\"\n        if not self._initialized:\n            raise RuntimeError(\"System not initialized\")\n        \n        if self.database.size() == 0:\n            print(\"❌ No faces in database. Load images first.\")\n            return []\n        \n        print(f\"\\n🔍 Searching for matches for: {selfie_path}\")\n        \n        # Load and process selfie\n        image = load_and_preprocess_image(selfie_path)\n        if image is None:\n            print(f\"❌ Could not load selfie image: {selfie_path}\")\n            return []\n        \n        # Extract embedding\n        embedding = self.face_processor.extract_embedding(image)\n        if embedding is None:\n            print(f\"❌ No face detected in selfie: {selfie_path}\")\n            return []\n        \n        print(f\"✅ Face detected in selfie\")\n        \n        # Find matches\n        image_paths = self.database.get_image_paths()\n        matches = self.similarity_matcher.find_matches(\n            query_embedding=embedding,\n            image_paths=image_paths,\n            k=max_matches,\n            threshold=threshold or SIMILARITY_THRESHOLD\n        )\n        \n        # Print results\n        if matches:\n            print(f\"\\n🎯 Found {len(matches)} matches:\")\n            print(\"-\" * 80)\n            for i, match in enumerate(matches, 1):\n                filename = os.path.basename(match['image_path'])\n                print(f\"{i:2d}. {filename:<40} (similarity: {match['similarity']:.3f})\")\n            print(\"-\" * 80)\n        else:\n            print(f\"❌ No matches found above threshold {threshold or SIMILARITY_THRESHOLD}\")\n        \n        return matches\n    \n    def print_database_summary(self):\n        \"\"\"Print database summary.\"\"\"\n        self.database.print_summary()\n    \n    def cleanup(self):\n        \"\"\"Clean up system resources.\"\"\"\n        if self.face_processor:\n            self.face_processor.cleanup()\n        if self.similarity_matcher:\n            self.similarity_matcher.cleanup()\n        logger.info(\"System cleanup complete\")\n\ndef main():\n    \"\"\"Main function.\"\"\"\n    # Setup logging\n    setup_logging()\n    \n    # Parse command line arguments\n    parser = argparse.ArgumentParser(\n        description=\"GPU-accelerated face recognition using ArcFace and FAISS\",\n        formatter_class=argparse.RawDescriptionHelpFormatter,\n        epilog=\"\"\"\nExamples:\n  python main.py --folder ./photos --selfie ./my_selfie.jpg\n  python main.py --folder ./event_photos --selfie ./query.jpg --max-matches 20\n  python main.py --folder ./images --selfie ./face.jpg --threshold 0.7\n        \"\"\"\n    )\n    \n    parser.add_argument('--folder', type=str,\n                       help='Folder containing images to process')\n    parser.add_argument('--selfie', type=str,\n                       help='Path to selfie image for matching')\n    parser.add_argument('--max-images', type=int, default=None,\n                       help='Maximum number of images to process from folder')\n    parser.add_argument('--max-matches', type=int, default=10,\n                       help='Maximum number of matches to return')\n    parser.add_argument('--threshold', type=float, default=None,\n                       help=f'Similarity threshold (default: {SIMILARITY_THRESHOLD})')\n    parser.add_argument('--system-info', action='store_true',\n                       help='Print system information and exit')\n    \n    args = parser.parse_args()\n    \n    # Print system info if requested\n    if args.system_info:\n        print_system_info()\n        return\n    \n    # Validate required inputs for normal operation\n    if not args.folder or not args.selfie:\n        parser.error(\"--folder and --selfie are required unless using --system-info\")\n    \n    # Validate inputs exist\n    if not os.path.exists(args.folder):\n        print(f\"❌ Folder does not exist: {args.folder}\")\n        sys.exit(1)\n    \n    if not os.path.exists(args.selfie):\n        print(f\"❌ Selfie file does not exist: {args.selfie}\")\n        sys.exit(1)\n    \n    # Initialize system\n    system = FaceRecognitionSystem()\n    \n    try:\n        # Print welcome message\n        print(\"🎭 GPU-Accelerated Face Recognition System\")\n        print(\"   Using ArcFace embeddings and FAISS similarity search\")\n        print()\n        \n        # Load and process images\n        faces_found = system.load_images_from_folder(\n            args.folder, \n            max_images=args.max_images\n        )\n        \n        if faces_found == 0:\n            print(\"❌ No faces found in the provided images\")\n            sys.exit(1)\n        \n        # Print database summary\n        system.print_database_summary()\n        \n        # Find matches for selfie\n        matches = system.find_matches(\n            args.selfie,\n            max_matches=args.max_matches,\n            threshold=args.threshold\n        )\n        \n        # Print final summary\n        print(f\"\\n🏁 Search complete: {len(matches)} matches found\")\n        \n    except KeyboardInterrupt:\n        print(\"\\n⚠️  Operation cancelled by user\")\n        sys.exit(1)\n    except Exception as e:\n        logger.error(f\"System error: {str(e)}\")\n        print(f\"❌ Error: {str(e)}\")\n        sys.exit(1)\n    finally:\n        system.cleanup()\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":11664},"attached_assets/similarity_matcher_1751515490694.py":{"content":"\"\"\"\nSimilarity matching using FAISS for efficient vector search.\n\"\"\"\n\nimport numpy as np\nfrom typing import List, Tuple, Optional, Dict\nimport logging\nfrom config import SIMILARITY_THRESHOLD, FORCE_CPU, GPU_DEVICE_ID\nfrom utils import check_gpu_availability\n\nlogger = logging.getLogger(__name__)\n\nclass SimilarityMatcher:\n    \"\"\"FAISS-based similarity matcher for face embeddings.\"\"\"\n    \n    def __init__(self, embedding_dimension: int = 512):\n        \"\"\"\n        Initialize the similarity matcher.\n        \n        Args:\n            embedding_dimension: Dimension of the embedding vectors\n        \"\"\"\n        self.embedding_dimension = embedding_dimension\n        self.index = None\n        self.using_gpu = False\n        self.gpu_resources = None\n        self._initialize_faiss()\n    \n    def _initialize_faiss(self):\n        \"\"\"Initialize FAISS index with GPU support if available.\"\"\"\n        try:\n            import faiss\n            \n            # Check GPU availability and FAISS GPU support\n            gpu_available, gpu_info = check_gpu_availability()\n            has_gpu_support = hasattr(faiss, 'StandardGpuResources')\n            \n            # Determine which device to use\n            if FORCE_CPU or not gpu_available or not has_gpu_support:\n                self._initialize_cpu_index(faiss)\n                if FORCE_CPU:\n                    device_info = \"CPU (forced)\"\n                elif not gpu_available:\n                    device_info = f\"CPU (no GPU: {gpu_info})\"\n                else:\n                    device_info = \"CPU (FAISS-GPU not available)\"\n            else:\n                try:\n                    self._initialize_gpu_index(faiss)\n                    device_info = f\"GPU {GPU_DEVICE_ID}\"\n                except Exception as e:\n                    logger.warning(f\"GPU initialization failed, falling back to CPU: {str(e)}\")\n                    self._initialize_cpu_index(faiss)\n                    device_info = f\"CPU (GPU fallback: {str(e)})\"\n            \n            logger.info(f\"Initialized FAISS index on {device_info}\")\n            \n        except ImportError as e:\n            logger.error(f\"FAISS not available: {str(e)}\")\n            raise RuntimeError(\"FAISS library is required but not installed\")\n    \n    def _initialize_cpu_index(self, faiss):\n        \"\"\"Initialize CPU-based FAISS index.\"\"\"\n        # Use inner product for cosine similarity (normalized vectors)\n        self.index = faiss.IndexFlatIP(self.embedding_dimension)\n        self.using_gpu = False\n        logger.debug(\"Initialized CPU FAISS index (IndexFlatIP)\")\n    \n    def _initialize_gpu_index(self, faiss):\n        \"\"\"Initialize GPU-based FAISS index.\"\"\"\n        # Create GPU resources\n        self.gpu_resources = faiss.StandardGpuResources()\n        \n        # Create CPU index first\n        cpu_index = faiss.IndexFlatIP(self.embedding_dimension)\n        \n        # Move to GPU\n        self.index = faiss.index_cpu_to_gpu(\n            self.gpu_resources, \n            GPU_DEVICE_ID, \n            cpu_index\n        )\n        \n        self.using_gpu = True\n        logger.debug(f\"Initialized GPU FAISS index on device {GPU_DEVICE_ID}\")\n    \n    def add_embeddings(self, embeddings: np.ndarray):\n        \"\"\"\n        Add embeddings to the FAISS index.\n        \n        Args:\n            embeddings: Matrix of embeddings (n_vectors x embedding_dim)\n        \"\"\"\n        if embeddings.size == 0:\n            logger.warning(\"Attempted to add empty embeddings array\")\n            return\n        \n        if embeddings.shape[1] != self.embedding_dimension:\n            raise ValueError(f\"Embedding dimension mismatch: expected {self.embedding_dimension}, got {embeddings.shape[1]}\")\n        \n        # Normalize embeddings for cosine similarity\n        normalized_embeddings = self._normalize_embeddings(embeddings)\n        \n        # Add to index\n        self.index.add(normalized_embeddings.astype(np.float32))\n        \n        logger.debug(f\"Added {embeddings.shape[0]} embeddings to FAISS index\")\n    \n    def search(self, query_embedding: np.ndarray, k: int = 10, \n               threshold: float = None) -> Tuple[List[float], List[int]]:\n        \"\"\"\n        Search for similar embeddings.\n        \n        Args:\n            query_embedding: Query embedding vector\n            k: Number of nearest neighbors to return\n            threshold: Similarity threshold (uses config default if None)\n            \n        Returns:\n            Tuple of (similarities, indices)\n        \"\"\"\n        if self.index is None:\n            raise RuntimeError(\"FAISS index not initialized\")\n        \n        if self.index.ntotal == 0:\n            logger.warning(\"FAISS index is empty\")\n            return [], []\n        \n        if threshold is None:\n            threshold = SIMILARITY_THRESHOLD\n        \n        # Normalize query embedding\n        query_normalized = self._normalize_embeddings(query_embedding.reshape(1, -1))\n        \n        # Search\n        similarities, indices = self.index.search(\n            query_normalized.astype(np.float32), \n            min(k, self.index.ntotal)\n        )\n        \n        # Filter by threshold and convert to lists\n        valid_similarities = []\n        valid_indices = []\n        \n        for sim, idx in zip(similarities[0], indices[0]):\n            if sim >= threshold and idx != -1:  # -1 indicates invalid result\n                valid_similarities.append(float(sim))\n                valid_indices.append(int(idx))\n        \n        logger.debug(f\"Found {len(valid_similarities)} matches above threshold {threshold}\")\n        return valid_similarities, valid_indices\n    \n    def find_matches(self, query_embedding: np.ndarray, image_paths: List[str],\n                    k: int = 10, threshold: float = None) -> List[Dict]:\n        \"\"\"\n        Find matching images for a query embedding.\n        \n        Args:\n            query_embedding: Query embedding vector\n            image_paths: List of image paths corresponding to stored embeddings\n            k: Maximum number of matches to return\n            threshold: Similarity threshold\n            \n        Returns:\n            List of match dictionaries with similarity scores and paths\n        \"\"\"\n        similarities, indices = self.search(query_embedding, k, threshold)\n        \n        matches = []\n        for sim, idx in zip(similarities, indices):\n            if idx < len(image_paths):\n                matches.append({\n                    'image_path': image_paths[idx],\n                    'similarity': sim,\n                    'index': idx\n                })\n        \n        # Sort by similarity (highest first)\n        matches.sort(key=lambda x: x['similarity'], reverse=True)\n        \n        return matches\n    \n    def _normalize_embeddings(self, embeddings: np.ndarray) -> np.ndarray:\n        \"\"\"\n        Normalize embeddings for cosine similarity.\n        \n        Args:\n            embeddings: Input embeddings\n            \n        Returns:\n            Normalized embeddings\n        \"\"\"\n        norms = np.linalg.norm(embeddings, axis=1, keepdims=True)\n        # Avoid division by zero\n        norms = np.maximum(norms, 1e-8)\n        return embeddings / norms\n    \n    def get_index_info(self) -> Dict:\n        \"\"\"\n        Get information about the FAISS index.\n        \n        Returns:\n            Dictionary with index information\n        \"\"\"\n        return {\n            'embedding_dimension': self.embedding_dimension,\n            'using_gpu': self.using_gpu,\n            'gpu_device_id': GPU_DEVICE_ID if self.using_gpu else None,\n            'total_vectors': self.index.ntotal if self.index else 0,\n            'index_type': type(self.index).__name__ if self.index else None\n        }\n    \n    def clear(self):\n        \"\"\"Clear the FAISS index.\"\"\"\n        if self.index is not None:\n            self.index.reset()\n            logger.debug(\"Cleared FAISS index\")\n    \n    def cleanup(self):\n        \"\"\"Clean up GPU resources.\"\"\"\n        if self.using_gpu and self.gpu_resources is not None:\n            # FAISS GPU resources are automatically managed\n            self.gpu_resources = None\n            logger.debug(\"Cleaned up GPU resources\")\n","size_bytes":8170},"server/cache.ts":{"content":"// Simple in-memory cache with TTL (Time To Live)\ninterface CacheEntry<T> {\n  data: T;\n  timestamp: number;\n}\n\nexport class CacheManager {\n  private cache: Map<string, CacheEntry<any>> = new Map();\n  private defaultTTL = 30000; // 30 seconds default TTL\n  \n  set<T>(key: string, data: T, ttl?: number): void {\n    this.cache.set(key, {\n      data,\n      timestamp: Date.now()\n    });\n    \n    // Auto-cleanup expired entries after TTL\n    setTimeout(() => {\n      this.delete(key);\n    }, ttl || this.defaultTTL);\n  }\n  \n  get<T>(key: string): T | null {\n    const entry = this.cache.get(key);\n    if (!entry) return null;\n    \n    // Check if entry is expired\n    const age = Date.now() - entry.timestamp;\n    if (age > this.defaultTTL) {\n      this.delete(key);\n      return null;\n    }\n    \n    return entry.data;\n  }\n  \n  delete(key: string): void {\n    this.cache.delete(key);\n  }\n  \n  clear(): void {\n    this.cache.clear();\n  }\n  \n  // Invalidate cache entries by pattern\n  invalidatePattern(pattern: string): void {\n    const keys = Array.from(this.cache.keys());\n    keys.forEach(key => {\n      if (key.includes(pattern)) {\n        this.delete(key);\n      }\n    });\n  }\n}\n\nexport const cache = new CacheManager();","size_bytes":1222},"server/face-recognition-service.ts":{"content":"import { spawn } from 'child_process';\nimport fetch from 'node-fetch';\nimport { Photo, FaceData } from '@shared/types';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\n// Python face recognition service URL\nconst FACE_SERVICE_URL = 'http://localhost:5001';\n\n// Start the Python face recognition service if not already running\nlet pythonProcess: any = null;\n\nexport function startFaceRecognitionService() {\n  if (pythonProcess) {\n    console.log('Face recognition service already running');\n    return;\n  }\n\n  console.log('Starting face recognition service...');\n  \n  // Install Python dependencies and download models first\n  return initializeFaceRecognitionService();\n}\n\nasync function initializeFaceRecognitionService() {\n  try {\n    // Install Python dependencies if requirements.txt exists\n    const requirementsPath = path.join(__dirname, 'face-recognition', 'requirements.txt');\n    if (await fileExists(requirementsPath)) {\n      console.log('Installing Python dependencies...');\n      await installPythonDependencies(requirementsPath);\n    }\n    \n    // Download models before starting the service\n    console.log('Downloading face recognition models...');\n    await downloadModels();\n    \n    // Start the Python Flask app\n    pythonProcess = spawn('python', [\n      path.join(__dirname, 'face-recognition', 'app.py')\n    ], {\n      stdio: ['ignore', 'pipe', 'pipe'],\n      env: { ...process.env, PYTHONUNBUFFERED: '1' }\n    });\n\n    pythonProcess.stdout.on('data', (data: Buffer) => {\n      console.log(`Face service: ${data.toString()}`);\n    });\n\n    pythonProcess.stderr.on('data', (data: Buffer) => {\n      console.error(`Face service error: ${data.toString()}`);\n    });\n\n    pythonProcess.on('close', (code: number) => {\n      console.log(`Face recognition service exited with code ${code}`);\n      pythonProcess = null;\n    });\n\n    // Wait for the service to be ready\n    return waitForService();\n    \n  } catch (error) {\n    console.error('Failed to initialize face recognition service:', error);\n    throw error;\n  }\n}\n\nasync function fileExists(filePath: string): Promise<boolean> {\n  try {\n    const fs = await import('fs');\n    await fs.promises.access(filePath);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nasync function installPythonDependencies(requirementsPath: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const pip = spawn('pip', ['install', '-r', requirementsPath], {\n      stdio: 'pipe',\n      env: { ...process.env }\n    });\n\n    pip.stdout.on('data', (data: Buffer) => {\n      console.log(`pip: ${data.toString()}`);\n    });\n\n    pip.stderr.on('data', (data: Buffer) => {\n      console.error(`pip error: ${data.toString()}`);\n    });\n\n    pip.on('close', (code: number) => {\n      if (code === 0) {\n        console.log('Python dependencies installed successfully');\n        resolve();\n      } else {\n        reject(new Error(`pip install failed with code ${code}`));\n      }\n    });\n  });\n}\n\nasync function downloadModels(): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const downloadScript = spawn('python', [\n      path.join(__dirname, 'face-recognition', 'download_models.py')\n    ], {\n      stdio: 'pipe',\n      env: { ...process.env }\n    });\n\n    downloadScript.stdout.on('data', (data: Buffer) => {\n      console.log(`Model download: ${data.toString()}`);\n    });\n\n    downloadScript.stderr.on('data', (data: Buffer) => {\n      console.error(`Model download error: ${data.toString()}`);\n    });\n\n    downloadScript.on('close', (code: number) => {\n      if (code === 0) {\n        console.log('Face recognition models downloaded successfully');\n        resolve();\n      } else {\n        console.log('Model download completed (may have been cached)');\n        resolve(); // Don't fail if models are already cached\n      }\n    });\n  });\n}\n\nasync function waitForService(maxAttempts = 30): Promise<boolean> {\n  for (let i = 0; i < maxAttempts; i++) {\n    try {\n      const response = await fetch(`${FACE_SERVICE_URL}/health`);\n      if (response.ok) {\n        console.log('Face recognition service is ready');\n        return true;\n      }\n    } catch (error) {\n      // Service not ready yet\n    }\n    await new Promise(resolve => setTimeout(resolve, 1000));\n  }\n  \n  console.error('Face recognition service failed to start');\n  return false;\n}\n\nexport async function processFacePhoto(photoPath: string): Promise<FaceData[]> {\n  try {\n    const response = await fetch(`${FACE_SERVICE_URL}/process-photo`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ photoPath })\n    });\n\n    if (!response.ok) {\n      throw new Error(`Face processing failed: ${response.statusText}`);\n    }\n\n    const result = await response.json() as { faces?: FaceData[] };\n    return result.faces || [];\n  } catch (error) {\n    console.error('Error processing face photo:', error);\n    throw error;\n  }\n}\n\nexport async function compareFaces(selfieData: string, photos: Array<Photo & { faceData?: FaceData[] }>): Promise<Array<{ photoId: string; similarity: number }>> {\n  try {\n    // Extract embeddings from photos that have face data\n    const embeddings = photos\n      .filter(photo => photo.faceData && photo.faceData.length > 0)\n      .flatMap(photo => \n        photo.faceData!.map(face => ({\n          photoId: photo.id,\n          embedding: face.embedding\n        }))\n      );\n\n    if (embeddings.length === 0) {\n      return [];\n    }\n\n    const response = await fetch(`${FACE_SERVICE_URL}/compare-faces`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ selfieData, embeddings })\n    });\n\n    if (!response.ok) {\n      throw new Error(`Face comparison failed: ${response.statusText}`);\n    }\n\n    const result = await response.json() as { matches?: Array<{ photoId: string; similarity: number }> };\n    return result.matches || [];\n  } catch (error) {\n    console.error('Error comparing faces:', error);\n    throw error;\n  }\n}\n\n// Stop the Python service when the Node.js process exits\nprocess.on('exit', () => {\n  if (pythonProcess) {\n    pythonProcess.kill();\n  }\n});\n\nprocess.on('SIGINT', () => {\n  if (pythonProcess) {\n    pythonProcess.kill();\n  }\n  process.exit();\n});\n\nprocess.on('SIGTERM', () => {\n  if (pythonProcess) {\n    pythonProcess.kill();\n  }\n  process.exit();\n});","size_bytes":6455},"server/face-recognition.ts":{"content":"import { Request, Response } from 'express';\nimport { storage } from './storage';\nimport { AuthenticatedRequest } from './middleware/auth';\nimport { Photo } from '@shared/types';\n\n// Mock face encoding function - Replace with actual Google Cloud Vision API\nasync function getFaceEncoding(imageData: string): Promise<number[]> {\n  // This would be replaced with actual Google Cloud Vision API call\n  // For now, we'll return a mock encoding\n  console.log('Processing face encoding for image...');\n  \n  // Simulate API processing time\n  await new Promise(resolve => setTimeout(resolve, 1000));\n  \n  // Return mock 128-dimensional face encoding vector\n  return Array.from({ length: 128 }, () => Math.random());\n}\n\n// Calculate similarity between two face encodings\nfunction calculateSimilarity(encoding1: number[], encoding2: number[]): number {\n  if (encoding1.length !== encoding2.length) return 0;\n  \n  // Calculate cosine similarity\n  let dotProduct = 0;\n  let norm1 = 0;\n  let norm2 = 0;\n  \n  for (let i = 0; i < encoding1.length; i++) {\n    dotProduct += encoding1[i] * encoding2[i];\n    norm1 += encoding1[i] * encoding1[i];\n    norm2 += encoding2[i] * encoding2[i];\n  }\n  \n  const similarity = dotProduct / (Math.sqrt(norm1) * Math.sqrt(norm2));\n  return similarity;\n}\n\nexport async function findMyFace(req: AuthenticatedRequest, res: Response) {\n  try {\n    const { selfieData, eventId } = req.body;\n    \n    if (!selfieData || !eventId) {\n      return res.status(400).json({ error: 'Selfie data and event ID are required' });\n    }\n    \n    // Get face encoding from the selfie\n    const selfieEncoding = await getFaceEncoding(selfieData);\n    \n    // Get all photos from the event\n    const eventPhotos = await storage.getEventPhotos(eventId);\n    \n    // For demo purposes, we'll simulate finding matches\n    // In production, this would compare actual face encodings\n    const matchedPhotos: Array<Photo & { similarity: number }> = [];\n    \n    // Simulate matching some photos (randomly select 30-60% of photos as matches)\n    const matchThreshold = 0.7; // 70% similarity threshold\n    \n    for (const photo of eventPhotos) {\n      // In production, photo.faceEncodings would contain pre-computed encodings\n      // For now, we'll generate random similarity scores\n      const similarity = 0.5 + Math.random() * 0.5; // Random between 0.5 and 1.0\n      \n      if (similarity >= matchThreshold) {\n        matchedPhotos.push({\n          ...photo,\n          similarity\n        });\n      }\n    }\n    \n    // Sort by similarity score (highest first)\n    matchedPhotos.sort((a, b) => b.similarity - a.similarity);\n    \n    res.json({\n      success: true,\n      matchedPhotos,\n      totalPhotos: eventPhotos.length,\n      matchesFound: matchedPhotos.length\n    });\n    \n  } catch (error) {\n    console.error('Face recognition error:', error);\n    res.status(500).json({ error: 'Failed to process face recognition' });\n  }\n}\n\nexport async function processPhotoFaceEncodings(req: AuthenticatedRequest, res: Response) {\n  try {\n    const { photoId } = req.params;\n    \n    const photo = await storage.getPhoto(photoId);\n    if (!photo) {\n      return res.status(404).json({ error: 'Photo not found' });\n    }\n    \n    // In production, this would:\n    // 1. Download the photo from storage\n    // 2. Use Google Cloud Vision API to detect faces\n    // 3. Generate face encodings for each detected face\n    // 4. Store encodings with the photo record\n    \n    console.log(`Processing face encodings for photo ${photoId}`);\n    \n    // Simulate processing\n    await new Promise(resolve => setTimeout(resolve, 2000));\n    \n    res.json({\n      success: true,\n      photoId,\n      facesDetected: Math.floor(Math.random() * 5) + 1 // Random 1-5 faces\n    });\n    \n  } catch (error) {\n    console.error('Photo processing error:', error);\n    res.status(500).json({ error: 'Failed to process photo face encodings' });\n  }\n}\n\nexport async function saveMatchedPhotos(req: AuthenticatedRequest, res: Response) {\n  try {\n    const { photoIds } = req.body;\n    const userId = req.user?.userData?.id;\n    \n    if (!userId) {\n      return res.status(401).json({ error: 'User not authenticated' });\n    }\n    \n    if (!Array.isArray(photoIds) || photoIds.length === 0) {\n      return res.status(400).json({ error: 'Photo IDs are required' });\n    }\n    \n    // In production, this would save the photo references to user's profile\n    // For now, we'll just simulate the save operation\n    console.log(`Saving ${photoIds.length} photos to user ${userId}'s profile`);\n    \n    res.json({\n      success: true,\n      savedCount: photoIds.length\n    });\n    \n  } catch (error) {\n    console.error('Save photos error:', error);\n    res.status(500).json({ error: 'Failed to save photos' });\n  }\n}","size_bytes":4776},"server/firebase-admin.ts":{"content":"// Load environment variables from .env file in development\nimport dotenv from 'dotenv';\nif (process.env.NODE_ENV !== 'production') {\n  dotenv.config();\n}\n\nimport admin from 'firebase-admin';\n\nlet firebaseAdmin: admin.app.App;\n\nexport function initializeFirebaseAdmin() {\n  if (!firebaseAdmin) {\n    if (!admin.apps.length) {\n      if (process.env.FIREBASE_SERVICE_ACCOUNT_KEY) {\n        const serviceAccount = JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT_KEY);\n        firebaseAdmin = admin.initializeApp({\n          credential: admin.credential.cert(serviceAccount),\n          projectId: process.env.FIREBASE_PROJECT_ID\n        });\n        console.log(`Firebase Admin: Using service account for project ${serviceAccount.project_id}`);\n      } else {\n        // For development with project ID\n        firebaseAdmin = admin.initializeApp({\n          projectId: process.env.FIREBASE_PROJECT_ID\n        });\n        console.log('Firebase Admin: Using project ID for development');\n      }\n    } else {\n      firebaseAdmin = admin.apps[0] as admin.app.App;\n    }\n  }\n  return firebaseAdmin;\n}\n\nexport async function verifyFirebaseToken(token: string) {\n  try {\n    // In development, if we can't verify the token due to Firebase Admin issues,\n    // we'll decode it locally (less secure but allows development to continue)\n    if (process.env.NODE_ENV === 'development') {\n      try {\n        const app = initializeFirebaseAdmin();\n        const decodedToken = await app.auth().verifyIdToken(token);\n        return decodedToken;\n      } catch (adminError) {\n        console.warn('Firebase Admin verification failed, using fallback for development:', adminError);\n\n        // Basic JWT decode for development (not secure for production)\n        const parts = token.split('.');\n        if (parts.length !== 3) {\n          throw new Error('Invalid token format');\n        }\n\n        const payload = JSON.parse(Buffer.from(parts[1], 'base64').toString());\n\n        // Basic validation\n        if (!payload.uid || !payload.email) {\n          throw new Error('Invalid token payload');\n        }\n\n        return {\n          uid: payload.uid,\n          email: payload.email,\n          firebase: payload\n        };\n      }\n    } else {\n      const app = initializeFirebaseAdmin();\n      const decodedToken = await app.auth().verifyIdToken(token);\n      return decodedToken;\n    }\n  } catch (error) {\n    console.error('Error verifying Firebase token:', error);\n    throw new Error('Invalid token');\n  }\n}\n\nexport { admin };","size_bytes":2514},"server/firebase-db.ts":{"content":"// Firebase Admin SDK disabled - using REST API approach instead\n// This eliminates credential warnings and provides better compatibility with Replit environment\n\nconsole.log('Firebase: Using REST API approach for database operations');\nconsole.log('Database URL:', process.env.FIREBASE_DATABASE_URL || 'https://pinmypic-3c170-default-rtdb.firebaseio.com/');\n\n// Legacy exports for backward compatibility (these will not be used)\nexport const db = null;\nexport const auth = null;","size_bytes":479},"server/firebase-rest.ts":{"content":"import fetch from 'node-fetch';\nimport { cache } from './cache';\n\nconst FIREBASE_DATABASE_URL = process.env.FIREBASE_DATABASE_URL?.replace(/\\/$/, '') || 'https://pinmypic-3c170-default-rtdb.firebaseio.com';\n\nexport class FirebaseRestClient {\n  private baseUrl: string;\n\n  constructor() {\n    this.baseUrl = FIREBASE_DATABASE_URL;\n  }\n\n  async set(path: string, data: any): Promise<void> {\n    const cleanPath = path.startsWith('/') ? path : `/${path}`;\n    const url = `${this.baseUrl}${cleanPath}.json`;\n    \n    const response = await fetch(url, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(data),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Firebase REST write failed: ${response.statusText}`);\n    }\n    \n    // Invalidate cache for this path and parent path\n    cache.delete(`firebase:${cleanPath}`);\n    const parentPath = cleanPath.substring(0, cleanPath.lastIndexOf('/'));\n    if (parentPath) {\n      cache.delete(`firebase:${parentPath}`);\n    }\n  }\n\n  async push(path: string, data: any): Promise<string> {\n    const cleanPath = path.startsWith('/') ? path : `/${path}`;\n    const url = `${this.baseUrl}${cleanPath}.json`;\n    \n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(data),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Firebase REST push failed: ${response.statusText}`);\n    }\n\n    const result = await response.json() as any;\n    const generatedKey = result.name;\n    \n    // Invalidate cache for the collection\n    cache.delete(`firebase:${cleanPath}`);\n    \n    return generatedKey;\n  }\n\n  async get(path: string): Promise<any> {\n    const cleanPath = path.startsWith('/') ? path : `/${path}`;\n    const cacheKey = `firebase:${cleanPath}`;\n    \n    // Check cache first\n    const cachedData = cache.get(cacheKey);\n    if (cachedData !== null) {\n      return cachedData;\n    }\n    \n    const url = `${this.baseUrl}${cleanPath}.json`;\n    \n    const response = await fetch(url);\n\n    if (!response.ok) {\n      throw new Error(`Firebase REST read failed: ${response.statusText}`);\n    }\n\n    const data = await response.json();\n    \n    // Cache the result\n    cache.set(cacheKey, data);\n    \n    return data;\n  }\n\n  async update(path: string, data: any): Promise<void> {\n    const cleanPath = path.startsWith('/') ? path : `/${path}`;\n    const url = `${this.baseUrl}${cleanPath}.json`;\n    \n    const response = await fetch(url, {\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(data),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Firebase REST update failed: ${response.statusText}`);\n    }\n    \n    // Invalidate cache for the updated item and its parent collection\n    const pathParts = cleanPath.split('/');\n    cache.delete(`firebase:${cleanPath}`);\n    \n    if (pathParts.length > 1) {\n      const parentPath = pathParts.slice(0, -1).join('/');\n      cache.delete(`firebase:${parentPath}`);\n    }\n  }\n\n  async delete(path: string): Promise<void> {\n    const cleanPath = path.startsWith('/') ? path : `/${path}`;\n    const url = `${this.baseUrl}${cleanPath}.json`;\n    \n    const response = await fetch(url, {\n      method: 'DELETE',\n    });\n\n    if (!response.ok) {\n      throw new Error(`Firebase REST delete failed: ${response.statusText}`);\n    }\n    \n    // Invalidate cache for the deleted item and its parent collection\n    const pathParts = cleanPath.split('/');\n    cache.delete(`firebase:${cleanPath}`);\n    \n    if (pathParts.length > 1) {\n      const parentPath = pathParts.slice(0, -1).join('/');\n      cache.delete(`firebase:${parentPath}`);\n    }\n  }\n}\n\nexport const firebaseRest = new FirebaseRestClient();","size_bytes":3841},"server/index.ts":{"content":"// Load environment variables from .env file in development\nimport dotenv from 'dotenv';\nif (process.env.NODE_ENV !== 'production') {\n  dotenv.config();\n}\n\nimport express, { type Request, Response, NextFunction } from \"express\";\nimport compression from \"compression\";\nimport multer from \"multer\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { mongoService } from \"./mongodb\";\nimport { fileURLToPath } from \"url\";\nimport path from \"path\";\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\nconst app = express();\n\n// Initialize MongoDB connection\nasync function initializeMongoDB() {\n  try {\n    await mongoService.connect();\n  } catch (error) {\n    console.error('Failed to initialize MongoDB:', error);\n  }\n}\n\n// Configure multer for file uploads with memory storage (for MongoDB GridFS)\nconst storage = multer.memoryStorage();\n\nconst upload = multer({\n  storage: storage,\n  limits: {\n    fileSize: 25 * 1024 * 1024, // 25MB limit per file (reduced for performance)\n    files: 50 // Max 50 files (reduced for better memory usage)\n  },\n  fileFilter: (req, file, cb) => {\n    try {\n      // Only allow image files\n      if (file.mimetype.startsWith('image/')) {\n        cb(null, true);\n      } else {\n        const error = new Error('Only image files are allowed') as any;\n        error.code = 'LIMIT_FILE_TYPE';\n        cb(error, false);\n      }\n    } catch (error) {\n      console.error('Error in multer fileFilter:', error);\n      cb(null, false);\n    }\n  }\n});\n\n// Enable compression for all routes\napp.use(compression({\n  level: 6, // Compression level (1-9, 6 is good balance)\n  threshold: 1024, // Only compress if response is larger than 1KB\n  filter: (req: Request, res: Response) => {\n    // Don't compress responses if the request is for an image\n    if (req.path.startsWith('/api/images/')) {\n      return false;\n    }\n    return compression.filter(req, res);\n  }\n}));\n\n// Optimized payload limits for better performance\napp.use(express.json({ limit: '25mb' })); // Reduced from 100mb\napp.use(express.urlencoded({ extended: false, limit: '25mb' }));\n\n// Serve static files from uploads directory (for local storage fallback)\nconst uploadsDir = path.join(__dirname, '..', 'uploads');\napp.use('/uploads', express.static(uploadsDir));\n\n// Route to serve images from MongoDB GridFS with optimization\napp.get('/api/images/:fileId', async (req, res) => {\n  try {\n    const { fileId } = req.params;\n    const { thumbnail = 'false', quality = '85', download = 'false' } = req.query;\n    const isThumbnail = thumbnail === 'true';\n    const isDownload = download === 'true';\n    const qualityNum = Math.min(Math.max(parseInt(quality as string), 20), 100);\n    \n    const { mongoStorage } = await import('./mongo-storage');\n    \n    const imageData = await mongoStorage.getImageFromGridFS(fileId);\n    if (!imageData) {\n      return res.status(404).json({ error: 'Image not found' });\n    }\n    \n    // Set appropriate headers for performance\n    let contentType = imageData.contentType;\n    res.set('Cache-Control', 'public, max-age=31536000, immutable'); // Cache for 1 year\n    res.set('ETag', `\"${fileId}${isThumbnail ? '-thumb' : ''}${isDownload ? '-orig' : ''}\"`);\n    res.set('Vary', 'Accept-Encoding');\n    \n    // Add performance headers\n    res.set('X-Content-Type-Options', 'nosniff');\n    res.set('Accept-Ranges', 'bytes');\n    \n    // For downloads, serve original quality without compression\n    if (isDownload) {\n      // Get proper filename from metadata if available\n      const filename = imageData.metadata?.originalName || `photo_${fileId}.jpg`;\n      \n      res.set('Content-Type', imageData.contentType);\n      res.set('Content-Disposition', `attachment; filename=\"${filename}\"`);\n      res.set('X-Image-Type', 'original-download');\n      \n      // Serve original file without any processing\n      imageData.stream.pipe(res);\n      return;\n    }\n    \n    // Check if client supports WebP\n    const acceptsWebP = req.headers.accept?.includes('image/webp');\n    \n    // For display (thumbnails or compressed versions), use Sharp for compression\n    if (imageData.contentType.startsWith('image/')) {\n      try {\n        const sharp = await import('sharp');\n        const chunks: Buffer[] = [];\n        \n        // Collect image data\n        for await (const chunk of imageData.stream) {\n          chunks.push(chunk);\n        }\n        const imageBuffer = Buffer.concat(chunks);\n        \n        let processedImage = sharp.default(imageBuffer);\n        \n        // First, check the original metadata\n        let originalMetadata;\n        try {\n          originalMetadata = await processedImage.metadata();\n          console.log(`Original image metadata for ${fileId}:`, {\n            width: originalMetadata.width,\n            height: originalMetadata.height,\n            orientation: originalMetadata.orientation,\n            format: originalMetadata.format\n          });\n        } catch (metaError: any) {\n          console.log('Could not read original metadata:', metaError?.message);\n        }\n        \n        // Set performance headers\n        res.set('Cache-Control', 'public, max-age=31536000, immutable');\n        res.set('X-Content-Type-Options', 'nosniff');\n        \n        // Apply explicit EXIF orientation correction\n        if (originalMetadata?.orientation && originalMetadata.orientation !== 1) {\n          console.log(`Applying orientation correction: ${originalMetadata.orientation}`);\n          \n          // Apply specific rotation based on EXIF orientation value\n          switch (originalMetadata.orientation) {\n            case 2:\n              processedImage = processedImage.flop();\n              break;\n            case 3:\n              processedImage = processedImage.rotate(180);\n              break;\n            case 4:\n              processedImage = processedImage.flip();\n              break;\n            case 5:\n              processedImage = processedImage.rotate(90).flop();\n              break;\n            case 6:\n              processedImage = processedImage.rotate(90);\n              break;\n            case 7:\n              processedImage = processedImage.rotate(270).flop();\n              break;\n            case 8:\n              processedImage = processedImage.rotate(270);\n              break;\n          }\n        }\n        \n        // For debugging, check metadata after rotation\n        try {\n          const rotatedMetadata = await processedImage.metadata();\n          console.log(`After orientation correction for ${fileId}:`, {\n            width: rotatedMetadata.width,\n            height: rotatedMetadata.height,\n            orientation: rotatedMetadata.orientation,\n            format: rotatedMetadata.format\n          });\n        } catch (metaError: any) {\n          console.log('Could not read rotated metadata:', metaError?.message);\n        }\n        \n        // For thumbnails, resize to max 300px while maintaining aspect ratio\n        if (isThumbnail) {\n          processedImage = processedImage.resize(300, 300, {\n            fit: 'inside',\n            withoutEnlargement: true\n          });\n        } else {\n          // For regular display, resize to max 600px for better loading performance\n          processedImage = processedImage.resize(600, 600, {\n            fit: 'inside',\n            withoutEnlargement: true\n          });\n        }\n        \n        // Convert to WebP if supported for better compression\n        if (acceptsWebP) {\n          // For thumbnails, use high compression; for regular images, use quality-based compression\n          const webpOptions = isThumbnail \n            ? { quality: 60, effort: 3, smartSubsample: true } // High compression for thumbnails\n            : { quality: qualityNum, effort: 4, smartSubsample: true }; // Quality-based for regular images\n            \n          const webpBuffer = await processedImage\n            .webp(webpOptions)\n            .toBuffer();\n          \n          res.set('Content-Type', 'image/webp');\n          res.set('Content-Length', webpBuffer.length.toString());\n          res.set('X-Image-Type', isThumbnail ? 'thumbnail-webp-lossless' : 'compressed-webp');\n          res.set('X-Image-Size', `${webpBuffer.length}`);\n          res.send(webpBuffer);\n        } else {\n          // For JPEG: thumbnails use lower quality for faster loading, regular images use balanced quality\n          const jpegQuality = isThumbnail ? 60 : qualityNum;\n          const jpegBuffer = await processedImage\n            .jpeg({ \n              quality: jpegQuality, \n              progressive: true,\n              mozjpeg: true, // Use mozjpeg encoder for better compression\n              optimizeScans: true,\n              trellisQuantisation: true\n            })\n            .toBuffer();\n          \n          res.set('Content-Type', 'image/jpeg');\n          res.set('X-Image-Type', isThumbnail ? 'thumbnail-jpeg-hq' : 'compressed-jpeg');\n          res.send(jpegBuffer);\n        }\n        \n      } catch (sharpError) {\n        console.error('Error processing image with Sharp:', sharpError);\n        // Fallback to original image\n        res.set('Content-Type', imageData.contentType);\n        imageData.stream.pipe(res);\n      }\n    } else {\n      // Non-image files, serve as-is\n      res.set('Content-Type', imageData.contentType);\n      imageData.stream.pipe(res);\n    }\n    \n  } catch (error) {\n    console.error('Error serving image:', error);\n    res.status(500).json({ error: 'Failed to serve image' });\n  }\n});\n\n// Add multer middleware only for POST requests to photo upload endpoint\napp.post('/api/photos/upload', (req, res, next) => {\n  upload.array('photos', 50)(req, res, (err) => {\n    if (err) {\n      console.error('Multer upload error:', err);\n      \n      if (err.code === 'LIMIT_FILE_TYPE') {\n        return res.status(400).json({ error: 'Only image files are allowed' });\n      }\n      if (err.code === 'LIMIT_FILE_SIZE') {\n        return res.status(400).json({ error: 'File too large. Max size is 10MB' });\n      }\n      if (err.code === 'LIMIT_FILE_COUNT') {\n        return res.status(400).json({ error: 'Too many files. Max 50 files allowed' });\n      }\n      \n      // Generic error\n      return res.status(400).json({ error: err.message || 'File upload error' });\n    }\n    next();\n  });\n});\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  // Initialize MongoDB connection\n  await initializeMongoDB();\n  \n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":12041},"server/mongo-storage.ts":{"content":"import { GridFSBucket, ObjectId } from 'mongodb';\nimport { Readable } from 'stream';\nimport { mongoService } from './mongodb';\nimport { firebaseRest } from './firebase-rest';\nimport { \n  User, Event, Booking, Photo, ContactMessage, Package,\n  InsertUser, InsertEvent, InsertBooking, InsertPhoto, InsertContactMessage, InsertPackage\n} from '../shared/types';\n\nexport interface IMongoStorage {\n  // User methods\n  getUser(id: string): Promise<User | undefined>;\n  getUserByFirebaseUid(firebaseUid: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, updates: Partial<InsertUser>): Promise<User | undefined>;\n  \n  // Event methods\n  getEvent(id: string): Promise<Event | undefined>;\n  getAllEvents(): Promise<Event[]>;\n  createEvent(event: InsertEvent): Promise<Event>;\n  updateEvent(id: string, updates: Partial<InsertEvent>): Promise<Event | undefined>;\n  deleteEvent(id: string): Promise<boolean>;\n  \n  // Booking methods\n  getBooking(id: string): Promise<Booking | undefined>;\n  getAllBookings(): Promise<Booking[]>;\n  getUserBookings(userId: string): Promise<Booking[]>;\n  createBooking(booking: InsertBooking): Promise<Booking>;\n  updateBooking(id: string, updates: Partial<InsertBooking>): Promise<Booking | undefined>;\n  deleteBooking(id: string): Promise<boolean>;\n  \n  // Contact message methods\n  getContactMessage(id: string): Promise<ContactMessage | undefined>;\n  getAllContactMessages(): Promise<ContactMessage[]>;\n  createContactMessage(message: InsertContactMessage): Promise<ContactMessage>;\n  updateContactMessage(id: string, updates: Partial<InsertContactMessage>): Promise<ContactMessage | undefined>;\n  deleteContactMessage(id: string): Promise<boolean>;\n  \n  // Package methods\n  getPackage(id: string): Promise<Package | undefined>;\n  getAllPackages(): Promise<Package[]>;\n  createPackage(pkg: InsertPackage): Promise<Package>;\n  updatePackage(id: string, updates: Partial<InsertPackage>): Promise<Package | undefined>;\n  deletePackage(id: string): Promise<boolean>;\n  \n  // Photo methods with MongoDB GridFS\n  getPhoto(id: string): Promise<Photo | undefined>;\n  getEventPhotos(eventId: string): Promise<Photo[]>;\n  createPhoto(photo: InsertPhoto): Promise<Photo>;\n  updatePhoto(id: string, updates: Partial<InsertPhoto>): Promise<Photo | undefined>;\n  deletePhoto(id: string): Promise<boolean>;\n  \n  // GridFS specific methods for image handling\n  uploadImageToGridFS(buffer: Buffer, filename: string, metadata: any): Promise<string>;\n  getImageFromGridFS(fileId: string): Promise<{ stream: Readable; contentType: string; metadata?: any } | null>;\n  deleteImageFromGridFS(fileId: string): Promise<boolean>;\n}\n\nclass MongoStorage implements IMongoStorage {\n  private async ensureConnection() {\n    await mongoService.ensureConnection();\n  }\n\n  // User methods - using Firebase for consistency with existing auth\n  async getUser(id: string): Promise<User | undefined> {\n    try {\n      const user = await firebaseRest.get(`users/${id}`);\n      return user;\n    } catch (error) {\n      console.error('Error getting user:', error);\n      return undefined;\n    }\n  }\n\n  async getUserByFirebaseUid(firebaseUid: string): Promise<User | undefined> {\n    try {\n      const users = await firebaseRest.get('users');\n      if (!users) return undefined;\n      \n      return Object.values(users as Record<string, User>)\n        .find((user: User) => user.firebaseUid === firebaseUid);\n    } catch (error) {\n      console.error('Error getting user by Firebase UID:', error);\n      return undefined;\n    }\n  }\n\n  async createUser(user: InsertUser): Promise<User> {\n    try {\n      const now = new Date().toISOString();\n      const userData = {\n        ...user,\n        createdAt: now,\n        updatedAt: now,\n      };\n      \n      const id = await firebaseRest.push('users', userData);\n      const newUser: User = {\n        id,\n        ...userData,\n      };\n      \n      await firebaseRest.update(`users/${id}`, { id });\n      return newUser;\n    } catch (error) {\n      console.error('Error creating user:', error);\n      throw error;\n    }\n  }\n\n  async updateUser(id: string, updates: Partial<InsertUser>): Promise<User | undefined> {\n    try {\n      const existingUser = await firebaseRest.get(`users/${id}`);\n      if (!existingUser) return undefined;\n      \n      const updatedUser = {\n        ...existingUser,\n        ...updates,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      await firebaseRest.set(`users/${id}`, updatedUser);\n      return updatedUser;\n    } catch (error) {\n      console.error('Error updating user:', error);\n      return undefined;\n    }\n  }\n\n  // Event methods - using Firebase for metadata\n  async getEvent(id: string): Promise<Event | undefined> {\n    try {\n      const event = await firebaseRest.get(`events/${id}`);\n      return event;\n    } catch (error) {\n      console.error('Error getting event:', error);\n      return undefined;\n    }\n  }\n\n  async getAllEvents(): Promise<Event[]> {\n    try {\n      const events = await firebaseRest.get('events');\n      if (!events) return [];\n      \n      return Object.values(events as Record<string, Event>)\n        .sort((a: Event, b: Event) => \n          new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n        );\n    } catch (error) {\n      console.error('Error fetching events:', error);\n      return [];\n    }\n  }\n\n  async createEvent(event: InsertEvent): Promise<Event> {\n    try {\n      const now = new Date().toISOString();\n      const eventData = {\n        ...event,\n        createdAt: now,\n        updatedAt: now,\n      };\n      \n      const id = await firebaseRest.push('events', eventData);\n      const newEvent: Event = {\n        id,\n        ...eventData,\n      };\n      \n      await firebaseRest.update(`events/${id}`, { id });\n      return newEvent;\n    } catch (error) {\n      console.error('Error creating event:', error);\n      throw error;\n    }\n  }\n\n  async updateEvent(id: string, updates: Partial<InsertEvent>): Promise<Event | undefined> {\n    try {\n      const existingEvent = await firebaseRest.get(`events/${id}`);\n      if (!existingEvent) return undefined;\n      \n      const updatedEvent = {\n        ...existingEvent,\n        ...updates,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      await firebaseRest.update(`events/${id}`, updatedEvent);\n      return updatedEvent;\n    } catch (error) {\n      console.error('Error updating event:', error);\n      return undefined;\n    }\n  }\n\n  async deleteEvent(id: string): Promise<boolean> {\n    try {\n      // First delete all photos for this event\n      const photos = await this.getEventPhotos(id);\n      for (const photo of photos) {\n        await this.deletePhoto(photo.id);\n      }\n      \n      await firebaseRest.delete(`events/${id}`);\n      return true;\n    } catch (error) {\n      console.error('Error deleting event:', error);\n      return false;\n    }\n  }\n\n  // Booking methods - using Firebase\n  async getBooking(id: string): Promise<Booking | undefined> {\n    try {\n      const booking = await firebaseRest.get(`bookings/${id}`);\n      return booking;\n    } catch (error) {\n      console.error('Error getting booking:', error);\n      return undefined;\n    }\n  }\n\n  async getAllBookings(): Promise<Booking[]> {\n    try {\n      const bookings = await firebaseRest.get('bookings');\n      if (!bookings) return [];\n      \n      return Object.values(bookings as Record<string, Booking>)\n        .sort((a: Booking, b: Booking) => \n          new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n        );\n    } catch (error) {\n      console.error('Error fetching bookings:', error);\n      return [];\n    }\n  }\n\n  async getUserBookings(userId: string): Promise<Booking[]> {\n    try {\n      const bookings = await firebaseRest.get('bookings');\n      if (!bookings) return [];\n      \n      return Object.values(bookings as Record<string, Booking>)\n        .filter((booking: Booking) => booking.userId === userId)\n        .sort((a: Booking, b: Booking) => \n          new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n        );\n    } catch (error) {\n      console.error('Error fetching user bookings:', error);\n      return [];\n    }\n  }\n\n  async createBooking(booking: InsertBooking): Promise<Booking> {\n    try {\n      const now = new Date().toISOString();\n      const bookingData = {\n        ...booking,\n        createdAt: now,\n        updatedAt: now,\n      };\n      \n      const id = await firebaseRest.push('bookings', bookingData);\n      const newBooking: Booking = {\n        id,\n        ...bookingData,\n      };\n      \n      await firebaseRest.update(`bookings/${id}`, { id });\n      return newBooking;\n    } catch (error) {\n      console.error('Error creating booking:', error);\n      throw error;\n    }\n  }\n\n  async updateBooking(id: string, updates: Partial<InsertBooking>): Promise<Booking | undefined> {\n    try {\n      const existingBooking = await firebaseRest.get(`bookings/${id}`);\n      if (!existingBooking) return undefined;\n      \n      const updatedBooking = {\n        ...existingBooking,\n        ...updates,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      await firebaseRest.update(`bookings/${id}`, updatedBooking);\n      return updatedBooking;\n    } catch (error) {\n      console.error('Error updating booking:', error);\n      return undefined;\n    }\n  }\n\n  async deleteBooking(id: string): Promise<boolean> {\n    try {\n      await firebaseRest.delete(`bookings/${id}`);\n      return true;\n    } catch (error) {\n      console.error('Error deleting booking:', error);\n      return false;\n    }\n  }\n\n  // Contact message methods - using Firebase\n  async getContactMessage(id: string): Promise<ContactMessage | undefined> {\n    try {\n      const message = await firebaseRest.get(`contactMessages/${id}`);\n      return message;\n    } catch (error) {\n      console.error('Error getting contact message:', error);\n      return undefined;\n    }\n  }\n\n  async getAllContactMessages(): Promise<ContactMessage[]> {\n    try {\n      const messages = await firebaseRest.get('contactMessages');\n      if (!messages) return [];\n      \n      return Object.values(messages as Record<string, ContactMessage>)\n        .sort((a: ContactMessage, b: ContactMessage) => \n          new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n        );\n    } catch (error) {\n      console.error('Error fetching contact messages:', error);\n      return [];\n    }\n  }\n\n  async createContactMessage(message: InsertContactMessage): Promise<ContactMessage> {\n    try {\n      const now = new Date().toISOString();\n      const messageData = {\n        ...message,\n        createdAt: now,\n      };\n      \n      const id = await firebaseRest.push('contactMessages', messageData);\n      const newMessage: ContactMessage = {\n        id,\n        ...messageData,\n      };\n      \n      await firebaseRest.update(`contactMessages/${id}`, { id });\n      return newMessage;\n    } catch (error) {\n      console.error('Error creating contact message:', error);\n      throw error;\n    }\n  }\n\n  async updateContactMessage(id: string, updates: Partial<InsertContactMessage>): Promise<ContactMessage | undefined> {\n    try {\n      const existingMessage = await firebaseRest.get(`contactMessages/${id}`);\n      if (!existingMessage) return undefined;\n      \n      const updatedMessage = {\n        ...existingMessage,\n        ...updates,\n      };\n      \n      await firebaseRest.update(`contactMessages/${id}`, updatedMessage);\n      return updatedMessage;\n    } catch (error) {\n      console.error('Error updating contact message:', error);\n      return undefined;\n    }\n  }\n\n  async deleteContactMessage(id: string): Promise<boolean> {\n    try {\n      await firebaseRest.delete(`contactMessages/${id}`);\n      return true;\n    } catch (error) {\n      console.error('Error deleting contact message:', error);\n      return false;\n    }\n  }\n\n  // Package methods - using Firebase\n  async getPackage(id: string): Promise<Package | undefined> {\n    try {\n      const pkg = await firebaseRest.get(`packages/${id}`);\n      return pkg;\n    } catch (error) {\n      console.error('Error getting package:', error);\n      return undefined;\n    }\n  }\n\n  async getAllPackages(): Promise<Package[]> {\n    try {\n      const packages = await firebaseRest.get('packages');\n      if (!packages) return [];\n      \n      return Object.values(packages as Record<string, Package>)\n        .filter((pkg: Package) => pkg.isActive)\n        .sort((a: Package, b: Package) => a.price - b.price);\n    } catch (error) {\n      console.error('Error fetching packages:', error);\n      return [];\n    }\n  }\n\n  async createPackage(pkg: InsertPackage): Promise<Package> {\n    try {\n      const now = new Date().toISOString();\n      const packageData = {\n        ...pkg,\n        createdAt: now,\n        updatedAt: now,\n      };\n      \n      const id = await firebaseRest.push('packages', packageData);\n      const newPackage: Package = {\n        id,\n        ...packageData,\n      };\n      \n      await firebaseRest.update(`packages/${id}`, { id });\n      return newPackage;\n    } catch (error) {\n      console.error('Error creating package:', error);\n      throw error;\n    }\n  }\n\n  async updatePackage(id: string, updates: Partial<InsertPackage>): Promise<Package | undefined> {\n    try {\n      const existingPackage = await firebaseRest.get(`packages/${id}`);\n      if (!existingPackage) return undefined;\n      \n      const updatedPackage = {\n        ...existingPackage,\n        ...updates,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      await firebaseRest.set(`packages/${id}`, updatedPackage);\n      return updatedPackage;\n    } catch (error) {\n      console.error('Error updating package:', error);\n      return undefined;\n    }\n  }\n\n  async deletePackage(id: string): Promise<boolean> {\n    try {\n      await firebaseRest.delete(`packages/${id}`);\n      return true;\n    } catch (error) {\n      console.error('Error deleting package:', error);\n      return false;\n    }\n  }\n\n  // Photo methods - using MongoDB GridFS for file storage, Firebase for metadata\n  async getPhoto(id: string): Promise<Photo | undefined> {\n    try {\n      const photo = await firebaseRest.get(`photos/${id}`);\n      return photo;\n    } catch (error) {\n      console.error('Error getting photo:', error);\n      return undefined;\n    }\n  }\n\n  async getEventPhotos(eventId: string): Promise<Photo[]> {\n    try {\n      const photos = await firebaseRest.get('photos');\n      if (!photos) return [];\n      \n      return Object.values(photos as Record<string, Photo>)\n        .filter((photo: Photo) => photo.eventId === eventId)\n        .sort((a: Photo, b: Photo) => \n          new Date(a.uploadedAt).getTime() - new Date(b.uploadedAt).getTime()\n        );\n    } catch (error) {\n      console.error('Error fetching event photos:', error);\n      return [];\n    }\n  }\n\n  async createPhoto(photo: InsertPhoto): Promise<Photo> {\n    try {\n      const now = new Date().toISOString();\n      const photoData = {\n        ...photo,\n        isProcessed: photo.isProcessed || false,\n        uploadedAt: now,\n      };\n      \n      const id = await firebaseRest.push('photos', photoData);\n      const newPhoto: Photo = {\n        id,\n        ...photoData,\n      };\n      \n      await firebaseRest.update(`photos/${id}`, { id });\n      \n      // Update event photo count in Firebase\n      await this.updateEventPhotoCount(photo.eventId);\n      \n      return newPhoto;\n    } catch (error) {\n      console.error('Error creating photo:', error);\n      throw error;\n    }\n  }\n\n  async updatePhoto(id: string, updates: Partial<InsertPhoto>): Promise<Photo | undefined> {\n    try {\n      const existingPhoto = await firebaseRest.get(`photos/${id}`);\n      if (!existingPhoto) return undefined;\n      \n      const updatedPhoto = {\n        ...existingPhoto,\n        ...updates,\n      };\n      \n      await firebaseRest.update(`photos/${id}`, updatedPhoto);\n      \n      return updatedPhoto as Photo;\n    } catch (error) {\n      console.error('Error updating photo:', error);\n      return undefined;\n    }\n  }\n\n  async deletePhoto(id: string): Promise<boolean> {\n    try {\n      const existingPhoto = await firebaseRest.get(`photos/${id}`);\n      if (!existingPhoto) return false;\n      \n      // Delete image from GridFS if it has a gridfs file ID\n      if (existingPhoto.url && existingPhoto.url.startsWith('gridfs://')) {\n        const fileId = existingPhoto.url.replace('gridfs://', '');\n        await this.deleteImageFromGridFS(fileId);\n      }\n      \n      await firebaseRest.delete(`photos/${id}`);\n      \n      // Update event photo count in Firebase\n      await this.updateEventPhotoCount(existingPhoto.eventId);\n      \n      return true;\n    } catch (error) {\n      console.error('Error deleting photo:', error);\n      return false;\n    }\n  }\n\n  // GridFS specific methods for image handling\n  async uploadImageToGridFS(buffer: Buffer, filename: string, metadata: any): Promise<string> {\n    try {\n      await this.ensureConnection();\n      const gridFS = mongoService.getGridFS();\n      \n      return new Promise((resolve, reject) => {\n        const uploadStream = gridFS.openUploadStream(filename, {\n          metadata: {\n            ...metadata,\n            uploadedAt: new Date(),\n          }\n        });\n        \n        uploadStream.on('error', reject);\n        uploadStream.on('finish', () => {\n          console.log(`Image uploaded to GridFS: ${uploadStream.id}`);\n          resolve(uploadStream.id.toString());\n        });\n        \n        // Convert buffer to readable stream and pipe to GridFS\n        const readable = Readable.from(buffer);\n        readable.pipe(uploadStream);\n      });\n    } catch (error) {\n      console.error('Error uploading image to GridFS:', error);\n      throw error;\n    }\n  }\n\n  async getImageFromGridFS(fileId: string): Promise<{ stream: Readable; contentType: string; metadata?: any } | null> {\n    try {\n      await this.ensureConnection();\n      const gridFS = mongoService.getGridFS();\n      \n      // Find the file to get metadata\n      const files = await gridFS.find({ _id: new ObjectId(fileId) }).toArray();\n      if (files.length === 0) {\n        return null;\n      }\n      \n      const file = files[0];\n      const downloadStream = gridFS.openDownloadStream(new ObjectId(fileId));\n      \n      // Determine content type from filename or metadata\n      const contentType = file.metadata?.contentType || this.getContentTypeFromFilename(file.filename);\n      \n      return {\n        stream: downloadStream,\n        contentType,\n        metadata: file.metadata\n      };\n    } catch (error) {\n      console.error('Error getting image from GridFS:', error);\n      return null;\n    }\n  }\n\n  async deleteImageFromGridFS(fileId: string): Promise<boolean> {\n    try {\n      await this.ensureConnection();\n      const gridFS = mongoService.getGridFS();\n      \n      await gridFS.delete(new ObjectId(fileId));\n      console.log(`Image deleted from GridFS: ${fileId}`);\n      return true;\n    } catch (error) {\n      console.error('Error deleting image from GridFS:', error);\n      return false;\n    }\n  }\n\n  private getContentTypeFromFilename(filename: string): string {\n    const extension = filename.toLowerCase().split('.').pop();\n    switch (extension) {\n      case 'jpg':\n      case 'jpeg':\n        return 'image/jpeg';\n      case 'png':\n        return 'image/png';\n      case 'gif':\n        return 'image/gif';\n      case 'webp':\n        return 'image/webp';\n      default:\n        return 'application/octet-stream';\n    }\n  }\n\n  // Helper method to update event photo count in Firebase\n  private async updateEventPhotoCount(eventId: string): Promise<void> {\n    try {\n      // Get actual photo count from photos collection\n      const photos = await firebaseRest.get('photos');\n      let actualPhotoCount = 0;\n      \n      if (photos) {\n        actualPhotoCount = Object.values(photos as Record<string, any>)\n          .filter((photo: any) => photo.eventId === eventId)\n          .length;\n      }\n      \n      // Update the event's photo count in Firebase\n      await firebaseRest.update(`events/${eventId}`, { \n        photoCount: actualPhotoCount,\n        updatedAt: new Date().toISOString()\n      });\n      \n      console.log(`Updated photo count for event ${eventId}: ${actualPhotoCount}`);\n    } catch (error) {\n      console.error('Error updating event photo count:', error);\n    }\n  }\n}\n\nexport const mongoStorage = new MongoStorage();","size_bytes":20527},"server/mongodb.ts":{"content":"import { MongoClient, GridFSBucket, Db } from 'mongodb';\n\nexport class MongoDBService {\n  private client: MongoClient | null = null;\n  private db: Db | null = null;\n  private gridFS: GridFSBucket | null = null;\n  private connectionString: string;\n\n  constructor() {\n    // Initialize connection string (will be set during connect())\n    this.connectionString = '';\n  }\n\n  private initializeConnectionString() {\n    // Use environment variable or default to local MongoDB\n    this.connectionString = process.env.MONGODB_URI || `mongodb://${process.env.MONGODB_USERNAME}:${process.env.MONGODB_PASSWORD}@localhost:27017/${process.env.MONGODB_DB_NAME}`;\n  }\n\n  async connect(): Promise<void> {\n    try {\n      if (!this.client) {\n        // Initialize connection string with current environment variables\n        this.initializeConnectionString();\n        \n        this.client = new MongoClient(this.connectionString, {\n          serverSelectionTimeoutMS: 10000, // 10 second timeout for Atlas\n          connectTimeoutMS: 10000,\n        });\n        await this.client.connect();\n        \n        // Test the connection\n        await this.client.db('admin').command({ ping: 1 });\n        \n        // Extract database name from connection string or use default\n        // For MongoDB Atlas, the database name might not be in the URL, so we use a default\n        let dbName = 'pinmypic';\n        try {\n          const urlParts = this.connectionString.split('/');\n          const lastPart = urlParts[urlParts.length - 1];\n          if (lastPart && lastPart !== '' && !lastPart.startsWith('?')) {\n            const nameBeforeQuery = lastPart.split('?')[0];\n            if (nameBeforeQuery && nameBeforeQuery !== '') {\n              dbName = nameBeforeQuery;\n            }\n          }\n        } catch (e) {\n          // Use default database name\n        }\n        \n        this.db = this.client.db(dbName);\n        \n        // Initialize GridFS bucket for file storage\n        this.gridFS = new GridFSBucket(this.db, { bucketName: 'photos' });\n      }\n    } catch (error) {\n      console.error('Failed to connect to MongoDB:', error);\n      // Reset connection state\n      this.client = null;\n      this.db = null;\n      this.gridFS = null;\n      throw error;\n    }\n  }\n\n  async disconnect(): Promise<void> {\n    if (this.client) {\n      await this.client.close();\n      this.client = null;\n      this.db = null;\n      this.gridFS = null;\n    }\n  }\n\n  getDb(): Db {\n    if (!this.db) {\n      throw new Error('MongoDB not connected');\n    }\n    return this.db;\n  }\n\n  getGridFS(): GridFSBucket {\n    if (!this.gridFS) {\n      throw new Error('GridFS not initialized');\n    }\n    return this.gridFS;\n  }\n\n  async ensureConnection(): Promise<void> {\n    if (!this.client || !this.db || !this.gridFS) {\n      await this.connect();\n    }\n  }\n}\n\nexport const mongoService = new MongoDBService();","size_bytes":2878},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { authenticateUser, requireAdmin, requireOwner, type AuthenticatedRequest } from \"./middleware/auth\";\nimport { insertUserSchema, insertEventSchema, insertBookingSchema, insertContactMessageSchema, insertPackageSchema, User, Photo } from \"@shared/types\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { fileURLToPath } from \"url\";\nimport { startFaceRecognitionService, processFacePhoto, compareFaces } from \"./face-recognition-service\";\nimport { cache } from \"./cache\";\nimport { verifyFirebaseToken } from \"./firebase-admin\";\nimport QRCode from 'qrcode';\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\n// Process faces for a photo\nasync function processPhotoFaces(photoId: string, photoPath: string) {\n  try {\n    console.log(`Processing faces for photo ${photoId} at ${photoPath}`);\n    \n    // Process the photo to extract face data\n    const faceData = await processFacePhoto(photoPath);\n    \n    if (faceData && faceData.length > 0) {\n      console.log(`Found ${faceData.length} faces in photo ${photoId}`);\n      \n      // Update the photo with face data\n      await storage.updatePhoto(photoId, {\n        faceData: faceData,\n        isProcessed: true\n      });\n    } else {\n      console.log(`No faces found in photo ${photoId}`);\n      // Still mark as processed even if no faces found\n      await storage.updatePhoto(photoId, {\n        isProcessed: true\n      });\n    }\n  } catch (error) {\n    console.error(`Error processing faces for photo ${photoId}:`, error);\n    // Mark as processed with error\n    await storage.updatePhoto(photoId, {\n      isProcessed: true\n    });\n  }\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Start the face recognition service\n  startFaceRecognitionService()?.then(() => {\n    console.log('Face recognition service started');\n  }).catch((err: any) => {\n    console.error('Failed to start face recognition service:', err);\n  });\n  // Auth routes\n  app.post(\"/api/auth/sync-user\", async (req, res) => {\n    try {\n      const { firebaseUid, email, displayName, photoURL } = req.body;\n      \n      // First try to find by firebase UID (this is the most reliable identifier)\n      let user = await storage.getUserByFirebaseUid(firebaseUid);\n      \n      if (user) {\n        // User exists, update profile info\n        \n        const updateData: any = {\n          displayName,\n          photoURL,\n          email, // Ensure email is updated if changed\n          // Preserve existing admin status\n          isAdmin: user.isAdmin,\n          adminRole: user.adminRole,\n          adminPermissions: user.adminPermissions\n        };\n        \n        // Ensure admin status for admin email\n        if (email === process.env.ADMIN_EMAIL) {\n          updateData.isAdmin = true;\n          updateData.adminRole = 'owner';\n          updateData.adminPermissions = ['events', 'bookings', 'packages', 'photos', 'contacts', 'users', 'users_manage'];\n        }\n        \n        // Update user with profile info\n        \n        const updatedUser = await storage.updateUser(user.id, updateData);\n        \n        if (!updatedUser) {\n          return res.status(500).json({ error: \"Failed to update user\" });\n        }\n        \n        // Clear cache for user data to ensure fresh data on next sync\n        cache.delete(`firebase:/users/${updatedUser.id}`);\n        cache.delete(`firebase:/users`);\n        \n        res.json(updatedUser);\n        return;\n      }\n      \n      // User doesn't exist by Firebase UID, use findOrCreateUserByEmail to ensure uniqueness\n      try {\n        user = await storage.findOrCreateUserByEmail({\n          firebaseUid,\n          email,\n          displayName,\n          photoURL,\n          isAdmin: email === process.env.ADMIN_EMAIL,\n          adminRole: email === process.env.ADMIN_EMAIL ? 'owner' : undefined,\n          adminPermissions: email === process.env.ADMIN_EMAIL ? ['events', 'bookings', 'packages', 'photos', 'contacts', 'users', 'users_manage'] : undefined\n        });\n        res.json(user);\n      } catch (createError: any) {\n        console.error('User sync failed:', createError);\n        throw createError;\n      }\n    } catch (error) {\n      console.error(\"Error syncing user:\", error);\n      res.status(500).json({ error: \"Failed to sync user\" });\n    }\n  });\n\n  // Events routes\n  app.get(\"/api/events\", async (req, res) => {\n    try {\n      const events = await storage.getPublicEvents();\n      res.json(events);\n    } catch (error) {\n      console.error(\"Error fetching events:\", error);\n      res.status(500).json({ error: \"Failed to fetch events\" });\n    }\n  });\n\n  // Generate shareable event URL\n  app.post(\"/api/events/:id/share-url\", authenticateUser, requireAdmin, async (req, res) => {\n    try {\n      const eventId = req.params.id;\n      const event = await storage.getEvent(eventId);\n      \n      if (!event) {\n        return res.status(404).json({ error: \"Event not found\" });\n      }\n\n      // Get the base URL from request headers\n      const protocol = req.get('x-forwarded-proto') || req.protocol;\n      const host = req.get('host');\n      const baseUrl = `${protocol}://${host}`;\n      \n      // Generate shareable URL\n      const shareUrl = `${baseUrl}/event/${eventId}`;\n      \n      res.json({\n        success: true,\n        shareUrl,\n        eventTitle: event.title,\n        eventId\n      });\n    } catch (error) {\n      console.error(\"Error generating share URL:\", error);\n      res.status(500).json({ error: \"Failed to generate share URL\" });\n    }\n  });\n  \n  // Lightweight endpoint for gallery page - returns all events with minimal data\n  app.get(\"/api/events/all\", async (req, res) => {\n    try {\n      const events = await storage.getEvents();\n      // Return only essential fields for listing view\n      const lightweightEvents = events.map(event => ({\n        id: event.id,\n        title: event.title,\n        eventDate: event.eventDate,\n        location: event.location,\n        category: event.category,\n        photoCount: event.photoCount,\n        isPrivate: event.isPrivate,\n        thumbnailUrl: event.thumbnailUrl,\n        publicPin: event.publicPin,\n        brideGroomPin: event.brideGroomPin\n      }));\n      res.json(lightweightEvents);\n    } catch (error) {\n      console.error(\"Error fetching all events:\", error);\n      res.status(500).json({ error: \"Failed to fetch events\" });\n    }\n  });\n\n  // Admin events route - returns all events including private ones\n  app.get(\"/api/admin/events\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    \n    try {\n      const events = await storage.getEvents();\n      \n      // Fix photo counts for all events\n      for (const event of events) {\n        const photos = await storage.getEventPhotos(event.id);\n        const actualPhotoCount = photos.length;\n        if (event.photoCount !== actualPhotoCount) {\n          console.log(`Fixing photo count for event ${event.id}: ${event.photoCount} -> ${actualPhotoCount}`);\n          await storage.updateEvent(event.id, { photoCount: actualPhotoCount });\n          event.photoCount = actualPhotoCount; // Update the object we're returning\n        }\n      }\n      \n      res.json(events);\n    } catch (error) {\n      console.error(\"Error fetching admin events:\", error);\n      res.status(500).json({ error: \"Failed to fetch events\" });\n    }\n  });\n\n  app.get(\"/api/events/:id\", async (req, res) => {\n    try {\n      const event = await storage.getEvent(req.params.id);\n      if (!event) {\n        return res.status(404).json({ error: \"Event not found\" });\n      }\n      res.json(event);\n    } catch (error) {\n      console.error(\"Error fetching event:\", error);\n      res.status(500).json({ error: \"Failed to fetch event\" });\n    }\n  });\n\n  app.post(\"/api/events\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    \n    try {\n\n      \n      // Clean event data\n      const eventData = {\n        title: req.body.title || '',\n        description: req.body.description || '',\n        eventDate: req.body.eventDate || new Date().toISOString(),\n        location: req.body.location || '',\n        category: req.body.category || 'other',\n        isPrivate: req.body.isPrivate || false,\n        photoCount: 0,\n        publicPin: req.body.publicPin || '',\n        brideGroomPin: req.body.brideGroomPin || '',\n        thumbnailUrl: req.body.thumbnailUrl || '',\n        createdBy: req.user?.userData?.id || 'admin'\n      };\n      \n\n      \n      // Send response immediately\n      res.status(201).json({ \n        success: true, \n        message: 'Event created successfully',\n        id: `event_${Date.now()}`,\n        ...eventData\n      });\n      \n      // Save to Firebase after response\n      storage.createEvent(eventData).then(event => {\n\n      }).catch(error => {\n        console.error('Error saving event to Firebase:', error);\n      });\n      \n    } catch (error) {\n      console.error(\"Error creating event:\", error);\n      res.status(500).json({ \n        success: false, \n        error: 'Failed to create event'\n      });\n    }\n  });\n\n  app.patch(\"/api/events/:id\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    \n    try {\n      const eventData = {\n        ...req.body,\n        eventDate: req.body.eventDate || new Date().toISOString()\n      };\n      \n      const event = await storage.updateEvent(req.params.id, eventData);\n      if (!event) {\n        return res.status(404).json({ error: \"Event not found\" });\n      }\n      res.json(event);\n    } catch (error) {\n      console.error(\"Error updating event:\", error);\n      res.status(500).json({ error: \"Failed to update event\" });\n    }\n  });\n\n  app.delete(\"/api/events/:id\", async (req: any, res) => {\n    // Development bypass for authentication issues  \n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    \n    try {\n      const success = await storage.deleteEvent(req.params.id);\n      if (!success) {\n        return res.status(404).json({ error: \"Event not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting event:\", error);\n      res.status(500).json({ error: \"Failed to delete event\" });\n    }\n  });\n\n  // Get photos for a specific event with pagination\n  app.get(\"/api/events/:id/photos\", async (req, res) => {\n    try {\n      const { page = '1', limit = '50', lightweight = 'false' } = req.query;\n      const pageNum = parseInt(page as string);\n      const limitNum = parseInt(limit as string);\n      const isLightweight = lightweight === 'true';\n      \n      let photos = await storage.getEventPhotos(req.params.id);\n      \n      // Update the event's photo count to match actual photos\n      const actualPhotoCount = photos.length;\n      const event = await storage.getEvent(req.params.id);\n      if (event && event.photoCount !== actualPhotoCount) {\n        await storage.updateEvent(req.params.id, { photoCount: actualPhotoCount });\n      }\n      \n      // For lightweight requests, return only essential fields\n      if (isLightweight) {\n        photos = photos.map(photo => ({\n          id: photo.id,\n          eventId: photo.eventId,\n          url: photo.url,\n          thumbnailUrl: photo.thumbnailUrl,\n          filename: photo.filename,\n          tags: photo.tags || '',\n          isProcessed: photo.isProcessed,\n          uploadedAt: photo.uploadedAt\n        }));\n      }\n      \n      // Implement pagination\n      const startIndex = (pageNum - 1) * limitNum;\n      const endIndex = startIndex + limitNum;\n      const paginatedPhotos = photos.slice(startIndex, endIndex);\n      \n      // Set cache headers for better performance\n      res.set('Cache-Control', 'public, max-age=300'); // Cache for 5 minutes\n      \n      res.json({\n        photos: paginatedPhotos,\n        total: photos.length,\n        page: pageNum,\n        limit: limitNum,\n        hasMore: endIndex < photos.length\n      });\n    } catch (error) {\n      console.error(\"Error fetching event photos:\", error);\n      res.status(500).json({ error: \"Failed to fetch photos\" });\n    }\n  });\n\n  // Photo upload routes\n  app.post(\"/api/photos/upload\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n\n    try {\n\n      \n      // Handle both single and multiple file uploads\n      const files = req.files || (req.file ? [req.file] : []);\n      \n      if (!files || files.length === 0) {\n        console.error('Photo upload: No files uploaded');\n        return res.status(400).json({ error: \"No files uploaded\" });\n      }\n\n      const eventId = req.body.eventId;\n      \n      if (!eventId) {\n        console.error('Photo upload: Missing eventId');\n        return res.status(400).json({ error: \"Event ID is required\" });\n      }\n\n      // Verify event exists\n      const event = await storage.getEvent(eventId);\n      if (!event) {\n        console.error('Photo upload: Event not found:', eventId);\n        return res.status(404).json({ error: \"Event not found\" });\n      }\n\n      const uploadedPhotos = [];\n      \n      // Process each file\n      for (const file of files) {\n        const originalFilename = file.originalname || 'photo.jpg';\n        \n        console.log('Processing file upload:', {\n          originalname: file.originalname,\n          mimetype: file.mimetype,\n          size: file.size\n        });\n\n        // Try MongoDB GridFS first, fallback to local storage\n        const multerFile = file as Express.Multer.File;\n        const filename = `${eventId}_${Date.now()}_${multerFile.originalname}`;\n        let photoData;\n        let fileReference;\n\n        try {\n          // Process image to correct EXIF orientation before storing\n          let processedBuffer = multerFile.buffer;\n          \n          if (multerFile.mimetype.startsWith('image/')) {\n            try {\n              const sharp = await import('sharp');\n              let sharpImage = sharp.default(multerFile.buffer);\n              \n              // Get original metadata to check orientation\n              const metadata = await sharpImage.metadata();\n              \n              // Apply explicit EXIF orientation correction\n              if (metadata.orientation && metadata.orientation !== 1) {\n                console.log(`Upload: Applying orientation correction: ${metadata.orientation}`);\n                \n                switch (metadata.orientation) {\n                  case 2:\n                    sharpImage = sharpImage.flop();\n                    break;\n                  case 3:\n                    sharpImage = sharpImage.rotate(180);\n                    break;\n                  case 4:\n                    sharpImage = sharpImage.flip();\n                    break;\n                  case 5:\n                    sharpImage = sharpImage.rotate(90).flop();\n                    break;\n                  case 6:\n                    sharpImage = sharpImage.rotate(90);\n                    break;\n                  case 7:\n                    sharpImage = sharpImage.rotate(270).flop();\n                    break;\n                  case 8:\n                    sharpImage = sharpImage.rotate(270);\n                    break;\n                }\n              }\n              \n              // Process with high quality for storage\n              processedBuffer = await sharpImage\n                .jpeg({ quality: 95, progressive: true })\n                .toBuffer();\n            } catch (sharpError: any) {\n              console.log('Sharp processing failed, using original buffer:', sharpError?.message || 'Unknown error');\n              // Use original buffer if Sharp processing fails\n            }\n          }\n          \n          // Try MongoDB GridFS storage\n          const { mongoStorage } = await import('./mongo-storage');\n          const fileId = await mongoStorage.uploadImageToGridFS(\n            processedBuffer, \n            filename,\n            {\n              eventId,\n              contentType: multerFile.mimetype,\n              originalName: multerFile.originalname,\n              size: processedBuffer.length // Update size to reflect processed image\n            }\n          );\n          \n          // Create photo record with GridFS reference\n          photoData = {\n            eventId,\n            filename: filename,\n            url: `/api/images/${fileId}`, // Use our API endpoint to serve from GridFS\n            thumbnailUrl: `/api/images/${fileId}`, // Use same image for thumbnail\n            tags: '',\n            isProcessed: false\n          };\n          fileReference = fileId;\n          \n        } catch (mongoError) {\n          \n          // Fallback to local file storage\n          const fs = await import('fs');\n          const path = await import('path');\n          const uploadsDir = path.join(__dirname, '..', 'uploads');\n          const eventDir = path.join(uploadsDir, eventId, 'photos');\n          \n          // Ensure directory exists\n          if (!fs.existsSync(eventDir)) {\n            fs.mkdirSync(eventDir, { recursive: true });\n          }\n          \n          // Apply same EXIF rotation processing for local storage\n          let processedBuffer = multerFile.buffer;\n          if (multerFile.mimetype.startsWith('image/')) {\n            try {\n              const sharp = await import('sharp');\n              let sharpImage = sharp.default(multerFile.buffer);\n              \n              // Get original metadata to check orientation\n              const metadata = await sharpImage.metadata();\n              \n              // Apply explicit EXIF orientation correction\n              if (metadata.orientation && metadata.orientation !== 1) {\n                console.log(`Local storage: Applying orientation correction: ${metadata.orientation}`);\n                \n                switch (metadata.orientation) {\n                  case 2:\n                    sharpImage = sharpImage.flop();\n                    break;\n                  case 3:\n                    sharpImage = sharpImage.rotate(180);\n                    break;\n                  case 4:\n                    sharpImage = sharpImage.flip();\n                    break;\n                  case 5:\n                    sharpImage = sharpImage.rotate(90).flop();\n                    break;\n                  case 6:\n                    sharpImage = sharpImage.rotate(90);\n                    break;\n                  case 7:\n                    sharpImage = sharpImage.rotate(270).flop();\n                    break;\n                  case 8:\n                    sharpImage = sharpImage.rotate(270);\n                    break;\n                }\n              }\n              \n              processedBuffer = await sharpImage\n                .jpeg({ quality: 95, progressive: true })\n                .toBuffer();\n            } catch (sharpError: any) {\n              console.log('Sharp processing failed for local storage, using original buffer:', sharpError?.message || 'Unknown error');\n            }\n          }\n          \n          // Save file to disk\n          const filePath = path.join(eventDir, filename);\n          fs.writeFileSync(filePath, processedBuffer);\n          const relativePath = `uploads/${eventId}/photos/${filename}`;\n          \n          photoData = {\n            eventId,\n            filename: filename,\n            url: `/${relativePath}`,\n            thumbnailUrl: `/${relativePath}`,\n            tags: '',\n            isProcessed: false\n          };\n          fileReference = filePath;\n        }\n\n        const photo = await storage.createPhoto(photoData);\n        uploadedPhotos.push(photo);\n        \n        // Process face recognition asynchronously (don't wait for it)\n        // Pass the file reference (GridFS ID or file path) for processing\n        processPhotoFaces(photo.id, fileReference).catch(err => {\n          console.error(`Failed to process faces for photo ${photo.id}:`, err);\n        });\n      }\n      \n      // Update event photo count\n      console.log('Updating event photo count for:', eventId);\n      const updatedEvent = await storage.updateEvent(eventId, { \n        photoCount: (event.photoCount || 0) + uploadedPhotos.length \n      });\n      console.log('Event photo count updated:', updatedEvent?.photoCount);\n\n      // Return the appropriate response based on single/multiple upload\n      if (files.length === 1) {\n        res.json({\n          success: true,\n          photo: uploadedPhotos[0],\n          url: uploadedPhotos[0].url\n        });\n      } else {\n        res.json({\n          success: true,\n          photos: uploadedPhotos,\n          count: uploadedPhotos.length\n        });\n      }\n\n    } catch (error: any) {\n      console.error(\"Error uploading photo:\", error);\n      res.status(500).json({ error: \"Failed to upload photo\", details: error?.message || 'Unknown error' });\n    }\n  });\n\n  app.get(\"/api/events/:eventId/photos\", async (req, res) => {\n    try {\n      const photos = await storage.getEventPhotos(req.params.eventId);\n      res.json(photos);\n    } catch (error) {\n      console.error(\"Error fetching event photos:\", error);\n      res.status(500).json({ error: \"Failed to fetch photos\" });\n    }\n  });\n\n  app.delete(\"/api/photos/:photoId\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n\n    try {\n      const photo = await storage.getPhoto(req.params.photoId);\n      if (!photo) {\n        return res.status(404).json({ error: \"Photo not found\" });\n      }\n\n      // Delete image based on storage type\n      if (photo.url) {\n        if (photo.url.startsWith('/api/images/')) {\n          // GridFS stored image\n          const fileId = photo.url.replace('/api/images/', '');\n          try {\n            const { mongoStorage } = await import('./mongo-storage');\n            await mongoStorage.deleteImageFromGridFS(fileId);\n\n          } catch (fileError) {\n            console.error('Error deleting GridFS file:', fileError);\n            // Continue with database deletion even if file deletion fails\n          }\n        } else if (photo.url.startsWith('/uploads/')) {\n          // Local file storage\n          const path = await import('path');\n          const fs = await import('fs');\n          const filePath = path.join(__dirname, '..', photo.url);\n          try {\n            if (fs.existsSync(filePath)) {\n              fs.unlinkSync(filePath);\n            }\n          } catch (fileError) {\n            console.error('Error deleting physical file:', fileError);\n            // Continue with database deletion even if file deletion fails\n          }\n        }\n      }\n\n      const success = await storage.deletePhoto(req.params.photoId);\n      if (!success) {\n        return res.status(404).json({ error: \"Photo not found\" });\n      }\n\n      // Update event photo count\n      const event = await storage.getEvent(photo.eventId);\n      if (event && event.photoCount > 0) {\n        await storage.updateEvent(photo.eventId, { \n          photoCount: event.photoCount - 1 \n        });\n      }\n\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting photo:\", error);\n      res.status(500).json({ error: \"Failed to delete photo\" });\n    }\n  });\n\n  // Bookings routes\n  app.get(\"/api/bookings\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-user',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-user',\n          firebaseUid: 'dev-user',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const user = req.user;\n      if (!user || !user.userData) {\n        return res.status(400).json({ error: \"User data not available\" });\n      }\n      \n      let bookings;\n      const isAdmin = user.userData.isAdmin || user.email === process.env.ADMIN_EMAIL;\n      \n      if (isAdmin) {\n        bookings = await storage.getBookings();\n      } else {\n        bookings = await storage.getUserBookings(user.userData.id);\n      }\n      res.json(bookings);\n    } catch (error) {\n      console.error(\"Error fetching bookings:\", error);\n      res.status(500).json({ error: \"Failed to fetch bookings\" });\n    }\n  });\n\n  app.post(\"/api/bookings\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-user',\n        email: req.body.email || 'user@example.com',\n        userData: {\n          id: 'dev-user',\n          firebaseUid: 'dev-user',\n          email: req.body.email || 'user@example.com',\n          isAdmin: req.body.email === process.env.ADMIN_EMAIL\n        }\n      };\n    }\n    try {\n      console.log('Received booking data:', req.body);\n      \n      // Create clean booking data without undefined values\n      const bookingData = {\n        name: req.body.name,\n        email: req.body.email,\n        eventType: req.body.eventType || '',\n        eventDate: req.body.eventDate || '',\n        eventTime: req.body.eventTime || '',\n        location: req.body.location || '',\n        duration: req.body.duration || '',\n        packageType: req.body.packageType || '',\n      };\n      \n      // Add optional fields with proper typing\n      if (req.body.phone && req.body.phone.trim()) {\n        (bookingData as any).phone = req.body.phone.trim();\n      }\n      if (req.body.message && req.body.message.trim()) {\n        (bookingData as any).message = req.body.message.trim();\n      }\n      if (req.body.guestCount && !isNaN(Number(req.body.guestCount))) {\n        (bookingData as any).guestCount = Number(req.body.guestCount);\n      }\n      if (req.body.amount && !isNaN(Number(req.body.amount))) {\n        (bookingData as any).amount = Number(req.body.amount);\n      }\n      if (req.user?.userData?.id) {\n        (bookingData as any).userId = req.user.userData.id;\n      }\n      \n\n      \n      // Send response immediately to prevent timeout\n      res.status(201).json({ \n        success: true, \n        message: 'Booking submitted successfully',\n        id: `booking_${Date.now()}`\n      });\n      \n      // Save to Firebase after response is sent\n      storage.createBooking(bookingData).then(booking => {\n        console.log('Booking saved successfully:', booking.id);\n      }).catch(error => {\n        console.error('Error saving booking:', error);\n      });\n    } catch (error) {\n      console.error(\"Error creating booking:\", error);\n      res.status(201).json({ \n        success: true, \n        message: 'Booking submitted successfully'\n      });\n    }\n  });\n\n  // PATCH endpoint for updating booking status and amount\n  app.patch(\"/api/bookings/:id\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const { id } = req.params;\n      const updateData = req.body;\n      \n      console.log(`PATCH /api/bookings/${id}:`, updateData);\n      \n      const booking = await storage.updateBooking(id, updateData);\n      if (!booking) {\n        console.log(`Booking ${id} not found`);\n        return res.status(404).json({ error: \"Booking not found\" });\n      }\n      \n      console.log(`Booking ${id} updated successfully:`, booking);\n      res.json(booking);\n    } catch (error) {\n      console.error(\"Error updating booking:\", error);\n      res.status(500).json({ error: \"Failed to update booking\" });\n    }\n  });\n\n  app.put(\"/api/bookings/:id\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const bookingData = insertBookingSchema.partial().parse(req.body);\n      const booking = await storage.updateBooking(req.params.id, bookingData);\n      if (!booking) {\n        return res.status(404).json({ error: \"Booking not found\" });\n      }\n      res.json(booking);\n    } catch (error) {\n      console.error(\"Error updating booking:\", error);\n      res.status(500).json({ error: \"Failed to update booking\" });\n    }\n  });\n\n  app.delete(\"/api/bookings/:id\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const { id } = req.params;\n      console.log(`DELETE /api/bookings/${id}`);\n      \n      const success = await storage.deleteBooking(id);\n      if (!success) {\n        console.log(`Booking ${id} not found for deletion`);\n        return res.status(404).json({ error: \"Booking not found\" });\n      }\n      \n      console.log(`Booking ${id} deleted successfully`);\n      res.json({ success: true, message: \"Booking deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting booking:\", error);\n      res.status(500).json({ error: \"Failed to delete booking\" });\n    }\n  });\n\n  // Packages routes\n  app.get(\"/api/packages\", async (req, res) => {\n    try {\n      let packages = await storage.getAllPackages();\n      \n      // If no packages exist, create default ones\n      if (!packages || packages.length === 0) {\n\n        const defaultPackages = [\n          {\n            name: \"Basic\",\n            price: 299,\n            duration: \"2 hours\",\n            photoCount: \"50+ photos\",\n            features: [\"Basic editing\", \"Digital gallery\", \"48-hour delivery\"],\n            isPopular: false,\n            isActive: true\n          },\n          {\n            name: \"Premium\",\n            price: 499,\n            duration: \"4 hours\", \n            photoCount: \"100+ photos\",\n            features: [\"Professional editing\", \"Digital gallery\", \"Print release\", \"24-hour delivery\", \"USB drive\"],\n            isPopular: true,\n            isActive: true\n          },\n          {\n            name: \"Deluxe\",\n            price: 799,\n            duration: \"6 hours\",\n            photoCount: \"200+ photos\", \n            features: [\"Advanced editing\", \"Digital gallery\", \"Print release\", \"Same day delivery\", \"USB drive\", \"Custom album\"],\n            isPopular: false,\n            isActive: true\n          }\n        ];\n        \n        // Create packages in Firebase\n        for (const pkg of defaultPackages) {\n          try {\n            await storage.createPackage(pkg);\n            console.log(`Created package: ${pkg.name}`);\n          } catch (error) {\n            console.error(`Error creating package ${pkg.name}:`, error);\n          }\n        }\n        \n        // Add a small delay to ensure packages are saved\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        \n        // Fetch packages again\n        packages = await storage.getActivePackages();\n      }\n      \n      res.json(packages);\n    } catch (error) {\n      console.error(\"Error fetching packages:\", error);\n      res.status(500).json({ error: \"Failed to fetch packages\" });\n    }\n  });\n\n  app.post(\"/api/packages\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const packageData = insertPackageSchema.parse(req.body);\n      const pkg = await storage.createPackage(packageData);\n      res.status(201).json(pkg);\n    } catch (error) {\n      console.error(\"Error creating package:\", error);\n      res.status(500).json({ error: \"Failed to create package\" });\n    }\n  });\n\n  app.patch(\"/api/packages/:id\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const { id } = req.params;\n      const updates = req.body;\n      const updatedPackage = await storage.updatePackage(id, updates);\n      \n      if (!updatedPackage) {\n        return res.status(404).json({ error: \"Package not found\" });\n      }\n      \n      res.json(updatedPackage);\n    } catch (error) {\n      console.error(\"Error updating package:\", error);\n      res.status(500).json({ error: \"Failed to update package\" });\n    }\n  });\n\n  app.delete(\"/api/packages/:id\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const { id } = req.params;\n      \n      // Actually delete the package from database\n      const deleted = await storage.deletePackage(id);\n      \n      if (!deleted) {\n        return res.status(404).json({ error: \"Package not found\" });\n      }\n      \n      res.json({ success: true, message: \"Package deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting package:\", error);\n      res.status(500).json({ error: \"Failed to delete package\" });\n    }\n  });\n\n  // User management routes\n  app.get(\"/api/users\", authenticateUser, requireAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      const users = await storage.getUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ error: \"Failed to fetch users\" });\n    }\n  });\n\n  // Admin user management routes\n  app.get(\"/api/admin/users\", authenticateUser, requireAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      const users = await storage.getUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ error: \"Failed to fetch users\" });\n    }\n  });\n\n  app.get(\"/api/admin/users/admins\", authenticateUser, requireAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      const adminUsers = await storage.getAdminUsers();\n      res.json(adminUsers);\n    } catch (error) {\n      console.error(\"Error fetching admin users:\", error);\n      res.status(500).json({ error: \"Failed to fetch admin users\" });\n    }\n  });\n\n  app.patch(\"/api/admin/users/:id/promote\", authenticateUser, requireAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { id } = req.params;\n      const { isAdmin, adminRole, adminPermissions } = req.body;\n      \n      // Only owners can promote/demote users\n      if (req.user?.userData?.adminRole !== 'owner') {\n        return res.status(403).json({ error: \"Only owners can manage admin privileges\" });\n      }\n      \n      // Check if target user is the owner - prevent changes to owner\n      const targetUser = await storage.getUser(id);\n      if (targetUser && targetUser.email === process.env.ADMIN_EMAIL) {\n        return res.status(403).json({ error: \"Owner account cannot be modified\" });\n      }\n      \n      const updatedUser = await storage.updateUserAdminStatus(id, isAdmin, adminRole, adminPermissions);\n      \n      if (!updatedUser) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error updating user admin status:\", error);\n      res.status(500).json({ error: \"Failed to update user admin status\" });\n    }\n  });\n\n  app.patch(\"/api/admin/users/:id/demote\", authenticateUser, requireAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { id } = req.params;\n      \n      // Only owners can promote/demote users\n      if (req.user?.userData?.adminRole !== 'owner') {\n        return res.status(403).json({ error: \"Only owners can manage admin privileges\" });\n      }\n      \n      // Check if target user is the owner - prevent changes to owner\n      const targetUser = await storage.getUser(id);\n      if (targetUser && targetUser.email === process.env.ADMIN_EMAIL) {\n        return res.status(403).json({ error: \"Owner account cannot be modified\" });\n      }\n      \n      const updatedUser = await storage.updateUserAdminStatus(id, false, undefined, []);\n      \n      if (!updatedUser) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error demoting user:\", error);\n      res.status(500).json({ error: \"Failed to demote user\" });\n    }\n  });\n\n  app.patch(\"/api/admin/users/:id/permissions\", authenticateUser, requireAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { id } = req.params;\n      const { adminPermissions } = req.body;\n      \n      // Only owners can modify permissions\n      if (req.user?.userData?.adminRole !== 'owner') {\n        return res.status(403).json({ error: \"Only owners can modify user permissions\" });\n      }\n      \n      // Check if target user is the owner - prevent changes to owner\n      const targetUser = await storage.getUser(id);\n      if (targetUser && targetUser.email === process.env.ADMIN_EMAIL) {\n        return res.status(403).json({ error: \"Owner account cannot be modified\" });\n      }\n      \n      const updatedUser = await storage.updateUserAdminStatus(id, targetUser?.isAdmin || false, targetUser?.adminRole, adminPermissions);\n      \n      if (!updatedUser) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error updating user permissions:\", error);\n      res.status(500).json({ error: \"Failed to update user permissions\" });\n    }\n  });\n\n  app.patch(\"/api/admin/users/:id/deactivate\", authenticateUser, requireOwner, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { id } = req.params;\n      \n      // Check if target user is the owner - prevent deactivating owner\n      const targetUser = await storage.getUser(id);\n      if (targetUser && targetUser.email === process.env.ADMIN_EMAIL) {\n        return res.status(403).json({ error: \"Owner account cannot be deactivated\" });\n      }\n      \n      const success = await storage.deactivateUser(id);\n      \n      if (!success) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      res.json({ message: \"User deactivated successfully\" });\n    } catch (error) {\n      console.error(\"Error deactivating user:\", error);\n      res.status(500).json({ error: \"Failed to deactivate user\" });\n    }\n  });\n\n  // Temporary admin promotion endpoint for development\n  app.post(\"/api/admin/promote-user\", async (req, res) => {\n    try {\n      const { email } = req.body;\n      \n      if (!email) {\n        return res.status(400).json({ error: \"Email is required\" });\n      }\n      \n      // Find user by email\n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      // Promote user to admin\n      const updatedUser = await storage.updateUserAdminStatus(\n        user.id,\n        true,\n        'admin',\n        ['events', 'bookings', 'packages', 'photos', 'contacts', 'users_view']\n      );\n      \n      if (!updatedUser) {\n        return res.status(500).json({ error: \"Failed to promote user\" });\n      }\n      \n      // Clear cache for user data to ensure fresh data on next sync\n      cache.delete(`firebase:/users/${user.id}`);\n      cache.delete(`firebase:/users`);\n      \n      res.json({ message: \"User promoted to admin successfully\", user: updatedUser });\n    } catch (error) {\n      console.error(\"Error promoting user:\", error);\n      res.status(500).json({ error: \"Failed to promote user\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id\", authenticateUser, requireAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { id } = req.params;\n      const updates = req.body;\n      \n      // Check if trying to change owner's admin status\n      if (updates.isAdmin !== undefined || updates.adminRole !== undefined) {\n        const targetUser = await storage.getUser(id);\n        if (targetUser?.email === process.env.ADMIN_EMAIL && targetUser?.adminRole === 'owner') {\n          // Only owner can change their own settings\n          if (req.user?.email !== process.env.ADMIN_EMAIL) {\n            return res.status(403).json({ error: \"Cannot modify owner account\" });\n          }\n        }\n      }\n      \n      const updatedUser = await storage.updateUser(id, updates);\n      if (!updatedUser) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error updating user:\", error);\n      res.status(500).json({ error: \"Failed to update user\" });\n    }\n  });\n\n  app.delete(\"/api/users/:id\", authenticateUser, requireOwner, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { id } = req.params;\n      \n      // Check if target user is the owner - prevent deleting owner\n      const targetUser = await storage.getUser(id);\n      if (targetUser && targetUser.email === process.env.ADMIN_EMAIL) {\n        return res.status(403).json({ error: \"Owner account cannot be deleted\" });\n      }\n      \n      const success = await storage.deleteUser(id);\n      if (!success) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      res.status(500).json({ error: \"Failed to delete user\" });\n    }\n  });\n\n  // Contact messages routes\n  app.post(\"/api/contact\", async (req, res) => {\n    try {\n      const messageData = insertContactMessageSchema.parse(req.body);\n      const message = await storage.createContactMessage(messageData);\n      res.status(201).json(message);\n    } catch (error) {\n      console.error(\"Error creating contact message:\", error);\n      res.status(500).json({ error: \"Failed to send message\" });\n    }\n  });\n\n  app.get(\"/api/contact\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const messages = await storage.getContactMessages();\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching contact messages:\", error);\n      res.status(500).json({ error: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.patch(\"/api/contact/:id/read\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const success = await storage.markMessageAsRead(req.params.id);\n      if (!success) {\n        return res.status(404).json({ error: \"Message not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error marking message as read:\", error);\n      res.status(500).json({ error: \"Failed to update message\" });\n    }\n  });\n\n  // Delete individual contact message\n  app.delete(\"/api/contact/:id\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const success = await storage.deleteContactMessage(req.params.id);\n      if (!success) {\n        return res.status(404).json({ error: \"Message not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting contact message:\", error);\n      res.status(500).json({ error: \"Failed to delete message\" });\n    }\n  });\n\n  // Clear all contact messages\n  app.delete(\"/api/contact/clear-all\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const success = await storage.clearAllContactMessages();\n      if (!success) {\n        return res.status(500).json({ error: \"Failed to clear messages\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error clearing all contact messages:\", error);\n      res.status(500).json({ error: \"Failed to clear messages\" });\n    }\n  });\n\n  // Test admin access endpoint\n  app.get(\"/api/admin/test\", authenticateUser, requireAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      res.json({ \n        message: \"Admin access confirmed\",\n        user: req.user?.userData \n      });\n    } catch (error) {\n      console.error(\"Error testing admin access:\", error);\n      res.status(500).json({ error: \"Failed to test admin access\" });\n    }\n  });\n\n  // Admin dashboard stats\n  app.get(\"/api/admin/stats\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const [events, bookings, messages] = await Promise.all([\n        storage.getEvents(),\n        storage.getBookings(),\n        storage.getContactMessages()\n      ]);\n\n      const stats = {\n        totalEvents: events.length,\n        totalBookings: bookings.length,\n        pendingBookings: bookings.filter(b => b.status === 'pending').length,\n        confirmedBookings: bookings.filter(b => b.status === 'confirmed').length,\n        totalRevenue: bookings\n          .filter(b => b.status === 'confirmed')\n          .reduce((sum, b) => sum + parseFloat(String(b.amount || '0')), 0),\n        unreadMessages: messages.filter(m => !m.isRead).length\n      };\n\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching admin stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch stats\" });\n    }\n  });\n\n  // Storage statistics endpoint\n  app.get(\"/api/admin/storage\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const [events, bookings, messages, packages, users] = await Promise.all([\n        storage.getEvents(),\n        storage.getBookings(),\n        storage.getContactMessages(),\n        storage.getPackages(),\n        storage.getUsers()\n      ]);\n\n      // Get all photos for size calculation\n      let totalPhotos = 0;\n      let totalPhotoSize = 0;\n      const photosByEvent = {};\n\n      for (const event of events) {\n        const photos = await storage.getEventPhotos(event.id);\n        totalPhotos += photos.length;\n        photosByEvent[event.id] = photos.length;\n        \n        // Estimate photo size (approximate 2MB per photo)\n        totalPhotoSize += photos.length * 2 * 1024 * 1024; // 2MB per photo estimate\n      }\n\n      // Storage statistics\n      const storageStats = {\n        database: {\n          totalEvents: events.length,\n          totalBookings: bookings.length,\n          totalMessages: messages.length,\n          totalPackages: packages.length,\n          totalUsers: users.length,\n          totalPhotos: totalPhotos\n        },\n        storage: {\n          totalPhotoSize: totalPhotoSize,\n          totalPhotoSizeMB: Math.round(totalPhotoSize / (1024 * 1024)),\n          totalPhotoSizeGB: Math.round(totalPhotoSize / (1024 * 1024 * 1024) * 100) / 100,\n          averagePhotosPerEvent: events.length > 0 ? Math.round(totalPhotos / events.length) : 0,\n          photosByEvent: photosByEvent\n        },\n        breakdown: {\n          activeEvents: events.filter(e => (e.photoCount || 0) > 0).length,\n          emptyEvents: events.filter(e => (e.photoCount || 0) === 0).length,\n          pendingBookings: bookings.filter(b => b.status === 'pending').length,\n          confirmedBookings: bookings.filter(b => b.status === 'confirmed').length,\n          activePackages: packages.filter(p => p.isActive !== false).length,\n          inactivePackages: packages.filter(p => p.isActive === false).length,\n          adminUsers: users.filter(u => u.isAdmin === true).length,\n          regularUsers: users.filter(u => u.isAdmin !== true).length,\n          unreadMessages: messages.filter(m => !m.isRead).length,\n          readMessages: messages.filter(m => m.isRead === true).length\n        }\n      };\n\n      res.json(storageStats);\n    } catch (error) {\n      console.error(\"Error fetching storage stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch storage stats\" });\n    }\n  });\n\n  // User profile update route\n  app.put(\"/api/user/profile\", async (req: any, res) => {\n    try {\n      // Extract token from Authorization header\n      const authHeader = req.headers.authorization;\n      if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        return res.status(401).json({ error: \"No authorization token provided\" });\n      }\n\n      const token = authHeader.split(' ')[1];\n      \n      // Verify the Firebase token using our custom function\n      let decodedToken;\n      try {\n        decodedToken = await verifyFirebaseToken(token);\n      } catch (error) {\n        console.error(\"Token verification failed:\", error);\n        return res.status(401).json({ error: \"Invalid authorization token\" });\n      }\n\n      // Get user from database by Firebase UID\n      const user = await storage.getUserByFirebaseUid(decodedToken.uid);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const { displayName, phone, bio, customPhotoURL } = req.body;\n      \n      const updatedUser = await storage.updateUser(user.id, {\n        displayName,\n        phone,\n        bio,\n        customPhotoURL\n      });\n\n      if (!updatedUser) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error updating user profile:\", error);\n      res.status(500).json({ error: \"Failed to update profile\" });\n    }\n  });\n\n  // User bookings route\n  app.get(\"/api/user/bookings\", async (req: any, res) => {\n    try {\n      // Extract token from Authorization header\n      const authHeader = req.headers.authorization;\n      if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        return res.status(401).json({ error: \"No authorization token provided\" });\n      }\n\n      const token = authHeader.split(' ')[1];\n      \n      // Verify the Firebase token using our custom function\n      let decodedToken;\n      try {\n        decodedToken = await verifyFirebaseToken(token);\n      } catch (error) {\n        console.error(\"Token verification failed:\", error);\n        return res.status(401).json({ error: \"Invalid authorization token\" });\n      }\n\n      // Get user from database by Firebase UID\n      const user = await storage.getUserByFirebaseUid(decodedToken.uid);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Get all bookings and filter by user email and userId\n      const allBookings = await storage.getBookings();\n      const userBookings = allBookings.filter(booking => \n        booking.email === user.email || booking.userId === user.id\n      );\n\n      // Sort bookings by creation date (newest first)\n      userBookings.sort((a, b) => new Date(b.createdAt || '').getTime() - new Date(a.createdAt || '').getTime());\n\n      res.json(userBookings);\n    } catch (error) {\n      console.error(\"Error fetching user bookings:\", error);\n      res.status(500).json({ error: \"Failed to fetch bookings\" });\n    }\n  });\n\n  // Optimized save photo route with caching and performance improvements\n  app.post(\"/api/user/save-photo\", async (req: any, res) => {\n    const startTime = Date.now();\n    \n    try {\n      // Extract token from Authorization header\n      const authHeader = req.headers.authorization;\n      if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        return res.status(401).json({ error: \"No authorization token provided\" });\n      }\n\n      const token = authHeader.split(' ')[1];\n      \n      // Verify the Firebase token using our custom function\n      let decodedToken;\n      try {\n        decodedToken = await verifyFirebaseToken(token);\n      } catch (error) {\n        console.error(\"Token verification failed:\", error);\n        return res.status(401).json({ error: \"Invalid authorization token\" });\n      }\n\n      // Get user from database by Firebase UID (with caching)\n      const cacheKey = `user:${decodedToken.uid}`;\n      let user = cache.get(cacheKey);\n      \n      if (!user) {\n        user = await storage.getUserByFirebaseUid(decodedToken.uid);\n        if (user) {\n          cache.set(cacheKey, user, 300); // Cache for 5 minutes\n        }\n      }\n      \n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const { photoId } = req.body;\n      if (!photoId) {\n        return res.status(400).json({ error: \"Photo ID is required\" });\n      }\n\n      // Verify the photo exists (with caching)\n      const photoCacheKey = `photo:${photoId}`;\n      let photo = cache.get(photoCacheKey);\n      \n      if (!photo) {\n        photo = await storage.getPhoto(photoId);\n        if (photo) {\n          cache.set(photoCacheKey, photo, 600); // Cache for 10 minutes\n        }\n      }\n      \n      if (!photo) {\n        return res.status(404).json({ error: \"Photo not found\" });\n      }\n\n      // Save the photo to user's profile\n      const result = await storage.savePhotoToProfile((user as User).id, photoId);\n      if (!result.success) {\n        return res.status(500).json({ error: \"Failed to save photo to profile\" });\n      }\n\n      // Clear user saved photos cache  \n      cache.delete(`saved-photos:${(user as User).id}`);\n      \n      // Set response headers for optimal caching\n      res.set('Cache-Control', 'no-cache, no-store, must-revalidate');\n      res.set('Pragma', 'no-cache');\n      res.set('X-Response-Time', `${Date.now() - startTime}ms`);\n\n      if (result.alreadySaved) {\n        res.json({ \n          success: true, \n          message: \"Photo was already saved to your profile\",\n          alreadySaved: true,\n          responseTime: Date.now() - startTime\n        });\n      } else {\n        res.json({ \n          success: true, \n          message: \"Photo saved to profile successfully\",\n          alreadySaved: false,\n          responseTime: Date.now() - startTime\n        });\n      }\n    } catch (error) {\n      console.error(\"Error saving photo to profile:\", error);\n      res.status(500).json({ \n        error: \"Failed to save photo to profile\",\n        responseTime: Date.now() - startTime\n      });\n    }\n  });\n\n  // Remove photo from saved photos (POST endpoint matching frontend)\n  app.post(\"/api/user/remove-photo\", async (req: any, res) => {\n    try {\n      // Extract token from Authorization header\n      const authHeader = req.headers.authorization;\n      if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        return res.status(401).json({ error: \"No authorization token provided\" });\n      }\n\n      const token = authHeader.split(' ')[1];\n      \n      // Verify the Firebase token using our custom function\n      let decodedToken;\n      try {\n        decodedToken = await verifyFirebaseToken(token);\n      } catch (error) {\n        console.error(\"Token verification failed:\", error);\n        return res.status(401).json({ error: \"Invalid authorization token\" });\n      }\n\n      // Get user from database by Firebase UID\n      const user = await storage.getUserByFirebaseUid(decodedToken.uid);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const { photoId } = req.body;\n      if (!photoId) {\n        return res.status(400).json({ error: \"Photo ID is required\" });\n      }\n      \n      // Remove the photo from user's profile\n      const success = await storage.removePhotoFromProfile(user.id, photoId);\n      if (!success) {\n        return res.status(500).json({ error: \"Failed to remove photo from profile\" });\n      }\n\n      // Clear user saved photos cache\n      cache.delete(`saved-photos:${user.id}`);\n      \n      // Set optimal response headers\n      res.set('Cache-Control', 'no-cache, no-store, must-revalidate');\n      res.set('Pragma', 'no-cache');\n      res.set('X-Action', 'photo-removed');\n\n      res.json({ success: true, message: \"Photo removed from profile successfully\" });\n    } catch (error) {\n      console.error(\"Error removing photo from profile:\", error);\n      res.status(500).json({ error: \"Failed to remove photo from profile\" });\n    }\n  });\n\n  app.delete(\"/api/user/save-photo/:photoId\", async (req: any, res) => {\n    try {\n      // Extract token from Authorization header\n      const authHeader = req.headers.authorization;\n      if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        return res.status(401).json({ error: \"No authorization token provided\" });\n      }\n\n      const token = authHeader.split(' ')[1];\n      \n      // Verify the Firebase token using our custom function\n      let decodedToken;\n      try {\n        decodedToken = await verifyFirebaseToken(token);\n      } catch (error) {\n        console.error(\"Token verification failed:\", error);\n        return res.status(401).json({ error: \"Invalid authorization token\" });\n      }\n\n      // Get user from database by Firebase UID\n      const user = await storage.getUserByFirebaseUid(decodedToken.uid);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const { photoId } = req.params;\n      \n      // Remove the photo from user's profile\n      const success = await storage.removePhotoFromProfile(user.id, photoId);\n      if (!success) {\n        return res.status(500).json({ error: \"Failed to remove photo from profile\" });\n      }\n\n      res.json({ success: true, message: \"Photo removed from profile successfully\" });\n    } catch (error) {\n      console.error(\"Error removing photo from profile:\", error);\n      res.status(500).json({ error: \"Failed to remove photo from profile\" });\n    }\n  });\n\n  // Optimized saved photos retrieval with caching and performance monitoring\n  app.get(\"/api/user/saved-photos\", async (req: any, res) => {\n    const startTime = Date.now();\n    \n    try {\n      // Extract token from Authorization header\n      const authHeader = req.headers.authorization;\n      if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        return res.status(401).json({ error: \"No authorization token provided\" });\n      }\n\n      const token = authHeader.split(' ')[1];\n      \n      // Verify the Firebase token using our custom function\n      let decodedToken;\n      try {\n        decodedToken = await verifyFirebaseToken(token);\n      } catch (error) {\n        console.error(\"Token verification failed:\", error);\n        return res.status(401).json({ error: \"Invalid authorization token\" });\n      }\n\n      // Get user from database by Firebase UID (with caching)\n      const cacheKey = `user:${decodedToken.uid}`;\n      let user = cache.get(cacheKey);\n      \n      if (!user) {\n        user = await storage.getUserByFirebaseUid(decodedToken.uid);\n        if (user) {\n          cache.set(cacheKey, user, 300); // Cache for 5 minutes\n        }\n      }\n      \n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Check cache for saved photos\n      const savedPhotosCacheKey = `saved-photos:${(user as User).id}`;\n      let savedPhotos = cache.get(savedPhotosCacheKey) as Photo[] | undefined;\n      \n      if (!savedPhotos) {\n        savedPhotos = await storage.getUserSavedPhotos((user as User).id);\n        // Cache saved photos for 2 minutes (shorter since they change frequently)\n        cache.set(savedPhotosCacheKey, savedPhotos, 120);\n      }\n      \n      // Set response headers with performance metrics\n      res.set('Cache-Control', 'no-cache, no-store, must-revalidate');\n      res.set('Pragma', 'no-cache');\n      res.set('X-Response-Time', `${Date.now() - startTime}ms`);\n      res.set('X-Photo-Count', (savedPhotos as Photo[]).length.toString());\n      \n      res.json(savedPhotos as Photo[]);\n    } catch (error) {\n      console.error(\"Error fetching user saved photos:\", error);\n      res.status(500).json({ \n        error: \"Failed to fetch saved photos\",\n        responseTime: Date.now() - startTime\n      });\n    }\n  });\n\n  // Face recognition routes\n  app.post(\"/api/face-recognition/find-my-face\", async (req: any, res) => {\n    try {\n      const { selfieData, eventId } = req.body;\n      \n      if (!selfieData || !eventId) {\n        return res.status(400).json({ error: 'Selfie data and event ID are required' });\n      }\n      \n      // Get all photos from the event\n      const eventPhotos = await storage.getEventPhotos(eventId);\n      \n      if (eventPhotos.length === 0) {\n        return res.json({\n          success: true,\n          matchedPhotos: [],\n          totalPhotos: 0,\n          matchesFound: 0\n        });\n      }\n      \n      // Use the face recognition service to compare faces\n      const matches = await compareFaces(selfieData, eventPhotos);\n      \n      // Get the matched photos with similarity scores\n      const matchedPhotos: any[] = [];\n      const matchThreshold = 0.6; // 60% similarity threshold\n      \n      for (const match of matches) {\n        if (match.similarity >= matchThreshold) {\n          const photo = eventPhotos.find(p => p.id === match.photoId);\n          if (photo) {\n            matchedPhotos.push({\n              ...photo,\n              similarity: match.similarity\n            });\n          }\n        }\n      }\n      \n      // Sort by similarity score (highest first)\n      matchedPhotos.sort((a, b) => b.similarity - a.similarity);\n      \n      res.json({\n        success: true,\n        matchedPhotos,\n        totalPhotos: eventPhotos.length,\n        matchesFound: matchedPhotos.length\n      });\n      \n    } catch (error) {\n      console.error('Face recognition error:', error);\n      res.status(500).json({ error: 'Failed to process face recognition' });\n    }\n  });\n\n  app.post(\"/api/face-recognition/save-photos\", async (req: any, res) => {\n    try {\n      // Extract token from Authorization header\n      const authHeader = req.headers.authorization;\n      if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        return res.status(401).json({ error: \"No authorization token provided\" });\n      }\n\n      const token = authHeader.split(' ')[1];\n      \n      // Verify the Firebase token using our custom function\n      let decodedToken;\n      try {\n        decodedToken = await verifyFirebaseToken(token);\n      } catch (error) {\n        console.error(\"Token verification failed:\", error);\n        return res.status(401).json({ error: \"Invalid authorization token\" });\n      }\n\n      // Get user from database by Firebase UID\n      const user = await storage.getUserByFirebaseUid(decodedToken.uid);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      const { photoIds } = req.body;\n      \n      if (!Array.isArray(photoIds) || photoIds.length === 0) {\n        return res.status(400).json({ error: 'Photo IDs are required' });\n      }\n      \n      // Save each photo to the user's profile\n      let savedCount = 0;\n      for (const photoId of photoIds) {\n        const success = await storage.savePhotoToProfile(user.id, photoId);\n        if (success) {\n          savedCount++;\n        }\n      }\n      \n      res.json({\n        success: true,\n        savedCount: savedCount,\n        totalRequested: photoIds.length\n      });\n      \n    } catch (error) {\n      console.error('Save photos error:', error);\n      res.status(500).json({ error: 'Failed to save photos' });\n    }\n  });\n\n  // Enhanced QR Code Generation API with database storage\n  app.post(\"/api/admin/generate-qr\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const { eventId, url, expirationHours = 24, maxUsage } = req.body;\n\n      if (!eventId || !url) {\n        return res.status(400).json({ \n          success: false, \n          message: 'Event ID and URL are required' \n        });\n      }\n\n      // Get event details\n      const event = await storage.getEvent(eventId);\n      if (!event) {\n        return res.status(404).json({\n          success: false,\n          message: 'Event not found'\n        });\n      }\n\n      // Calculate expiration date based on user input\n      const expiresAt = new Date();\n      expiresAt.setHours(expiresAt.getHours() + parseInt(expirationHours));\n      const timestamp = Date.now();\n      \n      // Save QR code to database first to get the ID\n      const qrCodeData = {\n        eventId,\n        eventTitle: event.title,\n        qrCodeDataUrl: '', // Will be updated below\n        accessUrl: '', // Will be updated below\n        expiresAt: expiresAt.toISOString(),\n        isActive: true,\n        usageCount: 0,\n        maxUsage: maxUsage ? parseInt(maxUsage) : undefined,\n        createdBy: req.user?.userData?.id || 'dev-admin'\n      };\n\n      const savedQRCode = await storage.createQRCode(qrCodeData);\n      \n      // Create URL with QR code ID and expiration parameters\n      const qrUrl = `${url}?qrId=${savedQRCode.id}&expires=${expiresAt.getTime()}&ts=${timestamp}`;\n\n      // Generate QR code as data URL\n      const qrCodeDataUrl = await QRCode.toDataURL(qrUrl, {\n        width: 512,\n        margin: 2,\n        color: {\n          dark: '#000000',\n          light: '#FFFFFF'\n        }\n      });\n\n      // Update QR code with generated data\n      const updatedQRCode = await storage.updateQRCode(savedQRCode.id, {\n        qrCodeDataUrl,\n        accessUrl: qrUrl\n      });\n\n      res.json({\n        success: true,\n        qrCode: updatedQRCode || savedQRCode,\n        qrCodeDataUrl,\n        url: qrUrl,\n        eventId,\n        expiresAt: expiresAt.toISOString()\n      });\n\n    } catch (error) {\n      console.error('Error generating QR code:', error);\n      res.status(500).json({\n        success: false,\n        message: 'Failed to generate QR code'\n      });\n    }\n  });\n\n  // QR Code Management APIs\n  app.get(\"/api/admin/qr-codes\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const qrCodes = await storage.getQRCodes();\n      res.json(qrCodes);\n    } catch (error) {\n      console.error(\"Error fetching QR codes:\", error);\n      res.status(500).json({ error: \"Failed to fetch QR codes\" });\n    }\n  });\n\n  app.get(\"/api/admin/qr-codes/active\", async (req: any, res) => {\n    try {\n      const activeQRCodes = await storage.getActiveQRCodes();\n      res.json(activeQRCodes);\n    } catch (error) {\n      console.error(\"Error fetching active QR codes:\", error);\n      res.status(500).json({ error: \"Failed to fetch active QR codes\" });\n    }\n  });\n\n  app.patch(\"/api/admin/qr-codes/:qrCodeId\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const { qrCodeId } = req.params;\n      const updates = req.body;\n      \n      const updatedQRCode = await storage.updateQRCode(qrCodeId, updates);\n      if (!updatedQRCode) {\n        return res.status(404).json({ error: \"QR code not found\" });\n      }\n      \n      res.json(updatedQRCode);\n    } catch (error) {\n      console.error(\"Error updating QR code:\", error);\n      res.status(500).json({ error: \"Failed to update QR code\" });\n    }\n  });\n\n  app.delete(\"/api/admin/qr-codes/:qrCodeId\", async (req: any, res) => {\n    // Development bypass for authentication issues\n    if (process.env.NODE_ENV === 'development') {\n      req.user = {\n        firebaseUid: 'dev-admin',\n        email: process.env.ADMIN_EMAIL,\n        userData: {\n          id: 'dev-admin',\n          firebaseUid: 'dev-admin',\n          email: process.env.ADMIN_EMAIL,\n          isAdmin: true\n        }\n      };\n    }\n    try {\n      const { qrCodeId } = req.params;\n      \n      const success = await storage.deleteQRCode(qrCodeId);\n      if (!success) {\n        return res.status(404).json({ error: \"QR code not found\" });\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting QR code:\", error);\n      res.status(500).json({ error: \"Failed to delete QR code\" });\n    }\n  });\n\n  // API endpoint to validate QR code status\n  app.get(\"/api/qr-codes/:qrCodeId/validate\", async (req: any, res) => {\n    try {\n      const { qrCodeId } = req.params;\n      const qrCode = await storage.getQRCode(qrCodeId);\n      \n      if (!qrCode) {\n        return res.status(404).json({ error: \"QR code not found\" });\n      }\n      \n      if (!qrCode.isActive) {\n        return res.status(403).json({ error: \"QR code is inactive\" });\n      }\n      \n      // Check expiration\n      if (qrCode.expiresAt && new Date(qrCode.expiresAt) < new Date()) {\n        return res.status(403).json({ error: \"QR code has expired\" });\n      }\n      \n      res.json({ valid: true, eventId: qrCode.eventId });\n    } catch (error) {\n      console.error(\"Error validating QR code:\", error);\n      res.status(500).json({ error: \"Failed to validate QR code\" });\n    }\n  });\n\n  // API endpoint to get all events (for QR generation)\n  app.get(\"/api/events/all\", async (req: any, res) => {\n    try {\n      const events = await storage.getEvents();\n      res.json(events);\n    } catch (error) {\n      console.error(\"Error fetching all events:\", error);\n      res.status(500).json({ error: \"Failed to fetch events\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":74621},"server/storage.ts":{"content":"import { firebaseRest } from \"./firebase-rest\";\nimport { cache } from \"./cache\";\nimport { \n  type User, \n  type InsertUser,\n  type Event,\n  type InsertEvent,\n  type Booking,\n  type InsertBooking,\n  type ContactMessage,\n  type InsertContactMessage,\n  type Photo,\n  type InsertPhoto,\n  type Package,\n  type InsertPackage,\n  type QRCode,\n  type InsertQRCode\n} from \"@shared/types\";\n\nexport interface IStorage {\n  // User methods\n  getUser(id: string): Promise<User | undefined>;\n  getUsers(): Promise<User[]>;\n  getAdminUsers(): Promise<User[]>;\n  getUserByFirebaseUid(firebaseUid: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, updates: Partial<InsertUser>): Promise<User | undefined>;\n  deleteUser(id: string): Promise<boolean>;\n  updateUserAdminStatus(id: string, isAdmin: boolean, adminRole?: 'owner' | 'admin' | 'moderator', permissions?: string[]): Promise<User | undefined>;\n  deactivateUser(id: string): Promise<boolean>;\n  findOrCreateUserByEmail(userData: InsertUser): Promise<User>;\n  savePhotoToProfile(userId: string, photoId: string): Promise<{ success: boolean; alreadySaved?: boolean }>;\n  removePhotoFromProfile(userId: string, photoId: string): Promise<boolean>;\n  getUserSavedPhotos(userId: string): Promise<Photo[]>;\n  \n  // Event methods\n  getEvents(): Promise<Event[]>;\n  getEvent(id: string): Promise<Event | undefined>;\n  getPublicEvents(): Promise<Event[]>;\n  createEvent(event: InsertEvent): Promise<Event>;\n  updateEvent(id: string, updates: Partial<InsertEvent>): Promise<Event | undefined>;\n  deleteEvent(id: string): Promise<boolean>;\n  \n  // Booking methods\n  getBookings(): Promise<Booking[]>;\n  getBooking(id: string): Promise<Booking | undefined>;\n  getUserBookings(userId: string): Promise<Booking[]>;\n  createBooking(booking: InsertBooking): Promise<Booking>;\n  updateBooking(id: string, updates: Partial<InsertBooking>): Promise<Booking | undefined>;\n  deleteBooking(id: string): Promise<boolean>;\n  \n  // Contact methods\n  getContactMessages(): Promise<ContactMessage[]>;\n  createContactMessage(message: InsertContactMessage): Promise<ContactMessage>;\n  markMessageAsRead(id: string): Promise<boolean>;\n  deleteContactMessage(id: string): Promise<boolean>;\n  clearAllContactMessages(): Promise<boolean>;\n  \n  // Package methods\n  getPackages(): Promise<Package[]>;\n  getAllPackages(): Promise<Package[]>;\n  getActivePackages(): Promise<Package[]>;\n  createPackage(pkg: InsertPackage): Promise<Package>;\n  updatePackage(id: string, updates: Partial<InsertPackage>): Promise<Package | undefined>;\n  deletePackage(id: string): Promise<boolean>;\n  \n  // Photo methods\n  getPhoto(id: string): Promise<Photo | undefined>;\n  getEventPhotos(eventId: string): Promise<Photo[]>;\n  createPhoto(photo: InsertPhoto): Promise<Photo>;\n  updatePhoto(id: string, updates: Partial<InsertPhoto>): Promise<Photo | undefined>;\n  deletePhoto(id: string): Promise<boolean>;\n  \n  // QR Code methods\n  getQRCodes(): Promise<QRCode[]>;\n  getQRCode(id: string): Promise<QRCode | undefined>;\n  getActiveQRCodes(): Promise<QRCode[]>;\n  getEventQRCodes(eventId: string): Promise<QRCode[]>;\n  createQRCode(qrCode: InsertQRCode): Promise<QRCode>;\n  updateQRCode(id: string, updates: Partial<InsertQRCode>): Promise<QRCode | undefined>;\n  deleteQRCode(id: string): Promise<boolean>;\n  incrementQRCodeUsage(id: string): Promise<QRCode | undefined>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User methods\n  async getUser(id: string): Promise<User | undefined> {\n    try {\n      const data = await firebaseRest.get(`users/${id}`);\n      return data;\n    } catch (error) {\n      console.error('Error getting user:', error);\n      return undefined;\n    }\n  }\n\n  async getUserByFirebaseUid(firebaseUid: string): Promise<User | undefined> {\n    try {\n      const users = await firebaseRest.get('users');\n      if (!users) return undefined;\n      \n      for (const [id, user] of Object.entries(users as Record<string, any>)) {\n        if (user.firebaseUid === firebaseUid) {\n          return { ...user, id } as User;\n        }\n      }\n      return undefined;\n    } catch (error) {\n      console.error('Error getting user by Firebase UID:', error);\n      return undefined;\n    }\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    try {\n      const users = await firebaseRest.get('users');\n      if (!users) return undefined;\n      \n      for (const [id, user] of Object.entries(users as Record<string, any>)) {\n        if (user.email === email) {\n          return { ...user, id } as User;\n        }\n      }\n      return undefined;\n    } catch (error) {\n      console.error('Error getting user by email:', error);\n      return undefined;\n    }\n  }\n\n  async findOrCreateUserByEmail(userData: InsertUser): Promise<User> {\n    try {\n      // First try to find existing user by Firebase UID (most reliable)\n      let user = await this.getUserByFirebaseUid(userData.firebaseUid);\n      \n      if (user) {\n        // User exists by Firebase UID, update with latest data\n        const updatedUser = await this.updateUser(user.id, {\n          displayName: userData.displayName,\n          photoURL: userData.photoURL,\n          email: userData.email, // Update email if changed\n        });\n        return updatedUser || user;\n      }\n      \n      // Try to find by email as fallback\n      user = await this.getUserByEmail(userData.email);\n      \n      if (user) {\n        // User exists by email but not Firebase UID, update Firebase UID and other data\n        const updatedUser = await this.updateUser(user.id, {\n          displayName: userData.displayName,\n          photoURL: userData.photoURL,\n          firebaseUid: userData.firebaseUid, // Link Firebase UID to existing account\n        });\n        return updatedUser || user;\n      } else {\n        // No user exists, create new one\n        return await this.createUser(userData);\n      }\n    } catch (error) {\n      console.error('Error finding or creating user by email:', error);\n      throw error;\n    }\n  }\n\n\n\n  async createUser(user: InsertUser): Promise<User> {\n    try {\n      // Double-check for existing users by both email and Firebase UID to prevent duplicates\n      const [existingUserByEmail, existingUserByUid] = await Promise.all([\n        this.getUserByEmail(user.email),\n        this.getUserByFirebaseUid(user.firebaseUid)\n      ]);\n      \n      if (existingUserByEmail) {\n        console.log(`User with email ${user.email} already exists, returning existing user`);\n        return existingUserByEmail;\n      }\n      \n      if (existingUserByUid) {\n        console.log(`User with Firebase UID ${user.firebaseUid} already exists, returning existing user`);\n        return existingUserByUid;\n      }\n      \n      const now = new Date().toISOString();\n      const userData = {\n        ...user,\n        createdAt: now,\n        updatedAt: now,\n      };\n      \n      const id = await firebaseRest.push('users', userData);\n      const newUser: User = {\n        id,\n        ...userData,\n      };\n      \n      console.log(`Created new user with email ${user.email} and Firebase UID ${user.firebaseUid}`);\n      return newUser;\n    } catch (error) {\n      console.error('Error creating user:', error);\n      throw error;\n    }\n  }\n\n  async updateUser(id: string, updates: Partial<InsertUser>): Promise<User | undefined> {\n    try {\n      const existingUser = await this.getUser(id);\n      if (!existingUser) {\n        return undefined;\n      }\n      \n      const updatedUser = {\n        ...existingUser,\n        ...updates,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      await firebaseRest.set(`users/${id}`, updatedUser);\n      return updatedUser;\n    } catch (error) {\n      console.error('Error updating user:', error);\n      return undefined;\n    }\n  }\n\n  async getUsers(): Promise<User[]> {\n    try {\n      const users = await firebaseRest.get('users');\n      if (!users) return [];\n      \n      // Convert Firebase object to array with proper ID fields\n      const userArray = Object.entries(users as Record<string, any>).map(([id, user]) => ({\n        ...user,\n        id\n      }));\n      \n      return userArray.sort((a: User, b: User) => \n        new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime()\n      );\n    } catch (error) {\n      console.error('Error fetching users:', error);\n      return [];\n    }\n  }\n\n  async deleteUser(id: string): Promise<boolean> {\n    try {\n      const existingUser = await this.getUser(id);\n      if (!existingUser) return false;\n      \n      await firebaseRest.delete(`users/${id}`);\n      return true;\n    } catch (error) {\n      console.error('Error deleting user:', error);\n      return false;\n    }\n  }\n\n  async getAdminUsers(): Promise<User[]> {\n    try {\n      const users = await firebaseRest.get('users');\n      if (!users) return [];\n      \n      const adminUsers = Object.entries(users as Record<string, any>)\n        .filter(([_, user]) => user.isAdmin === true)\n        .map(([id, user]) => ({ ...user, id }))\n        .sort((a: User, b: User) => \n          new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime()\n        );\n      \n      return adminUsers;\n    } catch (error) {\n      console.error('Error fetching admin users:', error);\n      return [];\n    }\n  }\n\n  async updateUserAdminStatus(\n    id: string, \n    isAdmin: boolean, \n    adminRole?: 'owner' | 'admin' | 'moderator', \n    permissions?: string[]\n  ): Promise<User | undefined> {\n    try {\n      const existingUser = await this.getUser(id);\n      if (!existingUser) return undefined;\n      \n      const updates = {\n        isAdmin,\n        adminRole,\n        adminPermissions: permissions,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      const updatedUser = {\n        ...existingUser,\n        ...updates,\n      };\n      \n      await firebaseRest.set(`users/${id}`, updatedUser);\n      return updatedUser;\n    } catch (error) {\n      console.error('Error updating user admin status:', error);\n      return undefined;\n    }\n  }\n\n  async deactivateUser(id: string): Promise<boolean> {\n    try {\n      const existingUser = await this.getUser(id);\n      if (!existingUser) return false;\n      \n      const updatedUser = {\n        ...existingUser,\n        isActive: false,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      await firebaseRest.set(`users/${id}`, updatedUser);\n      return true;\n    } catch (error) {\n      console.error('Error deactivating user:', error);\n      return false;\n    }\n  }\n\n  // Event methods\n  async getEvents(): Promise<Event[]> {\n    try {\n      const events = await firebaseRest.get('events');\n      if (!events) return [];\n      \n      // Convert Firebase object to array with proper id field\n      const eventsArray = Object.entries(events as Record<string, any>).map(([key, event]) => ({\n        ...event,\n        id: key\n      })) as Event[];\n      \n      // Update photo counts efficiently\n      const photos = await firebaseRest.get('photos');\n      if (photos) {\n        const photoCounts = new Map<string, number>();\n        Object.values(photos as Record<string, any>).forEach((photo: any) => {\n          const count = photoCounts.get(photo.eventId) || 0;\n          photoCounts.set(photo.eventId, count + 1);\n        });\n        \n        eventsArray.forEach(event => {\n          event.photoCount = photoCounts.get(event.id) || 0;\n        });\n      }\n      \n      return eventsArray.sort((a: Event, b: Event) => \n        new Date(a.eventDate).getTime() - new Date(b.eventDate).getTime()\n      );\n    } catch (error) {\n      console.error('Error fetching events:', error);\n      return [];\n    }\n  }\n\n  async getEvent(id: string): Promise<Event | undefined> {\n    try {\n      const event = await firebaseRest.get(`events/${id}`);\n      if (event) {\n        return { ...event, id };\n      }\n      return undefined;\n    } catch (error) {\n      console.error('Error getting event:', error);\n      return undefined;\n    }\n  }\n\n  async getPublicEvents(): Promise<Event[]> {\n    try {\n      const events = await firebaseRest.get('events');\n      if (!events) return [];\n      \n      // Convert Firebase object to array with proper id field\n      const eventsArray = Object.entries(events as Record<string, any>).map(([key, event]) => ({\n        ...event,\n        id: key\n      })) as Event[];\n      \n      return eventsArray\n        .filter((event: Event) => !event.isPrivate)\n        .sort((a: Event, b: Event) => \n          new Date(a.eventDate).getTime() - new Date(b.eventDate).getTime()\n        );\n    } catch (error) {\n      console.error('Error fetching public events:', error);\n      return [];\n    }\n  }\n\n  async createEvent(event: InsertEvent): Promise<Event> {\n    try {\n      const now = new Date().toISOString();\n      const eventData = {\n        ...event,\n        photoCount: event.photoCount || 0,\n        isPrivate: event.isPrivate || false,\n        createdAt: now,\n        updatedAt: now,\n      };\n      \n      const id = await firebaseRest.push('events', eventData);\n      const newEvent: Event = {\n        id,\n        ...eventData,\n      };\n      \n      return newEvent;\n    } catch (error) {\n      console.error('Error creating event:', error);\n      throw error;\n    }\n  }\n\n  async updateEvent(id: string, updates: Partial<InsertEvent>): Promise<Event | undefined> {\n    try {\n      const existingEvent = await this.getEvent(id);\n      if (!existingEvent) return undefined;\n      \n      const updatedEvent = {\n        ...existingEvent,\n        ...updates,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      await firebaseRest.set(`events/${id}`, updatedEvent);\n      return updatedEvent;\n    } catch (error) {\n      console.error('Error updating event:', error);\n      return undefined;\n    }\n  }\n\n  async deleteEvent(id: string): Promise<boolean> {\n    try {\n      const existingEvent = await this.getEvent(id);\n      if (!existingEvent) return false;\n      \n      await firebaseRest.delete(`events/${id}`);\n      return true;\n    } catch (error) {\n      console.error('Error deleting event:', error);\n      return false;\n    }\n  }\n\n  // Booking methods\n  async getBookings(): Promise<Booking[]> {\n    try {\n      const bookings = await firebaseRest.get('/bookings');\n      \n      if (!bookings) {\n        return [];\n      }\n      \n      // Convert Firebase object to array with proper id field\n      const bookingArray = Object.entries(bookings as Record<string, any>).map(([key, booking]) => ({\n        ...booking,\n        id: key\n      })) as Booking[];\n      \n      return bookingArray.sort((a: any, b: any) => \n        new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n      );\n    } catch (error) {\n      console.error('Error fetching bookings:', error);\n      return [];\n    }\n  }\n\n  async getBooking(id: string): Promise<Booking | undefined> {\n    try {\n      const booking = await firebaseRest.get(`bookings/${id}`);\n      return booking;\n    } catch (error) {\n      console.error('Error getting booking:', error);\n      return undefined;\n    }\n  }\n\n  async getUserBookings(userId: string): Promise<Booking[]> {\n    try {\n      const bookings = await firebaseRest.get('bookings');\n      if (!bookings) return [];\n      \n      const userBookings = Object.values(bookings as Record<string, Booking>)\n        .filter((booking: Booking) => booking.userId === userId)\n        .sort((a: Booking, b: Booking) => \n          new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime()\n        );\n      \n      return userBookings;\n    } catch (error) {\n      console.error('Error fetching user bookings:', error);\n      return [];\n    }\n  }\n\n  async createBooking(booking: any): Promise<Booking> {\n    try {\n      const now = new Date().toISOString();\n      \n      // Create booking object with only defined values\n      const newBooking: any = {\n        status: 'pending',\n        createdAt: now,\n        updatedAt: now,\n      };\n      \n      // Only add defined values from booking\n      Object.keys(booking).forEach(key => {\n        if (booking[key] !== undefined && booking[key] !== null && booking[key] !== '') {\n          newBooking[key] = booking[key];\n        }\n      });\n      \n  \n      \n      // Use Firebase REST API to push data\n      const generatedKey = await firebaseRest.push('/bookings', newBooking);\n      \n      // Add the ID to the booking object\n      const finalBooking = {\n        id: generatedKey,\n        ...newBooking\n      };\n      \n      // Update the record with the ID\n      await firebaseRest.update(`/bookings/${generatedKey}`, { id: generatedKey });\n      \n\n      \n      return finalBooking as Booking;\n    } catch (firebaseError) {\n      console.error('Firebase booking save error:', firebaseError);\n      throw firebaseError;\n    }\n  }\n\n  async updateBooking(id: string, updates: Partial<InsertBooking>): Promise<Booking | undefined> {\n    try {\n  \n      \n      // Get current booking data first\n      const currentData = await firebaseRest.get(`/bookings/${id}`);\n      if (!currentData) {\n        console.error(`Booking ${id} not found`);\n        return undefined;\n      }\n      \n      const updatedData = {\n        ...currentData,\n        ...updates,\n        updatedAt: new Date().toISOString()\n      };\n      \n      // Update the booking using REST API\n      await firebaseRest.update(`/bookings/${id}`, updatedData);\n\n      \n      return updatedData as Booking;\n    } catch (error) {\n      console.error('Error updating booking:', error);\n      throw error;\n    }\n  }\n\n  async deleteBooking(id: string): Promise<boolean> {\n    try {\n  \n      \n      // Check if booking exists first\n      const currentData = await firebaseRest.get(`/bookings/${id}`);\n      if (!currentData) {\n        console.error(`Booking ${id} not found`);\n        return false;\n      }\n      \n      // Delete the booking using REST API\n      await firebaseRest.delete(`/bookings/${id}`);\n\n      \n      return true;\n    } catch (error) {\n      console.error('Error deleting booking:', error);\n      return false;\n    }\n  }\n\n  // Contact methods\n  async getContactMessages(): Promise<ContactMessage[]> {\n    try {\n      const messages = await firebaseRest.get('contactMessages');\n      if (!messages) return [];\n      return Object.values(messages as Record<string, ContactMessage>).sort((a: ContactMessage, b: ContactMessage) => \n        new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime()\n      );\n    } catch (error) {\n      console.error('Error fetching contact messages:', error);\n      return [];\n    }\n  }\n\n  async createContactMessage(message: InsertContactMessage): Promise<ContactMessage> {\n    try {\n      const now = new Date().toISOString();\n      const messageData = {\n        ...message,\n        isRead: message.isRead || false,\n        createdAt: now,\n      };\n      \n      const id = await firebaseRest.push('contactMessages', messageData);\n      const newMessage: ContactMessage = {\n        id,\n        ...messageData,\n      };\n      \n      await firebaseRest.update(`contactMessages/${id}`, { id });\n      return newMessage;\n    } catch (error) {\n      console.error('Error creating contact message:', error);\n      throw error;\n    }\n  }\n\n  async markMessageAsRead(id: string): Promise<boolean> {\n    try {\n      const existingMessage = await firebaseRest.get(`contactMessages/${id}`);\n      if (!existingMessage) return false;\n      \n      await firebaseRest.update(`contactMessages/${id}`, { isRead: true });\n      return true;\n    } catch (error) {\n      console.error('Error marking message as read:', error);\n      return false;\n    }\n  }\n\n  async deleteContactMessage(id: string): Promise<boolean> {\n    try {\n      const existingMessage = await firebaseRest.get(`contactMessages/${id}`);\n      if (!existingMessage) return false;\n      \n      await firebaseRest.delete(`contactMessages/${id}`);\n      // Clear cache for contact messages\n      cache.invalidatePattern('contactMessages');\n      return true;\n    } catch (error) {\n      console.error('Error deleting contact message:', error);\n      return false;\n    }\n  }\n\n  async clearAllContactMessages(): Promise<boolean> {\n    try {\n      await firebaseRest.delete('contactMessages');\n      // Clear cache for contact messages\n      cache.invalidatePattern('contactMessages');\n      return true;\n    } catch (error) {\n      console.error('Error clearing all contact messages:', error);\n      return false;\n    }\n  }\n\n  // Package methods\n  async getPackages(): Promise<Package[]> {\n    try {\n      const packages = await firebaseRest.get('packages');\n      if (!packages) return [];\n      return Object.values(packages as Record<string, Package>).sort((a: Package, b: Package) => \n        new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime()\n      );\n    } catch (error) {\n      console.error('Error fetching packages:', error);\n      return [];\n    }\n  }\n\n  async getAllPackages(): Promise<Package[]> {\n    try {\n      const packages = await firebaseRest.get('packages');\n      if (!packages) return [];\n      \n      // Return all packages without filtering - include both active and inactive\n      const packageArray = Object.values(packages as Record<string, Package>);\n      \n      return packageArray.sort((a: Package, b: Package) => \n        new Date(a.createdAt || new Date()).getTime() - new Date(b.createdAt || new Date()).getTime()\n      );\n    } catch (error) {\n      console.error('Error fetching all packages:', error);\n      return [];\n    }\n  }\n\n  async getActivePackages(): Promise<Package[]> {\n    try {\n      const packages = await firebaseRest.get('packages');\n      \n      if (!packages) {\n        return [];\n      }\n      \n      const packageArray = Object.values(packages as Record<string, Package>).filter((pkg: Package) => pkg.isActive !== false);\n      \n      return packageArray.sort((a: Package, b: Package) => \n        new Date(a.createdAt || new Date()).getTime() - new Date(b.createdAt || new Date()).getTime()\n      );\n    } catch (error) {\n      console.error('Error fetching active packages:', error);\n      return [];\n    }\n  }\n\n  async createPackage(pkg: InsertPackage): Promise<Package> {\n    try {\n      const now = new Date().toISOString();\n      const packageData = {\n        ...pkg,\n        isPopular: pkg.isPopular || false,\n        isActive: pkg.isActive !== false, // default to true\n        createdAt: now,\n        updatedAt: now,\n      };\n      \n      const generatedKey = await firebaseRest.push('/packages', packageData);\n      const newPackage: Package = {\n        id: generatedKey,\n        ...packageData,\n      };\n      \n      // Update with ID\n      await firebaseRest.update(`/packages/${generatedKey}`, { id: generatedKey });\n      \n      return newPackage;\n    } catch (error) {\n      console.error('Error creating package:', error);\n      throw error;\n    }\n  }\n\n  private async seedDefaultPackages(): Promise<void> {\n    try {\n      const defaultPackages = [\n        {\n          name: \"Basic\",\n          price: 299,\n          duration: \"2 hours\",\n          photoCount: \"50+ photos\",\n          features: [\"Professional editing\", \"Digital gallery\", \"Email delivery\"],\n          isPopular: false,\n          isActive: true\n        },\n        {\n          name: \"Premium\",\n          price: 499,\n          duration: \"4 hours\",\n          photoCount: \"100+ photos\",\n          features: [\"Professional editing\", \"Digital gallery\", \"Print release\", \"USB drive\"],\n          isPopular: true,\n          isActive: true\n        },\n        {\n          name: \"Deluxe\",\n          price: 799,\n          duration: \"8 hours\",\n          photoCount: \"200+ photos\",\n          features: [\"Professional editing\", \"Digital gallery\", \"Print release\", \"USB drive\", \"Photo album\"],\n          isPopular: false,\n          isActive: true\n        }\n      ];\n\n\n      for (const pkg of defaultPackages) {\n        await this.createPackage(pkg);\n      }\n\n    } catch (error) {\n      console.error('Error seeding default packages:', error);\n    }\n  }\n\n  async updatePackage(id: string, updates: Partial<InsertPackage>): Promise<Package | undefined> {\n    try {\n      const existingPackage = await firebaseRest.get(`packages/${id}`);\n      if (!existingPackage) return undefined;\n      \n      const updatedPackage = {\n        ...existingPackage,\n        ...updates,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      await firebaseRest.set(`packages/${id}`, updatedPackage);\n      return updatedPackage;\n    } catch (error) {\n      console.error('Error updating package:', error);\n      return undefined;\n    }\n  }\n\n  async deletePackage(id: string): Promise<boolean> {\n    try {\n      await firebaseRest.delete(`packages/${id}`);\n      return true;\n    } catch (error) {\n      console.error('Error deleting package:', error);\n      return false;\n    }\n  }\n\n  // Photo methods\n  async getPhoto(id: string): Promise<Photo | undefined> {\n    try {\n      const photo = await firebaseRest.get(`photos/${id}`);\n      return photo;\n    } catch (error) {\n      console.error('Error getting photo:', error);\n      return undefined;\n    }\n  }\n\n  async getEventPhotos(eventId: string): Promise<Photo[]> {\n    try {\n      const photos = await firebaseRest.get('photos');\n      if (!photos) return [];\n      \n      return Object.values(photos as Record<string, Photo>)\n        .filter((photo: Photo) => photo.eventId === eventId)\n        .sort((a: Photo, b: Photo) => \n          new Date(a.uploadedAt).getTime() - new Date(b.uploadedAt).getTime()\n        );\n    } catch (error) {\n      console.error('Error fetching event photos:', error);\n      return [];\n    }\n  }\n\n  async createPhoto(photo: InsertPhoto): Promise<Photo> {\n    try {\n      const now = new Date().toISOString();\n      const photoData = {\n        ...photo,\n        isProcessed: photo.isProcessed || false,\n        uploadedAt: now,\n      };\n      \n      const id = await firebaseRest.push('photos', photoData);\n      const newPhoto: Photo = {\n        id,\n        ...photoData,\n      };\n      \n      await firebaseRest.update(`photos/${id}`, { id });\n      \n      // Update event photo count in Firebase\n      await this.updateEventPhotoCount(photo.eventId);\n      \n      return newPhoto;\n    } catch (error) {\n      console.error('Error creating photo:', error);\n      throw error;\n    }\n  }\n\n  async updatePhoto(id: string, updates: Partial<InsertPhoto>): Promise<Photo | undefined> {\n    try {\n      const existingPhoto = await firebaseRest.get(`photos/${id}`);\n      if (!existingPhoto) return undefined;\n      \n      const updatedPhoto = {\n        ...existingPhoto,\n        ...updates,\n      };\n      \n      await firebaseRest.update(`photos/${id}`, updatedPhoto);\n      \n      return updatedPhoto as Photo;\n    } catch (error) {\n      console.error('Error updating photo:', error);\n      return undefined;\n    }\n  }\n\n  // Helper method to update event photo count in Firebase\n  private async updateEventPhotoCount(eventId: string): Promise<void> {\n    try {\n      // Get actual photo count from photos collection\n      const photos = await firebaseRest.get('photos');\n      let actualPhotoCount = 0;\n      \n      if (photos) {\n        actualPhotoCount = Object.values(photos as Record<string, any>)\n          .filter((photo: any) => photo.eventId === eventId)\n          .length;\n      }\n      \n      // Update the event's photo count in Firebase\n      await firebaseRest.update(`events/${eventId}`, { \n        photoCount: actualPhotoCount,\n        updatedAt: new Date().toISOString()\n      });\n      \n\n    } catch (error) {\n      console.error('Error updating event photo count:', error);\n    }\n  }\n\n  async deletePhoto(id: string): Promise<boolean> {\n    try {\n      const existingPhoto = await firebaseRest.get(`photos/${id}`);\n      if (!existingPhoto) return false;\n      \n      await firebaseRest.delete(`photos/${id}`);\n      \n      // Update event photo count in Firebase\n      await this.updateEventPhotoCount(existingPhoto.eventId);\n      \n      return true;\n    } catch (error) {\n      console.error('Error deleting photo:', error);\n      return false;\n    }\n  }\n\n  // User saved photos methods\n  async savePhotoToProfile(userId: string, photoId: string): Promise<{ success: boolean; alreadySaved?: boolean }> {\n    try {\n      console.log(`Attempting to save photo ${photoId} for user ${userId}`);\n      \n      // Get the current user data\n      const user = await firebaseRest.get(`users/${userId}`);\n      if (!user) {\n        console.log('User not found in database');\n        return { success: false };\n      }\n      \n      // Initialize savedPhotos array if it doesn't exist\n      const savedPhotos = user.savedPhotos || [];\n      console.log('Current saved photos:', savedPhotos);\n      \n      // Check if photo is already saved\n      if (savedPhotos.includes(photoId)) {\n        console.log(`Photo ${photoId} already saved`);\n        return { success: true, alreadySaved: true }; // Already saved\n      }\n      \n      // Add the photo ID to the saved photos array\n      const updatedSavedPhotos = [...savedPhotos, photoId];\n      console.log('Updated saved photos array:', updatedSavedPhotos);\n      \n      // Update the user record\n      await firebaseRest.update(`users/${userId}`, {\n        savedPhotos: updatedSavedPhotos,\n        updatedAt: new Date().toISOString()\n      });\n      \n      console.log(`Successfully saved photo ${photoId} to user ${userId} profile`);\n      \n      // Clear cache to ensure fresh data\n      cache.delete(`users/${userId}`);\n      \n      return { success: true, alreadySaved: false };\n    } catch (error) {\n      console.error('Error saving photo to profile:', error);\n      return { success: false };\n    }\n  }\n\n  async removePhotoFromProfile(userId: string, photoId: string): Promise<boolean> {\n    try {\n      // Get the current user data\n      const user = await firebaseRest.get(`users/${userId}`);\n      if (!user) return false;\n      \n      // Get current saved photos\n      const savedPhotos = user.savedPhotos || [];\n      \n      // Remove the photo ID from the saved photos array\n      const updatedSavedPhotos = savedPhotos.filter((id: string) => id !== photoId);\n      \n      // Update the user record\n      await firebaseRest.update(`users/${userId}`, {\n        savedPhotos: updatedSavedPhotos,\n        updatedAt: new Date().toISOString()\n      });\n      \n      return true;\n    } catch (error) {\n      console.error('Error removing photo from profile:', error);\n      return false;\n    }\n  }\n\n  async getUserSavedPhotos(userId: string): Promise<Photo[]> {\n    try {\n      console.log(`Fetching saved photos for user ${userId}`);\n      \n      // Clear cache for this user to ensure fresh data\n      cache.delete(`users/${userId}`);\n      \n      // Get the user data (fresh from database)\n      const user = await firebaseRest.get(`users/${userId}`);\n      if (!user || !user.savedPhotos) {\n        console.log(`No saved photos found for user ${userId}`);\n        return [];\n      }\n      \n      console.log(`User has ${user.savedPhotos.length} saved photos:`, user.savedPhotos);\n      \n      // Get all photos and filter by saved photo IDs\n      const allPhotos = await firebaseRest.get('photos');\n      if (!allPhotos) return [];\n      \n      const savedPhotos = Object.values(allPhotos as Record<string, Photo>)\n        .filter((photo: Photo) => user.savedPhotos.includes(photo.id))\n        .sort((a: Photo, b: Photo) => \n          new Date(b.uploadedAt).getTime() - new Date(a.uploadedAt).getTime()\n        );\n      \n      console.log(`Returning ${savedPhotos.length} saved photos for user ${userId}`);\n      \n      return savedPhotos;\n    } catch (error) {\n      console.error('Error fetching user saved photos:', error);\n      return [];\n    }\n  }\n\n  // QR Code methods\n  async getQRCodes(): Promise<QRCode[]> {\n    try {\n      const qrCodes = await firebaseRest.get('qrcodes');\n      if (!qrCodes) return [];\n      \n      return Object.values(qrCodes as Record<string, QRCode>)\n        .sort((a: QRCode, b: QRCode) => \n          new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n        );\n    } catch (error) {\n      console.error('Error fetching QR codes:', error);\n      return [];\n    }\n  }\n\n  async getQRCode(id: string): Promise<QRCode | undefined> {\n    try {\n      const qrCode = await firebaseRest.get(`qrcodes/${id}`);\n      return qrCode;\n    } catch (error) {\n      console.error('Error getting QR code:', error);\n      return undefined;\n    }\n  }\n\n  async getActiveQRCodes(): Promise<QRCode[]> {\n    try {\n      const qrCodes = await this.getQRCodes();\n      const now = new Date().getTime();\n      \n      return qrCodes.filter(qrCode => \n        qrCode.isActive && \n        new Date(qrCode.expiresAt).getTime() > now\n      );\n    } catch (error) {\n      console.error('Error fetching active QR codes:', error);\n      return [];\n    }\n  }\n\n  async getEventQRCodes(eventId: string): Promise<QRCode[]> {\n    try {\n      const qrCodes = await this.getQRCodes();\n      return qrCodes.filter(qrCode => qrCode.eventId === eventId);\n    } catch (error) {\n      console.error('Error fetching event QR codes:', error);\n      return [];\n    }\n  }\n\n  async createQRCode(qrCode: InsertQRCode): Promise<QRCode> {\n    try {\n      const now = new Date().toISOString();\n      const qrCodeData = {\n        ...qrCode,\n        createdAt: now,\n      };\n      \n      const id = await firebaseRest.push('qrcodes', qrCodeData);\n      const newQRCode: QRCode = {\n        id,\n        ...qrCodeData,\n      };\n      \n      await firebaseRest.update(`qrcodes/${id}`, { id });\n      \n      return newQRCode;\n    } catch (error) {\n      console.error('Error creating QR code:', error);\n      throw error;\n    }\n  }\n\n  async updateQRCode(id: string, updates: Partial<InsertQRCode>): Promise<QRCode | undefined> {\n    try {\n      const existingQRCode = await firebaseRest.get(`qrcodes/${id}`);\n      if (!existingQRCode) return undefined;\n      \n      const updatedQRCode = {\n        ...existingQRCode,\n        ...updates,\n      };\n      \n      await firebaseRest.update(`qrcodes/${id}`, updatedQRCode);\n      \n      return updatedQRCode as QRCode;\n    } catch (error) {\n      console.error('Error updating QR code:', error);\n      return undefined;\n    }\n  }\n\n  async deleteQRCode(id: string): Promise<boolean> {\n    try {\n      await firebaseRest.delete(`qrcodes/${id}`);\n      return true;\n    } catch (error) {\n      console.error('Error deleting QR code:', error);\n      return false;\n    }\n  }\n\n  async incrementQRCodeUsage(id: string): Promise<QRCode | undefined> {\n    try {\n      const existingQRCode = await firebaseRest.get(`qrcodes/${id}`);\n      if (!existingQRCode) return undefined;\n      \n      const updatedQRCode = {\n        ...existingQRCode,\n        usageCount: (existingQRCode.usageCount || 0) + 1,\n        lastUsedAt: new Date().toISOString(),\n      };\n      \n      await firebaseRest.update(`qrcodes/${id}`, updatedQRCode);\n      \n      return updatedQRCode as QRCode;\n    } catch (error) {\n      console.error('Error incrementing QR code usage:', error);\n      return undefined;\n    }\n  }\n\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":35235},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2254},"shared/types.ts":{"content":"import { z } from \"zod\";\n\n// Firebase Realtime Database compatible types\nexport interface User {\n  id: string;\n  firebaseUid: string;\n  email: string;\n  displayName?: string;\n  photoURL?: string;\n  customPhotoURL?: string;\n  isAdmin?: boolean;\n  adminRole?: 'owner' | 'admin' | 'moderator' | 'qr_share';\n  adminPermissions?: string[];\n  isActive?: boolean;\n  lastLogin?: string;\n  phone?: string;\n  bio?: string;\n  savedPhotos?: string[]; // Array of photo IDs saved to profile\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface Event {\n  id: string;\n  title: string;\n  description?: string;\n  eventDate: string;\n  location: string;\n  photoCount: number;\n  isPrivate: boolean;\n  category: string;\n  thumbnailUrl?: string;\n  publicPin?: string;\n  brideGroomPin?: string;\n  passcode?: string;\n  createdBy?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface Booking {\n  id: string;\n  userId?: string;\n  name: string;\n  email: string;\n  phone?: string;\n  eventType: string;\n  eventDate: string;\n  eventTime: string;\n  location: string;\n  duration: string;\n  guestCount?: number;\n  packageType: string;\n  amount?: number;\n  status: 'pending' | 'confirmed' | 'cancelled';\n  message?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface Photo {\n  id: string;\n  eventId: string;\n  filename: string;\n  url: string;\n  thumbnailUrl?: string;\n  tags?: string;\n  isProcessed: boolean;\n  uploadedAt: string;\n  faceData?: FaceData[];\n}\n\nexport interface FaceData {\n  bbox: number[]; // [x, y, width, height]\n  confidence: number;\n  embedding: number[];\n  landmarks?: number[][];\n}\n\nexport interface ContactMessage {\n  id: string;\n  name: string;\n  email: string;\n  subject?: string;\n  message: string;\n  isRead: boolean;\n  createdAt: string;\n}\n\nexport interface Package {\n  id: string;\n  name: string;\n  price: number;\n  duration: string;\n  photoCount: string;\n  features?: string[];\n  isPopular: boolean;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface QRCode {\n  id: string;\n  eventId: string;\n  eventTitle: string;\n  qrCodeDataUrl: string;\n  accessUrl: string;\n  expiresAt: string;\n  isActive: boolean;\n  usageCount: number;\n  maxUsage?: number;\n  createdBy: string;\n  createdAt: string;\n  lastUsedAt?: string;\n}\n\n// Zod schemas for validation\nexport const insertUserSchema = z.object({\n  firebaseUid: z.string(),\n  email: z.string().email(),\n  displayName: z.string().optional(),\n  photoURL: z.string().optional(),\n  customPhotoURL: z.string().optional(),\n  isAdmin: z.boolean().optional(),\n  adminRole: z.enum(['owner', 'admin', 'moderator']).optional(),\n  adminPermissions: z.array(z.string()).optional(),\n  isActive: z.boolean().optional(),\n  lastLogin: z.string().optional(),\n  phone: z.string().optional(),\n  bio: z.string().optional(),\n});\n\nexport const insertEventSchema = z.object({\n  title: z.string(),\n  description: z.string().optional(),\n  eventDate: z.string(),\n  location: z.string(),\n  photoCount: z.number().default(0),\n  isPrivate: z.boolean().default(false),\n  category: z.string(),\n  thumbnailUrl: z.string().optional(),\n  publicPin: z.string().optional(),\n  brideGroomPin: z.string().optional(),\n  passcode: z.string().optional(),\n  createdBy: z.string().optional(),\n});\n\nexport const insertBookingSchema = z.object({\n  userId: z.string().optional(),\n  name: z.string(),\n  email: z.string().email(),\n  phone: z.string().optional(),\n  eventType: z.string(),\n  eventDate: z.string(),\n  eventTime: z.string(),\n  location: z.string(),\n  duration: z.string(),\n  guestCount: z.union([z.number(), z.string()]).optional().transform((val) => {\n    if (val === null || val === undefined || val === '') return undefined;\n    return typeof val === 'string' ? parseInt(val, 10) || undefined : val;\n  }),\n  packageType: z.string(),\n  amount: z.number().optional(),\n  status: z.enum(['pending', 'confirmed', 'cancelled']).default('pending'),\n  message: z.string().optional(),\n});\n\nexport const insertPhotoSchema = z.object({\n  eventId: z.string(),\n  filename: z.string(),\n  url: z.string(),\n  thumbnailUrl: z.string().optional(),\n  tags: z.string().optional(),\n  isProcessed: z.boolean().default(false),\n  faceData: z.array(z.object({\n    bbox: z.array(z.number()).length(4),\n    confidence: z.number(),\n    embedding: z.array(z.number()),\n    landmarks: z.array(z.array(z.number())).optional(),\n  })).optional(),\n});\n\nexport const insertContactMessageSchema = z.object({\n  name: z.string(),\n  email: z.string().email(),\n  subject: z.string().optional(),\n  message: z.string(),\n  isRead: z.boolean().default(false),\n});\n\nexport const insertPackageSchema = z.object({\n  name: z.string(),\n  price: z.number(),\n  duration: z.string(),\n  photoCount: z.string(),\n  features: z.array(z.string()).optional(),\n  isPopular: z.boolean().default(false),\n  isActive: z.boolean().default(true),\n});\n\nexport const insertQRCodeSchema = z.object({\n  eventId: z.string(),\n  eventTitle: z.string(),\n  qrCodeDataUrl: z.string(),\n  accessUrl: z.string(),\n  expiresAt: z.string(),\n  isActive: z.boolean().default(true),\n  usageCount: z.number().default(0),\n  maxUsage: z.number().optional(),\n  createdBy: z.string(),\n  lastUsedAt: z.string().optional(),\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type InsertEvent = z.infer<typeof insertEventSchema>;\nexport type InsertBooking = z.infer<typeof insertBookingSchema>;\nexport type InsertPhoto = z.infer<typeof insertPhotoSchema>;\nexport type InsertContactMessage = z.infer<typeof insertContactMessageSchema>;\nexport type InsertPackage = z.infer<typeof insertPackageSchema>;\nexport type InsertQRCode = z.infer<typeof insertQRCodeSchema>;","size_bytes":5668},"client/src/App.css":{"content":"#root {\n  max-width: 1280px;\n  margin: 0 auto;\n  padding: 2rem;\n  text-align: center;\n}\n\n.logo {\n  height: 6em;\n  padding: 1.5em;\n  will-change: filter;\n  transition: filter 300ms;\n}\n.logo:hover {\n  filter: drop-shadow(0 0 2em #646cffaa);\n}\n.logo.react:hover {\n  filter: drop-shadow(0 0 2em #61dafbaa);\n}\n\n@keyframes logo-spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  a:nth-of-type(2) .logo {\n    animation: logo-spin infinite 20s linear;\n  }\n}\n\n.card {\n  padding: 2em;\n}\n\n.read-the-docs {\n  color: #888;\n}\n","size_bytes":606},"client/src/App.tsx":{"content":"\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { Toaster as Sonner } from \"@/components/ui/sonner\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { BrowserRouter, Routes, Route } from \"react-router-dom\";\nimport { AuthProvider } from \"./contexts/AuthContext\";\nimport ErrorBoundary from \"./components/ErrorBoundary\";\nimport { Suspense, lazy } from \"react\";\nimport LoadingSpinner from \"./components/LoadingSpinner\";\n\n// Lazy load all pages for better performance\nconst Index = lazy(() => import(\"./pages/Index\"));\nconst Events = lazy(() => import(\"./pages/Events\"));\nconst FindMyFace = lazy(() => import(\"./pages/FindMyFace\"));\nconst Booking = lazy(() => import(\"./pages/Booking\"));\nconst Contact = lazy(() => import(\"./pages/Contact\"));\nconst AdminDashboard = lazy(() => import(\"./pages/AdminDashboard\"));\nconst Profile = lazy(() => import(\"./pages/Profile\"));\nconst AlertExamples = lazy(() => import(\"./components/examples/AlertExamples\"));\n\nconst QRAccess = lazy(() => import(\"./components/QRAccess\"));\nconst NotFound = lazy(() => import(\"./pages/NotFound\"));\nconst ProtectedRoute = lazy(() => import(\"./components/ProtectedRoute\"));\n// Import AdminStatusNotification normally since it's always needed\nimport { AdminStatusNotification } from \"./components/AdminStatusNotification\";\n\n// Optimized query client with performance settings\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      staleTime: 5 * 60 * 1000, // 5 minutes\n      gcTime: 10 * 60 * 1000, // 10 minutes (formerly cacheTime)\n      refetchOnWindowFocus: false,\n      retry: 1,\n    },\n  },\n});\n\nconst App = () => {\n  return (\n    <ErrorBoundary>\n      <QueryClientProvider client={queryClient}>\n        <AuthProvider>\n          <TooltipProvider>\n            <Toaster />\n            <Sonner />\n            <AdminStatusNotification />\n            <BrowserRouter>\n              <Suspense fallback={<LoadingSpinner />}>\n                <Routes>\n                  <Route path=\"/\" element={<Index />} />\n                  <Route path=\"/events\" element={<Events />} />\n                  <Route path=\"/event/:eventId\" element={<Events />} />\n                  <Route path=\"/findmyface\" element={<FindMyFace />} />\n                  <Route path=\"/contact\" element={<Contact />} />\n\n                  <Route path=\"/booking\" element={\n                    <ProtectedRoute>\n                      <Booking />\n                    </ProtectedRoute>\n                  } />\n                  <Route path=\"/profile\" element={\n                    <ProtectedRoute>\n                      <Profile />\n                    </ProtectedRoute>\n                  } />\n                  <Route path=\"/admin\" element={\n                    <ProtectedRoute requireAdmin>\n                      <AdminDashboard />\n                    </ProtectedRoute>\n                  } />\n\n                  <Route path=\"/qr-access/:eventId\" element={<QRAccess />} />\n                  <Route path=\"/alerts\" element={<AlertExamples />} />\n                  <Route path=\"*\" element={<NotFound />} />\n                </Routes>\n              </Suspense>\n            </BrowserRouter>\n          </TooltipProvider>\n        </AuthProvider>\n      </QueryClientProvider>\n    </ErrorBoundary>\n  );\n};\n\nexport default App;\n","size_bytes":3360},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* Definition of the design system. All colors, gradients, fonts, etc should be defined here. */\n\n@layer base {\n  :root {\n    --background: 0 0% 100%;\n    --foreground: 222.2 84% 4.9%;\n\n    --card: 0 0% 100%;\n    --card-foreground: 222.2 84% 4.9%;\n\n    --popover: 0 0% 100%;\n    --popover-foreground: 222.2 84% 4.9%;\n\n    --primary: 222.2 47.4% 11.2%;\n    --primary-foreground: 210 40% 98%;\n\n    --secondary: 210 40% 96.1%;\n    --secondary-foreground: 222.2 47.4% 11.2%;\n\n    --muted: 210 40% 96.1%;\n    --muted-foreground: 215.4 16.3% 46.9%;\n\n    --accent: 210 40% 96.1%;\n    --accent-foreground: 222.2 47.4% 11.2%;\n\n    --destructive: 0 84.2% 60.2%;\n    --destructive-foreground: 210 40% 98%;\n\n    --border: 214.3 31.8% 91.4%;\n    --input: 214.3 31.8% 91.4%;\n    --ring: 222.2 84% 4.9%;\n\n    --radius: 0.5rem;\n\n    --sidebar-background: 0 0% 98%;\n\n    --sidebar-foreground: 240 5.3% 26.1%;\n\n    --sidebar-primary: 240 5.9% 10%;\n\n    --sidebar-primary-foreground: 0 0% 98%;\n\n    --sidebar-accent: 240 4.8% 95.9%;\n\n    --sidebar-accent-foreground: 240 5.9% 10%;\n\n    --sidebar-border: 220 13% 91%;\n\n    --sidebar-ring: 217.2 91.2% 59.8%;\n  }\n\n  .dark {\n    --background: 222.2 84% 4.9%;\n    --foreground: 210 40% 98%;\n\n    --card: 222.2 84% 4.9%;\n    --card-foreground: 210 40% 98%;\n\n    --popover: 222.2 84% 4.9%;\n    --popover-foreground: 210 40% 98%;\n\n    --primary: 210 40% 98%;\n    --primary-foreground: 222.2 47.4% 11.2%;\n\n    --secondary: 217.2 32.6% 17.5%;\n    --secondary-foreground: 210 40% 98%;\n\n    --muted: 217.2 32.6% 17.5%;\n    --muted-foreground: 215 20.2% 65.1%;\n\n    --accent: 217.2 32.6% 17.5%;\n    --accent-foreground: 210 40% 98%;\n\n    --destructive: 0 62.8% 30.6%;\n    --destructive-foreground: 210 40% 98%;\n\n    --border: 217.2 32.6% 17.5%;\n    --input: 217.2 32.6% 17.5%;\n    --ring: 212.7 26.8% 83.9%;\n    --sidebar-background: 240 5.9% 10%;\n    --sidebar-foreground: 240 4.8% 95.9%;\n    --sidebar-primary: 224.3 76.3% 48%;\n    --sidebar-primary-foreground: 0 0% 100%;\n    --sidebar-accent: 240 3.7% 15.9%;\n    --sidebar-accent-foreground: 240 4.8% 95.9%;\n    --sidebar-border: 240 3.7% 15.9%;\n    --sidebar-ring: 217.2 91.2% 59.8%;\n  }\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  html {\n    scroll-behavior: smooth;\n  }\n\n  body {\n    @apply bg-background text-foreground;\n  }\n}","size_bytes":2375},"client/src/main.tsx":{"content":"import { createRoot } from 'react-dom/client'\nimport App from './App.tsx'\nimport './index.css'\nimport PerformanceMonitor from './utils/performanceMonitor';\n\n// Initialize performance monitoring\nPerformanceMonitor.init();\n\nconst container = document.getElementById(\"root\");\nif (container) {\n  createRoot(container).render(<App />);\n} else {\n  console.error('Root element not found');\n}\n","size_bytes":385},"client/src/vite-env.d.ts":{"content":"/// <reference types=\"vite/client\" />\n","size_bytes":38},"server/face-recognition/app.py":{"content":"\"\"\"\nFlask API for face recognition processing.\n\"\"\"\nimport os\nimport json\nimport sys\nfrom flask import Flask, request, jsonify\nimport numpy as np\nimport cv2\nimport base64\nimport requests\nimport io\nfrom face_processor import FaceProcessor\nimport logging\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\napp = Flask(__name__)\nface_processor = None\n\ndef download_models_if_needed():\n    \"\"\"Download models before starting the face processor.\"\"\"\n    try:\n        logger.info(\"Checking for face recognition models...\")\n        \n        # Import and initialize to trigger model download\n        import insightface\n        from config import ARCFACE_MODEL_NAME\n        \n        # Create a temporary face analysis app to trigger model download\n        logger.info(f\"Downloading {ARCFACE_MODEL_NAME} model if not cached...\")\n        temp_app = insightface.app.FaceAnalysis(\n            name=ARCFACE_MODEL_NAME,\n            providers=['CPUExecutionProvider']  # Use CPU for model download\n        )\n        \n        # This will download the model if not already cached\n        temp_app.prepare(ctx_id=-1, det_size=(640, 640))\n        \n        logger.info(f\"Model {ARCFACE_MODEL_NAME} is ready\")\n        return True\n        \n    except Exception as e:\n        logger.error(f\"Failed to download models: {str(e)}\")\n        return False\n\ndef get_face_processor():\n    \"\"\"Get or create face processor instance.\"\"\"\n    global face_processor\n    if face_processor is None:\n        # Download models first if needed\n        if not download_models_if_needed():\n            logger.error(\"Failed to download required models\")\n            sys.exit(1)\n        \n        face_processor = FaceProcessor()\n    return face_processor\n\n@app.route('/health', methods=['GET'])\ndef health_check():\n    \"\"\"Health check endpoint.\"\"\"\n    return jsonify({'status': 'healthy', 'service': 'face-recognition'})\n\n@app.route('/process-photo', methods=['POST'])\ndef process_photo():\n    \"\"\"Process a photo and extract face embeddings.\"\"\"\n    try:\n        data = request.json\n        photo_path = data.get('photoPath')\n        \n        if not photo_path:\n            return jsonify({'error': 'photoPath is required'}), 400\n        \n        # Get face processor\n        processor = get_face_processor()\n        \n        # Check if photoPath is a GridFS ID (24 character hex string) or a file path\n        if len(photo_path) == 24 and all(c in '0123456789abcdef' for c in photo_path.lower()):\n            # This is a GridFS ID, download the image from the main server\n            try:\n                image_url = f\"http://localhost:5000/api/images/{photo_path}\"\n                response = requests.get(image_url, timeout=30)\n                response.raise_for_status()\n                \n                # Convert the image data to numpy array\n                image_data = np.frombuffer(response.content, np.uint8)\n                image = cv2.imdecode(image_data, cv2.IMREAD_COLOR)\n                if image is None:\n                    return jsonify({'error': 'Could not decode image data'}), 400\n                \n                # Convert BGR to RGB for face processing\n                image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n                \n                # Process the image directly\n                faces = processor.detect_faces(image)\n                \n            except requests.RequestException as e:\n                logger.error(f\"Error downloading image from GridFS: {str(e)}\")\n                return jsonify({'error': f'Could not download image: {str(e)}'}), 500\n            except Exception as e:\n                logger.error(f\"Error processing GridFS image: {str(e)}\")\n                return jsonify({'error': f'Could not process image: {str(e)}'}), 500\n        else:\n            # This is a file path, process normally\n            faces = processor.process_image_file(photo_path)\n        \n        return jsonify({\n            'success': True,\n            'faces': faces,\n            'faceCount': len(faces)\n        })\n        \n    except Exception as e:\n        logger.error(f\"Error processing photo: {str(e)}\")\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/compare-faces', methods=['POST'])\ndef compare_faces():\n    \"\"\"Compare a selfie with stored face embeddings.\"\"\"\n    try:\n        data = request.json\n        selfie_data = data.get('selfieData')  # Base64 encoded image\n        embeddings = data.get('embeddings')  # List of stored embeddings to compare against\n        \n        if not selfie_data or not embeddings:\n            return jsonify({'error': 'selfieData and embeddings are required'}), 400\n        \n        # Decode base64 image\n        image_data = base64.b64decode(selfie_data.split(',')[1] if ',' in selfie_data else selfie_data)\n        nparr = np.frombuffer(image_data, np.uint8)\n        image = cv2.imdecode(nparr, cv2.IMREAD_COLOR)\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n        \n        # Get face processor\n        processor = get_face_processor()\n        \n        # Detect faces in selfie\n        faces = processor.detect_faces(image)\n        if not faces:\n            return jsonify({'error': 'No face detected in selfie'}), 400\n        \n        # Use the first face (largest)\n        selfie_embedding = np.array(faces[0]['embedding'])\n        \n        # Calculate similarities\n        matches = []\n        for i, stored in enumerate(embeddings):\n            stored_embedding = np.array(stored['embedding'])\n            \n            # Calculate cosine similarity\n            similarity = np.dot(selfie_embedding, stored_embedding) / (\n                np.linalg.norm(selfie_embedding) * np.linalg.norm(stored_embedding)\n            )\n            \n            matches.append({\n                'photoId': stored['photoId'],\n                'similarity': float(similarity)\n            })\n        \n        # Sort by similarity\n        matches.sort(key=lambda x: x['similarity'], reverse=True)\n        \n        return jsonify({\n            'success': True,\n            'matches': matches\n        })\n        \n    except Exception as e:\n        logger.error(f\"Error comparing faces: {str(e)}\")\n        return jsonify({'error': str(e)}), 500\n\nif __name__ == '__main__':\n    # Run on a different port to avoid conflict with main app\n    app.run(host='0.0.0.0', port=5001, debug=True)","size_bytes":6357},"server/face-recognition/config.py":{"content":"\"\"\"\nConfiguration settings for the face recognition system.\n\"\"\"\n\nimport os\n\n# Model configuration\nARCFACE_MODEL_NAME = 'buffalo_l'\nEMBEDDING_DIMENSION = 512  # buffalo_l produces 512-dimensional embeddings\nSIMILARITY_THRESHOLD = 0.6  # Minimum similarity score for matches\n\n# GPU configuration\nFORCE_CPU = os.getenv(\"FORCE_CPU\", \"false\").lower() == \"true\"\nGPU_DEVICE_ID = int(os.getenv(\"GPU_DEVICE_ID\", \"0\"))\n\n# Processing configuration\nBATCH_SIZE = 32  # Images to process in a single batch\nMAX_IMAGE_SIZE = 1024  # Maximum image dimension for processing\nMIN_FACE_SIZE = 50  # Minimum face size for detection\n\n# File handling\nSUPPORTED_IMAGE_FORMATS = ['.jpg', '.jpeg', '.png', '.bmp', '.tiff', '.webp']\nMAX_IMAGES_TO_PROCESS = 1000\n\n# Logging configuration\nLOG_LEVEL = os.getenv(\"LOG_LEVEL\", \"INFO\")\nSHOW_PROGRESS = True","size_bytes":822},"server/face-recognition/face_processor.py":{"content":"\"\"\"\nFace processing module using InsightFace and ArcFace embeddings.\n\"\"\"\n\nimport numpy as np\nimport cv2\nfrom typing import List, Tuple, Optional, Dict\nimport logging\nimport os\nfrom config import (\n    ARCFACE_MODEL_NAME, FORCE_CPU, GPU_DEVICE_ID, \n    MIN_FACE_SIZE, BATCH_SIZE\n)\n\nlogger = logging.getLogger(__name__)\n\nclass FaceProcessor:\n    \"\"\"Face detection and embedding extraction using InsightFace.\"\"\"\n    \n    def __init__(self):\n        \"\"\"Initialize the face processor.\"\"\"\n        self.app = None\n        self.model_loaded = False\n        self.using_gpu = False\n        self._initialize_model()\n    \n    def _initialize_model(self):\n        \"\"\"Initialize the InsightFace model.\"\"\"\n        try:\n            import insightface\n            \n            # Determine which context to use\n            if FORCE_CPU:\n                ctx_id = -1  # CPU\n                device_info = \"CPU (forced)\"\n                self.using_gpu = False\n            else:\n                ctx_id = GPU_DEVICE_ID  # Try GPU\n                device_info = f\"GPU {GPU_DEVICE_ID}\"\n                self.using_gpu = True\n            \n            logger.info(f\"Initializing InsightFace model on {device_info}\")\n            \n            # Initialize the face analysis app\n            self.app = insightface.app.FaceAnalysis(\n                name=ARCFACE_MODEL_NAME,\n                providers=['CUDAExecutionProvider', 'CPUExecutionProvider'] if self.using_gpu else ['CPUExecutionProvider']\n            )\n            \n            # Prepare the model with context\n            self.app.prepare(ctx_id=ctx_id, det_size=(640, 640))\n            \n            self.model_loaded = True\n            logger.info(f\"Successfully initialized {ARCFACE_MODEL_NAME} model on {device_info}\")\n            \n        except Exception as e:\n            logger.error(f\"Failed to initialize face model: {str(e)}\")\n            raise RuntimeError(f\"Model initialization failed: {str(e)}\")\n    \n    def detect_faces(self, image: np.ndarray) -> List[Dict]:\n        \"\"\"\n        Detect faces in an image.\n        \n        Args:\n            image: Input image in RGB format\n            \n        Returns:\n            List of face detection results\n        \"\"\"\n        if not self.model_loaded:\n            raise RuntimeError(\"Face model not loaded\")\n        \n        try:\n            # Detect faces\n            faces = self.app.get(image)\n            \n            # Filter faces by minimum size\n            valid_faces = []\n            for face in faces:\n                bbox = face.bbox.astype(int)\n                width = bbox[2] - bbox[0]\n                height = bbox[3] - bbox[1]\n                \n                if width >= MIN_FACE_SIZE and height >= MIN_FACE_SIZE:\n                    face_info = {\n                        'bbox': (int(bbox[0]), int(bbox[1]), int(width), int(height)),\n                        'confidence': float(face.det_score),\n                        'embedding': face.embedding.tolist(),  # Convert to list for JSON serialization\n                        'landmarks': face.kps.tolist() if hasattr(face, 'kps') else None\n                    }\n                    valid_faces.append(face_info)\n                else:\n                    logger.debug(f\"Filtered out small face: {width}x{height}\")\n            \n            return valid_faces\n            \n        except Exception as e:\n            logger.error(f\"Face detection failed: {str(e)}\")\n            return []\n    \n    def process_image_file(self, image_path: str) -> List[Dict]:\n        \"\"\"\n        Process a single image file and extract face information.\n        \n        Args:\n            image_path: Path to the image file\n            \n        Returns:\n            List of face information dictionaries\n        \"\"\"\n        # Load image\n        image = cv2.imread(image_path)\n        if image is None:\n            logger.warning(f\"Could not load image: {image_path}\")\n            return []\n        \n        # Convert BGR to RGB\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n        \n        # Resize if needed\n        height, width = image.shape[:2]\n        max_dim = 1024\n        if max(height, width) > max_dim:\n            scale = max_dim / max(height, width)\n            new_width = int(width * scale)\n            new_height = int(height * scale)\n            image = cv2.resize(image, (new_width, new_height))\n        \n        # Detect faces\n        faces = self.detect_faces(image)\n        \n        logger.debug(f\"Processed {image_path}: found {len(faces)} faces\")\n        return faces\n    \n    def get_model_info(self) -> Dict:\n        \"\"\"\n        Get information about the loaded model.\n        \n        Returns:\n            Dictionary with model information\n        \"\"\"\n        return {\n            'model_name': ARCFACE_MODEL_NAME,\n            'model_loaded': self.model_loaded,\n            'using_gpu': self.using_gpu,\n            'gpu_device_id': GPU_DEVICE_ID if self.using_gpu else None,\n            'embedding_dimension': 512  # buffalo_l produces 512-dim embeddings\n        }","size_bytes":5026},"server/middleware/auth.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { verifyFirebaseToken } from '../firebase-admin';\nimport { storage } from '../storage';\n\nexport interface AuthenticatedRequest extends Request {\n  user?: {\n    firebaseUid: string;\n    email: string;\n    userData?: any;\n  };\n}\n\nexport async function authenticateUser(req: AuthenticatedRequest, res: Response, next: NextFunction) {\n  try {\n    const authHeader = req.headers.authorization;\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\n      return res.status(401).json({ error: 'No token provided' });\n    }\n\n    const token = authHeader.split(' ')[1];\n    \n    // Development bypass: If Firebase Admin is having issues, use token payload directly\n    if (process.env.NODE_ENV === 'development') {\n      console.log('Development mode: bypassing full Firebase verification');\n      try {\n        const parts = token.split('.');\n        if (parts.length >= 2) {\n          const payload = JSON.parse(Buffer.from(parts[1], 'base64').toString());\n          \n          if (payload.uid && payload.email) {\n            req.user = {\n              firebaseUid: payload.uid,\n              email: payload.email,\n            };\n\n            // Get or create user data\n            let userData = await storage.getUserByFirebaseUid(payload.uid);\n            if (!userData) {\n              userData = await storage.getUserByEmail(payload.email);\n            }\n            \n            if (!userData) {\n              // Create user in database for development\n              userData = {\n                id: payload.uid,\n                firebaseUid: payload.uid,\n                email: payload.email,\n                displayName: payload.name || 'User',\n                createdAt: new Date().toISOString(),\n                updatedAt: new Date().toISOString(),\n                // Set admin status for owner\n                isAdmin: payload.email === process.env.ADMIN_EMAIL,\n                adminRole: payload.email === process.env.ADMIN_EMAIL ? 'owner' : undefined,\n                adminPermissions: payload.email === process.env.ADMIN_EMAIL ? ['events', 'bookings', 'packages', 'photos', 'contacts', 'users', 'users_manage'] : undefined\n              };\n            } else if (payload.email === process.env.ADMIN_EMAIL && !userData.isAdmin) {\n              // Ensure owner always has admin status\n              userData.isAdmin = true;\n              userData.adminRole = 'owner';\n              userData.adminPermissions = ['events', 'bookings', 'packages', 'photos', 'contacts', 'users', 'users_manage'];\n            }\n            \n            req.user.userData = userData;\n            return next();\n          }\n        }\n      } catch (devError) {\n        console.log('Development token parsing failed, trying Firebase verification');\n      }\n    }\n    \n    // Production path: Use Firebase verification\n    try {\n      const decodedToken = await verifyFirebaseToken(token);\n      \n      req.user = {\n        firebaseUid: decodedToken.uid,\n        email: decodedToken.email || '',\n      };\n\n      // Get user data from database\n      let userData = await storage.getUserByFirebaseUid(decodedToken.uid);\n      if (!userData) {\n        userData = await storage.getUserByEmail(decodedToken.email || '');\n      }\n      \n      // Ensure owner always has admin status\n      if (userData && decodedToken.email === process.env.ADMIN_EMAIL && !userData.isAdmin) {\n        userData.isAdmin = true;\n        userData.adminRole = 'owner';\n        userData.adminPermissions = ['events', 'bookings', 'packages', 'photos', 'contacts', 'users', 'users_manage'];\n      }\n      \n      if (userData) {\n        req.user.userData = userData;\n      }\n\n      next();\n    } catch (error) {\n      console.error('Authentication error:', error);\n      res.status(401).json({ error: 'Invalid token' });\n    }\n  } catch (error) {\n    console.error('Authentication middleware error:', error);\n    res.status(401).json({ error: 'Authentication failed' });\n  }\n}\n\nexport function requireAdmin(req: AuthenticatedRequest, res: Response, next: NextFunction) {\n  // Check if user has admin privileges in the database\n  const userData = req.user?.userData;\n  const isAdmin = userData?.isAdmin === true;\n  \n  if (!isAdmin) {\n    console.log('Admin access denied for user:', userData);\n    return res.status(403).json({ error: 'Admin access required' });\n  }\n  next();\n}\n\nexport function requireOwner(req: AuthenticatedRequest, res: Response, next: NextFunction) {\n  // Only allow the owner to perform certain actions\n  const isOwner = req.user?.email === process.env.ADMIN_EMAIL && req.user?.userData?.adminRole === 'owner';\n  if (!isOwner) {\n    return res.status(403).json({ error: 'Owner access required' });\n  }\n  next();\n}","size_bytes":4753},"client/src/components/AnalyticsReport.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport type { Booking, Event, Package as PackageType } from '@shared/types';\nimport { \n  BarChart, \n  Bar, \n  LineChart, \n  Line, \n  PieChart, \n  Pie, \n  Cell, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer, \n  Legend \n} from 'recharts';\nimport { \n  TrendingUp, \n  Calendar, \n  Camera, \n  Users, \n  IndianRupee, \n  Download,\n  FileText,\n  Eye\n} from 'lucide-react';\nimport { format } from 'date-fns';\n\ninterface AnalyticsReportProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\ninterface AnalyticsData {\n  bookingStats: {\n    total: number;\n    confirmed: number;\n    pending: number;\n    cancelled: number;\n    revenue: number;\n  };\n  eventStats: {\n    total: number;\n    private: number;\n    public: number;\n    photoCount: number;\n  };\n  monthlyData: Array<{\n    month: string;\n    bookings: number;\n    revenue: number;\n    events: number;\n  }>;\n  categoryData: Array<{\n    name: string;\n    count: number;\n  }>;\n  packageData: Array<{\n    name: string;\n    bookings: number;\n    revenue: number;\n  }>;\n}\n\nexport function AnalyticsReport({ open, onOpenChange }: AnalyticsReportProps) {\n  const [loading, setLoading] = useState(true);\n  const [analyticsData, setAnalyticsData] = useState<AnalyticsData | null>(null);\n  const [activeTab, setActiveTab] = useState('overview');\n\n  useEffect(() => {\n    if (open) {\n      fetchAnalyticsData();\n    }\n  }, [open]);\n\n  const fetchAnalyticsData = async () => {\n    setLoading(true);\n    try {\n      // Fetch all required data\n      const [bookingsRes, eventsRes, photosRes, packagesRes] = await Promise.all([\n        fetch('/api/bookings'),\n        fetch('/api/events/all'),\n        fetch('/api/events'), // Public events\n        fetch('/api/packages')\n      ]);\n\n      const bookings = await bookingsRes.json();\n      const allEvents = await eventsRes.json();\n      const photos = [];\n      const packages = await packagesRes.json();\n\n      // Calculate booking statistics\n      const bookingStats = {\n        total: bookings.length,\n        confirmed: bookings.filter((b: Booking) => b.status === 'confirmed').length,\n        pending: bookings.filter((b: Booking) => b.status === 'pending').length,\n        cancelled: bookings.filter((b: Booking) => b.status === 'cancelled').length,\n        revenue: bookings\n          .filter((b: Booking) => b.status === 'confirmed')\n          .reduce((sum: number, b: Booking) => sum + (b.amount || 0), 0)\n      };\n\n      // Calculate event statistics\n      const eventStats = {\n        total: allEvents.length,\n        private: allEvents.filter((e: Event) => e.isPrivate).length,\n        public: allEvents.filter((e: Event) => !e.isPrivate).length,\n        photoCount: allEvents.reduce((sum: number, e: Event) => sum + (e.photoCount || 0), 0)\n      };\n\n      // Generate monthly data (last 6 months)\n      const monthlyData = generateMonthlyData(bookings, allEvents);\n\n      // Category distribution\n      const categoryData = generateCategoryData(bookings);\n\n      // Package performance\n      const packageData = generatePackageData(bookings, packages);\n\n      setAnalyticsData({\n        bookingStats,\n        eventStats,\n        monthlyData,\n        categoryData,\n        packageData\n      });\n    } catch (error) {\n      console.error('Error fetching analytics:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const generateMonthlyData = (bookings: Booking[], events: Event[]) => {\n    const months = [];\n    const today = new Date();\n    \n    for (let i = 5; i >= 0; i--) {\n      const date = new Date(today.getFullYear(), today.getMonth() - i, 1);\n      const monthStr = format(date, 'MMM yyyy');\n      \n      const monthBookings = bookings.filter(b => {\n        const bookingDate = new Date(b.createdAt);\n        return bookingDate.getMonth() === date.getMonth() && \n               bookingDate.getFullYear() === date.getFullYear();\n      });\n\n      const monthEvents = events.filter(e => {\n        const eventDate = new Date(e.createdAt);\n        return eventDate.getMonth() === date.getMonth() && \n               eventDate.getFullYear() === date.getFullYear();\n      });\n\n      months.push({\n        month: monthStr,\n        bookings: monthBookings.length,\n        revenue: monthBookings\n          .filter(b => b.status === 'confirmed')\n          .reduce((sum, b) => sum + (b.amount || 0), 0),\n        events: monthEvents.length\n      });\n    }\n    \n    return months;\n  };\n\n  const generateCategoryData = (bookings: Booking[]) => {\n    const categories: { [key: string]: number } = {};\n    \n    bookings.forEach(b => {\n      const category = b.eventType || 'Other';\n      categories[category] = (categories[category] || 0) + 1;\n    });\n\n    return Object.entries(categories)\n      .map(([name, count]) => ({ name, count }))\n      .sort((a, b) => b.count - a.count);\n  };\n\n  const generatePackageData = (bookings: Booking[], packages: PackageType[]) => {\n    const packageStats: { [key: string]: { bookings: number; revenue: number } } = {};\n    \n    bookings.forEach(b => {\n      const pkgName = b.packageType || 'Custom';\n      if (!packageStats[pkgName]) {\n        packageStats[pkgName] = { bookings: 0, revenue: 0 };\n      }\n      packageStats[pkgName].bookings += 1;\n      if (b.status === 'confirmed') {\n        packageStats[pkgName].revenue += (b.amount || 0);\n      }\n    });\n\n    return Object.entries(packageStats)\n      .map(([name, stats]) => ({\n        name,\n        bookings: stats.bookings,\n        revenue: stats.revenue\n      }))\n      .sort((a, b) => b.revenue - a.revenue);\n  };\n\n  const COLORS = ['#ec4899', '#f97316', '#eab308', '#22c55e', '#3b82f6', '#8b5cf6'];\n\n  const downloadReport = () => {\n    if (!analyticsData) return;\n\n    const reportContent = `\nPINMYPIC ANALYTICS REPORT\nGenerated on: ${new Date().toLocaleString()}\n\nBOOKING STATISTICS\nTotal Bookings: ${analyticsData.bookingStats.total}\nConfirmed: ${analyticsData.bookingStats.confirmed}\nPending: ${analyticsData.bookingStats.pending}\nCancelled: ${analyticsData.bookingStats.cancelled}\nTotal Revenue: ₹${analyticsData.bookingStats.revenue.toLocaleString()}\n\nEVENT STATISTICS\nTotal Events: ${analyticsData.eventStats.total}\nPrivate Events: ${analyticsData.eventStats.private}\nPublic Events: ${analyticsData.eventStats.public}\nTotal Photos: ${analyticsData.eventStats.photoCount}\n\nMONTHLY PERFORMANCE\n${analyticsData.monthlyData.map(m => \n  `${m.month}: ${m.bookings} bookings, ₹${m.revenue.toLocaleString()} revenue`\n).join('\\n')}\n\nTOP CATEGORIES\n${analyticsData.categoryData.map(c => \n  `${c.name}: ${c.count} bookings`\n).join('\\n')}\n\nPACKAGE PERFORMANCE\n${analyticsData.packageData.map(p => \n  `${p.name}: ${p.bookings} bookings, ₹${p.revenue.toLocaleString()} revenue`\n).join('\\n')}\n    `;\n\n    const blob = new Blob([reportContent], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `analytics-report-${format(new Date(), 'yyyy-MM-dd')}.txt`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center justify-between\">\n            <span className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5\" />\n              Analytics Report\n            </span>\n            <Button variant=\"outline\" size=\"sm\" onClick={downloadReport}>\n              <Download className=\"h-4 w-4 mr-2\" />\n              Download Report\n            </Button>\n          </DialogTitle>\n        </DialogHeader>\n\n        {loading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500\"></div>\n          </div>\n        ) : analyticsData ? (\n          <Tabs value={activeTab} onValueChange={setActiveTab}>\n            <TabsList className=\"grid w-full grid-cols-4\">\n              <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n              <TabsTrigger value=\"bookings\">Bookings</TabsTrigger>\n              <TabsTrigger value=\"events\">Events</TabsTrigger>\n              <TabsTrigger value=\"revenue\">Revenue</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"overview\" className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base\">Total Bookings</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{analyticsData.bookingStats.total}</div>\n                    <div className=\"text-xs text-muted-foreground mt-1\">\n                      {analyticsData.bookingStats.confirmed} confirmed\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base\">Total Revenue</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold flex items-center\">\n                      <IndianRupee className=\"h-5 w-5\" />\n                      {analyticsData.bookingStats.revenue.toLocaleString()}\n                    </div>\n                    <div className=\"text-xs text-muted-foreground mt-1\">\n                      From confirmed bookings\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base\">Total Events</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{analyticsData.eventStats.total}</div>\n                    <div className=\"text-xs text-muted-foreground mt-1\">\n                      {analyticsData.eventStats.private} private\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base\">Total Photos</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{analyticsData.eventStats.photoCount}</div>\n                    <div className=\"text-xs text-muted-foreground mt-1\">\n                      Across all events\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Monthly Trends</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ResponsiveContainer width=\"100%\" height={300}>\n                    <LineChart data={analyticsData.monthlyData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis dataKey=\"month\" />\n                      <YAxis yAxisId=\"left\" />\n                      <YAxis yAxisId=\"right\" orientation=\"right\" />\n                      <Tooltip />\n                      <Legend />\n                      <Line \n                        yAxisId=\"left\" \n                        type=\"monotone\" \n                        dataKey=\"bookings\" \n                        stroke=\"#ec4899\" \n                        name=\"Bookings\"\n                      />\n                      <Line \n                        yAxisId=\"right\" \n                        type=\"monotone\" \n                        dataKey=\"revenue\" \n                        stroke=\"#22c55e\" \n                        name=\"Revenue (₹)\"\n                      />\n                    </LineChart>\n                  </ResponsiveContainer>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"bookings\" className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Booking Status Distribution</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <ResponsiveContainer width=\"100%\" height={300}>\n                      <PieChart>\n                        <Pie\n                          data={[\n                            { name: 'Confirmed', value: analyticsData.bookingStats.confirmed },\n                            { name: 'Pending', value: analyticsData.bookingStats.pending },\n                            { name: 'Cancelled', value: analyticsData.bookingStats.cancelled }\n                          ]}\n                          cx=\"50%\"\n                          cy=\"50%\"\n                          labelLine={false}\n                          label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                          outerRadius={80}\n                          fill=\"#8884d8\"\n                          dataKey=\"value\"\n                        >\n                          <Cell fill=\"#22c55e\" />\n                          <Cell fill=\"#f97316\" />\n                          <Cell fill=\"#ef4444\" />\n                        </Pie>\n                        <Tooltip />\n                      </PieChart>\n                    </ResponsiveContainer>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Event Type Distribution</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <ResponsiveContainer width=\"100%\" height={300}>\n                      <BarChart data={analyticsData.categoryData}>\n                        <CartesianGrid strokeDasharray=\"3 3\" />\n                        <XAxis dataKey=\"name\" angle={-45} textAnchor=\"end\" height={70} />\n                        <YAxis />\n                        <Tooltip />\n                        <Bar dataKey=\"count\" fill=\"#ec4899\" />\n                      </BarChart>\n                    </ResponsiveContainer>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Monthly Booking Trends</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ResponsiveContainer width=\"100%\" height={300}>\n                    <BarChart data={analyticsData.monthlyData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis dataKey=\"month\" />\n                      <YAxis />\n                      <Tooltip />\n                      <Bar dataKey=\"bookings\" fill=\"#3b82f6\" />\n                    </BarChart>\n                  </ResponsiveContainer>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"events\" className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Event Privacy Distribution</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <ResponsiveContainer width=\"100%\" height={300}>\n                      <PieChart>\n                        <Pie\n                          data={[\n                            { name: 'Public', value: analyticsData.eventStats.public },\n                            { name: 'Private', value: analyticsData.eventStats.private }\n                          ]}\n                          cx=\"50%\"\n                          cy=\"50%\"\n                          labelLine={false}\n                          label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                          outerRadius={80}\n                          fill=\"#8884d8\"\n                          dataKey=\"value\"\n                        >\n                          <Cell fill=\"#22c55e\" />\n                          <Cell fill=\"#ef4444\" />\n                        </Pie>\n                        <Tooltip />\n                      </PieChart>\n                    </ResponsiveContainer>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Events Created Over Time</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <ResponsiveContainer width=\"100%\" height={300}>\n                      <LineChart data={analyticsData.monthlyData}>\n                        <CartesianGrid strokeDasharray=\"3 3\" />\n                        <XAxis dataKey=\"month\" />\n                        <YAxis />\n                        <Tooltip />\n                        <Line type=\"monotone\" dataKey=\"events\" stroke=\"#8b5cf6\" name=\"Events\" />\n                      </LineChart>\n                    </ResponsiveContainer>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"revenue\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Monthly Revenue Trends</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ResponsiveContainer width=\"100%\" height={300}>\n                    <BarChart data={analyticsData.monthlyData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis dataKey=\"month\" />\n                      <YAxis />\n                      <Tooltip formatter={(value) => `₹${value}`} />\n                      <Bar dataKey=\"revenue\" fill=\"#22c55e\" />\n                    </BarChart>\n                  </ResponsiveContainer>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Package Performance</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ResponsiveContainer width=\"100%\" height={300}>\n                    <BarChart data={analyticsData.packageData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis dataKey=\"name\" angle={-45} textAnchor=\"end\" height={70} />\n                      <YAxis />\n                      <Tooltip formatter={(value) => `₹${value}`} />\n                      <Bar dataKey=\"revenue\" fill=\"#f97316\" />\n                    </BarChart>\n                  </ResponsiveContainer>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        ) : (\n          <div className=\"text-center py-8\">\n            <p className=\"text-muted-foreground\">Failed to load analytics data</p>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":19276},"client/src/components/CreateBookingDialog.tsx":{"content":"import { useState } from 'react';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Calendar, Clock, MapPin, Phone, Mail, User, Users, Package, MessageSquare, Plus } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface CreateBookingDialogProps {\n  onBookingCreated: () => void;\n}\n\nexport function CreateBookingDialog({ onBookingCreated }: CreateBookingDialogProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const { toast } = useToast();\n\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    countryCode: '+91',\n    eventType: '',\n    eventDate: '',\n    eventTime: '',\n    location: '',\n    duration: '',\n    guestCount: '',\n    packageType: '',\n    amount: '',\n    status: 'pending',\n    message: ''\n  });\n\n  const eventTypes = [\n    'Wedding',\n    'Corporate Event',\n    'Birthday Party',\n    'Family Portrait',\n    'Baby & Maternity',\n    'Graduation',\n    'Concert & Show',\n    'Other'\n  ];\n\n  const durations = [\n    '2 hours',\n    '4 hours',\n    '6 hours',\n    '8 hours',\n    'Full day',\n    'Half day'\n  ];\n\n  const guestCounts = [\n    '1-10 people',\n    '11-25 people',\n    '26-50 people',\n    '51-100 people',\n    '100+ people'\n  ];\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const bookingData = {\n        ...formData,\n        phone: `${formData.countryCode}${formData.phone}`,\n        amount: formData.amount ? parseFloat(formData.amount) : undefined,\n        guestCount: formData.guestCount ? parseInt(formData.guestCount) : undefined,\n      };\n\n      const response = await fetch('/api/bookings', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(bookingData),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to create booking');\n      }\n\n      toast({\n        title: \"Booking created successfully\",\n        description: `New booking for ${formData.name} has been created.`,\n      });\n\n      // Reset form\n      setFormData({\n        name: '',\n        email: '',\n        phone: '',\n        countryCode: '+91',\n        eventType: '',\n        eventDate: '',\n        eventTime: '',\n        location: '',\n        duration: '',\n        guestCount: '',\n        packageType: '',\n        amount: '',\n        status: 'pending',\n        message: ''\n      });\n\n      setIsOpen(false);\n      onBookingCreated();\n    } catch (error) {\n      console.error('Error creating booking:', error);\n      toast({\n        title: \"Error creating booking\",\n        description: \"Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild>\n        <Button className=\"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Create New Booking\n        </Button>\n      </DialogTrigger>\n      \n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-xl font-bold\">Create New Booking</DialogTitle>\n          <DialogDescription>\n            Add a new booking request to the system\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-6 p-2\">\n          {/* Client Information */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <User className=\"h-5 w-5\" />\n                Client Information\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"name\">Full Name *</Label>\n                  <Input\n                    id=\"name\"\n                    type=\"text\"\n                    value={formData.name}\n                    onChange={(e) => handleInputChange('name', e.target.value)}\n                    placeholder=\"Client's full name\"\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"email\">Email Address *</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={(e) => handleInputChange('email', e.target.value)}\n                    placeholder=\"client@example.com\"\n                    required\n                  />\n                </div>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"phone\">Phone Number</Label>\n                <div className=\"flex gap-2\">\n                  <Select value={formData.countryCode} onValueChange={(value) => handleInputChange('countryCode', value)}>\n                    <SelectTrigger className=\"w-24\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"+91\">🇮🇳 +91</SelectItem>\n                      <SelectItem value=\"+1\">🇺🇸 +1</SelectItem>\n                      <SelectItem value=\"+44\">🇬🇧 +44</SelectItem>\n                      <SelectItem value=\"+61\">🇦🇺 +61</SelectItem>\n                      <SelectItem value=\"+81\">🇯🇵 +81</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <Input\n                    id=\"phone\"\n                    type=\"tel\"\n                    value={formData.phone}\n                    onChange={(e) => handleInputChange('phone', e.target.value)}\n                    placeholder=\"Phone number\"\n                    className=\"flex-1\"\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Event Details */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Calendar className=\"h-5 w-5\" />\n                Event Details\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"eventType\">Event Type *</Label>\n                  <Select value={formData.eventType} onValueChange={(value) => handleInputChange('eventType', value)}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select event type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {eventTypes.map((type, index) => (\n                        <SelectItem key={`${type}-${index}`} value={type}>{type}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"location\">Location *</Label>\n                  <Input\n                    id=\"location\"\n                    type=\"text\"\n                    value={formData.location}\n                    onChange={(e) => handleInputChange('location', e.target.value)}\n                    placeholder=\"Event location\"\n                    required\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid md:grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"eventDate\">Event Date *</Label>\n                  <Input\n                    id=\"eventDate\"\n                    type=\"date\"\n                    value={formData.eventDate}\n                    onChange={(e) => handleInputChange('eventDate', e.target.value)}\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"eventTime\">Event Time *</Label>\n                  <Input\n                    id=\"eventTime\"\n                    type=\"time\"\n                    value={formData.eventTime}\n                    onChange={(e) => handleInputChange('eventTime', e.target.value)}\n                    required\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"duration\">Duration</Label>\n                  <Select value={formData.duration} onValueChange={(value) => handleInputChange('duration', value)}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select duration\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {durations.map(duration => (\n                        <SelectItem key={duration} value={duration}>{duration}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"guestCount\">Guest Count</Label>\n                  <Select value={formData.guestCount} onValueChange={(value) => handleInputChange('guestCount', value)}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Expected number of guests\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {guestCounts.map(count => (\n                        <SelectItem key={count} value={count}>{count}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"packageType\">Package Type</Label>\n                  <Input\n                    id=\"packageType\"\n                    type=\"text\"\n                    value={formData.packageType}\n                    onChange={(e) => handleInputChange('packageType', e.target.value)}\n                    placeholder=\"Package selected\"\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Booking Details */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Package className=\"h-5 w-5\" />\n                Booking Details\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"amount\">Amount (₹)</Label>\n                  <Input\n                    id=\"amount\"\n                    type=\"number\"\n                    value={formData.amount}\n                    onChange={(e) => handleInputChange('amount', e.target.value)}\n                    placeholder=\"Booking amount\"\n                    min=\"0\"\n                    step=\"100\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"status\">Status</Label>\n                  <Select value={formData.status} onValueChange={(value) => handleInputChange('status', value)}>\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"pending\">Pending</SelectItem>\n                      <SelectItem value=\"confirmed\">Confirmed</SelectItem>\n                      <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"message\">Additional Details</Label>\n                <Textarea\n                  id=\"message\"\n                  value={formData.message}\n                  onChange={(e) => handleInputChange('message', e.target.value)}\n                  placeholder=\"Any special requests or additional information...\"\n                  rows={4}\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"flex justify-end gap-4 pt-4\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setIsOpen(false)}\n              disabled={loading}\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={loading}\n              className=\"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600\"\n            >\n              {loading ? 'Creating...' : 'Create Booking'}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":13364},"client/src/components/CreateEventDialog.tsx":{"content":"import React, { useState } from 'react';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Calendar, CalendarIcon, Plus } from 'lucide-react';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { Calendar as CalendarComponent } from '@/components/ui/calendar';\nimport { format } from 'date-fns';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface CreateEventDialogProps {\n  onEventCreated: () => void;\n}\n\nexport function CreateEventDialog({ onEventCreated }: CreateEventDialogProps) {\n  const [open, setOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    title: '',\n    description: '',\n    eventDate: undefined as Date | undefined,\n    location: '',\n    category: '',\n    isPrivate: false,\n    publicPin: '',\n    brideGroomPin: '',\n    thumbnailUrl: ''\n  });\n  const [loading, setLoading] = useState(false);\n  const { currentUser } = useAuth();\n\n  const generatePin = (length = 6) => {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    let result = '';\n    for (let i = 0; i < length; i++) {\n      result += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return result;\n  };\n\n  const handleGeneratePins = () => {\n    setFormData(prev => ({\n      ...prev,\n      publicPin: generatePin(6),\n      brideGroomPin: generatePin(8)\n    }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.title || !formData.eventDate || !formData.location || !formData.category) {\n      alert('Please fill in all required fields');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await fetch('/api/events', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          ...formData,\n          eventDate: formData.eventDate?.toISOString()\n        })\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        console.log('Event created successfully:', result);\n        setOpen(false);\n        setFormData({\n          title: '',\n          description: '',\n          eventDate: undefined,\n          location: '',\n          category: '',\n          isPrivate: false,\n          publicPin: '',\n          brideGroomPin: '',\n          thumbnailUrl: ''\n        });\n        onEventCreated();\n      } else {\n        console.error('Failed to create event');\n        alert('Failed to create event');\n      }\n    } catch (error) {\n      console.error('Error creating event:', error);\n      alert('Failed to create event');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button className=\"bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Create Event\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Create New Event</DialogTitle>\n          <DialogDescription>\n            Create a new photography event with access controls and photo management.\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"title\">Event Title *</Label>\n              <Input\n                id=\"title\"\n                placeholder=\"Wedding of John & Jane\"\n                value={formData.title}\n                onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}\n                required\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"category\">Category *</Label>\n              <Select value={formData.category} onValueChange={(value) => setFormData(prev => ({ ...prev, category: value }))}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select category\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"wedding\">Wedding</SelectItem>\n                  <SelectItem value=\"portrait\">Portrait</SelectItem>\n                  <SelectItem value=\"corporate\">Corporate</SelectItem>\n                  <SelectItem value=\"birthday\">Birthday</SelectItem>\n                  <SelectItem value=\"graduation\">Graduation</SelectItem>\n                  <SelectItem value=\"other\">Other</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"description\">Description</Label>\n            <Textarea\n              id=\"description\"\n              placeholder=\"Brief description of the event...\"\n              value={formData.description}\n              onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\n              rows={3}\n            />\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>Event Date *</Label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className=\"w-full justify-start text-left font-normal\"\n                  >\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                    {formData.eventDate ? format(formData.eventDate, 'PPP') : 'Pick a date'}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\">\n                  <CalendarComponent\n                    mode=\"single\"\n                    selected={formData.eventDate}\n                    onSelect={(date) => setFormData(prev => ({ ...prev, eventDate: date }))}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"location\">Location *</Label>\n              <Input\n                id=\"location\"\n                placeholder=\"Event venue or address\"\n                value={formData.location}\n                onChange={(e) => setFormData(prev => ({ ...prev, location: e.target.value }))}\n                required\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"thumbnail\">Event Thumbnail (optional)</Label>\n            <Input\n              id=\"thumbnail\"\n              type=\"file\"\n              accept=\"image/jpeg,image/jpg\"\n              onChange={async (e) => {\n                const file = e.target.files?.[0];\n                if (file && file.type.match(/^image\\/jpe?g$/i)) {\n                  // Convert to base64 for immediate storage\n                  const reader = new FileReader();\n                  reader.onloadend = () => {\n                    setFormData(prev => ({ ...prev, thumbnailUrl: reader.result as string }));\n                  };\n                  reader.readAsDataURL(file);\n                } else if (file) {\n                  alert('Please select a JPEG image file');\n                }\n              }}\n            />\n            <p className=\"text-xs text-gray-500\">Upload a JPEG image for the event thumbnail</p>\n          </div>\n\n          <div className=\"space-y-4 border rounded-lg p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <Label className=\"text-base font-medium\">Access Controls</Label>\n                <p className=\"text-sm text-gray-600\">Set up PIN codes for different access levels</p>\n              </div>\n              <Button type=\"button\" onClick={handleGeneratePins} variant=\"outline\" size=\"sm\">\n                Generate PINs\n              </Button>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"publicPin\">Public PIN</Label>\n                <Input\n                  id=\"publicPin\"\n                  placeholder=\"ABC123\"\n                  value={formData.publicPin}\n                  onChange={(e) => setFormData(prev => ({ ...prev, publicPin: e.target.value }))}\n                />\n                <p className=\"text-xs text-gray-500\">General access for guests</p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"brideGroomPin\">Bride-Groom PIN</Label>\n                <Input\n                  id=\"brideGroomPin\"\n                  placeholder=\"XYZ789AB\"\n                  value={formData.brideGroomPin}\n                  onChange={(e) => setFormData(prev => ({ ...prev, brideGroomPin: e.target.value }))}\n                />\n                <p className=\"text-xs text-gray-500\">Special access for bride and groom</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-2\">\n            <Switch\n              id=\"isPrivate\"\n              checked={formData.isPrivate}\n              onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isPrivate: checked }))}\n            />\n            <Label htmlFor=\"isPrivate\">Private Event</Label>\n            <p className=\"text-sm text-gray-600\">Only accessible with PIN codes</p>\n          </div>\n\n          <DialogFooter>\n            <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)}>\n              Cancel\n            </Button>\n            <Button \n              type=\"submit\" \n              disabled={loading}\n              className=\"bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white\"\n            >\n              {loading ? 'Creating...' : 'Create Event'}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":10467},"client/src/components/CreatePackageDialog.tsx":{"content":"import React, { useState } from 'react';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { Badge } from '@/components/ui/badge';\nimport { Plus, X } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport type { Package } from '@shared/types';\n\ninterface CreatePackageDialogProps {\n  onPackageCreated: () => void;\n  editPackage?: Package;\n  isEditing?: boolean;\n}\n\nexport function CreatePackageDialog({ onPackageCreated, editPackage, isEditing = false }: CreatePackageDialogProps) {\n  const [open, setOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: editPackage?.name || '',\n    price: editPackage?.price || '',\n    duration: editPackage?.duration || '',\n    photoCount: editPackage?.photoCount || '',\n    features: editPackage?.features || [''],\n    isPopular: editPackage?.isPopular || false,\n    isActive: editPackage?.isActive !== false,\n  });\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      // Filter out empty features\n      const cleanFeatures = formData.features.filter((feature: string) => feature.trim() !== '');\n      \n      const packageData = {\n        ...formData,\n        price: Number(formData.price),\n        features: cleanFeatures,\n      };\n\n      const url = isEditing && editPackage ? `/api/packages/${editPackage.id}` : '/api/packages';\n      const method = isEditing ? 'PATCH' : 'POST';\n\n      const response = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(packageData),\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        console.log(`Package ${isEditing ? 'updated' : 'created'} successfully:`, result);\n        \n        toast({\n          title: \"Success\",\n          description: `Package ${isEditing ? 'updated' : 'created'} successfully`,\n        });\n\n        setOpen(false);\n        setFormData({\n          name: '',\n          price: '',\n          duration: '',\n          photoCount: '',\n          features: [''],\n          isPopular: false,\n          isActive: true,\n        });\n        onPackageCreated();\n      } else {\n        throw new Error(`Failed to ${isEditing ? 'update' : 'create'} package`);\n      }\n    } catch (error) {\n      console.error(`Error ${isEditing ? 'updating' : 'creating'} package:`, error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: `Failed to ${isEditing ? 'update' : 'create'} package. Please try again.`,\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const addFeature = () => {\n    setFormData(prev => ({\n      ...prev,\n      features: [...prev.features, '']\n    }));\n  };\n\n  const updateFeature = (index: number, value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      features: prev.features.map((feature: string, i: number) => i === index ? value : feature)\n    }));\n  };\n\n  const removeFeature = (index: number) => {\n    setFormData(prev => ({\n      ...prev,\n      features: prev.features.filter((_: string, i: number) => i !== index)\n    }));\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button>\n          <Plus className=\"w-4 h-4 mr-2\" />\n          {isEditing ? 'Edit Package' : 'Add Package'}\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle>{isEditing ? 'Edit Package' : 'Create New Package'}</DialogTitle>\n          <DialogDescription>\n            {isEditing ? 'Update the package details below.' : 'Add a new photography package to your offerings.'}\n          </DialogDescription>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"name\">Package Name</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                placeholder=\"e.g., Premium\"\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"price\">Price (₹)</Label>\n              <Input\n                id=\"price\"\n                type=\"number\"\n                value={formData.price}\n                onChange={(e) => setFormData(prev => ({ ...prev, price: e.target.value }))}\n                placeholder=\"499\"\n                required\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"duration\">Duration</Label>\n              <Input\n                id=\"duration\"\n                value={formData.duration}\n                onChange={(e) => setFormData(prev => ({ ...prev, duration: e.target.value }))}\n                placeholder=\"4 hours\"\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"photoCount\">Photo Count</Label>\n              <Input\n                id=\"photoCount\"\n                value={formData.photoCount}\n                onChange={(e) => setFormData(prev => ({ ...prev, photoCount: e.target.value }))}\n                placeholder=\"100+ photos\"\n                required\n              />\n            </div>\n          </div>\n\n          <div>\n            <Label>Features</Label>\n            <div className=\"space-y-2\">\n              {formData.features.map((feature: string, index: number) => (\n                <div key={`feature-${index}`} className=\"flex gap-2\">\n                  <Input\n                    value={feature}\n                    onChange={(e) => updateFeature(index, e.target.value)}\n                    placeholder=\"e.g., Professional editing\"\n                    className=\"flex-1\"\n                  />\n                  {formData.features.length > 1 && (\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => removeFeature(index)}\n                    >\n                      <X className=\"w-4 h-4\" />\n                    </Button>\n                  )}\n                </div>\n              ))}\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={addFeature}\n                className=\"w-full\"\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Add Feature\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-2\">\n              <Switch\n                id=\"isPopular\"\n                checked={formData.isPopular}\n                onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isPopular: checked }))}\n              />\n              <Label htmlFor=\"isPopular\">Mark as Popular</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Switch\n                id=\"isActive\"\n                checked={formData.isActive}\n                onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isActive: checked }))}\n              />\n              <Label htmlFor=\"isActive\">Active</Label>\n            </div>\n          </div>\n\n          <div className=\"flex justify-end space-x-2 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={loading}>\n              {loading ? 'Saving...' : (isEditing ? 'Update Package' : 'Create Package')}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":8285},"client/src/components/EditableEventRow.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { TableCell, TableRow } from '@/components/ui/table';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { PhotoUploadDialog } from '@/components/PhotoUploadDialog';\nimport { Edit, Save, X, Eye, Calendar, MapPin, Lock, Unlock, Camera } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { Event } from '@shared/types';\n\ninterface EditableEventRowProps {\n  event: Event;\n  onEventUpdated: () => void;\n  onViewEvent: (event: Event) => void;\n}\n\nexport function EditableEventRow({ event, onEventUpdated, onViewEvent }: EditableEventRowProps) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const { toast } = useToast();\n\n  const [editData, setEditData] = useState({\n    title: event.title,\n    description: event.description || '',\n    eventDate: event.eventDate.split('T')[0], // Format for input[type=\"date\"]\n    location: event.location,\n    category: event.category,\n    isPrivate: event.isPrivate,\n    publicPin: event.publicPin || '',\n    brideGroomPin: event.brideGroomPin || '',\n    passcode: event.passcode || ''\n  });\n\n  const categories = [\n    'Wedding',\n    'Corporate',\n    'Birthday',\n    'Family',\n    'Graduation',\n    'Concert',\n    'Other'\n  ];\n\n  const handleSave = async () => {\n    setLoading(true);\n    try {\n      const response = await fetch(`/api/events/${event.id}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          ...editData,\n          eventDate: new Date(editData.eventDate).toISOString(),\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to update event');\n      }\n\n      toast({\n        title: \"Event updated\",\n        description: \"Event details have been saved successfully.\",\n      });\n\n      setIsEditing(false);\n      onEventUpdated();\n    } catch (error) {\n      console.error('Error updating event:', error);\n      toast({\n        title: \"Error updating event\",\n        description: \"Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCancel = () => {\n    setEditData({\n      title: event.title,\n      description: event.description || '',\n      eventDate: event.eventDate.split('T')[0],\n      location: event.location,\n      category: event.category,\n      isPrivate: event.isPrivate,\n      publicPin: event.publicPin || '',\n      brideGroomPin: event.brideGroomPin || '',\n      passcode: event.passcode || ''\n    });\n    setIsEditing(false);\n  };\n\n  if (isEditing) {\n    return (\n      <TableRow className=\"bg-blue-50\">\n        <TableCell>\n          <Input\n            value={editData.title}\n            onChange={(e) => setEditData(prev => ({ ...prev, title: e.target.value }))}\n            placeholder=\"Event title\"\n            className=\"min-w-[200px]\"\n          />\n        </TableCell>\n        <TableCell>\n          <Textarea\n            value={editData.description}\n            onChange={(e) => setEditData(prev => ({ ...prev, description: e.target.value }))}\n            placeholder=\"Event description\"\n            rows={2}\n            className=\"min-w-[300px]\"\n          />\n        </TableCell>\n        <TableCell>\n          <Input\n            type=\"date\"\n            value={editData.eventDate}\n            onChange={(e) => setEditData(prev => ({ ...prev, eventDate: e.target.value }))}\n            className=\"min-w-[150px]\"\n          />\n        </TableCell>\n        <TableCell>\n          <Input\n            value={editData.location}\n            onChange={(e) => setEditData(prev => ({ ...prev, location: e.target.value }))}\n            placeholder=\"Location\"\n            className=\"min-w-[150px]\"\n          />\n        </TableCell>\n        <TableCell>\n          <Select \n            value={editData.category} \n            onValueChange={(value) => setEditData(prev => ({ ...prev, category: value }))}\n          >\n            <SelectTrigger className=\"min-w-[120px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {categories.map(cat => (\n                <SelectItem key={cat} value={cat}>{cat}</SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </TableCell>\n        <TableCell>\n          <Select \n            value={editData.isPrivate.toString()} \n            onValueChange={(value) => setEditData(prev => ({ ...prev, isPrivate: value === 'true' }))}\n          >\n            <SelectTrigger className=\"min-w-[100px]\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"false\">Public</SelectItem>\n              <SelectItem value=\"true\">Private</SelectItem>\n            </SelectContent>\n          </Select>\n        </TableCell>\n        <TableCell>\n          <div className=\"space-y-2\">\n            <Input\n              value={editData.publicPin}\n              onChange={(e) => setEditData(prev => ({ ...prev, publicPin: e.target.value }))}\n              placeholder=\"Public PIN\"\n              className=\"min-w-[100px]\"\n            />\n            <Input\n              value={editData.brideGroomPin}\n              onChange={(e) => setEditData(prev => ({ ...prev, brideGroomPin: e.target.value }))}\n              placeholder=\"B&G PIN\"\n              className=\"min-w-[100px]\"\n            />\n          </div>\n        </TableCell>\n        <TableCell>{event.photoCount}</TableCell>\n        <TableCell>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              size=\"sm\"\n              onClick={handleSave}\n              disabled={loading}\n              className=\"bg-green-500 hover:bg-green-600 text-white\"\n            >\n              <Save className=\"h-3 w-3\" />\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={handleCancel}\n              disabled={loading}\n            >\n              <X className=\"h-3 w-3\" />\n            </Button>\n          </div>\n        </TableCell>\n      </TableRow>\n    );\n  }\n\n  return (\n    <TableRow className=\"hover:bg-gray-50\">\n      <TableCell>\n        <div className=\"font-medium\">{event.title}</div>\n      </TableCell>\n      <TableCell>\n        <div className=\"max-w-[300px] truncate text-sm text-gray-600\">\n          {event.description || 'No description'}\n        </div>\n      </TableCell>\n      <TableCell>\n        <div className=\"flex items-center gap-2 text-sm\">\n          <Calendar className=\"h-4 w-4 text-gray-500\" />\n          {new Date(event.eventDate).toLocaleDateString()}\n        </div>\n      </TableCell>\n      <TableCell>\n        <div className=\"flex items-center gap-2 text-sm\">\n          <MapPin className=\"h-4 w-4 text-gray-500\" />\n          {event.location}\n        </div>\n      </TableCell>\n      <TableCell>\n        <Badge variant=\"secondary\">{event.category}</Badge>\n      </TableCell>\n      <TableCell>\n        <div className=\"flex items-center gap-2\">\n          {event.isPrivate ? (\n            <>\n              <Lock className=\"h-4 w-4 text-red-500\" />\n              <span className=\"text-sm text-red-600\">Private</span>\n            </>\n          ) : (\n            <>\n              <Unlock className=\"h-4 w-4 text-green-500\" />\n              <span className=\"text-sm text-green-600\">Public</span>\n            </>\n          )}\n        </div>\n      </TableCell>\n      <TableCell>\n        <div className=\"space-y-1\">\n          {event.publicPin && (\n            <div className=\"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded\">\n              Public: {event.publicPin}\n            </div>\n          )}\n          {event.brideGroomPin && (\n            <div className=\"text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded\">\n              B&G: {event.brideGroomPin}\n            </div>\n          )}\n        </div>\n      </TableCell>\n      <TableCell>\n        <div className=\"flex items-center gap-2\">\n          <Camera className=\"h-4 w-4 text-gray-500\" />\n          <span className=\"font-medium\">{event.photoCount}</span>\n        </div>\n      </TableCell>\n      <TableCell>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={() => onViewEvent(event)}\n          >\n            <Eye className=\"h-3 w-3 mr-1\" />\n            View\n          </Button>\n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={() => setIsEditing(true)}\n            className=\"text-blue-600 hover:text-blue-700\"\n          >\n            <Edit className=\"h-3 w-3\" />\n          </Button>\n          <PhotoUploadDialog\n            eventId={event.id}\n            eventTitle={event.title}\n            onPhotosUploaded={onEventUpdated}\n          />\n        </div>\n      </TableCell>\n    </TableRow>\n  );\n}","size_bytes":9127},"client/src/components/ErrorBoundary.tsx":{"content":"import React from 'react';\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error?: Error;\n}\n\ninterface ErrorBoundaryProps {\n  children: React.ReactNode;\n}\n\nclass ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    console.error('Error caught by boundary:', error, errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n          <div className=\"text-center p-8 max-w-md\">\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Something went wrong</h1>\n            <p className=\"text-gray-600 mb-4\">\n              We're having trouble loading the page. Please refresh and try again.\n            </p>\n            <button \n              onClick={() => window.location.reload()} \n              className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n            >\n              Refresh Page\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;","size_bytes":1376},"client/src/components/EventDetailsDialog.tsx":{"content":"import React, { useState, useEffect, useRef } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { \n  ArrowLeft, \n  Save, \n  Edit, \n  Calendar, \n  MapPin, \n  Camera, \n  Lock, \n  Unlock,\n  Eye,\n  X,\n  Grid,\n  Download,\n  Trash2,\n  Upload,\n  ImageIcon,\n  ChevronLeft,\n  ChevronRight,\n  Share2\n} from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { Event, Photo } from '@shared/types';\nimport { PhotoUploadDialog } from './PhotoUploadDialog';\nimport AdminPhotoGallery from './AdminPhotoGallery';\nimport { DeleteConfirmation } from '@/components/ui/confirmation-alert';\nimport { EventShareDialog } from './EventShareDialog';\n\ninterface EventDetailsDialogProps {\n  event: Event | null;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onEventUpdated: () => void;\n  initialEditMode?: boolean;\n}\n\nexport function EventDetailsDialog({ event, open, onOpenChange, onEventUpdated, initialEditMode = false }: EventDetailsDialogProps) {\n  const [activeTab, setActiveTab] = useState('details');\n  const [isEditing, setIsEditing] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [photos, setPhotos] = useState<Photo[]>([]);\n  const [loadingPhotos, setLoadingPhotos] = useState(false);\n  const [deletingPhotoId, setDeletingPhotoId] = useState<string | null>(null);\n  const [uploadingThumbnail, setUploadingThumbnail] = useState(false);\n  const [fullScreenImage, setFullScreenImage] = useState<Photo | null>(null);\n  const [currentPhotoIndex, setCurrentPhotoIndex] = useState<number>(0);\n  const [shareDialogOpen, setShareDialogOpen] = useState(false);\n  const thumbnailInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n\n  // Navigation functions for slideshow\n  const goToPreviousPhoto = () => {\n    if (photos.length === 0) return;\n    const newIndex = currentPhotoIndex === 0 ? photos.length - 1 : currentPhotoIndex - 1;\n    setCurrentPhotoIndex(newIndex);\n    setFullScreenImage(photos[newIndex]);\n  };\n\n  const goToNextPhoto = () => {\n    if (photos.length === 0) return;\n    const newIndex = currentPhotoIndex === photos.length - 1 ? 0 : currentPhotoIndex + 1;\n    setCurrentPhotoIndex(newIndex);\n    setFullScreenImage(photos[newIndex]);\n  };\n\n  // Handle keyboard navigation\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      if (!fullScreenImage) return;\n      \n      switch (event.key) {\n        case 'ArrowLeft':\n          event.preventDefault();\n          goToPreviousPhoto();\n          break;\n        case 'ArrowRight':\n          event.preventDefault();\n          goToNextPhoto();\n          break;\n        case 'Escape':\n          event.preventDefault();\n          event.stopPropagation(); // Prevent dialog from closing\n          setFullScreenImage(null);\n          setActiveTab('gallery'); // Ensure we're on the gallery tab\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyPress);\n    return () => window.removeEventListener('keydown', handleKeyPress);\n  }, [fullScreenImage, currentPhotoIndex, photos]);\n\n  // Update photo index when fullScreenImage changes\n  useEffect(() => {\n    if (fullScreenImage) {\n      const index = photos.findIndex(photo => photo.id === fullScreenImage.id);\n      if (index !== -1) {\n        setCurrentPhotoIndex(index);\n      }\n    }\n  }, [fullScreenImage, photos]);\n\n  const [editData, setEditData] = useState({\n    title: '',\n    description: '',\n    eventDate: '',\n    location: '',\n    category: '',\n    isPrivate: false,\n    publicPin: '',\n    brideGroomPin: '',\n    passcode: ''\n  });\n\n  const categories = [\n    'Wedding',\n    'Corporate',\n    'Birthday',\n    'Family',\n    'Graduation',\n    'Concert',\n    'Other'\n  ];\n\n  useEffect(() => {\n    if (event) {\n      setEditData({\n        title: event.title,\n        description: event.description || '',\n        eventDate: event.eventDate.split('T')[0],\n        location: event.location,\n        category: event.category,\n        isPrivate: event.isPrivate,\n        publicPin: event.publicPin || '',\n        brideGroomPin: event.brideGroomPin || '',\n        passcode: event.passcode || ''\n      });\n      \n      if (activeTab === 'gallery') {\n        loadPhotos();\n      }\n    }\n  }, [event, activeTab]);\n\n  // Reset state when dialog opens\n  useEffect(() => {\n    if (open && event) {\n      setActiveTab('details');\n      setPhotos([]);\n      setIsEditing(initialEditMode);\n    }\n  }, [open, event, initialEditMode]);\n\n  const loadPhotos = async () => {\n    if (!event) return;\n    \n    setLoadingPhotos(true);\n    try {\n      const response = await fetch(`/api/events/${event.id}/photos`);\n      if (response.ok) {\n        const data = await response.json();\n        // Handle both new paginated format and old direct array format\n        if (data.photos && Array.isArray(data.photos)) {\n          setPhotos(data.photos);\n        } else if (Array.isArray(data)) {\n          setPhotos(data);\n        } else {\n          setPhotos([]);\n        }\n      }\n    } catch (error) {\n      console.error('Error loading photos:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load photos\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoadingPhotos(false);\n    }\n  };\n\n  const handleDeletePhoto = async (photoId: string) => {\n    setDeletingPhotoId(photoId);\n    try {\n      const response = await fetch(`/api/photos/${photoId}`, {\n        method: 'DELETE'\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: \"Photo deleted successfully\"\n        });\n        // Remove photo from local state\n        setPhotos(photos.filter(p => p.id !== photoId));\n        // Refresh event data to update photo count\n        onEventUpdated();\n      } else {\n        throw new Error('Failed to delete photo');\n      }\n    } catch (error) {\n      console.error('Error deleting photo:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete photo\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setDeletingPhotoId(null);\n    }\n  };\n\n  const handleSetAsThumbnail = async (photoUrl: string) => {\n    if (!event) return;\n    \n    setUploadingThumbnail(true);\n    try {\n      const response = await fetch(`/api/events/${event.id}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ thumbnailUrl: photoUrl })\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: \"Event thumbnail updated successfully\"\n        });\n        onEventUpdated();\n      } else {\n        throw new Error('Failed to update thumbnail');\n      }\n    } catch (error) {\n      console.error('Error updating thumbnail:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update thumbnail\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setUploadingThumbnail(false);\n    }\n  };\n\n  const handleSave = async () => {\n    if (!event) return;\n    \n    setLoading(true);\n    try {\n      const response = await fetch(`/api/events/${event.id}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(editData)\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: \"Event updated successfully\"\n        });\n        setIsEditing(false);\n        onEventUpdated();\n        // Update the dialog with new data\n        const updatedEvent = await response.json();\n        if (updatedEvent) {\n          setEditData({\n            title: updatedEvent.title,\n            description: updatedEvent.description || '',\n            eventDate: updatedEvent.eventDate.split('T')[0],\n            location: updatedEvent.location,\n            category: updatedEvent.category,\n            isPrivate: updatedEvent.isPrivate,\n            publicPin: updatedEvent.publicPin || '',\n            brideGroomPin: updatedEvent.brideGroomPin || '',\n            passcode: updatedEvent.passcode || ''\n          });\n        }\n      } else {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to update event');\n      }\n    } catch (error) {\n      console.error('Error updating event:', error);\n      toast({\n        title: \"Error\",\n        description: error instanceof Error ? error.message : \"Failed to update event\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleThumbnailUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file || !event) return;\n\n    // Only accept JPEG/JPG files\n    if (!file.type.match(/^image\\/jpe?g$/i)) {\n      toast({\n        title: \"Invalid file type\",\n        description: \"Please select a JPEG image file\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setUploadingThumbnail(true);\n    const formData = new FormData();\n    formData.append('photos', file); // Changed from 'file' to 'photos' to match multer config\n    formData.append('eventId', event.id);\n    formData.append('filename', file.name);\n\n    try {\n      const response = await fetch('/api/photos/upload', {\n        method: 'POST',\n        body: formData\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        // Set the uploaded photo as thumbnail\n        await handleSetAsThumbnail(data.photo.url);\n        // Load photos to show the new upload\n        loadPhotos();\n      } else {\n        throw new Error('Failed to upload thumbnail');\n      }\n    } catch (error) {\n      console.error('Error uploading thumbnail:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to upload thumbnail\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setUploadingThumbnail(false);\n      // Reset input\n      if (thumbnailInputRef.current) {\n        thumbnailInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleCancel = () => {\n    if (event) {\n      setEditData({\n        title: event.title,\n        description: event.description || '',\n        eventDate: event.eventDate.split('T')[0],\n        location: event.location,\n        category: event.category,\n        isPrivate: event.isPrivate,\n        publicPin: event.publicPin || '',\n        brideGroomPin: event.brideGroomPin || '',\n        passcode: event.passcode || ''\n      });\n    }\n    setIsEditing(false);\n  };\n\n  if (!event) return null;\n\n  return (\n    <Dialog \n      open={open} \n      onOpenChange={fullScreenImage ? undefined : onOpenChange} // Prevent closing when in slideshow\n    >\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              onClick={() => onOpenChange(false)}\n              className=\"p-1 h-auto\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <Calendar className=\"h-5 w-5\" />\n            {event.title}\n          </DialogTitle>\n          <DialogDescription className=\"sr-only\">\n            View and manage event details including photos, thumbnail, and event information\n          </DialogDescription>\n        </DialogHeader>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"details\" className=\"flex items-center gap-2\">\n              <Edit className=\"h-4 w-4\" />\n              Event Details\n            </TabsTrigger>\n            <TabsTrigger value=\"gallery\" className=\"flex items-center gap-2\">\n              <Camera className=\"h-4 w-4\" />\n              Photo Gallery ({event.photoCount})\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"details\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <Button \n                onClick={() => setShareDialogOpen(true)} \n                variant=\"outline\" \n                size=\"sm\"\n                className=\"flex items-center gap-2\"\n              >\n                <Share2 className=\"h-4 w-4\" />\n                Share Event URL\n              </Button>\n              <h3 className=\"text-lg font-semibold\">Event Information</h3>\n              <div className=\"flex gap-2\">\n                {isEditing ? (\n                  <>\n                    <Button onClick={handleSave} disabled={loading} size=\"sm\">\n                      <Save className=\"h-4 w-4 mr-2\" />\n                      Save Changes\n                    </Button>\n                    <Button onClick={handleCancel} variant=\"outline\" size=\"sm\">\n                      <X className=\"h-4 w-4 mr-2\" />\n                      Cancel\n                    </Button>\n                  </>\n                ) : (\n                  <Button onClick={() => setIsEditing(true)} size=\"sm\">\n                    <Edit className=\"h-4 w-4 mr-2\" />\n                    Edit Event\n                  </Button>\n                )}\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Basic Information</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div>\n                    <Label htmlFor=\"title\">Event Title</Label>\n                    {isEditing ? (\n                      <Input\n                        id=\"title\"\n                        value={editData.title}\n                        onChange={(e) => setEditData(prev => ({ ...prev, title: e.target.value }))}\n                        placeholder=\"Enter event title\"\n                      />\n                    ) : (\n                      <p className=\"mt-1 text-sm text-gray-600\">{event.title}</p>\n                    )}\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"description\">Description</Label>\n                    {isEditing ? (\n                      <Textarea\n                        id=\"description\"\n                        value={editData.description}\n                        onChange={(e) => setEditData(prev => ({ ...prev, description: e.target.value }))}\n                        placeholder=\"Enter event description\"\n                        rows={3}\n                      />\n                    ) : (\n                      <p className=\"mt-1 text-sm text-gray-600\">{event.description || 'No description provided'}</p>\n                    )}\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"eventDate\">Event Date</Label>\n                    {isEditing ? (\n                      <Input\n                        id=\"eventDate\"\n                        type=\"date\"\n                        value={editData.eventDate}\n                        onChange={(e) => setEditData(prev => ({ ...prev, eventDate: e.target.value }))}\n                      />\n                    ) : (\n                      <p className=\"mt-1 text-sm text-gray-600 flex items-center\">\n                        <Calendar className=\"h-4 w-4 mr-2\" />\n                        {new Date(event.eventDate).toLocaleDateString()}\n                      </p>\n                    )}\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"location\">Location</Label>\n                    {isEditing ? (\n                      <Input\n                        id=\"location\"\n                        value={editData.location}\n                        onChange={(e) => setEditData(prev => ({ ...prev, location: e.target.value }))}\n                        placeholder=\"Enter event location\"\n                      />\n                    ) : (\n                      <p className=\"mt-1 text-sm text-gray-600 flex items-center\">\n                        <MapPin className=\"h-4 w-4 mr-2\" />\n                        {event.location}\n                      </p>\n                    )}\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"category\">Category</Label>\n                    {isEditing ? (\n                      <Select \n                        value={editData.category} \n                        onValueChange={(value) => setEditData(prev => ({ ...prev, category: value }))}\n                      >\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {categories.map(cat => (\n                            <SelectItem key={cat} value={cat}>{cat}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    ) : (\n                      <Badge variant=\"secondary\" className=\"mt-1\">\n                        {event.category}\n                      </Badge>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Privacy & Access</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div>\n                    <Label>Event Type</Label>\n                    {isEditing ? (\n                      <Select \n                        value={editData.isPrivate.toString()} \n                        onValueChange={(value) => setEditData(prev => ({ ...prev, isPrivate: value === 'true' }))}\n                      >\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"false\">Public Event</SelectItem>\n                          <SelectItem value=\"true\">Private Event</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    ) : (\n                      <div className=\"mt-1\">\n                        <Badge variant={event.isPrivate ? \"destructive\" : \"secondary\"} className=\"flex items-center w-fit\">\n                          {event.isPrivate ? <Lock className=\"h-3 w-3 mr-1\" /> : <Unlock className=\"h-3 w-3 mr-1\" />}\n                          {event.isPrivate ? 'Private' : 'Public'}\n                        </Badge>\n                      </div>\n                    )}\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"publicPin\">Public PIN</Label>\n                    {isEditing ? (\n                      <Input\n                        id=\"publicPin\"\n                        value={editData.publicPin}\n                        onChange={(e) => setEditData(prev => ({ ...prev, publicPin: e.target.value }))}\n                        placeholder=\"Enter public PIN\"\n                      />\n                    ) : (\n                      <p className=\"mt-1 text-sm text-gray-600 font-mono\">\n                        {event.publicPin || 'Not set'}\n                      </p>\n                    )}\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"brideGroomPin\">Bride & Groom PIN</Label>\n                    {isEditing ? (\n                      <Input\n                        id=\"brideGroomPin\"\n                        value={editData.brideGroomPin}\n                        onChange={(e) => setEditData(prev => ({ ...prev, brideGroomPin: e.target.value }))}\n                        placeholder=\"Enter bride & groom PIN\"\n                      />\n                    ) : (\n                      <p className=\"mt-1 text-sm text-gray-600 font-mono\">\n                        {event.brideGroomPin || 'Not set'}\n                      </p>\n                    )}\n                  </div>\n\n                  <div className=\"pt-4 border-t\">\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-gray-500\">Photo Count:</span>\n                      <span className=\"font-medium flex items-center\">\n                        <Camera className=\"h-4 w-4 mr-1\" />\n                        {event.photoCount} photos\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-between text-sm mt-2\">\n                      <span className=\"text-gray-500\">Created:</span>\n                      <span className=\"text-gray-600\">{new Date(event.createdAt).toLocaleDateString()}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between text-sm mt-1\">\n                      <span className=\"text-gray-500\">Updated:</span>\n                      <span className=\"text-gray-600\">{new Date(event.updatedAt).toLocaleDateString()}</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"md:col-span-2\">\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Event Thumbnail</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {event.thumbnailUrl ? (\n                    <div className=\"space-y-4\">\n                      <img \n                        src={event.thumbnailUrl} \n                        alt=\"Event thumbnail\" \n                        className=\"w-full max-w-md h-48 object-cover rounded-lg border\"\n                        onError={(e) => {\n                          const target = e.target as HTMLImageElement;\n                          target.src = 'https://via.placeholder.com/400x300?text=No+Thumbnail';\n                        }}\n                      />\n                      <p className=\"text-xs text-gray-500\">Current thumbnail image</p>\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center justify-center w-full max-w-md h-48 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300\">\n                      <div className=\"text-center\">\n                        <ImageIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-2\" />\n                        <p className=\"text-sm text-gray-500\">No thumbnail set</p>\n                        <p className=\"text-xs text-gray-400 mt-1\">Select a photo from the gallery to set as thumbnail</p>\n                      </div>\n                    </div>\n                  )}\n                  \n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center gap-4\">\n                      <input\n                        ref={thumbnailInputRef}\n                        type=\"file\"\n                        accept=\"image/jpeg,image/jpg\"\n                        onChange={handleThumbnailUpload}\n                        className=\"hidden\"\n                        id=\"thumbnail-upload\"\n                      />\n                      <label\n                        htmlFor=\"thumbnail-upload\"\n                        className={`cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-pink-500 to-orange-500 text-white rounded-lg hover:from-pink-600 hover:to-orange-600 transition-all ${uploadingThumbnail ? 'opacity-50 cursor-not-allowed' : ''}`}\n                      >\n                        {uploadingThumbnail ? (\n                          <>\n                            <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                            Uploading...\n                          </>\n                        ) : (\n                          <>\n                            <Upload className=\"h-4 w-4\" />\n                            Upload JPEG Thumbnail\n                          </>\n                        )}\n                      </label>\n                      <span className=\"text-xs text-gray-500\">JPEG files only</span>\n                    </div>\n                    \n                    <div className=\"text-sm text-gray-600\">\n                      <p className=\"mb-2\">Or set from gallery:</p>\n                      <ol className=\"list-decimal list-inside space-y-1\">\n                        <li>Go to the Photo Gallery tab</li>\n                        <li>Hover over any photo</li>\n                        <li>Click the camera icon to set it as thumbnail</li>\n                      </ol>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"gallery\" className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n                <Grid className=\"h-5 w-5\" />\n                Photo Gallery\n              </h3>\n              <div className=\"flex gap-2\">\n                <PhotoUploadDialog \n                  eventId={event.id} \n                  eventTitle={event.title}\n                  onPhotosUploaded={() => {\n                    loadPhotos();\n                    onEventUpdated();\n                  }}\n                />\n                <Button onClick={loadPhotos} variant=\"outline\" size=\"sm\">\n                  <Camera className=\"h-4 w-4 mr-2\" />\n                  Refresh\n                </Button>\n              </div>\n            </div>\n\n            <AdminPhotoGallery\n              photos={photos}\n              loading={loadingPhotos}\n              onPhotoClick={setFullScreenImage}\n              onDeletePhoto={handleDeletePhoto}\n              onSetAsThumbnail={handleSetAsThumbnail}\n              currentThumbnailUrl={event?.thumbnailUrl}\n              deletingPhotoId={deletingPhotoId}\n              uploadingThumbnail={uploadingThumbnail}\n            />\n          </TabsContent>\n        </Tabs>\n      </DialogContent>\n\n      {/* Full Screen Image Viewer with Slideshow */}\n      {fullScreenImage && (\n        <div \n          className=\"fixed inset-0 z-[60] bg-black\"\n          onClick={(e) => {\n            // Only close if clicking on the background (not on buttons or image)\n            if (e.target === e.currentTarget) {\n              setFullScreenImage(null);\n              setActiveTab('gallery');\n            }\n          }}\n        >\n          {/* Header with back button and download */}\n          <div className=\"absolute top-0 left-0 right-0 z-20 p-4 bg-gradient-to-b from-black/80 to-transparent pointer-events-auto\">\n            <div className=\"flex items-center justify-between text-white\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  console.log('Back button clicked');\n                  setFullScreenImage(null);\n                  setActiveTab('gallery');\n                }}\n                className=\"text-white hover:bg-white/20 pointer-events-auto cursor-pointer\"\n              >\n                <ArrowLeft className=\"h-5 w-5 mr-2\" />\n                Back to Event Gallery\n              </Button>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm opacity-75\">\n                  {currentPhotoIndex + 1} of {photos.length}\n                </span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    console.log('Download button clicked');\n                    const link = document.createElement('a');\n                    link.href = fullScreenImage.url;\n                    link.download = fullScreenImage.filename;\n                    link.click();\n                  }}\n                  className=\"text-white hover:bg-white/20 pointer-events-auto cursor-pointer\"\n                >\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Download\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    console.log('Close button clicked');\n                    setFullScreenImage(null);\n                    setActiveTab('gallery');\n                  }}\n                  className=\"text-white hover:bg-white/20 pointer-events-auto cursor-pointer\"\n                >\n                  <X className=\"h-5 w-5\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Navigation Arrows */}\n          {photos.length > 1 && (\n            <>\n              {/* Previous Button */}\n              <Button\n                variant=\"ghost\"\n                size=\"lg\"\n                onClick={goToPreviousPhoto}\n                className=\"absolute left-4 top-1/2 transform -translate-y-1/2 z-20 text-white hover:bg-white/20 h-16 w-16 rounded-full pointer-events-auto\"\n              >\n                <ChevronLeft className=\"h-8 w-8\" />\n              </Button>\n\n              {/* Next Button */}\n              <Button\n                variant=\"ghost\"\n                size=\"lg\"\n                onClick={goToNextPhoto}\n                className=\"absolute right-4 top-1/2 transform -translate-y-1/2 z-20 text-white hover:bg-white/20 h-16 w-16 rounded-full pointer-events-auto\"\n              >\n                <ChevronRight className=\"h-8 w-8\" />\n              </Button>\n            </>\n          )}\n\n          {/* Image container */}\n          <div className=\"flex items-center justify-center h-full p-4 pt-20 pb-20\">\n            <img\n              src={fullScreenImage.url}\n              alt={fullScreenImage.filename}\n              className=\"max-w-full max-h-full object-contain transition-opacity duration-300\"\n              style={{ maxHeight: 'calc(100vh - 160px)' }}\n            />\n          </div>\n\n          {/* Footer with image info and navigation dots */}\n          <div className=\"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent\">\n            <div className=\"text-center text-white\">\n              <p className=\"text-sm opacity-75\">\n                {fullScreenImage.filename}\n              </p>\n              <p className=\"text-xs opacity-50 mt-1\">\n                Use arrow keys or navigation buttons to browse • Press ESC or Back button to return to event gallery\n              </p>\n              \n              {/* Navigation dots for smaller photo sets */}\n              {photos.length > 1 && photos.length <= 10 && (\n                <div className=\"flex justify-center mt-3 gap-2\">\n                  {photos.map((_, index) => (\n                    <button\n                      key={index}\n                      onClick={() => {\n                        setCurrentPhotoIndex(index);\n                        setFullScreenImage(photos[index]);\n                      }}\n                      className={`w-2 h-2 rounded-full transition-all ${\n                        index === currentPhotoIndex \n                          ? 'bg-white scale-125' \n                          : 'bg-white/50 hover:bg-white/75'\n                      }`}\n                    />\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Event Share Dialog */}\n      <EventShareDialog \n        open={shareDialogOpen}\n        onOpenChange={setShareDialogOpen}\n        event={event}\n      />\n    </Dialog>\n  );\n}","size_bytes":32264},"client/src/components/EventTypes.tsx":{"content":"\nimport { Heart, Users, Building, Baby, Cake, Star, GraduationCap, Music } from 'lucide-react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n\nconst EventTypes = () => {\n  const eventTypes = [\n    {\n      icon: <Heart className=\"h-8 w-8\" />,\n      title: \"Weddings\",\n      description: \"Capturing your special day with romantic elegance and timeless beauty\",\n      color: \"from-pink-500 to-rose-500\",\n      bgColor: \"from-pink-50 to-rose-50\"\n    },\n    {\n      icon: <Building className=\"h-8 w-8\" />,\n      title: \"Corporate Events\",\n      description: \"Professional photography for conferences, galas, and business gatherings\",\n      color: \"from-blue-500 to-cyan-500\",\n      bgColor: \"from-blue-50 to-cyan-50\"\n    },\n    {\n      icon: <Cake className=\"h-8 w-8\" />,\n      title: \"Birthday Parties\",\n      description: \"Joyful celebrations and milestone moments captured with fun and creativity\",\n      color: \"from-yellow-500 to-orange-500\",\n      bgColor: \"from-yellow-50 to-orange-50\"\n    },\n    {\n      icon: <Users className=\"h-8 w-8\" />,\n      title: \"Family Portraits\",\n      description: \"Beautiful family memories preserved with warmth and natural connection\",\n      color: \"from-green-500 to-emerald-500\",\n      bgColor: \"from-green-50 to-emerald-50\"\n    },\n    {\n      icon: <Baby className=\"h-8 w-8\" />,\n      title: \"Baby & Maternity\",\n      description: \"Tender moments and new beginnings captured with gentle care\",\n      color: \"from-purple-500 to-violet-500\",\n      bgColor: \"from-purple-50 to-violet-50\"\n    },\n    {\n      icon: <GraduationCap className=\"h-8 w-8\" />,\n      title: \"Graduations\",\n      description: \"Achievement milestones and proud moments documented beautifully\",\n      color: \"from-indigo-500 to-blue-500\",\n      bgColor: \"from-indigo-50 to-blue-50\"\n    },\n    {\n      icon: <Music className=\"h-8 w-8\" />,\n      title: \"Concerts & Shows\",\n      description: \"Live performances and entertainment events with dynamic energy\",\n      color: \"from-red-500 to-pink-500\",\n      bgColor: \"from-red-50 to-pink-50\"\n    },\n    {\n      icon: <Star className=\"h-8 w-8\" />,\n      title: \"Special Occasions\",\n      description: \"Anniversaries, engagements, and unique celebrations tailored to you\",\n      color: \"from-amber-500 to-yellow-500\",\n      bgColor: \"from-amber-50 to-yellow-50\"\n    }\n  ];\n\n  return (\n    <section className=\"py-20 bg-white\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"text-center mb-12\">\n          <h2 className=\"text-4xl md:text-5xl font-bold mb-4\">\n            <span className=\"bg-gradient-to-r from-orange-500 to-cyan-500 bg-clip-text text-transparent\">\n              Event Types\n            </span>\n          </h2>\n          <p className=\"text-xl text-gray-600 max-w-3xl mx-auto\">\n            Specializing in various types of events, each captured with unique style and attention to detail\n          </p>\n        </div>\n\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {eventTypes.map((eventType, index) => (\n            <Card key={index} className=\"group hover:shadow-xl transition-all duration-300 hover:scale-105 border-0 overflow-hidden\">\n              <div className={`h-2 bg-gradient-to-r ${eventType.color}`}></div>\n              <CardHeader className={`bg-gradient-to-br ${eventType.bgColor} pb-4`}>\n                <div className={`w-16 h-16 bg-gradient-to-r ${eventType.color} rounded-2xl flex items-center justify-center text-white mx-auto mb-4 group-hover:scale-110 transition-transform`}>\n                  {eventType.icon}\n                </div>\n                <CardTitle className=\"text-xl font-bold text-gray-800 text-center\">\n                  {eventType.title}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"pt-4\">\n                <p className=\"text-gray-600 text-center leading-relaxed\">\n                  {eventType.description}\n                </p>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default EventTypes;\n","size_bytes":4106},"client/src/components/EventsPreview.tsx":{"content":"\nimport { Calendar, Lock, Users, Camera } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { useQuery } from '@tanstack/react-query';\nimport { Link } from 'react-router-dom';\n\ninterface Event {\n  id: string;\n  title: string;\n  eventDate: string;\n  location: string;\n  photoCount: number;\n  isPrivate: boolean;\n  thumbnailUrl?: string;\n  category: string;\n}\n\nconst EventsPreview = () => {\n  // Fetch real events from database - only public events for homepage\n  const { data: events = [], isLoading, error, isError } = useQuery<Event[]>({\n    queryKey: ['/api/events'],\n    queryFn: async () => {\n      const response = await fetch('/api/events');\n      if (!response.ok) {\n        throw new Error('Failed to fetch events');\n      }\n      return response.json();\n    },\n    select: (data) => data\n      .filter(event => !event.isPrivate) // Show only public events\n      .sort((a, b) => new Date(b.eventDate).getTime() - new Date(a.eventDate).getTime())\n      .slice(0, 3) // Show only 3 most recent events\n  });\n\n  // Show loading state\n  if (isLoading) {\n    return (\n      <section className=\"py-20 bg-gray-50\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-4xl md:text-5xl font-bold mb-4\">\n              <span className=\"bg-gradient-to-r from-pink-600 to-orange-500 bg-clip-text text-transparent\">\n                Recent Events\n              </span>\n            </h2>\n            <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n              Browse through our latest photography events and find your memorable moments\n            </p>\n          </div>\n\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12\">\n            {[1, 2, 3].map((i) => (\n              <Card key={i} className=\"overflow-hidden\">\n                <div className=\"w-full h-48 bg-gray-200 animate-pulse\"></div>\n                <CardHeader>\n                  <div className=\"h-5 bg-gray-200 rounded animate-pulse\"></div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2 mb-4\">\n                    <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                    <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                    <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                  </div>\n                  <div className=\"h-10 bg-gray-200 rounded animate-pulse\"></div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n    );\n  }\n\n  // Show error state\n  if (isError) {\n    return (\n      <section className=\"py-20 bg-gray-50\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-4xl md:text-5xl font-bold mb-4\">\n              <span className=\"bg-gradient-to-r from-pink-600 to-orange-500 bg-clip-text text-transparent\">\n                Recent Events\n              </span>\n            </h2>\n            <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n              Unable to load events at the moment. Please try again later.\n            </p>\n          </div>\n        </div>\n      </section>\n    );\n  }\n\n  // Show empty state if no events\n  if (events.length === 0) {\n    return (\n      <section className=\"py-20 bg-gray-50\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-4xl md:text-5xl font-bold mb-4\">\n              <span className=\"bg-gradient-to-r from-pink-600 to-orange-500 bg-clip-text text-transparent\">\n                Recent Events\n              </span>\n            </h2>\n            <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n              No events available at the moment. Check back soon for new photography events!\n            </p>\n          </div>\n        </div>\n      </section>\n    );\n  }\n\n  return (\n    <section className=\"py-20 bg-gray-50\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"text-center mb-12\">\n          <h2 className=\"text-4xl md:text-5xl font-bold mb-4\">\n            <span className=\"bg-gradient-to-r from-pink-600 to-orange-500 bg-clip-text text-transparent\">\n              Recent Events\n            </span>\n          </h2>\n          <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n            Browse through our latest photography events and find your memorable moments\n          </p>\n        </div>\n\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12\">\n          {events.map((event) => (\n            <Card key={event.id} className=\"group hover:shadow-xl transition-all duration-300 hover:scale-105 overflow-hidden\">\n              <div className=\"relative overflow-hidden\">\n                <img \n                  src={event.thumbnailUrl || 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&h=300&fit=crop'} \n                  alt={event.title}\n                  className=\"w-full h-48 object-cover group-hover:scale-110 transition-transform duration-300\"\n                  onError={(e) => {\n                    e.currentTarget.src = 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&h=300&fit=crop';\n                  }}\n                />\n                <div className=\"absolute top-4 right-4\">\n                  {event.isPrivate ? (\n                    <div className=\"bg-red-500 text-white px-2 py-1 rounded-full text-sm flex items-center\">\n                      <Lock className=\"h-3 w-3 mr-1\" />\n                      Private\n                    </div>\n                  ) : (\n                    <div className=\"bg-green-500 text-white px-2 py-1 rounded-full text-sm\">\n                      Public\n                    </div>\n                  )}\n                </div>\n              </div>\n              \n              <CardHeader>\n                <CardTitle className=\"text-lg font-semibold text-gray-800\">\n                  {event.title}\n                </CardTitle>\n              </CardHeader>\n              \n              <CardContent>\n                <div className=\"space-y-2 mb-4\">\n                  <div className=\"flex items-center text-gray-600\">\n                    <Calendar className=\"h-4 w-4 mr-2\" />\n                    <span className=\"text-sm\">{new Date(event.eventDate).toLocaleDateString()}</span>\n                  </div>\n                  <div className=\"flex items-center text-gray-600\">\n                    <Users className=\"h-4 w-4 mr-2\" />\n                    <span className=\"text-sm\">{event.location}</span>\n                  </div>\n                  <div className=\"flex items-center text-gray-600\">\n                    <Camera className=\"h-4 w-4 mr-2\" />\n                    <span className=\"text-sm\">{event.photoCount} photos</span>\n                  </div>\n                </div>\n                \n                <Link to=\"/events\">\n                  <Button \n                    className=\"w-full bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white\"\n                    onClick={() => {\n                      // Store the selected event ID for the Events page to auto-open\n                      sessionStorage.setItem('selectedEventId', event.id);\n                    }}\n                  >\n                    View Event\n                  </Button>\n                </Link>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        <div className=\"text-center\">\n          <Link to=\"/events\">\n            <Button variant=\"outline\" className=\"border-2 border-pink-200 text-pink-600 hover:bg-pink-50 px-8 py-3 text-lg rounded-full\">\n              View All Events\n            </Button>\n          </Link>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default EventsPreview;\n","size_bytes":7971},"client/src/components/FindMyFaceSection.tsx":{"content":"\nimport { Camera, Search, Download, Save, ArrowRight } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Link } from 'react-router-dom';\n\nconst FindMyFaceSection = () => {\n  const steps = [\n    {\n      icon: <Camera className=\"h-8 w-8\" />,\n      title: \"Take a Selfie\",\n      description: \"Use your camera to take a clear selfie for face recognition\"\n    },\n    {\n      icon: <Search className=\"h-8 w-8\" />,\n      title: \"AI Recognition\",\n      description: \"Our AI scans through event photos to find matches\"\n    },\n    {\n      icon: <Download className=\"h-8 w-8\" />,\n      title: \"Download & Save\",\n      description: \"Download your photos or save them to your profile\"\n    }\n  ];\n\n  return (\n    <section className=\"py-20 bg-white\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"text-center mb-12\">\n          <h2 className=\"text-4xl md:text-5xl font-bold mb-4\">\n            <span className=\"bg-gradient-to-r from-orange-500 to-cyan-500 bg-clip-text text-transparent\">\n              FindMyFace\n            </span>\n          </h2>\n          <p className=\"text-xl text-gray-600 max-w-3xl mx-auto\">\n            Revolutionary AI-powered face recognition technology that helps you find all your photos from any event instantly\n          </p>\n        </div>\n\n        {/* How it works */}\n        <div className=\"grid md:grid-cols-3 gap-8 mb-16\">\n          {steps.map((step, index) => (\n            <div key={index} className=\"text-center\">\n              <div className=\"relative mb-6\">\n                <div className=\"w-16 h-16 bg-gradient-to-r from-pink-500 to-orange-500 rounded-2xl flex items-center justify-center text-white mx-auto shadow-lg\">\n                  {step.icon}\n                </div>\n                <div className=\"absolute -top-2 -right-2 w-8 h-8 bg-gradient-to-r from-yellow-400 to-cyan-400 rounded-full flex items-center justify-center text-white font-bold text-sm\">\n                  {index + 1}\n                </div>\n              </div>\n              <h3 className=\"text-xl font-semibold text-gray-800 mb-3\">{step.title}</h3>\n              <p className=\"text-gray-600\">{step.description}</p>\n            </div>\n          ))}\n        </div>\n\n\n\n        {/* Features */}\n        <div className=\"grid md:grid-cols-2 gap-8 mt-16\">\n          <div className=\"bg-gradient-to-br from-pink-50 to-orange-50 rounded-2xl p-8\">\n            <h3 className=\"text-2xl font-bold text-gray-800 mb-4\">Advanced AI Technology</h3>\n            <ul className=\"space-y-3 text-gray-600\">\n              <li className=\"flex items-center\">\n                <div className=\"w-2 h-2 bg-pink-500 rounded-full mr-3\"></div>\n                Google Cloud Vision API integration\n              </li>\n              <li className=\"flex items-center\">\n                <div className=\"w-2 h-2 bg-orange-500 rounded-full mr-3\"></div>\n                High accuracy face matching\n              </li>\n              <li className=\"flex items-center\">\n                <div className=\"w-2 h-2 bg-yellow-500 rounded-full mr-3\"></div>\n                Real-time photo processing\n              </li>\n              <li className=\"flex items-center\">\n                <div className=\"w-2 h-2 bg-cyan-500 rounded-full mr-3\"></div>\n                Secure and private recognition\n              </li>\n            </ul>\n          </div>\n          \n          <div className=\"bg-gradient-to-br from-yellow-50 to-cyan-50 rounded-2xl p-8\">\n            <h3 className=\"text-2xl font-bold text-gray-800 mb-4\">Easy Photo Management</h3>\n            <ul className=\"space-y-3 text-gray-600\">\n              <li className=\"flex items-center\">\n                <Save className=\"w-5 h-5 text-cyan-500 mr-3\" />\n                Save photos to your profile\n              </li>\n              <li className=\"flex items-center\">\n                <Download className=\"w-5 h-5 text-cyan-500 mr-3\" />\n                Download in high resolution\n              </li>\n              <li className=\"flex items-center\">\n                <Search className=\"w-5 h-5 text-cyan-500 mr-3\" />\n                Search across multiple events\n              </li>\n              <li className=\"flex items-center\">\n                <Camera className=\"w-5 h-5 text-cyan-500 mr-3\" />\n                Access from any device\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default FindMyFaceSection;\n","size_bytes":4510},"client/src/components/Footer.tsx":{"content":"\nimport { Camera, Mail, Phone, MapPin } from 'lucide-react';\n\nconst Footer = () => {\n  return (\n    <footer className=\"bg-gray-900 text-white\">\n      <div className=\"container mx-auto px-4 py-12\">\n        <div className=\"grid md:grid-cols-4 gap-8\">\n          {/* Brand */}\n          <div className=\"col-span-2 md:col-span-1\">\n            <div className=\"flex items-center space-x-2 mb-4\">\n              <Camera className=\"h-8 w-8 text-transparent bg-gradient-to-r from-pink-500 via-orange-500 to-yellow-500 bg-clip-text\" />\n              <span className=\"text-2xl font-bold bg-gradient-to-r from-pink-500 via-orange-500 to-cyan-500 bg-clip-text text-transparent\">\n                PinMyPic\n              </span>\n            </div>\n            <p className=\"text-gray-400 leading-relaxed\">\n              Professional photography services with AI-powered face recognition technology. \n              Capture every moment, find every memory.\n            </p>\n          </div>\n\n          {/* Quick Links */}\n          <div>\n            <h3 className=\"text-lg font-semibold mb-4\">Quick Links</h3>\n            <ul className=\"space-y-2\">\n              <li><a href=\"#home\" className=\"text-gray-400 hover:text-white transition-colors\">Home</a></li>\n              <li><a href=\"#events\" className=\"text-gray-400 hover:text-white transition-colors\">Events</a></li>\n              <li><a href=\"#findmyface\" className=\"text-gray-400 hover:text-white transition-colors\">FindMyFace</a></li>\n              <li><a href=\"#booking\" className=\"text-gray-400 hover:text-white transition-colors\">Booking</a></li>\n              <li><a href=\"#contact\" className=\"text-gray-400 hover:text-white transition-colors\">Contact</a></li>\n            </ul>\n          </div>\n\n          {/* Services */}\n          <div>\n            <h3 className=\"text-lg font-semibold mb-4\">Services</h3>\n            <ul className=\"space-y-2\">\n              <li className=\"text-gray-400\">Wedding Photography</li>\n              <li className=\"text-gray-400\">Corporate Events</li>\n              <li className=\"text-gray-400\">Birthday Parties</li>\n              <li className=\"text-gray-400\">Face Recognition</li>\n              <li className=\"text-gray-400\">Photo Downloads</li>\n            </ul>\n          </div>\n\n          {/* Contact */}\n          <div>\n            <h3 className=\"text-lg font-semibold mb-4\">Contact Info</h3>\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-center text-gray-400\">\n                <Mail className=\"h-4 w-4 mr-3\" />\n                info@pinmypic.com\n              </li>\n              <li className=\"flex items-center text-gray-400\">\n                <Phone className=\"h-4 w-4 mr-3\" />\n                +1 (555) 123-4567\n              </li>\n              <li className=\"flex items-center text-gray-400\">\n                <MapPin className=\"h-4 w-4 mr-3\" />\n                123 Photography St, City\n              </li>\n            </ul>\n          </div>\n        </div>\n\n        <div className=\"border-t border-gray-800 mt-12 pt-8 text-center\">\n          <p className=\"text-gray-400\">\n            © 2024 PinMyPic. All rights reserved. | Made with ❤️ for photographers\n          </p>\n        </div>\n      </div>\n    </footer>\n  );\n};\n\nexport default Footer;\n","size_bytes":3264},"client/src/components/GalleryUploadDialog.tsx":{"content":"import { useState } from 'react';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { PhotoUploadDialog } from './PhotoUploadDialog';\nimport { Camera } from 'lucide-react';\nimport { Event } from '@shared/types';\n\ninterface GalleryUploadDialogProps {\n  events: Event[];\n  onPhotosUploaded: () => void;\n}\n\nexport function GalleryUploadDialog({ events, onPhotosUploaded }: GalleryUploadDialogProps) {\n  const [open, setOpen] = useState(false);\n  const [selectedEventId, setSelectedEventId] = useState<string>('');\n  const [uploadDialogOpen, setUploadDialogOpen] = useState(false);\n\n  const selectedEvent = events.find(e => e.id === selectedEventId);\n\n  const handleOpenUpload = () => {\n    if (selectedEventId) {\n      setUploadDialogOpen(true);\n    }\n  };\n\n  const handlePhotosUploaded = () => {\n    setUploadDialogOpen(false);\n    setOpen(false);\n    setSelectedEventId('');\n    onPhotosUploaded();\n  };\n\n  return (\n    <>\n      <Dialog open={open} onOpenChange={setOpen}>\n        <DialogTrigger asChild>\n          <Button variant=\"outline\" className=\"bg-green-50 border-green-200 text-green-600 hover:bg-green-100\">\n            <Camera className=\"h-4 w-4 mr-2\" />\n            Upload Gallery Photos\n          </Button>\n        </DialogTrigger>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>Upload Gallery Photos</DialogTitle>\n            <DialogDescription>\n              Select an event to upload photos to its gallery\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 mt-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Select Event</label>\n              <Select value={selectedEventId} onValueChange={setSelectedEventId}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Choose an event to upload photos\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {events.length > 0 ? (\n                    events.map((event) => (\n                      <SelectItem key={event.id} value={event.id}>\n                        {event.title} ({event.photoCount || 0} photos)\n                      </SelectItem>\n                    ))\n                  ) : (\n                    <SelectItem value=\"no-events\" disabled>\n                      No events available\n                    </SelectItem>\n                  )}\n                </SelectContent>\n              </Select>\n            </div>\n            \n            {selectedEvent && (\n              <div className=\"bg-gray-50 p-4 rounded-lg\">\n                <h4 className=\"font-medium mb-2\">{selectedEvent.title}</h4>\n                <div className=\"text-sm text-gray-600 space-y-1\">\n                  <p>Date: {new Date(selectedEvent.eventDate).toLocaleDateString()}</p>\n                  <p>Location: {selectedEvent.location}</p>\n                  <p>Current Photos: {selectedEvent.photoCount || 0}</p>\n                </div>\n              </div>\n            )}\n\n            <Button \n              onClick={handleOpenUpload}\n              disabled={!selectedEventId}\n              className=\"w-full bg-gradient-to-r from-pink-500 to-orange-500 text-white hover:from-pink-600 hover:to-orange-600\"\n            >\n              <Camera className=\"h-4 w-4 mr-2\" />\n              Upload Photos to Selected Event\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {selectedEvent && (\n        <PhotoUploadDialog\n          eventId={selectedEvent.id}\n          eventTitle={selectedEvent.title}\n          onPhotosUploaded={handlePhotosUploaded}\n          open={uploadDialogOpen}\n          onOpenChange={setUploadDialogOpen}\n        />\n      )}\n    </>\n  );\n}","size_bytes":3972},"client/src/components/Header.tsx":{"content":"\nimport { useState } from 'react';\nimport { Menu, X, Camera, User, Settings, LogOut, Shield, QrCode } from 'lucide-react';\nimport { Link, useLocation, useNavigate } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { hasAdminDashboardAccess, getAdminRoleDisplayName } from '@/utils/adminUtils';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport logoImage from '@assets/pinmypic_removed bg_1750753890638.png';\n\nconst Header = () => {\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const location = useLocation();\n  const navigate = useNavigate();\n  const { currentUser, userData, logout, loginWithGoogle } = useAuth();\n\n\n\n  const isActive = (path: string) => location.pathname === path;\n\n  const handleLogout = async () => {\n    try {\n      await logout();\n      navigate('/');\n    } catch (error) {\n      console.error('Error logging out:', error);\n    }\n  };\n\n  const handleGoogleSignIn = async () => {\n    setLoading(true);\n    try {\n      await loginWithGoogle();\n    } catch (error) {\n      console.error('Error signing in:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <header className=\"bg-white/90 backdrop-blur-sm border-b border-gray-200 sticky top-0 z-50\">\n      <div className=\"container mx-auto px-4 py-2\">\n        <div className=\"flex items-center justify-between\">\n          {/* Logo */}\n          <Link to=\"/\" className=\"flex items-center space-x-3\">\n            <img \n              src={logoImage} \n              alt=\"PinMyPic Logo\" \n              className=\"h-8 w-auto\"\n            />\n            <span className=\"text-xl font-bold bg-gradient-to-r from-pink-500 via-orange-500 to-cyan-500 bg-clip-text text-transparent\">\n              PinMyPic\n            </span>\n          </Link>\n\n          {/* Desktop Navigation */}\n          <nav className=\"hidden md:flex items-center space-x-8\">\n            <Link \n              to=\"/\" \n              className={`transition-colors font-medium ${\n                isActive('/') ? 'text-pink-500' : 'text-gray-700 hover:text-pink-500'\n              }`}\n            >\n              Home\n            </Link>\n            <Link \n              to=\"/events\" \n              className={`transition-colors font-medium ${\n                isActive('/events') ? 'text-pink-500' : 'text-gray-700 hover:text-pink-500'\n              }`}\n            >\n              Events\n            </Link>\n            <Link \n              to=\"/findmyface\" \n              className={`transition-colors font-medium ${\n                isActive('/findmyface') ? 'text-pink-500' : 'text-gray-700 hover:text-pink-500'\n              }`}\n            >\n              FindMyFace\n            </Link>\n            <Link \n              to=\"/booking\" \n              className={`transition-colors font-medium ${\n                isActive('/booking') ? 'text-pink-500' : 'text-gray-700 hover:text-pink-500'\n              }`}\n            >\n              Booking\n            </Link>\n            <Link \n              to=\"/contact\" \n              className={`transition-colors font-medium ${\n                isActive('/contact') ? 'text-pink-500' : 'text-gray-700 hover:text-pink-500'\n              }`}\n            >\n              Contact Us\n            </Link>\n          </nav>\n\n          {/* Auth Section */}\n          <div className=\"hidden md:flex items-center space-x-4\">\n            {currentUser ? (\n              <div className=\"flex items-center space-x-4\">\n                <Link to=\"/booking\">\n                  <Button className=\"bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white\">\n                    Book Now\n                  </Button>\n                </Link>\n                \n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" className=\"relative h-8 w-8 rounded-full p-0\">\n                      {(userData?.customPhotoURL || currentUser.photoURL) ? (\n                        <img\n                          className=\"h-8 w-8 rounded-full object-cover\"\n                          src={(userData?.customPhotoURL || currentUser.photoURL) as string}\n                          alt={currentUser.displayName || 'User'}\n                          onError={(e) => {\n                            const target = e.currentTarget;\n                            const fallback = target.nextElementSibling as HTMLElement;\n                            target.style.display = 'none';\n                            if (fallback) fallback.style.display = 'flex';\n                          }}\n                        />\n                      ) : null}\n                      <div \n                        className=\"h-8 w-8 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm\"\n                        style={{ display: (userData?.customPhotoURL || currentUser.photoURL) ? 'none' : 'flex' }}\n                      >\n                        {currentUser.displayName ? currentUser.displayName.charAt(0).toUpperCase() : currentUser.email?.charAt(0).toUpperCase() || 'U'}\n                      </div>\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent className=\"w-56\" align=\"end\" forceMount>\n                    <div className=\"flex items-center justify-start gap-2 p-2\">\n                      <div className=\"flex flex-col space-y-1 leading-none\">\n                        {currentUser.displayName && (\n                          <p className=\"font-medium\">{currentUser.displayName}</p>\n                        )}\n                        {currentUser.email && (\n                          <p className=\"w-[200px] truncate text-sm text-muted-foreground\">\n                            {currentUser.email}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                    <DropdownMenuSeparator />\n                    <DropdownMenuItem asChild>\n                      <Link to=\"/profile\" className=\"flex items-center\">\n                        <User className=\"mr-2 h-4 w-4\" />\n                        Profile\n                      </Link>\n                    </DropdownMenuItem>\n                    {hasAdminDashboardAccess(userData) && (\n                      <>\n                        <DropdownMenuSeparator />\n                        <DropdownMenuItem asChild>\n                          <Link to=\"/admin\" className=\"flex items-center\">\n                            <Shield className=\"mr-2 h-4 w-4\" />\n                            Admin Dashboard\n                            <span className=\"ml-2 text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded\">\n                              {getAdminRoleDisplayName(userData?.adminRole)}\n                            </span>\n                          </Link>\n                        </DropdownMenuItem>\n\n                      </>\n                    )}\n                    <DropdownMenuSeparator />\n                    <DropdownMenuItem onClick={handleLogout}>\n                      <LogOut className=\"mr-2 h-4 w-4\" />\n                      Log out\n                    </DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              </div>\n            ) : (\n              <Button \n                onClick={handleGoogleSignIn}\n                disabled={loading}\n                className=\"bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white\"\n              >\n                {loading ? 'Signing In...' : 'Sign In'}\n              </Button>\n            )}\n          </div>\n\n          {/* Mobile Menu */}\n          <div className=\"md:hidden flex items-center space-x-2\">\n            {currentUser ? (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" className=\"relative h-8 w-8 rounded-full p-0\">\n                    {(userData?.customPhotoURL || currentUser.photoURL) ? (\n                      <img\n                        className=\"h-8 w-8 rounded-full object-cover\"\n                        src={(userData?.customPhotoURL || currentUser.photoURL) as string}\n                        alt={currentUser.displayName || 'User'}\n                        onError={(e) => {\n                          const target = e.currentTarget;\n                          const fallback = target.nextElementSibling as HTMLElement;\n                          target.style.display = 'none';\n                          if (fallback) fallback.style.display = 'flex';\n                        }}\n                      />\n                    ) : null}\n                    <div \n                      className=\"h-8 w-8 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm\"\n                      style={{ display: (userData?.customPhotoURL || currentUser.photoURL) ? 'none' : 'flex' }}\n                    >\n                      {currentUser.displayName ? currentUser.displayName.charAt(0).toUpperCase() : currentUser.email?.charAt(0).toUpperCase() || 'U'}\n                    </div>\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent className=\"w-56\" align=\"end\" forceMount>\n                  <div className=\"flex items-center justify-start gap-2 p-2\">\n                    <div className=\"flex flex-col space-y-1 leading-none\">\n                      {currentUser.displayName && (\n                        <p className=\"font-medium\">{currentUser.displayName}</p>\n                      )}\n                      {currentUser.email && (\n                        <p className=\"w-[200px] truncate text-sm text-muted-foreground\">\n                          {currentUser.email}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem asChild>\n                    <Link to=\"/booking\" className=\"flex items-center\">\n                      <Camera className=\"mr-2 h-4 w-4\" />\n                      Book Now\n                    </Link>\n                  </DropdownMenuItem>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem asChild>\n                    <Link to=\"/profile\" className=\"flex items-center\">\n                      <User className=\"mr-2 h-4 w-4\" />\n                      Profile\n                    </Link>\n                  </DropdownMenuItem>\n                  {hasAdminDashboardAccess(userData) && (\n                    <>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem asChild>\n                        <Link to=\"/admin\" className=\"flex items-center\">\n                          <Shield className=\"mr-2 h-4 w-4\" />\n                          Admin Dashboard\n                        </Link>\n                      </DropdownMenuItem>\n\n                    </>\n                  )}\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem onClick={handleLogout}>\n                    <LogOut className=\"mr-2 h-4 w-4\" />\n                    Log out\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            ) : (\n              <Button \n                onClick={handleGoogleSignIn}\n                disabled={loading}\n                size=\"sm\"\n                className=\"bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white\"\n              >\n                {loading ? 'Signing In...' : 'Sign In'}\n              </Button>\n            )}\n            \n            <button\n              className=\"p-2 text-gray-600 hover:text-pink-500 transition-colors\"\n              onClick={() => setIsMenuOpen(!isMenuOpen)}\n            >\n              {isMenuOpen ? <X className=\"h-6 w-6\" /> : <Menu className=\"h-6 w-6\" />}\n            </button>\n          </div>\n        </div>\n\n        {/* Mobile Navigation */}\n        {isMenuOpen && (\n          <div className=\"md:hidden mt-4 pb-4 border-t border-gray-200 pt-4\">\n            <div className=\"flex flex-col space-y-4\">\n              <Link \n                to=\"/\" \n                className={`transition-colors font-medium ${\n                  isActive('/') ? 'text-pink-500' : 'text-gray-700 hover:text-pink-500'\n                }`}\n                onClick={() => setIsMenuOpen(false)}\n              >\n                Home\n              </Link>\n              <Link \n                to=\"/events\" \n                className={`transition-colors font-medium ${\n                  isActive('/events') ? 'text-pink-500' : 'text-gray-700 hover:text-pink-500'\n                }`}\n                onClick={() => setIsMenuOpen(false)}\n              >\n                Events\n              </Link>\n              <Link \n                to=\"/findmyface\" \n                className={`transition-colors font-medium ${\n                  isActive('/findmyface') ? 'text-pink-500' : 'text-gray-700 hover:text-pink-500'\n                }`}\n                onClick={() => setIsMenuOpen(false)}\n              >\n                FindMyFace\n              </Link>\n              <Link \n                to=\"/booking\" \n                className={`transition-colors font-medium ${\n                  isActive('/booking') ? 'text-pink-500' : 'text-gray-700 hover:text-pink-500'\n                }`}\n                onClick={() => setIsMenuOpen(false)}\n              >\n                Booking\n              </Link>\n              <Link \n                to=\"/contact\" \n                className={`transition-colors font-medium ${\n                  isActive('/contact') ? 'text-pink-500' : 'text-gray-700 hover:text-pink-500'\n                }`}\n                onClick={() => setIsMenuOpen(false)}\n              >\n                Contact Us\n              </Link>\n              \n              <div className=\"pt-4 border-t border-gray-200\">\n                {currentUser ? (\n                  <div className=\"space-y-3\">\n                    <Link \n                      to=\"/profile\"\n                      className=\"flex items-center gap-2 text-gray-700 hover:text-pink-500 font-medium\"\n                      onClick={() => setIsMenuOpen(false)}\n                    >\n                      <User className=\"h-4 w-4\" />\n                      Profile\n                    </Link>\n                    {(userData?.isAdmin || currentUser?.email === 'dond2674@gmail.com') && (\n                      <Link \n                        to=\"/admin\"\n                        className=\"flex items-center gap-2 text-gray-700 hover:text-pink-500 font-medium\"\n                        onClick={() => setIsMenuOpen(false)}\n                      >\n                        <Settings className=\"h-4 w-4\" />\n                        Admin Dashboard\n                      </Link>\n                    )}\n                    <button\n                      onClick={() => {\n                        handleLogout();\n                        setIsMenuOpen(false);\n                      }}\n                      className=\"flex items-center gap-2 text-gray-700 hover:text-red-500 font-medium\"\n                    >\n                      <LogOut className=\"h-4 w-4\" />\n                      Log Out\n                    </button>\n                  </div>\n                ) : (\n                  <Button \n                    onClick={() => {\n                      handleGoogleSignIn();\n                      setIsMenuOpen(false);\n                    }}\n                    disabled={loading}\n                    className=\"w-full bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white\"\n                  >\n                    {loading ? 'Signing In...' : 'Sign In with Google'}\n                  </Button>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </header>\n  );\n};\n\nexport default Header;\n","size_bytes":16234},"client/src/components/Hero.tsx":{"content":"\nimport { Camera, Search, Calendar, Download } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Link } from 'react-router-dom';\n\nconst Hero = () => {\n  return (\n    <section className=\"relative min-h-screen flex items-center justify-center overflow-hidden pt-20\">\n      {/* Background image with overlay */}\n      <div \n        className=\"absolute inset-0 bg-cover bg-center bg-no-repeat\"\n        style={{\n          backgroundImage: 'url(/hero-background.jpg)',\n        }}\n      >\n        <div className=\"absolute inset-0 bg-gradient-to-br from-pink-900/70 via-orange-900/60 to-yellow-900/70\"></div>\n      </div>\n\n      {/* Background decorative elements */}\n      <div className=\"absolute top-20 left-10 w-20 h-20 bg-gradient-to-br from-pink-400 to-orange-400 rounded-full opacity-20 animate-pulse\"></div>\n      <div className=\"absolute bottom-20 right-10 w-32 h-32 bg-gradient-to-br from-yellow-400 to-cyan-400 rounded-full opacity-20 animate-pulse delay-1000\"></div>\n      <div className=\"absolute top-1/2 left-1/4 w-16 h-16 bg-gradient-to-br from-cyan-400 to-pink-400 rounded-full opacity-15 animate-pulse delay-500\"></div>\n\n      <div className=\"container mx-auto px-4 text-center relative z-10 py-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          {/* Main heading */}\n          <h1 className=\"text-5xl md:text-7xl font-bold mb-6 leading-tight\">\n            <span className=\"bg-gradient-to-r from-pink-300 via-orange-300 to-yellow-300 bg-clip-text text-transparent\">\n              Capture\n            </span>\n            <br />\n            <span className=\"bg-gradient-to-r from-yellow-300 via-orange-300 to-cyan-300 bg-clip-text text-transparent\">\n              Every Moment\n            </span>\n          </h1>\n          \n          <p className=\"text-xl md:text-2xl text-white/90 mb-8 max-w-2xl mx-auto leading-relaxed\">\n            Professional photography services with AI-powered face recognition. \n            Find yourself in any event instantly.\n          </p>\n\n          {/* CTA Buttons */}\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center mb-12\">\n            <Link to=\"/findmyface\">\n              <Button className=\"bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white px-8 py-3 text-lg rounded-full shadow-lg hover:shadow-xl transition-all\">\n                <Search className=\"mr-2 h-5 w-5\" />\n                Find My Photos\n              </Button>\n            </Link>\n            <Link to=\"/events\">\n              <Button variant=\"outline\" className=\"border-2 border-white/60 text-white hover:bg-transparent hover:border-white/80 bg-transparent px-8 py-3 text-lg rounded-full\">\n                <Calendar className=\"mr-2 h-5 w-5\" />\n                View Events\n              </Button>\n            </Link>\n          </div>\n\n          {/* Feature cards */}\n          <div className=\"grid md:grid-cols-3 gap-6 mt-16\">\n            <div className=\"bg-white/10 backdrop-blur-md rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all hover:scale-105 border border-white/20\">\n              <div className=\"w-12 h-12 bg-gradient-to-r from-pink-500 to-orange-500 rounded-xl flex items-center justify-center mb-4 mx-auto\">\n                <Camera className=\"h-6 w-6 text-white\" />\n              </div>\n              <h3 className=\"text-xl font-semibold text-white mb-2\">Professional Photography</h3>\n              <p className=\"text-white/80\">High-quality event photography with professional equipment and expertise.</p>\n            </div>\n\n            <div className=\"bg-white/10 backdrop-blur-md rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all hover:scale-105 border border-white/20\">\n              <div className=\"w-12 h-12 bg-gradient-to-r from-orange-500 to-yellow-500 rounded-xl flex items-center justify-center mb-4 mx-auto\">\n                <Search className=\"h-6 w-6 text-white\" />\n              </div>\n              <h3 className=\"text-xl font-semibold text-white mb-2\">AI Face Recognition</h3>\n              <p className=\"text-white/80\">Find yourself in thousands of photos using our advanced AI technology.</p>\n            </div>\n\n            <div className=\"bg-white/10 backdrop-blur-md rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all hover:scale-105 border border-white/20\">\n              <div className=\"w-12 h-12 bg-gradient-to-r from-yellow-500 to-cyan-500 rounded-xl flex items-center justify-center mb-4 mx-auto\">\n                <Download className=\"h-6 w-6 text-white\" />\n              </div>\n              <h3 className=\"text-xl font-semibold text-white mb-2\">Instant Download</h3>\n              <p className=\"text-white/80\">Download your favorite photos instantly in high resolution.</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default Hero;\n","size_bytes":4849},"client/src/components/LoadingSpinner.tsx":{"content":"const LoadingSpinner = ({ message = \"Loading...\" }: { message?: string }) => {\n  return (\n    <div className=\"min-h-screen flex items-center justify-center\">\n      <div className=\"text-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n        <p className=\"text-gray-600\">{message}</p>\n      </div>\n    </div>\n  );\n};\n\nexport default LoadingSpinner;","size_bytes":416},"client/src/components/ManageUsersDialog.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Users, Search, Edit, Trash2, Shield, ShieldCheck, Mail, Phone, Calendar, User } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { User as UserType } from '@shared/types';\n\ninterface ManageUsersDialogProps {\n  onUserUpdated: () => void;\n}\n\nexport function ManageUsersDialog({ onUserUpdated }: ManageUsersDialogProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [users, setUsers] = useState<UserType[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedUser, setSelectedUser] = useState<UserType | null>(null);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const { toast } = useToast();\n  const { currentUser } = useAuth();\n\n  // Helper function to get authentication headers\n  const getAuthHeaders = async (): Promise<Record<string, string>> => {\n    if (!currentUser) return {};\n    try {\n      const token = await currentUser.getIdToken();\n      return {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      };\n    } catch (error) {\n      console.error('Error getting auth token:', error);\n      return {};\n    }\n  };\n\n  const fetchUsers = async () => {\n    setLoading(true);\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch('/api/users', { headers });\n      if (response.ok) {\n        const usersData = await response.json();\n        setUsers(usersData || []);\n      } else {\n        console.error('Failed to fetch users:', response.status);\n        toast({\n          title: \"Error fetching users\",\n          description: \"Failed to load user data. Please check your permissions.\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error) {\n      console.error('Error fetching users:', error);\n      toast({\n        title: \"Error fetching users\",\n        description: \"Failed to load user data.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (isOpen) {\n      fetchUsers();\n    }\n  }, [isOpen]);\n\n  const filteredUsers = users.filter(user =>\n    user.displayName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    user.email.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const handleToggleAdmin = async (user: UserType) => {\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`/api/users/${user.id}`, {\n        method: 'PATCH',\n        headers,\n        body: JSON.stringify({\n          isAdmin: !user.isAdmin\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to update user');\n      }\n\n      toast({\n        title: \"User updated\",\n        description: `${user.displayName || user.email} ${user.isAdmin ? 'removed from' : 'granted'} admin access.`,\n      });\n\n      fetchUsers();\n      onUserUpdated();\n    } catch (error) {\n      console.error('Error updating user:', error);\n      toast({\n        title: \"Error updating user\",\n        description: (error as Error)?.message || \"Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const handleDeleteUser = async (user: UserType) => {\n    if (!confirm(`Are you sure you want to delete ${user.displayName || user.email}? This action cannot be undone.`)) {\n      return;\n    }\n\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`/api/users/${user.id}`, {\n        method: 'DELETE',\n        headers,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to delete user');\n      }\n\n      toast({\n        title: \"User deleted\",\n        description: `${user.displayName || user.email} has been removed from the system.`,\n      });\n\n      fetchUsers();\n      onUserUpdated();\n    } catch (error) {\n      console.error('Error deleting user:', error);\n      toast({\n        title: \"Error deleting user\",\n        description: (error as Error)?.message || \"Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const getInitials = (name: string, email: string) => {\n    if (name) {\n      return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n    }\n    return email.slice(0, 2).toUpperCase();\n  };\n\n  return (\n    <>\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\n        <DialogTrigger asChild>\n          <Button variant=\"outline\" className=\"bg-blue-50 border-blue-200 text-blue-600 hover:bg-blue-100\">\n            <Users className=\"h-4 w-4 mr-2\" />\n            Manage User Accounts\n          </Button>\n        </DialogTrigger>\n        \n        <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-xl font-bold flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              Manage User Accounts\n            </DialogTitle>\n            <DialogDescription>\n              View and manage all registered users in the system\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-6 p-2\">\n            {/* Search Bar */}\n            <div className=\"flex items-center gap-4\">\n              <div className=\"relative flex-1\">\n                <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search users by name or email...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-8\"\n                />\n              </div>\n              <Badge variant=\"secondary\" className=\"px-3 py-1\">\n                {filteredUsers.length} users\n              </Badge>\n            </div>\n\n            {/* Users Table */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Registered Users</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {loading ? (\n                  <div className=\"text-center py-8\">Loading users...</div>\n                ) : filteredUsers.length === 0 ? (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    {searchTerm ? 'No users found matching your search.' : 'No users registered yet.'}\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>User</TableHead>\n                        <TableHead>Contact</TableHead>\n                        <TableHead>Role</TableHead>\n                        <TableHead>Joined</TableHead>\n                        <TableHead>Actions</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {filteredUsers.map((user) => (\n                        <TableRow key={user.id}>\n                          <TableCell>\n                            <div className=\"flex items-center gap-3\">\n                              <Avatar className=\"h-10 w-10\">\n                                <AvatarImage src={user.customPhotoURL || user.photoURL} />\n                                <AvatarFallback className=\"bg-gradient-to-br from-purple-500 to-pink-500 text-white font-semibold\">\n                                  {getInitials(user.displayName || '', user.email)}\n                                </AvatarFallback>\n                              </Avatar>\n                              <div>\n                                <div className=\"font-medium\">{user.displayName || 'No name'}</div>\n                                <div className=\"text-sm text-gray-500\">{user.email}</div>\n                              </div>\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center gap-2 text-sm\">\n                                <Mail className=\"h-3 w-3\" />\n                                {user.email}\n                              </div>\n                              {user.phone && (\n                                <div className=\"flex items-center gap-2 text-sm text-gray-500\">\n                                  <Phone className=\"h-3 w-3\" />\n                                  {user.phone}\n                                </div>\n                              )}\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant={user.isAdmin ? \"default\" : \"secondary\"} className=\"flex items-center gap-1 w-fit\">\n                              {user.isAdmin ? <ShieldCheck className=\"h-3 w-3\" /> : <Shield className=\"h-3 w-3\" />}\n                              {user.isAdmin ? 'Admin' : 'User'}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-2 text-sm text-gray-500\">\n                              <Calendar className=\"h-3 w-3\" />\n                              {new Date(user.createdAt).toLocaleDateString()}\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-2\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => handleToggleAdmin(user)}\n                                className={user.isAdmin ? \"text-red-600 hover:text-red-700\" : \"text-green-600 hover:text-green-700\"}\n                              >\n                                {user.isAdmin ? 'Remove Admin' : 'Make Admin'}\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => {\n                                  setSelectedUser(user);\n                                  setEditDialogOpen(true);\n                                }}\n                                className=\"text-blue-600 hover:text-blue-700\"\n                              >\n                                <Edit className=\"h-3 w-3\" />\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => handleDeleteUser(user)}\n                                className=\"text-red-600 hover:text-red-700\"\n                              >\n                                <Trash2 className=\"h-3 w-3\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit User Dialog */}\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit User</DialogTitle>\n            <DialogDescription>\n              Update user information\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedUser && (\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"displayName\">Display Name</Label>\n                <Input\n                  id=\"displayName\"\n                  value={selectedUser.displayName || ''}\n                  onChange={(e) => setSelectedUser({...selectedUser, displayName: e.target.value})}\n                  placeholder=\"User's display name\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"phone\">Phone Number</Label>\n                <Input\n                  id=\"phone\"\n                  value={selectedUser.phone || ''}\n                  onChange={(e) => setSelectedUser({...selectedUser, phone: e.target.value})}\n                  placeholder=\"Phone number\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"bio\">Bio</Label>\n                <Input\n                  id=\"bio\"\n                  value={selectedUser.bio || ''}\n                  onChange={(e) => setSelectedUser({...selectedUser, bio: e.target.value})}\n                  placeholder=\"User bio\"\n                />\n              </div>\n\n              <div className=\"flex justify-end gap-2 pt-4\">\n                <Button variant=\"outline\" onClick={() => setEditDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button onClick={async () => {\n                  try {\n                    const headers = await getAuthHeaders();\n                    const response = await fetch(`/api/users/${selectedUser.id}`, {\n                      method: 'PATCH',\n                      headers,\n                      body: JSON.stringify({\n                        displayName: selectedUser.displayName,\n                        phone: selectedUser.phone,\n                        bio: selectedUser.bio\n                      }),\n                    });\n\n                    if (!response.ok) {\n                      const error = await response.json();\n                      throw new Error(error.error || 'Failed to update user');\n                    }\n\n                    toast({\n                      title: \"User updated\",\n                      description: \"User information has been updated successfully.\",\n                    });\n\n                    setEditDialogOpen(false);\n                    fetchUsers();\n                    onUserUpdated();\n                  } catch (error) {\n                    console.error('Error updating user:', error);\n                    toast({\n                      title: \"Error updating user\",\n                      description: (error as Error)?.message || \"Please try again.\",\n                      variant: \"destructive\"\n                    });\n                  }\n                }}>\n                  Save Changes\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}","size_bytes":15365},"client/src/components/PhotoUploadDialog.tsx":{"content":"import { useState, useRef, useMemo, useCallback } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Progress } from '@/components/ui/progress';\nimport { Badge } from '@/components/ui/badge';\nimport { Upload, Camera, X, FileImage, AlertCircle, CheckCircle } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { UploadOptimizer, MemoryMonitor } from '@/utils/uploadOptimizer';\n\ninterface PhotoUploadDialogProps {\n  eventId: string;\n  eventTitle: string;\n  onPhotosUploaded: () => void;\n  open?: boolean;\n  onOpenChange?: (open: boolean) => void;\n}\n\ninterface UploadFile {\n  file: File;\n  id: string;\n  progress: number;\n  status: 'pending' | 'uploading' | 'completed' | 'error';\n  url?: string;\n  error?: string;\n}\n\nexport function PhotoUploadDialog({ \n  eventId, \n  eventTitle, \n  onPhotosUploaded,\n  open: controlledOpen,\n  onOpenChange: controlledOnOpenChange \n}: PhotoUploadDialogProps) {\n  const [internalOpen, setInternalOpen] = useState(false);\n  const [uploadFiles, setUploadFiles] = useState<UploadFile[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [isDragOver, setIsDragOver] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n\n  // Use controlled props if provided, otherwise use internal state\n  const isOpen = controlledOpen !== undefined ? controlledOpen : internalOpen;\n  const setIsOpen = controlledOnOpenChange || setInternalOpen;\n\n\n\n  const processFiles = (files: File[]) => {\n    const imageFiles = files.filter(file => file.type.startsWith('image/'));\n    \n    if (imageFiles.length !== files.length) {\n      toast({\n        title: \"Invalid files detected\",\n        description: \"Only image files are allowed.\",\n        variant: \"destructive\"\n      });\n    }\n\n    if (imageFiles.length === 0) {\n      toast({\n        title: \"No valid images\",\n        description: \"Please select image files (JPG, PNG, WebP).\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Use upload optimizer to check if browser can handle the upload\n    const optimizer = UploadOptimizer.getInstance();\n    const canHandle = optimizer.canHandleUpload(imageFiles);\n    \n    if (!canHandle.canHandle) {\n      toast({\n        title: \"Upload too large\",\n        description: canHandle.reason,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Check memory usage before processing\n    const memoryMonitor = new MemoryMonitor();\n    const memoryStatus = memoryMonitor.checkMemoryUsage();\n    \n    if (memoryStatus.critical) {\n      toast({\n        title: \"Memory warning\",\n        description: \"Browser memory is low. Please close other tabs and try again.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Warn user for large uploads with estimated time\n    if (imageFiles.length > 50) {\n      const estimatedTime = optimizer.estimateUploadTime(imageFiles);\n      toast({\n        title: \"Large upload detected\",\n        description: `Uploading ${imageFiles.length} photos. Estimated time: ${estimatedTime}`,\n      });\n    }\n\n    const newUploadFiles: UploadFile[] = imageFiles.map(file => ({\n      file,\n      id: `${Date.now()}-${Math.random()}`,\n      progress: 0,\n      status: 'pending'\n    }));\n\n    setUploadFiles(prev => [...prev, ...newUploadFiles]);\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    processFiles(files);\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(false);\n    \n    const files = Array.from(e.dataTransfer.files);\n    processFiles(files);\n  };\n\n  const removeFile = (id: string) => {\n    setUploadFiles(prev => prev.filter(f => f.id !== id));\n  };\n\n  const uploadPhoto = async (uploadFile: UploadFile): Promise<void> => {\n    try {\n      // Validate eventId before proceeding\n      if (!eventId || eventId === 'undefined') {\n        throw new Error('Invalid event ID');\n      }\n\n      // Update status to uploading\n      setUploadFiles(prev => prev.map(f => \n        f.id === uploadFile.id ? { ...f, status: 'uploading' as const, progress: 0 } : f\n      ));\n\n      // Create FormData for file upload\n      const formData = new FormData();\n      formData.append('photos', uploadFile.file);\n      formData.append('eventId', eventId);\n      formData.append('filename', uploadFile.file.name);\n\n      // Create XMLHttpRequest for progress tracking\n      const xhr = new XMLHttpRequest();\n      \n      return new Promise((resolve, reject) => {\n        xhr.upload.addEventListener('progress', (e) => {\n          if (e.lengthComputable) {\n            const progress = Math.round((e.loaded / e.total) * 100);\n            setUploadFiles(prev => prev.map(f => \n              f.id === uploadFile.id ? { ...f, progress } : f\n            ));\n          }\n        });\n\n        xhr.addEventListener('load', async () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            try {\n              const result = JSON.parse(xhr.responseText);\n              setUploadFiles(prev => prev.map(f => \n                f.id === uploadFile.id ? { \n                  ...f, \n                  status: 'completed' as const, \n                  url: result.url,\n                  progress: 100 \n                } : f\n              ));\n              resolve();\n            } catch (error) {\n              reject(new Error('Invalid response format'));\n            }\n          } else {\n            reject(new Error(`Upload failed with status ${xhr.status}`));\n          }\n        });\n\n        xhr.addEventListener('error', () => {\n          reject(new Error('Network error during upload'));\n        });\n\n        xhr.addEventListener('timeout', () => {\n          reject(new Error('Upload timed out'));\n        });\n\n        xhr.open('POST', '/api/photos/upload');\n        xhr.timeout = 300000; // 5 minute timeout\n        xhr.send(formData);\n      });\n\n    } catch (error) {\n      console.error('Upload error:', error);\n      setUploadFiles(prev => prev.map(f => \n        f.id === uploadFile.id ? { \n          ...f, \n          status: 'error' as const, \n          error: error instanceof Error ? error.message : 'Upload failed'\n        } : f\n      ));\n    }\n  };\n\n  const handleUploadAll = async () => {\n    if (uploadFiles.length === 0) return;\n\n    setIsUploading(true);\n    \n    try {\n      const pendingFiles = uploadFiles.filter(f => f.status === 'pending');\n      \n      // Use upload optimizer for intelligent batching\n      const optimizer = UploadOptimizer.getInstance();\n      const memoryMonitor = new MemoryMonitor();\n      \n      // Create optimal batches based on browser capabilities and file sizes\n      const files = pendingFiles.map(uf => uf.file);\n      const batches = optimizer.createOptimalBatches(files, 8);\n      \n      console.log(`Processing ${pendingFiles.length} files in ${batches.length} optimized batches`);\n      \n      let completedCount = 0;\n      let errorCount = 0;\n      \n      // Process each batch\n      for (let batchIndex = 0; batchIndex < batches.length; batchIndex++) {\n        const batch = batches[batchIndex];\n        const batchUploadFiles = pendingFiles.filter(uf => \n          batch.files.some(bf => bf.name === uf.file.name && bf.size === uf.file.size)\n        );\n        \n        try {\n          // Check memory before each batch\n          const memoryStatus = memoryMonitor.checkMemoryUsage();\n          if (memoryStatus.critical) {\n            console.warn('Critical memory usage detected, forcing cleanup');\n            memoryMonitor.forceGarbageCollection();\n            \n            // Small pause to allow cleanup\n            await new Promise(resolve => setTimeout(resolve, 500));\n          }\n          \n          // Upload batch in parallel\n          await Promise.all(batchUploadFiles.map(uploadPhoto));\n          \n          // Count successful uploads in this batch\n          const batchCompleted = batchUploadFiles.filter(uf => {\n            const current = uploadFiles.find(f => f.id === uf.id);\n            return current?.status === 'completed';\n          }).length;\n          \n          completedCount += batchCompleted;\n          \n          // Add intelligent delay between batches\n          if (batchIndex < batches.length - 1) {\n            const delay = optimizer.calculateBatchDelay(pendingFiles.length);\n            if (delay > 0) {\n              await new Promise(resolve => setTimeout(resolve, delay));\n            }\n          }\n          \n        } catch (batchError) {\n          console.error(`Batch ${batchIndex + 1} failed:`, batchError);\n          errorCount += batchUploadFiles.length;\n        }\n      }\n\n      // Final success/error reporting\n      const finalErrorCount = uploadFiles.filter(f => f.status === 'error').length;\n      const finalSuccessCount = uploadFiles.filter(f => f.status === 'completed').length;\n\n      if (finalSuccessCount > 0) {\n        toast({\n          title: \"Photos uploaded successfully\",\n          description: `${finalSuccessCount} photos uploaded to ${eventTitle}`,\n        });\n        onPhotosUploaded();\n      }\n\n      if (finalErrorCount > 0) {\n        toast({\n          title: \"Some uploads failed\",\n          description: `${finalErrorCount} photos failed to upload`,\n          variant: \"destructive\"\n        });\n      }\n\n    } catch (error) {\n      console.error('Upload process error:', error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\n      toast({\n        title: \"Upload failed\",\n        description: `Failed to upload photos: ${errorMessage}. Please try again.`,\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (!isUploading) {\n      setUploadFiles([]);\n      setIsOpen(false);\n    }\n  };\n\n  // Optimize state calculations with useMemo to prevent recalculations on every render\n  const uploadStats = useMemo(() => {\n    const completed = uploadFiles.filter(f => f.status === 'completed').length;\n    const uploading = uploadFiles.filter(f => f.status === 'uploading').length;\n    const pending = uploadFiles.filter(f => f.status === 'pending').length;\n    const errors = uploadFiles.filter(f => f.status === 'error').length;\n    \n    return {\n      completed,\n      uploading,\n      pending,\n      errors,\n      total: uploadFiles.length\n    };\n  }, [uploadFiles]);\n\n  // Optimize file removal with useCallback\n  const optimizedRemoveFile = useCallback((id: string) => {\n    setUploadFiles(prev => prev.filter(f => f.id !== id));\n  }, []);\n\n  // For large uploads, only show a subset of files to prevent UI lag\n  const displayFiles = useMemo(() => {\n    if (uploadFiles.length <= 20) {\n      return uploadFiles;\n    }\n    \n    // For large uploads, prioritize showing:\n    // 1. Currently uploading files\n    // 2. Failed files (so user can retry)\n    // 3. First few completed files\n    // 4. First few pending files\n    const uploading = uploadFiles.filter(f => f.status === 'uploading');\n    const errors = uploadFiles.filter(f => f.status === 'error');\n    const completed = uploadFiles.filter(f => f.status === 'completed').slice(0, 5);\n    const pending = uploadFiles.filter(f => f.status === 'pending').slice(0, 5);\n    \n    return [...uploading, ...errors, ...completed, ...pending];\n  }, [uploadFiles]);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\">\n          <Upload className=\"h-4 w-4 mr-2\" />\n          Upload Photos\n        </Button>\n      </DialogTrigger>\n      \n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Camera className=\"h-5 w-5\" />\n            Upload Photos to {eventTitle}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Upload Area */}\n          <Card \n            className={`border-2 border-dashed transition-colors cursor-pointer ${\n              isDragOver \n                ? 'border-blue-400 bg-blue-50' \n                : 'border-gray-300 hover:border-gray-400'\n            }`}\n            onClick={() => fileInputRef.current?.click()}\n            onDragOver={handleDragOver}\n            onDragLeave={handleDragLeave}\n            onDrop={handleDrop}\n          >\n            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n              <Upload className={`h-12 w-12 mb-4 ${\n                isDragOver ? 'text-blue-500' : 'text-gray-400'\n              }`} />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                {isDragOver ? 'Drop photos here' : 'Drop photos here or click to browse'}\n              </h3>\n              <p className=\"text-gray-600 text-center\">\n                Support for JPG, PNG, WebP files<br />\n                Maximum 200 photos per upload (optimized for large batches)\n              </p>\n              <Button className=\"mt-4\" variant=\"outline\">\n                <FileImage className=\"h-4 w-4 mr-2\" />\n                Select Photos\n              </Button>\n            </CardContent>\n          </Card>\n\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            accept=\"image/*\"\n            className=\"hidden\"\n            onChange={handleFileSelect}\n          />\n\n          {/* Upload Progress */}\n          {uploadFiles.length > 0 && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-medium\">\n                  Photos ({uploadStats.completed}/{uploadStats.total})\n                </h3>\n                {uploadStats.total > 20 && (\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    Showing key files only\n                  </Badge>\n                )}\n                <div className=\"flex gap-2\">\n                  <Button\n                    onClick={handleUploadAll}\n                    disabled={isUploading || uploadFiles.every(f => f.status !== 'pending')}\n                  >\n                    {isUploading ? 'Uploading...' : 'Upload All'}\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => setUploadFiles([])}\n                    disabled={isUploading}\n                  >\n                    Clear All\n                  </Button>\n                </div>\n              </div>\n\n              {/* Overall Progress Bar for Large Uploads */}\n              {uploadStats.total > 5 && (\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span>Overall Progress</span>\n                    <span>{uploadStats.completed}/{uploadStats.total}</span>\n                  </div>\n                  <Progress \n                    value={(uploadStats.completed / uploadStats.total) * 100} \n                    className=\"h-2\"\n                  />\n                  <div className=\"flex justify-between text-xs text-gray-500\">\n                    <span>{uploadStats.uploading} uploading</span>\n                    <span>{uploadStats.errors} failed</span>\n                    <span>{uploadStats.pending} pending</span>\n                  </div>\n                </div>\n              )}\n\n              {/* File List */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto\">\n                {displayFiles.map((uploadFile) => (\n                  <Card key={uploadFile.id} className=\"relative\">\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"flex-shrink-0\">\n                          <FileImage className=\"h-8 w-8 text-gray-400\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm font-medium text-gray-900 truncate\">\n                            {uploadFile.file.name}\n                          </p>\n                          <p className=\"text-xs text-gray-500\">\n                            {(uploadFile.file.size / 1024 / 1024).toFixed(1)} MB\n                          </p>\n                          \n                          {uploadFile.status === 'uploading' && (\n                            <Progress value={uploadFile.progress} className=\"mt-2\" />\n                          )}\n                        </div>\n                        \n                        <div className=\"flex items-center gap-2\">\n                          {uploadFile.status === 'pending' && (\n                            <Badge variant=\"secondary\">Pending</Badge>\n                          )}\n                          {uploadFile.status === 'uploading' && (\n                            <Badge className=\"bg-blue-100 text-blue-800\">Uploading</Badge>\n                          )}\n                          {uploadFile.status === 'completed' && (\n                            <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                          )}\n                          {uploadFile.status === 'error' && (\n                            <AlertCircle className=\"h-5 w-5 text-red-500\" />\n                          )}\n                          \n                          {!isUploading && uploadFile.status === 'pending' && (\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => optimizedRemoveFile(uploadFile.id)}\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                      \n                      {uploadFile.status === 'error' && uploadFile.error && (\n                        <p className=\"text-xs text-red-600 mt-2\">{uploadFile.error}</p>\n                      )}\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"flex justify-end gap-2 border-t pt-4\">\n            <Button variant=\"outline\" onClick={handleClose} disabled={isUploading}>\n              Close\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":18946},"client/src/components/PhotographyShowcase.tsx":{"content":"\nimport { useState } from 'react';\nimport { Camera, Heart, Users, Building, Baby, Cake, Star, ChevronLeft, ChevronRight } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\n\nconst PhotographyShowcase = () => {\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n\n  const showcaseImages = [\n    {\n      url: \"https://images.unsplash.com/photo-1519741497674-611481863552?w=800&h=600&fit=crop\",\n      title: \"Wedding Bliss\",\n      description: \"Capturing eternal love moments\"\n    },\n    {\n      url: \"https://images.unsplash.com/photo-1511795409834-ef04bbd61622?w=800&h=600&fit=crop\",\n      title: \"Corporate Excellence\",\n      description: \"Professional event photography\"\n    },\n    {\n      url: \"https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=800&h=600&fit=crop\",\n      title: \"Birthday Joy\",\n      description: \"Celebrating life's special moments\"\n    },\n    {\n      url: \"https://images.unsplash.com/photo-1464366400600-7168b8af9bc3?w=800&h=600&fit=crop\",\n      title: \"Family Memories\",\n      description: \"Precious family gatherings\"\n    },\n    {\n      url: \"https://images.unsplash.com/photo-1472396961693-142e6e269027?w=800&h=600&fit=crop\",\n      title: \"Nature's Beauty\",\n      description: \"Capturing wildlife in their natural habitat\"\n    },\n    {\n      url: \"https://images.unsplash.com/photo-1482938289607-e9573fc25ebb?w=800&h=600&fit=crop\",\n      title: \"Mountain Majesty\",\n      description: \"Breathtaking landscape photography\"\n    },\n    {\n      url: \"https://images.unsplash.com/photo-1509316975850-ff9c5deb0cd9?w=800&h=600&fit=crop\",\n      title: \"Forest Serenity\",\n      description: \"Peaceful pine forest captures\"\n    },\n    {\n      url: \"https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=800&h=600&fit=crop\",\n      title: \"Golden Hour Magic\",\n      description: \"Nature's dramatic lighting moments\"\n    }\n  ];\n\n  const nextImage = () => {\n    setCurrentImageIndex((prev) => (prev + 1) % showcaseImages.length);\n  };\n\n  const prevImage = () => {\n    setCurrentImageIndex((prev) => (prev - 1 + showcaseImages.length) % showcaseImages.length);\n  };\n\n  return (\n    <section className=\"py-20 bg-gradient-to-br from-gray-50 to-pink-50\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"text-center mb-12\">\n          <h2 className=\"text-4xl md:text-5xl font-bold mb-4\">\n            <span className=\"bg-gradient-to-r from-pink-600 to-orange-500 bg-clip-text text-transparent\">\n              My Photography\n            </span>\n          </h2>\n          <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n            Capturing life's most precious moments with artistic vision and professional expertise\n          </p>\n        </div>\n\n        {/* Main Showcase */}\n        <div className=\"relative max-w-4xl mx-auto mb-16\">\n          <div className=\"relative overflow-hidden rounded-2xl shadow-2xl\">\n            <img \n              src={showcaseImages[currentImageIndex].url}\n              alt={showcaseImages[currentImageIndex].title}\n              className=\"w-full h-96 md:h-[500px] object-cover transition-all duration-500\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent\"></div>\n            <div className=\"absolute bottom-8 left-8 text-white\">\n              <h3 className=\"text-2xl md:text-3xl font-bold mb-2\">\n                {showcaseImages[currentImageIndex].title}\n              </h3>\n              <p className=\"text-lg opacity-90\">\n                {showcaseImages[currentImageIndex].description}\n              </p>\n            </div>\n          </div>\n          \n          {/* Navigation Buttons */}\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            className=\"absolute left-4 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white border-0 shadow-lg\"\n            onClick={prevImage}\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            className=\"absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white border-0 shadow-lg\"\n            onClick={nextImage}\n          >\n            <ChevronRight className=\"h-5 w-5\" />\n          </Button>\n\n          {/* Dots Indicator */}\n          <div className=\"flex justify-center mt-6 space-x-2\">\n            {showcaseImages.map((_, index) => (\n              <button\n                key={index}\n                className={`w-3 h-3 rounded-full transition-all ${\n                  index === currentImageIndex \n                    ? 'bg-pink-500 scale-125' \n                    : 'bg-gray-300 hover:bg-gray-400'\n                }`}\n                onClick={() => setCurrentImageIndex(index)}\n              />\n            ))}\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default PhotographyShowcase;\n","size_bytes":4964},"client/src/components/ProtectedRoute.tsx":{"content":"import { useAuth } from '@/contexts/AuthContext';\nimport { Navigate } from 'react-router-dom';\nimport LoadingSpinner from './LoadingSpinner';\nimport { hasAdminDashboardAccess } from '@/utils/adminUtils';\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode;\n  requireAdmin?: boolean;\n}\n\nconst ProtectedRoute = ({ children, requireAdmin = false }: ProtectedRouteProps) => {\n  const { currentUser, userData, loading } = useAuth();\n\n  // Don't show loading if we have a current user\n  if (loading && !currentUser) {\n    return <LoadingSpinner message=\"Authenticating...\" />;\n  }\n\n  if (!currentUser) {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  // Check if user has admin access\n  if (requireAdmin) {\n    const hasAdminAccess = hasAdminDashboardAccess(userData);\n    \n    if (!hasAdminAccess) {\n      console.log('Admin access denied for user:', userData);\n      return <Navigate to=\"/\" replace />;\n    }\n  }\n\n  return <>{children}</>;\n};\n\nexport default ProtectedRoute;","size_bytes":979},"client/src/contexts/AuthContext.tsx":{"content":"import React, { createContext, useContext, useEffect, useState } from 'react';\nimport { \n  User as FirebaseUser,\n  signOut,\n  onAuthStateChanged,\n  GoogleAuthProvider,\n  signInWithPopup\n} from 'firebase/auth';\nimport { auth } from '@/lib/firebase';\nimport { User } from '@shared/types';\n\ninterface AuthContextType {\n  currentUser: FirebaseUser | null;\n  userData: User | null;\n  loginWithGoogle: () => Promise<void>;\n  logout: () => Promise<void>;\n  refreshUserData: () => Promise<void>;\n  loading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [currentUser, setCurrentUser] = useState<FirebaseUser | null>(null);\n  const [userData, setUserData] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [syncInProgress, setSyncInProgress] = useState(false);\n\n  const syncUserWithDatabase = async (firebaseUser: FirebaseUser) => {\n    // Prevent duplicate sync requests\n    if (syncInProgress) {\n      console.log('Sync already in progress, skipping duplicate request');\n      return;\n    }\n\n    setSyncInProgress(true);\n    \n    try {\n      const token = await firebaseUser.getIdToken();\n      const response = await fetch('/api/auth/sync-user', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          firebaseUid: firebaseUser.uid,\n          email: firebaseUser.email,\n          displayName: firebaseUser.displayName,\n          photoURL: firebaseUser.photoURL\n        })\n      });\n\n      if (response.ok) {\n        const user = await response.json();\n        console.log('Synced user data:', user);\n        setUserData(user);\n      } else {\n        console.error('Failed to sync user:', response.status, response.statusText);\n        // Set basic user data even if sync fails\n        const fallbackUser = {\n          id: firebaseUser.uid,\n          firebaseUid: firebaseUser.uid,\n          email: firebaseUser.email || '',\n          displayName: firebaseUser.displayName || '',\n          photoURL: firebaseUser.photoURL || '',\n          createdAt: new Date().toISOString(),\n          updatedAt: new Date().toISOString()\n        };\n        setUserData(fallbackUser);\n      }\n    } catch (error) {\n      console.error('Error syncing user with database:', error);\n      // Set basic user data even if sync fails\n      const fallbackUser = {\n        id: firebaseUser.uid,\n        firebaseUid: firebaseUser.uid,\n        email: firebaseUser.email || '',\n        displayName: firebaseUser.displayName || '',\n        photoURL: firebaseUser.photoURL || '',\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n      setUserData(fallbackUser);\n    } finally {\n      setSyncInProgress(false);\n    }\n  };\n\n  const loginWithGoogle = async () => {\n    try {\n      const provider = new GoogleAuthProvider();\n      provider.setCustomParameters({\n        prompt: 'select_account'\n      });\n      await signInWithPopup(auth, provider);\n      // Note: syncUserWithDatabase will be called automatically by onAuthStateChanged\n    } catch (error) {\n      console.error('Error signing in:', error);\n      throw error;\n    }\n  };\n\n  const logout = async () => {\n    await signOut(auth);\n    setUserData(null);\n  };\n\n  const refreshUserData = async () => {\n    if (currentUser) {\n      // Force refresh the Firebase token to get updated claims\n      await currentUser.getIdToken(true);\n      await syncUserWithDatabase(currentUser);\n    }\n  };\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      setCurrentUser(user);\n      setLoading(false);\n      \n      if (user) {\n        await syncUserWithDatabase(user);\n      } else {\n        setUserData(null);\n      }\n    });\n\n    return unsubscribe;\n  }, []);\n\n  // Sync user data on page refresh/reload\n  useEffect(() => {\n    const handlePageRefresh = async () => {\n      if (currentUser) {\n        await refreshUserData();\n      }\n    };\n\n    // Listen for page visibility changes (when user returns to tab)\n    const handleVisibilityChange = () => {\n      if (!document.hidden && currentUser) {\n        handlePageRefresh();\n      }\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    \n    // Also sync when the page loads if user is already authenticated\n    if (currentUser && !loading) {\n      handlePageRefresh();\n    }\n\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, [currentUser, loading]);\n\n  const value: AuthContextType = {\n    currentUser,\n    userData,\n    loginWithGoogle,\n    logout,\n    refreshUserData,\n    loading\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n}","size_bytes":5130},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/lib/firebase.ts":{"content":"import { initializeApp, getApps } from 'firebase/app';\nimport { getAuth } from 'firebase/auth';\nimport { getStorage } from 'firebase/storage';\n\nconst firebaseConfig = {\n  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\n  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,\n  databaseURL: import.meta.env.VITE_FIREBASE_DATABASE_URL,\n  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\n  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,\n  appId: import.meta.env.VITE_FIREBASE_APP_ID,\n  measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID\n};\n\n// Initialize Firebase only if not already initialized\nconst app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];\n\n// Initialize Firebase Authentication and get a reference to the service\nexport const auth = getAuth(app);\n\n// Initialize Cloud Storage and get a reference to the service\nexport const storage = getStorage(app);\n\nexport default app;","size_bytes":1007},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/AdminDashboard.tsx":{"content":"\nimport React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Label } from '@/components/ui/label';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { hasPermission, getAvailableTabs } from '@/utils/adminUtils';\nimport { \n  Users, \n  Calendar, \n  Camera, \n  BookOpen, \n  TrendingUp, \n  DollarSign,\n  Search,\n  Plus,\n  Edit,\n  Trash2,\n  Info,\n  FileText,\n  Eye,\n  Phone,\n  Mail,\n  MapPin,\n  Clock,\n  User,\n  Lock,\n  RefreshCw,\n  QrCode,\n  Download,\n  Copy,\n  Check,\n  Database,\n  HardDrive,\n  BarChart3\n} from 'lucide-react';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { ChevronUp, ChevronDown, Filter } from 'lucide-react';\nimport Header from '@/components/Header';\nimport { CreateEventDialog } from '@/components/CreateEventDialog';\nimport { CreatePackageDialog } from '@/components/CreatePackageDialog';\nimport { PhotoUploadDialog } from '@/components/PhotoUploadDialog';\nimport { CreateBookingDialog } from '@/components/CreateBookingDialog';\nimport { ManageUsersDialog } from '@/components/ManageUsersDialog';\nimport { EditableEventRow } from '@/components/EditableEventRow';\nimport { EventDetailsDialog } from '@/components/EventDetailsDialog';\nimport { AnalyticsReport } from '@/components/AnalyticsReport';\nimport { GalleryUploadDialog } from '@/components/GalleryUploadDialog';\nimport { AdminUsersManagement } from '@/components/AdminUsersManagement';\nimport AdminRoleManagement from '@/components/AdminRoleManagement';\nimport QRManagement from '@/components/QRManagement';\nimport { Booking, ContactMessage, Event, Package } from '@shared/types';\nimport { useNavigate } from 'react-router-dom';\nimport { useToast } from '@/hooks/use-toast';\nimport { DeleteConfirmation } from '@/components/ui/confirmation-alert';\n\ninterface AdminStats {\n  totalEvents: number;\n  totalBookings: number;\n  pendingBookings: number;\n  confirmedBookings: number;\n  totalRevenue: number;\n  unreadMessages: number;\n}\n\ninterface StorageStats {\n  database: {\n    totalEvents: number;\n    totalBookings: number;\n    totalMessages: number;\n    totalPackages: number;\n    totalUsers: number;\n    totalPhotos: number;\n  };\n  storage: {\n    totalPhotoSize: number;\n    totalPhotoSizeMB: number;\n    totalPhotoSizeGB: number;\n    averagePhotosPerEvent: number;\n    photosByEvent: Record<string, number>;\n  };\n  breakdown: {\n    activeEvents: number;\n    emptyEvents: number;\n    pendingBookings: number;\n    confirmedBookings: number;\n    activePackages: number;\n    inactivePackages: number;\n    adminUsers: number;\n    regularUsers: number;\n    unreadMessages: number;\n    readMessages: number;\n  };\n}\n\nconst AdminDashboard = () => {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedBooking, setSelectedBooking] = useState<Booking | null>(null);\n  const [viewDialogOpen, setViewDialogOpen] = useState(false);\n  const [sortField, setSortField] = useState<keyof Booking>('createdAt');\n  const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('desc');\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [stats, setStats] = useState<AdminStats | null>(null);\n  const [storageStats, setStorageStats] = useState<StorageStats | null>(null);\n  const [bookings, setBookings] = useState<Booking[]>([]);\n  const [messages, setMessages] = useState<ContactMessage[]>([]);\n  const [events, setEvents] = useState<Event[]>([]);\n  const [packages, setPackages] = useState<Package[]>([]);\n  const [photoRequests, setPhotoRequests] = useState<any[]>([]);\n  const [users, setUsers] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n  const [analyticsOpen, setAnalyticsOpen] = useState(false);\n  const [uploadGalleryOpen, setUploadGalleryOpen] = useState(false);\n  const [selectedEventForUpload, setSelectedEventForUpload] = useState<Event | null>(null);\n  const [eventDetailsOpen, setEventDetailsOpen] = useState(false);\n  const [selectedEventForView, setSelectedEventForView] = useState<Event | null>(null);\n  const [isEditingEvent, setIsEditingEvent] = useState(false);\n  const [selectedMessage, setSelectedMessage] = useState<ContactMessage | null>(null);\n  const [messageDialogOpen, setMessageDialogOpen] = useState(false);\n  \n  // Package management states\n  const [packageSearchTerm, setPackageSearchTerm] = useState('');\n  const [packageStatusFilter, setPackageStatusFilter] = useState<string>('all');\n  const [packageSortField, setPackageSortField] = useState<keyof Package>('createdAt');\n  const [packageSortDirection, setPackageSortDirection] = useState<'asc' | 'desc'>('desc');\n  \n  // QR Management states\n  const [selectedEventForQR, setSelectedEventForQR] = useState<Event | null>(null);\n  const [qrCodeUrl, setQrCodeUrl] = useState<string>('');\n  const [isGeneratingQR, setIsGeneratingQR] = useState(false);\n  const [copiedQRUrl, setCopiedQRUrl] = useState(false);\n  \n  const { currentUser, userData } = useAuth();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  // Get available tabs based on user permissions\n  const availableTabs = getAvailableTabs(userData);\n  const [activeTab, setActiveTab] = useState(availableTabs.length > 0 ? availableTabs[0].value : 'events');\n\n  // Helper function to get authentication headers\n  const getAuthHeaders = async (): Promise<Record<string, string>> => {\n    if (!currentUser) return {};\n    try {\n      const token = await currentUser.getIdToken();\n      return {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      };\n    } catch (error) {\n      console.error('Error getting auth token:', error);\n      return {};\n    }\n  };\n\n  // Separate function to fetch packages for reuse\n  const fetchPackages = async () => {\n    try {\n      const headers = await getAuthHeaders();\n      const packagesRes = await fetch('/api/packages', { headers });\n      if (packagesRes.ok) {\n        const packagesData = await packagesRes.json();\n        setPackages(packagesData || []);\n      }\n    } catch (error) {\n      console.error('Error fetching packages:', error);\n    }\n  };\n\n  // Package filtering and sorting logic\n  const filteredAndSortedPackages = packages\n    .filter(pkg => {\n      // Status filter\n      if (packageStatusFilter === 'active' && !pkg.isActive) return false;\n      if (packageStatusFilter === 'inactive' && pkg.isActive) return false;\n      \n      // Search filter\n      if (packageSearchTerm) {\n        const searchLower = packageSearchTerm.toLowerCase();\n        return (\n          pkg.name?.toLowerCase().includes(searchLower) ||\n          pkg.duration?.toLowerCase().includes(searchLower) ||\n          pkg.photoCount?.toLowerCase().includes(searchLower) ||\n          pkg.features?.some(feature => feature.toLowerCase().includes(searchLower)) ||\n          pkg.price?.toString().includes(searchLower)\n        );\n      }\n      \n      return true;\n    })\n    .sort((a, b) => {\n      let aValue, bValue;\n      \n      switch (packageSortField) {\n        case 'price':\n          aValue = a.price || 0;\n          bValue = b.price || 0;\n          break;\n        case 'name':\n          aValue = a.name?.toLowerCase() || '';\n          bValue = b.name?.toLowerCase() || '';\n          break;\n        case 'createdAt':\n          aValue = new Date(a.createdAt || '').getTime();\n          bValue = new Date(b.createdAt || '').getTime();\n          break;\n        case 'updatedAt':\n          aValue = new Date(a.updatedAt || '').getTime();\n          bValue = new Date(b.updatedAt || '').getTime();\n          break;\n        default:\n          aValue = a[packageSortField];\n          bValue = b[packageSortField];\n      }\n      \n      if (packageSortDirection === 'asc') {\n        return (aValue ?? 0) < (bValue ?? 0) ? -1 : (aValue ?? 0) > (bValue ?? 0) ? 1 : 0;\n      } else {\n        return (aValue ?? 0) > (bValue ?? 0) ? -1 : (aValue ?? 0) < (bValue ?? 0) ? 1 : 0;\n      }\n    });\n\n  const handlePackageSort = (field: keyof Package) => {\n    if (packageSortField === field) {\n      setPackageSortDirection(packageSortDirection === 'asc' ? 'desc' : 'asc');\n    } else {\n      setPackageSortField(field);\n      setPackageSortDirection('asc');\n    }\n  };\n\n\n\n  useEffect(() => {\n    const fetchAdminData = async () => {\n      try {\n        setLoading(true);\n        console.log('Admin Dashboard: Starting parallel data fetch...');\n\n        // Get authentication headers\n        const headers = await getAuthHeaders();\n\n        // Fetch all data in parallel for better performance\n        const promises = [\n          fetch('/api/bookings', { headers }).then(res => res.ok ? res.json() : []).catch(() => []),\n          fetch('/api/admin/stats', { headers }).then(res => res.ok ? res.json() : null).catch(() => null),\n          fetch('/api/admin/storage', { headers }).then(res => res.ok ? res.json() : null).catch(() => null),\n          fetch('/api/contact', { headers }).then(res => res.ok ? res.json() : []).catch(() => []),\n          fetch('/api/admin/events', { headers }).then(res => res.ok ? res.json() : []).catch(() => []),\n          fetch('/api/packages', { headers }).then(res => res.ok ? res.json() : []).catch(() => [])\n        ];\n\n        const [bookingsData, statsData, storageData, messagesData, eventsData, packagesData] = await Promise.all(promises);\n\n        // Update all states at once\n        setBookings(bookingsData || []);\n        setStats(statsData);\n        setStorageStats(storageData);\n        setMessages(messagesData || []);\n        setEvents(eventsData || []);\n        setPackages(packagesData || []);\n        \n        console.log('Admin Dashboard: Data fetch completed');\n      } catch (error) {\n        console.error('Admin Dashboard: General error:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchAdminData();\n  }, [currentUser]);\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'confirmed': return 'bg-green-100 text-green-800';\n      case 'pending': return 'bg-yellow-100 text-yellow-800';\n      case 'cancelled': return 'bg-red-100 text-red-800';\n      case 'processed': return 'bg-blue-100 text-blue-800';\n      case 'delivered': return 'bg-purple-100 text-purple-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const handleBookingAction = async (bookingId: string, status: 'confirmed' | 'cancelled' | 'pending') => {\n    try {\n      console.log(`Updating booking ${bookingId} to status: ${status}`);\n      const response = await fetch(`/api/bookings/${bookingId}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ status })\n      });\n\n      if (response.ok) {\n        console.log('Booking status updated successfully');\n        // Refresh bookings data\n        const bookingsRes = await fetch('/api/bookings');\n        if (bookingsRes.ok) {\n          const bookingsData = await bookingsRes.json();\n          setBookings(bookingsData);\n          console.log('Bookings data refreshed');\n        }\n      } else {\n        console.error('Failed to update booking status:', response.statusText);\n        toast({\n          title: \"Error\",\n          description: \"Failed to update booking status. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error('Error updating booking:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update booking status. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleAmountChange = async (bookingId: string, amount: number) => {\n    try {\n      console.log(`Updating booking ${bookingId} amount to: ${amount}`);\n      const response = await fetch(`/api/bookings/${bookingId}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ amount })\n      });\n\n      if (response.ok) {\n        const updatedBooking = await response.json();\n        console.log('Amount updated successfully:', updatedBooking);\n        \n        // Update local state immediately\n        setBookings(prevBookings => \n          prevBookings.map(booking => \n            booking.id === bookingId ? { ...booking, amount } : booking\n          )\n        );\n        \n        // Update the selected booking if it's currently viewed\n        if (selectedBooking && selectedBooking.id === bookingId) {\n          setSelectedBooking(prev => prev ? { ...prev, amount } : null);\n        }\n      } else {\n        console.error('Failed to update booking amount:', response.statusText);\n        toast({\n          title: \"Error\",\n          description: \"Failed to update amount. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error('Error updating booking amount:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update amount. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDeleteBooking = async (bookingId: string) => {\n    try {\n      console.log(`Deleting booking: ${bookingId}`);\n      const response = await fetch(`/api/bookings/${bookingId}`, {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (response.ok) {\n        console.log('Booking deleted successfully');\n        // Refresh bookings data\n        const bookingsRes = await fetch('/api/bookings');\n        if (bookingsRes.ok) {\n          const bookingsData = await bookingsRes.json();\n          setBookings(bookingsData);\n          console.log('Bookings data refreshed after deletion');\n        }\n        toast({\n          title: \"Success\",\n          description: \"Booking deleted successfully.\",\n        });\n      } else {\n        console.error('Failed to delete booking:', response.statusText);\n        toast({\n          title: \"Error\",\n          description: \"Failed to delete booking. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error('Error deleting booking:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete booking. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDeleteMessage = async (messageId: string) => {\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`/api/contact/${messageId}`, {\n        method: 'DELETE',\n        headers\n      });\n\n      if (response.ok) {\n        // Refresh messages data\n        const messagesRes = await fetch('/api/contact');\n        if (messagesRes.ok) {\n          const messagesData = await messagesRes.json();\n          setMessages(messagesData || []);\n        }\n        toast({\n          title: \"Success\",\n          description: \"Message deleted successfully.\",\n        });\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Failed to delete message. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error('Error deleting message:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete message. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleClearAllMessages = async () => {\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch('/api/contact/clear-all', {\n        method: 'DELETE',\n        headers\n      });\n\n      if (response.ok) {\n        setMessages([]);\n        toast({\n          title: \"Success\",\n          description: \"All messages cleared successfully.\",\n        });\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Failed to clear messages. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error('Error clearing messages:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to clear messages. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleViewBooking = (booking: Booking) => {\n    setSelectedBooking(booking);\n    setViewDialogOpen(true);\n  };\n\n  const handleSort = (field: keyof Booking) => {\n    if (sortField === field) {\n      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortField(field);\n      setSortDirection('asc');\n    }\n  };\n\n  const getSortedAndFilteredBookings = () => {\n    let filteredBookings = bookings.filter(booking => {\n      // Search filter\n      const matchesSearch = booking.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        booking.eventType?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        booking.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        booking.location?.toLowerCase().includes(searchTerm.toLowerCase());\n      \n      // Status filter\n      const matchesStatus = statusFilter === 'all' || booking.status === statusFilter;\n      \n      return matchesSearch && matchesStatus;\n    });\n\n    // Sort bookings\n    filteredBookings.sort((a, b) => {\n      let aValue = a[sortField];\n      let bValue = b[sortField];\n      \n      // Handle date sorting\n      if (sortField === 'eventDate' || sortField === 'createdAt') {\n        aValue = new Date(aValue as string).getTime();\n        bValue = new Date(bValue as string).getTime();\n      }\n      \n      // Handle string sorting\n      if (typeof aValue === 'string' && typeof bValue === 'string') {\n        aValue = aValue.toLowerCase();\n        bValue = bValue.toLowerCase();\n      }\n      \n      // Handle undefined values\n      if (aValue === undefined && bValue === undefined) return 0;\n      if (aValue === undefined) return sortDirection === 'asc' ? 1 : -1;\n      if (bValue === undefined) return sortDirection === 'asc' ? -1 : 1;\n      \n      if (aValue < bValue) return sortDirection === 'asc' ? -1 : 1;\n      if (aValue > bValue) return sortDirection === 'asc' ? 1 : -1;\n      return 0;\n    });\n\n    return filteredBookings;\n  };\n\n  const refreshData = async () => {\n    setRefreshing(true);\n    try {\n      console.log('Refreshing admin dashboard data...');\n\n      const [statsRes, storageRes, bookingsRes, messagesRes, eventsRes] = await Promise.all([\n        fetch('/api/admin/stats').catch(() => ({ ok: false })),\n        fetch('/api/admin/storage').catch(() => ({ ok: false })),\n        fetch('/api/bookings').catch(() => ({ ok: false })),\n        fetch('/api/contact').catch(() => ({ ok: false })),\n        fetch('/api/admin/events').catch(() => ({ ok: false }))\n      ]);\n\n      if (statsRes.ok && 'json' in statsRes) {\n        const statsData = await statsRes.json();\n        setStats(statsData);\n      }\n\n      if (storageRes.ok && 'json' in storageRes) {\n        const storageData = await storageRes.json();\n        setStorageStats(storageData);\n      }\n\n      if (bookingsRes.ok && 'json' in bookingsRes) {\n        const bookingsData = await bookingsRes.json();\n        setBookings(bookingsData || []);\n      }\n\n      if (messagesRes.ok && 'json' in messagesRes) {\n        const messagesData = await messagesRes.json();\n        setMessages(messagesData || []);\n      }\n\n      if (eventsRes.ok && 'json' in eventsRes) {\n        const eventsData = await eventsRes.json();\n        setEvents(eventsData || []);\n      }\n\n      // Refresh packages data\n      await fetchPackages();\n\n      // Trigger users data refresh by incrementing the refresh trigger\n      setRefreshTrigger(prev => prev + 1);\n\n      console.log('Admin dashboard data refreshed successfully');\n    } catch (error) {\n      console.error('Error refreshing admin data:', error);\n    } finally {\n      setRefreshing(false);\n    }\n  };\n\n  const handleViewEvent = (event: Event) => {\n    setSelectedEventForView(event);\n    setIsEditingEvent(false);\n    setEventDetailsOpen(true);\n  };\n\n  const handleEditEvent = (event: Event) => {\n    setSelectedEventForView(event);\n    setEventDetailsOpen(true);\n    setIsEditingEvent(true);\n    // The EventDetailsDialog will handle the editing functionality\n  };\n\n  const handleUploadPhotos = (eventId: string) => {\n    // Photo upload is now handled by the PhotoUploadDialog component\n    console.log('Photo upload triggered for event:', eventId);\n  };\n\n  const handleDeleteEvent = async (eventId: string) => {\n    try {\n      const token = await currentUser?.getIdToken();\n      const response = await fetch(`/api/events/${eventId}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n\n      if (response.ok) {\n        refreshData();\n        toast({\n          title: \"Success\",\n          description: \"Event deleted successfully.\",\n        });\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Failed to delete event. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error('Error deleting event:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete event. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // QR Code generation functions\n  const generateQRCode = async (event: Event) => {\n    setIsGeneratingQR(true);\n    try {\n      const baseUrl = window.location.origin;\n      const qrUrl = `${baseUrl}/qr-access/${event.id}`;\n      \n      const response = await fetch('/api/admin/generate-qr', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          eventId: event.id,\n          url: qrUrl\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to generate QR code');\n      }\n\n      const data = await response.json();\n      setQrCodeUrl(data.qrCodeDataUrl);\n      setSelectedEventForQR(event);\n      \n      toast({\n        title: \"QR Code Generated\",\n        description: `QR code created for ${event.title}`,\n      });\n    } catch (error) {\n      console.error('Error generating QR code:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to generate QR code. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGeneratingQR(false);\n    }\n  };\n\n  const downloadQRCode = () => {\n    if (!qrCodeUrl || !selectedEventForQR) return;\n\n    const link = document.createElement('a');\n    link.href = qrCodeUrl;\n    link.download = `qr-code-${selectedEventForQR.title.replace(/\\s+/g, '-').toLowerCase()}.png`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n    toast({\n      title: \"QR Code Downloaded\",\n      description: `QR code saved as ${link.download}`,\n    });\n  };\n\n  const copyQRUrl = async () => {\n    if (!selectedEventForQR) return;\n\n    const baseUrl = window.location.origin;\n    const qrUrl = `${baseUrl}/qr-access/${selectedEventForQR.id}`;\n    \n    try {\n      await navigator.clipboard.writeText(qrUrl);\n      setCopiedQRUrl(true);\n      setTimeout(() => setCopiedQRUrl(false), 2000);\n      \n      toast({\n        title: \"URL Copied\",\n        description: \"QR access URL copied to clipboard\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to copy URL to clipboard\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n      \n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"mb-8 flex items-center justify-between\">\n          <div>\n            <div className=\"flex items-center gap-4 mb-2\">\n              <h1 className=\"text-4xl font-bold text-gray-900\">Admin Dashboard</h1>\n              {userData && (\n                <Badge variant=\"outline\" className=\"bg-blue-50 border-blue-200 text-blue-700 px-3 py-1\">\n                  {userData.adminRole === 'owner' && '👑 Owner'}\n                  {userData.adminRole === 'admin' && '🛡️ Administrator'}\n                  {userData.adminRole === 'moderator' && '⚡ Moderator'}\n                </Badge>\n              )}\n            </div>\n            <p className=\"text-gray-600\">Welcome back! Here's what's happening with your photography business.</p>\n          </div>\n          <Button \n            onClick={refreshData}\n            disabled={refreshing || loading}\n            variant=\"outline\"\n            size=\"lg\"\n            className=\"bg-blue-50 border-blue-200 text-blue-600 hover:bg-blue-100 disabled:opacity-50\"\n          >\n            <RefreshCw className={`h-5 w-5 mr-2 ${refreshing ? 'animate-spin' : ''}`} />\n            {refreshing ? 'Refreshing...' : 'Refresh Data'}\n          </Button>\n        </div>\n\n        {/* Quick Actions */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"text-xl font-bold\">Quick Actions</CardTitle>\n            <CardDescription>Administrative tasks based on your permissions</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              {hasPermission(userData, 'bookings') && (\n                <CreateBookingDialog onBookingCreated={() => {\n                  console.log('Booking created, refreshing data...');\n                  const refreshData = async () => {\n                    try {\n                      const bookingsRes = await fetch('/api/bookings');\n                      if (bookingsRes.ok) {\n                        const bookingsData = await bookingsRes.json();\n                        setBookings(bookingsData);\n                      }\n                    } catch (error) {\n                      console.error('Error refreshing bookings:', error);\n                    }\n                  };\n                  refreshData();\n                }} />\n              )}\n              {hasPermission(userData, 'photos') && (\n                <GalleryUploadDialog \n                  events={events} \n                  onPhotosUploaded={refreshData} \n                />\n              )}\n              {hasPermission(userData, 'users') && (\n                <ManageUsersDialog onUserUpdated={() => {\n                  console.log('User updated, refreshing data...');\n                }} />\n              )}\n              {hasPermission(userData, 'events') && (\n                <Button \n                  variant=\"outline\" \n                  className=\"bg-purple-50 border-purple-200 text-purple-600 hover:bg-purple-100\"\n                  onClick={() => setAnalyticsOpen(true)}\n                >\n                  <TrendingUp className=\"h-4 w-4 mr-2\" />\n                  View Analytics Report\n                </Button>\n              )}\n\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Stats Cards */}\n        {loading ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n            {[1, 2, 3, 4].map((i) => (\n              <Card key={i} className=\"animate-pulse\">\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n                  <div className=\"h-4 w-4 bg-gray-200 rounded\"></div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"h-8 bg-gray-200 rounded w-16 mb-2\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-20\"></div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : stats ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Total Events</CardTitle>\n                <Calendar className=\"h-4 w-4 text-blue-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stats.totalEvents}</div>\n                <p className=\"text-xs text-muted-foreground\">Active events</p>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Total Bookings</CardTitle>\n                <BookOpen className=\"h-4 w-4 text-green-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stats.totalBookings}</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {stats.pendingBookings} pending, {stats.confirmedBookings} confirmed\n                </p>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Revenue</CardTitle>\n                <DollarSign className=\"h-4 w-4 text-orange-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">₹{stats.totalRevenue.toLocaleString()}</div>\n                <p className=\"text-xs text-muted-foreground\">From confirmed bookings</p>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Messages</CardTitle>\n                <Users className=\"h-4 w-4 text-purple-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stats.unreadMessages}</div>\n                <p className=\"text-xs text-muted-foreground\">Unread messages</p>\n              </CardContent>\n            </Card>\n          </div>\n        ) : null}\n\n        {/* Main Content Tabs */}\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n          <div className=\"border-b border-gray-200 mb-6\">\n            <TabsList className=\"inline-flex h-10 items-center justify-start rounded-none bg-transparent p-0 space-x-0 w-full overflow-x-auto\">\n              {availableTabs.map((tab) => (\n                <TabsTrigger \n                  key={tab.value} \n                  value={tab.value}\n                  className=\"inline-flex items-center justify-center whitespace-nowrap rounded-none border-b-2 border-transparent bg-transparent px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 data-[state=active]:border-blue-500 data-[state=active]:text-blue-600 data-[state=active]:bg-transparent transition-colors duration-200\"\n                >\n                  {tab.label}\n                </TabsTrigger>\n              ))}\n            </TabsList>\n          </div>\n\n\n\n          {hasPermission(userData, 'events') && (\n            <TabsContent value=\"events\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex justify-between items-center\">\n                  <div>\n                    <CardTitle>Event Management</CardTitle>\n                    <CardDescription>Create and manage photography events with photo galleries</CardDescription>\n                  </div>\n                  <CreateEventDialog onEventCreated={refreshData} />\n                </div>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Event Title</TableHead>\n                      <TableHead>Date</TableHead>\n                      <TableHead>Location</TableHead>\n                      <TableHead>Category</TableHead>\n                      <TableHead>Visibility</TableHead>\n                      <TableHead>Photos</TableHead>\n                      <TableHead>PINs</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {events.length > 0 ? (\n                      events.map((event) => (\n                        <TableRow key={event.id}>\n                          <TableCell className=\"font-medium\">{event.title}</TableCell>\n                          <TableCell>{new Date(event.eventDate).toLocaleDateString()}</TableCell>\n                          <TableCell>{event.location}</TableCell>\n                          <TableCell>\n                            <Badge variant=\"outline\">{event.category}</Badge>\n                          </TableCell>\n                          <TableCell>\n                            <Badge className={event.isPrivate ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}>\n                              {event.isPrivate ? 'Private' : 'Public'}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant=\"secondary\">{event.photoCount || 0} photos</Badge>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"space-y-1\">\n                              {event.publicPin && (\n                                <div className=\"text-xs\">\n                                  <span className=\"font-mono bg-gray-100 px-1 rounded\">Public: {event.publicPin}</span>\n                                </div>\n                              )}\n                              {event.brideGroomPin && (\n                                <div className=\"text-xs\">\n                                  <span className=\"font-mono bg-pink-100 px-1 rounded\">B&G: {event.brideGroomPin}</span>\n                                </div>\n                              )}\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex gap-2\">\n                              <Button variant=\"ghost\" size=\"sm\" onClick={() => handleViewEvent(event)} title=\"View Details\">\n                                <Eye className=\"h-4 w-4\" />\n                              </Button>\n                              <PhotoUploadDialog \n                                eventId={event.id} \n                                eventTitle={event.title}\n                                onPhotosUploaded={refreshData}\n                              />\n                              <Button variant=\"ghost\" size=\"sm\" onClick={() => handleEditEvent(event)} title=\"Edit Event\">\n                                <Edit className=\"h-4 w-4\" />\n                              </Button>\n                              <DeleteConfirmation\n                                itemName={event.title}\n                                itemType=\"event\"\n                                onConfirm={() => handleDeleteEvent(event.id)}\n                                trigger={\n                                  <Button \n                                    variant=\"ghost\" \n                                    size=\"sm\"\n                                    title=\"Delete Event\"\n                                    className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n                                  >\n                                    <Trash2 className=\"h-4 w-4\" />\n                                  </Button>\n                                }\n                              />\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    ) : (\n                      <TableRow>\n                        <TableCell colSpan={8} className=\"text-center py-8 text-gray-500\">\n                          <Calendar className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                          <p>No events created yet</p>\n                          <p className=\"text-sm mt-2\">Create your first event to start managing photo galleries</p>\n                        </TableCell>\n                      </TableRow>\n                    )}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          </TabsContent>\n          )}\n\n          {hasPermission(userData, 'bookings') && (\n            <TabsContent value=\"bookings\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex justify-between items-center\">\n                  <div>\n                    <CardTitle>All Bookings</CardTitle>\n                    <CardDescription>Manage all event bookings and requests</CardDescription>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                      <Input\n                        placeholder=\"Search bookings...\"\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                        className=\"pl-8 w-64\"\n                      />\n                    </div>\n                    <Select value={statusFilter} onValueChange={setStatusFilter}>\n                      <SelectTrigger className=\"w-32\">\n                        <Filter className=\"h-4 w-4 mr-2\" />\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Status</SelectItem>\n                        <SelectItem value=\"pending\">Pending</SelectItem>\n                        <SelectItem value=\"confirmed\">Confirmed</SelectItem>\n                        <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <Button \n                      onClick={() => navigate('/booking')}\n                      className=\"bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white\"\n                    >\n                      <Plus className=\"mr-2 h-4 w-4\" />\n                      New Booking\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead \n                        className=\"cursor-pointer hover:bg-gray-50 select-none\"\n                        onClick={() => handleSort('name')}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          Client\n                          {sortField === 'name' && (\n                            sortDirection === 'asc' ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                          )}\n                        </div>\n                      </TableHead>\n                      <TableHead \n                        className=\"cursor-pointer hover:bg-gray-50 select-none\"\n                        onClick={() => handleSort('eventType')}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          Event Type\n                          {sortField === 'eventType' && (\n                            sortDirection === 'asc' ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                          )}\n                        </div>\n                      </TableHead>\n                      <TableHead \n                        className=\"cursor-pointer hover:bg-gray-50 select-none\"\n                        onClick={() => handleSort('eventDate')}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          Date\n                          {sortField === 'eventDate' && (\n                            sortDirection === 'asc' ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                          )}\n                        </div>\n                      </TableHead>\n                      <TableHead \n                        className=\"cursor-pointer hover:bg-gray-50 select-none\"\n                        onClick={() => handleSort('status')}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          Status\n                          {sortField === 'status' && (\n                            sortDirection === 'asc' ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                          )}\n                        </div>\n                      </TableHead>\n                      <TableHead \n                        className=\"cursor-pointer hover:bg-gray-50 select-none\"\n                        onClick={() => handleSort('amount')}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          Amount\n                          {sortField === 'amount' && (\n                            sortDirection === 'asc' ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />\n                          )}\n                        </div>\n                      </TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {getSortedAndFilteredBookings().length > 0 ? (\n                      getSortedAndFilteredBookings().map((booking) => (\n                        <TableRow key={booking.id}>\n                          <TableCell className=\"font-medium\">{booking.name || 'Unknown Client'}</TableCell>\n                          <TableCell>{booking.eventType}</TableCell>\n                          <TableCell>{new Date(booking.eventDate).toLocaleDateString()}</TableCell>\n                          <TableCell>\n                            <Select \n                              value={booking.status} \n                              onValueChange={(newStatus) => handleBookingAction(booking.id, newStatus as 'confirmed' | 'cancelled' | 'pending')}\n                            >\n                              <SelectTrigger className={`w-32 ${getStatusColor(booking.status)} border-0`}>\n                                <SelectValue />\n                              </SelectTrigger>\n                              <SelectContent>\n                                <SelectItem value=\"pending\">\n                                  <div className=\"flex items-center gap-2\">\n                                    <div className=\"w-2 h-2 bg-yellow-500 rounded-full\"></div>\n                                    Pending\n                                  </div>\n                                </SelectItem>\n                                <SelectItem value=\"confirmed\">\n                                  <div className=\"flex items-center gap-2\">\n                                    <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                                    Confirmed\n                                  </div>\n                                </SelectItem>\n                                <SelectItem value=\"cancelled\">\n                                  <div className=\"flex items-center gap-2\">\n                                    <div className=\"w-2 h-2 bg-red-500 rounded-full\"></div>\n                                    Cancelled\n                                  </div>\n                                </SelectItem>\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-1\">\n                              <span className=\"text-sm\">₹</span>\n                              <input\n                                type=\"number\"\n                                value={booking.amount || 0}\n                                onChange={(e) => handleAmountChange(booking.id, Number(e.target.value))}\n                                className=\"w-20 px-2 py-1 border border-gray-300 rounded text-sm\"\n                                min=\"0\"\n                                step=\"50\"\n                              />\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex gap-2\">\n                              <Button variant=\"ghost\" size=\"sm\" onClick={() => handleViewBooking(booking)}>\n                                <Eye className=\"h-4 w-4\" />\n                              </Button>\n                              <DeleteConfirmation\n                                itemName={booking.name || 'booking'}\n                                itemType=\"booking\"\n                                onConfirm={() => handleDeleteBooking(booking.id)}\n                                trigger={\n                                  <Button \n                                    variant=\"ghost\" \n                                    size=\"sm\"\n                                    className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n                                  >\n                                    <Trash2 className=\"h-4 w-4\" />\n                                  </Button>\n                                }\n                              />\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    ) : (\n                      <TableRow>\n                        <TableCell colSpan={6} className=\"text-center py-8 text-gray-500\">\n                          <BookOpen className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                          <p>\n                            {bookings.length === 0 \n                              ? 'No bookings found' \n                              : 'No bookings match your filters'\n                            }\n                          </p>\n                          <p className=\"text-sm\">\n                            {bookings.length === 0 \n                              ? 'Create your first booking to get started' \n                              : 'Try adjusting your search or filter options'\n                            }\n                          </p>\n                        </TableCell>\n                      </TableRow>\n                    )}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          </TabsContent>\n          )}\n\n          {hasPermission(userData, 'packages') && (\n            <TabsContent value=\"packages\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex justify-between items-center\">\n                  <div>\n                    <CardTitle>Photography Packages</CardTitle>\n                    <CardDescription>Manage your photography service packages and pricing</CardDescription>\n                  </div>\n                  <CreatePackageDialog onPackageCreated={fetchPackages} />\n                </div>\n              </CardHeader>\n              <CardContent>\n                {/* Search and Filter Controls */}\n                <div className=\"flex flex-col sm:flex-row gap-4 mb-6\">\n                  <div className=\"relative flex-1\">\n                    <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                      placeholder=\"Search packages by name, duration, features, or price...\"\n                      value={packageSearchTerm}\n                      onChange={(e) => setPackageSearchTerm(e.target.value)}\n                      className=\"pl-8\"\n                    />\n                  </div>\n                  <Select value={packageStatusFilter} onValueChange={setPackageStatusFilter}>\n                    <SelectTrigger className=\"w-[150px]\">\n                      <Filter className=\"w-4 h-4 mr-2\" />\n                      <SelectValue placeholder=\"Filter by status\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Packages</SelectItem>\n                      <SelectItem value=\"active\">Active Only</SelectItem>\n                      <SelectItem value=\"inactive\">Inactive Only</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <Select value={`${packageSortField}-${packageSortDirection}`} onValueChange={(value) => {\n                    const [field, direction] = value.split('-') as [keyof Package, 'asc' | 'desc'];\n                    setPackageSortField(field);\n                    setPackageSortDirection(direction);\n                  }}>\n                    <SelectTrigger className=\"w-[180px]\">\n                      <SelectValue placeholder=\"Sort by\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"createdAt-desc\">Newest First</SelectItem>\n                      <SelectItem value=\"createdAt-asc\">Oldest First</SelectItem>\n                      <SelectItem value=\"name-asc\">Name A-Z</SelectItem>\n                      <SelectItem value=\"name-desc\">Name Z-A</SelectItem>\n                      <SelectItem value=\"price-asc\">Price Low-High</SelectItem>\n                      <SelectItem value=\"price-desc\">Price High-Low</SelectItem>\n                      <SelectItem value=\"updatedAt-desc\">Recently Updated</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Results Summary */}\n                <div className=\"flex justify-between items-center mb-4\">\n                  <p className=\"text-sm text-gray-600\">\n                    Showing {filteredAndSortedPackages.length} of {packages.length} packages\n                  </p>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                  {filteredAndSortedPackages.length > 0 ? (\n                    filteredAndSortedPackages.map((pkg) => (\n                      <Card key={pkg.id} className=\"relative\">\n                        <CardHeader>\n                          <div className=\"flex justify-between items-start\">\n                            <div>\n                              <CardTitle className=\"text-lg\">{pkg.name}</CardTitle>\n                              <div className=\"flex gap-2 mt-2\">\n                                {pkg.isPopular && (\n                                  <Badge className=\"bg-orange-100 text-orange-800\">Popular</Badge>\n                                )}\n                                <Badge className={pkg.isActive ? \"bg-green-100 text-green-800\" : \"bg-gray-100 text-gray-800\"}>\n                                  {pkg.isActive ? 'Active' : 'Inactive'}\n                                </Badge>\n                              </div>\n                            </div>\n                            <div className=\"text-right\">\n                              <p className=\"text-2xl font-bold\">₹{pkg.price}</p>\n                            </div>\n                          </div>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"space-y-2\">\n                            <p className=\"text-sm text-gray-600\">\n                              <Clock className=\"w-4 h-4 inline mr-1\" />\n                              {pkg.duration}\n                            </p>\n                            <p className=\"text-sm text-gray-600\">\n                              <Camera className=\"w-4 h-4 inline mr-1\" />\n                              {pkg.photoCount}\n                            </p>\n                            <div className=\"mt-3\">\n                              <p className=\"text-sm font-medium mb-2\">Features:</p>\n                              <ul className=\"text-sm text-gray-600 space-y-1\">\n                                {pkg.features?.map((feature, index) => (\n                                  <li key={`${pkg.id}-feature-${index}-${feature.substring(0, 10)}`} className=\"flex items-center\">\n                                    <div className=\"w-1.5 h-1.5 bg-blue-500 rounded-full mr-2\"></div>\n                                    {feature}\n                                  </li>\n                                ))}\n                              </ul>\n                            </div>\n                          </div>\n                          <div className=\"flex gap-2 mt-4\">\n                            <CreatePackageDialog \n                              editPackage={pkg} \n                              isEditing={true} \n                              onPackageCreated={fetchPackages} \n                            />\n                            <DeleteConfirmation\n                              itemName={pkg.name}\n                              itemType=\"package\"\n                              onConfirm={async () => {\n                                try {\n                                  await fetch(`/api/packages/${pkg.id}`, { method: 'DELETE' });\n                                  await fetchPackages();\n                                  toast({\n                                    title: \"Success\",\n                                    description: `Package \"${pkg.name}\" deleted successfully.`,\n                                  });\n                                } catch (error) {\n                                  console.error('Error deleting package:', error);\n                                  toast({\n                                    title: \"Error\",\n                                    description: \"Failed to delete package. Please try again.\",\n                                    variant: \"destructive\",\n                                  });\n                                }\n                              }}\n                              trigger={\n                                <Button \n                                  variant=\"outline\" \n                                  size=\"sm\"\n                                >\n                                  <Trash2 className=\"w-4 h-4\" />\n                                </Button>\n                              }\n                            />\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))\n                  ) : (\n                    <div className=\"col-span-full text-center py-12\">\n                      <Camera className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                      <p className=\"text-gray-500 mb-4\">\n                        {packages.length === 0 \n                          ? 'No packages found' \n                          : 'No packages match your filters'\n                        }\n                      </p>\n                      <p className=\"text-sm text-gray-400 mb-4\">\n                        {packages.length === 0 \n                          ? 'Create your first package to get started' \n                          : 'Try adjusting your search or filter options'\n                        }\n                      </p>\n                      {packages.length === 0 && (\n                        <CreatePackageDialog onPackageCreated={fetchPackages} />\n                      )}\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n          )}\n\n          {hasPermission(userData, 'photos') && (\n            <TabsContent value=\"photos\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Photo Requests</CardTitle>\n                <CardDescription>Manage FindMyFace photo requests and deliveries</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Client</TableHead>\n                      <TableHead>Event</TableHead>\n                      <TableHead>Photos Found</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {photoRequests.length > 0 ? (\n                      photoRequests.map((request) => (\n                        <TableRow key={request.id}>\n                          <TableCell className=\"font-medium\">{request.client}</TableCell>\n                          <TableCell>{request.event}</TableCell>\n                          <TableCell>{request.photos} photos</TableCell>\n                          <TableCell>\n                            <Badge className={getStatusColor(request.status)}>\n                              {request.status}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex gap-2\">\n                              <Button variant=\"ghost\" size=\"sm\">\n                                <Eye className=\"h-4 w-4\" />\n                              </Button>\n                              <Button variant=\"ghost\" size=\"sm\">\n                                <Edit className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    ) : (\n                      <TableRow>\n                        <TableCell colSpan={5} className=\"text-center py-8 text-gray-500\">\n                          <Camera className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                          <p>No photo requests yet</p>\n                        </TableCell>\n                      </TableRow>\n                    )}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          </TabsContent>\n          )}\n\n          {hasPermission(userData, 'contacts') && (\n            <TabsContent value=\"messages\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex justify-between items-center\">\n                  <div>\n                    <CardTitle>Contact Messages</CardTitle>\n                    <CardDescription>Manage messages from contact form submissions</CardDescription>\n                  </div>\n                  <div className=\"flex items-center gap-3\">\n                    <Badge variant=\"secondary\" className=\"px-3 py-1\">\n                      {messages.filter(m => !m.isRead).length} unread\n                    </Badge>\n                    {messages.length > 0 && (\n                      <DeleteConfirmation\n                        itemName=\"all contact messages\"\n                        itemType=\"messages\"\n                        onConfirm={handleClearAllMessages}\n                        trigger={\n                          <Button variant=\"destructive\" size=\"sm\">\n                            <Trash2 className=\"h-4 w-4 mr-2\" />\n                            Clear All\n                          </Button>\n                        }\n                      />\n                    )}\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"w-[100px]\">Date</TableHead>\n                        <TableHead className=\"w-[120px]\">Name</TableHead>\n                        <TableHead className=\"w-[200px]\">Email</TableHead>\n                        <TableHead className=\"w-[150px]\">Subject</TableHead>\n                        <TableHead className=\"w-[250px]\">Message</TableHead>\n                        <TableHead className=\"w-[80px] text-center\">Status</TableHead>\n                        <TableHead className=\"w-[100px] text-center\">Actions</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {messages.length > 0 ? (\n                        messages.map((message) => (\n                          <TableRow key={message.id} className={!message.isRead ? 'bg-blue-50' : ''}>\n                            <TableCell className=\"text-sm font-medium\">\n                              {new Date(message.createdAt).toLocaleDateString()}\n                            </TableCell>\n                            <TableCell className=\"font-medium\">\n                              <div className=\"truncate\" title={message.name}>\n                                {message.name}\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              <a \n                                href={`mailto:${message.email}`} \n                                className=\"text-blue-600 hover:underline truncate block\" \n                                title={message.email}\n                              >\n                                {message.email}\n                              </a>\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"truncate\" title={message.subject || 'No subject'}>\n                                {message.subject || 'No subject'}\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"truncate\" title={message.message}>\n                                {message.message}\n                              </div>\n                            </TableCell>\n                            <TableCell className=\"text-center\">\n                              <Badge variant={message.isRead ? \"secondary\" : \"default\"} className=\"whitespace-nowrap\">\n                                {message.isRead ? 'Read' : 'Unread'}\n                              </Badge>\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"flex gap-1 justify-center\">\n                                <Button \n                                  variant=\"ghost\" \n                                  size=\"sm\"\n                                  className=\"h-8 w-8 p-0\"\n                                  onClick={() => {\n                                    setSelectedMessage(message);\n                                    setMessageDialogOpen(true);\n                                    // Mark as read\n                                    fetch(`/api/contact/${message.id}/read`, { method: 'PATCH' })\n                                      .then(() => refreshData())\n                                      .catch(console.error);\n                                  }}\n                                  title=\"View message\"\n                                >\n                                  <Eye className=\"h-4 w-4\" />\n                                </Button>\n                                <Button \n                                  variant=\"ghost\" \n                                  size=\"sm\"\n                                  className=\"h-8 w-8 p-0 text-blue-600 hover:text-blue-700\"\n                                  onClick={() => window.location.href = `mailto:${message.email}?subject=Re: ${message.subject || 'Your inquiry'}`}\n                                  title=\"Reply via email\"\n                                >\n                                  <Mail className=\"h-4 w-4\" />\n                                </Button>\n                                <DeleteConfirmation\n                                  itemName={`message from ${message.name}`}\n                                  itemType=\"message\"\n                                  onConfirm={() => handleDeleteMessage(message.id)}\n                                  trigger={\n                                    <Button \n                                      variant=\"ghost\" \n                                      size=\"sm\"\n                                      className=\"h-8 w-8 p-0 text-red-600 hover:text-red-700\"\n                                      title=\"Delete message\"\n                                    >\n                                      <Trash2 className=\"h-4 w-4\" />\n                                    </Button>\n                                  }\n                                />\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        ))\n                    ) : (\n                      <TableRow>\n                        <TableCell colSpan={7} className=\"text-center py-8 text-gray-500\">\n                          <Mail className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                          <p>No messages received yet</p>\n                          <p className=\"text-sm mt-2\">Contact form submissions will appear here</p>\n                        </TableCell>\n                      </TableRow>\n                    )}\n                  </TableBody>\n                  </Table>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n          )}\n\n          {hasPermission(userData, 'users') && (\n            <TabsContent value=\"users\" className=\"space-y-6\">\n              <AdminRoleManagement currentUser={userData} refreshTrigger={refreshTrigger} />\n            </TabsContent>\n          )}\n\n          {hasPermission(userData, 'events') && (\n            <TabsContent value=\"qr\" className=\"space-y-6\">\n              <QRManagement />\n            </TabsContent>\n          )}\n\n        </Tabs>\n      </div>\n\n      {/* Booking Details Dialog */}\n      <Dialog open={viewDialogOpen} onOpenChange={setViewDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-xl font-bold\">Booking Details</DialogTitle>\n            <DialogDescription>\n              Complete information about this booking request\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedBooking && (\n            <div className=\"space-y-6 p-2\">\n              {/* Header with Status */}\n              <div className=\"flex justify-between items-center border-b pb-4\">\n                <div>\n                  <h3 className=\"text-xl font-semibold\">{selectedBooking.name}</h3>\n                  <p className=\"text-gray-600\">{selectedBooking.email}</p>\n                </div>\n                <Badge className={getStatusColor(selectedBooking.status)} variant=\"outline\">\n                  {selectedBooking.status.toUpperCase()}\n                </Badge>\n              </div>\n\n              {/* Client Information */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <Card className=\"border-l-4 border-l-blue-500\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-lg flex items-center gap-2 text-blue-700\">\n                      <User className=\"h-5 w-5\" />\n                      Client Information\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <User className=\"h-4 w-4 text-gray-500\" />\n                        <span className=\"font-medium text-sm text-gray-600\">Name:</span>\n                      </div>\n                      <span className=\"font-semibold\">{selectedBooking.name}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Mail className=\"h-4 w-4 text-gray-500\" />\n                        <span className=\"font-medium text-sm text-gray-600\">Email:</span>\n                      </div>\n                      <span>{selectedBooking.email}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Phone className=\"h-4 w-4 text-gray-500\" />\n                        <span className=\"font-medium text-sm text-gray-600\">Phone:</span>\n                      </div>\n                      <span>{selectedBooking.phone || 'Not provided'}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"border-l-4 border-l-green-500\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-lg flex items-center gap-2 text-green-700\">\n                      <Calendar className=\"h-5 w-5\" />\n                      Event Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"font-medium text-sm text-gray-600\">Event Type:</span>\n                      <span className=\"font-semibold\">{selectedBooking.eventType}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Calendar className=\"h-4 w-4 text-gray-500\" />\n                        <span className=\"font-medium text-sm text-gray-600\">Date:</span>\n                      </div>\n                      <span>{new Date(selectedBooking.eventDate).toLocaleDateString()}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Clock className=\"h-4 w-4 text-gray-500\" />\n                        <span className=\"font-medium text-sm text-gray-600\">Time:</span>\n                      </div>\n                      <span>{selectedBooking.eventTime}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <MapPin className=\"h-4 w-4 text-gray-500\" />\n                        <span className=\"font-medium text-sm text-gray-600\">Location:</span>\n                      </div>\n                      <span>{selectedBooking.location}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Booking Details */}\n              <Card className=\"border-l-4 border-l-purple-500\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-lg text-purple-700\">Booking Information</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                    <div className=\"bg-gray-50 p-3 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block\">Duration:</span>\n                      <p className=\"text-lg font-semibold text-gray-800\">{selectedBooking.duration}</p>\n                    </div>\n                    <div className=\"bg-gray-50 p-3 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block\">Guest Count:</span>\n                      <p className=\"text-lg font-semibold text-gray-800\">{selectedBooking.guestCount || 'Not specified'}</p>\n                    </div>\n                    <div className=\"bg-gray-50 p-3 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block\">Package:</span>\n                      <p className=\"text-lg font-semibold text-gray-800\">{selectedBooking.packageType || 'Not specified'}</p>\n                    </div>\n                    <div className=\"bg-gray-50 p-3 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block\">Amount:</span>\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-lg font-semibold text-gray-800\">₹</span>\n                        <input\n                          type=\"number\"\n                          value={selectedBooking.amount || 0}\n                          onChange={(e) => {\n                            const newAmount = Number(e.target.value);\n                            setSelectedBooking(prev => prev ? {...prev, amount: newAmount} : null);\n                            handleAmountChange(selectedBooking.id, newAmount);\n                          }}\n                          className=\"w-20 px-2 py-1 border border-gray-300 rounded text-lg font-semibold\"\n                          min=\"0\"\n                          step=\"50\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n\n                  {selectedBooking.message && (\n                    <div className=\"mt-4\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Client Message:</span>\n                      <div className=\"bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg\">\n                        <p className=\"text-gray-800 italic\">\"{selectedBooking.message}\"</p>\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Action Buttons */}\n              <div className=\"flex gap-4 pt-6 border-t bg-gray-50 p-4 rounded-lg\">\n                {selectedBooking.status === 'pending' ? (\n                  <>\n                    <Button \n                      onClick={() => {\n                        handleBookingAction(selectedBooking.id, 'confirmed');\n                        setViewDialogOpen(false);\n                      }}\n                      className=\"bg-green-600 hover:bg-green-700 text-white flex-1 py-3 text-lg font-semibold\"\n                      size=\"lg\"\n                    >\n                      ✓ Accept Booking\n                    </Button>\n                    <Button \n                      variant=\"destructive\"\n                      onClick={() => {\n                        handleBookingAction(selectedBooking.id, 'cancelled');\n                        setViewDialogOpen(false);\n                      }}\n                      className=\"flex-1 py-3 text-lg font-semibold\"\n                      size=\"lg\"\n                    >\n                      ✗ Decline Booking\n                    </Button>\n                  </>\n                ) : (\n                  <div className=\"flex-1 text-center\">\n                    <p className=\"text-gray-600 text-lg\">\n                      This booking has been {selectedBooking.status === 'confirmed' ? 'accepted' : 'declined'}.\n                    </p>\n                    {selectedBooking.status === 'confirmed' && (\n                      <p className=\"text-green-600 font-semibold mt-2\">\n                        Amount: ₹{selectedBooking.amount || 0}\n                      </p>\n                    )}\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Comprehensive Event Details Dialog - Disabled in favor of EventDetailsDialog */}\n      <Dialog open={false} onOpenChange={() => setSelectedEventForView(null)}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-2xl font-bold text-gray-800 flex items-center gap-2\">\n              <Calendar className=\"h-6 w-6 text-blue-600\" />\n              Complete Event Details\n            </DialogTitle>\n          </DialogHeader>\n          \n          {selectedEventForView && (\n            <div className=\"space-y-6 py-4\">\n              {/* Basic Event Information */}\n              <Card className=\"border-l-4 border-l-blue-500\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-lg flex items-center gap-2 text-blue-700\">\n                    <Info className=\"h-5 w-5\" />\n                    Basic Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Event Title:</span>\n                      <p className=\"text-lg font-semibold text-gray-800 break-words\">{selectedEventForView.title}</p>\n                    </div>\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Event ID:</span>\n                      <p className=\"text-sm font-mono text-gray-700 break-all\">{selectedEventForView.id}</p>\n                    </div>\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Category:</span>\n                      <Badge variant=\"outline\" className=\"text-base\">{selectedEventForView.category}</Badge>\n                    </div>\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Visibility:</span>\n                      <Badge className={selectedEventForView.isPrivate ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}>\n                        {selectedEventForView.isPrivate ? 'Private Event' : 'Public Event'}\n                      </Badge>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Date & Location */}\n              <Card className=\"border-l-4 border-l-green-500\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-lg flex items-center gap-2 text-green-700\">\n                    <MapPin className=\"h-5 w-5\" />\n                    Date & Location\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <Calendar className=\"h-4 w-4 text-gray-500\" />\n                        <span className=\"font-medium text-sm text-gray-600\">Event Date:</span>\n                      </div>\n                      <p className=\"text-lg font-semibold text-gray-800\">\n                        {new Date(selectedEventForView.eventDate).toLocaleDateString('en-US', {\n                          weekday: 'long',\n                          year: 'numeric',\n                          month: 'long',\n                          day: 'numeric'\n                        })}\n                      </p>\n                    </div>\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <MapPin className=\"h-4 w-4 text-gray-500\" />\n                        <span className=\"font-medium text-sm text-gray-600\">Location:</span>\n                      </div>\n                      <p className=\"text-lg font-semibold text-gray-800 break-words\">{selectedEventForView.location}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Description */}\n              {selectedEventForView.description && (\n                <Card className=\"border-l-4 border-l-purple-500\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-lg flex items-center gap-2 text-purple-700\">\n                      <FileText className=\"h-5 w-5\" />\n                      Description\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <p className=\"text-gray-800 whitespace-pre-wrap break-words leading-relaxed\">\n                        {selectedEventForView.description}\n                      </p>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Access & Security */}\n              <Card className=\"border-l-4 border-l-orange-500\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-lg flex items-center gap-2 text-orange-700\">\n                    <Lock className=\"h-5 w-5\" />\n                    Access & Security\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Public PIN:</span>\n                      {selectedEventForView.publicPin ? (\n                        <p className=\"text-lg font-mono bg-green-100 text-green-800 px-3 py-2 rounded border\">\n                          {selectedEventForView.publicPin}\n                        </p>\n                      ) : (\n                        <p className=\"text-gray-500 italic\">Not set</p>\n                      )}\n                    </div>\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Bride & Groom PIN:</span>\n                      {selectedEventForView.brideGroomPin ? (\n                        <p className=\"text-lg font-mono bg-pink-100 text-pink-800 px-3 py-2 rounded border\">\n                          {selectedEventForView.brideGroomPin}\n                        </p>\n                      ) : (\n                        <p className=\"text-gray-500 italic\">Not set</p>\n                      )}\n                    </div>\n                  </div>\n                  {selectedEventForView.passcode && (\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Additional Passcode:</span>\n                      <p className=\"text-lg font-mono bg-blue-100 text-blue-800 px-3 py-2 rounded border break-all\">\n                        {selectedEventForView.passcode}\n                      </p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Photo & Media Information */}\n              <Card className=\"border-l-4 border-l-indigo-500\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-lg flex items-center gap-2 text-indigo-700\">\n                    <Camera className=\"h-5 w-5\" />\n                    Photo & Media\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    <div className=\"bg-gray-50 p-4 rounded-lg text-center\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Photo Count:</span>\n                      <p className=\"text-3xl font-bold text-indigo-600\">{selectedEventForView.photoCount || 0}</p>\n                    </div>\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Thumbnail URL:</span>\n                      {selectedEventForView.thumbnailUrl ? (\n                        <div className=\"space-y-2\">\n                          <p className=\"text-xs text-gray-500 break-all font-mono\">{selectedEventForView.thumbnailUrl}</p>\n                          <img \n                            src={selectedEventForView.thumbnailUrl} \n                            alt=\"Event thumbnail\" \n                            className=\"w-full h-20 object-cover rounded border\"\n                            onError={(e) => {\n                              e.currentTarget.style.display = 'none';\n                            }}\n                          />\n                        </div>\n                      ) : (\n                        <p className=\"text-gray-500 italic\">No thumbnail set</p>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Creation & Modification Info */}\n              <Card className=\"border-l-4 border-l-gray-500\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-lg flex items-center gap-2 text-gray-700\">\n                    <Clock className=\"h-5 w-5\" />\n                    System Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Created At:</span>\n                      <p className=\"text-sm text-gray-800\">\n                        {new Date(selectedEventForView.createdAt).toLocaleString('en-US', {\n                          weekday: 'short',\n                          year: 'numeric',\n                          month: 'short',\n                          day: 'numeric',\n                          hour: '2-digit',\n                          minute: '2-digit',\n                          second: '2-digit'\n                        })}\n                      </p>\n                    </div>\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Last Updated:</span>\n                      <p className=\"text-sm text-gray-800\">\n                        {new Date(selectedEventForView.updatedAt).toLocaleString('en-US', {\n                          weekday: 'short',\n                          year: 'numeric',\n                          month: 'short',\n                          day: 'numeric',\n                          hour: '2-digit',\n                          minute: '2-digit',\n                          second: '2-digit'\n                        })}\n                      </p>\n                    </div>\n                  </div>\n                  {selectedEventForView.createdBy && (\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <span className=\"font-medium text-sm text-gray-600 block mb-2\">Created By:</span>\n                      <p className=\"text-sm font-mono text-gray-700 break-all\">{selectedEventForView.createdBy}</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Action Buttons */}\n              <div className=\"flex justify-end gap-3 pt-4 border-t\">\n                <Button variant=\"outline\" onClick={() => setSelectedEventForView(null)}>\n                  Close\n                </Button>\n                <Button variant=\"outline\" onClick={() => handleEditEvent(selectedEventForView)}>\n                  <Edit className=\"h-4 w-4 mr-2\" />\n                  Edit Event\n                </Button>\n                <Button variant=\"outline\" onClick={() => handleUploadPhotos(selectedEventForView.id)}>\n                  <Camera className=\"h-4 w-4 mr-2\" />\n                  Upload Photos\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Event Details Dialog */}\n      <EventDetailsDialog\n        event={selectedEventForView}\n        open={eventDetailsOpen}\n        onOpenChange={(open) => {\n          setEventDetailsOpen(open);\n          if (!open) {\n            setIsEditingEvent(false);\n          }\n        }}\n        onEventUpdated={refreshData}\n        initialEditMode={isEditingEvent}\n      />\n\n      {/* Analytics Report */}\n      <AnalyticsReport\n        open={analyticsOpen}\n        onOpenChange={setAnalyticsOpen}\n      />\n\n      {/* Message Details Dialog */}\n      <Dialog open={messageDialogOpen} onOpenChange={setMessageDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"text-xl font-bold\">Message Details</DialogTitle>\n          </DialogHeader>\n          \n          {selectedMessage && (\n            <div className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg flex items-center gap-2\">\n                    <User className=\"h-5 w-5\" />\n                    Sender Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"font-medium text-sm text-gray-600\">Name:</span>\n                    <span className=\"font-semibold\">{selectedMessage.name}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"font-medium text-sm text-gray-600\">Email:</span>\n                    <span>{selectedMessage.email}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"font-medium text-sm text-gray-600\">Date:</span>\n                    <span>{new Date(selectedMessage.createdAt).toLocaleString()}</span>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">Message Content</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  {selectedMessage.subject && (\n                    <div>\n                      <span className=\"font-medium text-sm text-gray-600 block mb-1\">Subject:</span>\n                      <p className=\"font-semibold\">{selectedMessage.subject}</p>\n                    </div>\n                  )}\n                  <div>\n                    <span className=\"font-medium text-sm text-gray-600 block mb-1\">Message:</span>\n                    <div className=\"bg-gray-50 p-4 rounded-lg\">\n                      <p className=\"text-gray-800 whitespace-pre-wrap\">{selectedMessage.message}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <div className=\"flex justify-end gap-3 pt-4\">\n                <Button variant=\"outline\" onClick={() => setMessageDialogOpen(false)}>\n                  Close\n                </Button>\n                <Button \n                  onClick={() => window.location.href = `mailto:${selectedMessage.email}?subject=Re: ${selectedMessage.subject || 'Your inquiry'}`}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                >\n                  <Mail className=\"h-4 w-4 mr-2\" />\n                  Reply via Email\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\nexport default AdminDashboard;\n","size_bytes":92374},"client/src/pages/Booking.tsx":{"content":"\nimport { useState, useEffect } from 'react';\nimport { Calendar, Clock, MapPin, Camera, User, Mail, Phone, MessageSquare, Star, Check } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Badge } from '@/components/ui/badge';\nimport useEmblaCarousel from 'embla-carousel-react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useToast } from '@/hooks/use-toast';\nimport Header from '@/components/Header';\nimport Footer from '@/components/Footer';\nimport { Package as PackageType } from '@shared/types';\n\nconst Booking = () => {\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    countryCode: '+91',\n    eventType: '',\n    eventDate: '',\n    eventTime: '',\n    location: '',\n    duration: '',\n    guestCount: '',\n    packageType: '',\n    message: ''\n  });\n  const [packages, setPackages] = useState<PackageType[]>([]);\n  const [selectedPackage, setSelectedPackage] = useState<PackageType | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [emblaRef] = useEmblaCarousel({ align: 'start', loop: false });\n  const { currentUser } = useAuth();\n  const { toast } = useToast();\n\n  const eventTypes = [\n    'Wedding',\n    'Corporate Event',\n    'Birthday Party',\n    'Family Portrait',\n    'Baby & Maternity',\n    'Graduation',\n    'Concert & Show',\n    'Other'\n  ];\n\n  useEffect(() => {\n    const fetchPackages = async () => {\n      try {\n        const response = await fetch('/api/packages');\n        if (response.ok) {\n          const data = await response.json();\n          // Ensure packages have features as arrays and proper price formatting\n          const processedPackages = data.map((pkg: PackageType) => ({\n            ...pkg,\n            features: Array.isArray(pkg.features) ? pkg.features : (typeof pkg.features === 'string' ? JSON.parse(pkg.features || '[]') : []),\n            price: typeof pkg.price === 'number' ? pkg.price : parseFloat(pkg.price || '0')\n          }));\n          setPackages(processedPackages);\n        }\n      } catch (error) {\n        console.error('Error fetching packages:', error);\n      }\n    };\n\n    fetchPackages();\n  }, []);\n\n  useEffect(() => {\n    if (currentUser) {\n      setFormData(prev => ({\n        ...prev,\n        name: currentUser.displayName || '',\n        email: currentUser.email || '',\n        countryCode: '+91'\n      }));\n    }\n  }, [currentUser]);\n\n  const handlePackageSelect = (pkg: PackageType) => {\n    setSelectedPackage(pkg);\n    setFormData(prev => ({\n      ...prev,\n      packageType: pkg.name,\n      duration: pkg.duration\n    }));\n    // Scroll to form section\n    setTimeout(() => {\n      document.getElementById('booking-form')?.scrollIntoView({ behavior: 'smooth' });\n    }, 100);\n  };\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      if (!currentUser) {\n        throw new Error('Please sign in to submit a booking');\n      }\n\n      if (!formData.packageType) {\n        toast({\n          title: \"Package Required\",\n          description: \"Please select a photography package before submitting.\",\n          variant: \"destructive\",\n        });\n        setLoading(false);\n        return;\n      }\n\n      // Get token with fallback for development\n      let token;\n      try {\n        token = await currentUser.getIdToken();\n      } catch (error) {\n        console.warn('Failed to get Firebase token, using fallback');\n        token = 'dev-token';\n      }\n      \n      const bookingData = {\n        name: formData.name,\n        email: formData.email,\n        phone: formData.countryCode + formData.phone,\n        eventType: formData.eventType,\n        eventDate: formData.eventDate,\n        eventTime: formData.eventTime,\n        location: formData.location,\n        duration: formData.duration,\n        packageType: formData.packageType,\n        amount: selectedPackage?.price || undefined,\n        guestCount: formData.guestCount ? parseInt(formData.guestCount) : undefined,\n        message: formData.message\n      };\n      \n      console.log('Submitting booking data:', bookingData);\n      \n      const response = await fetch('/api/bookings', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(bookingData)\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        console.log('Booking created successfully:', result);\n        toast({\n          title: \"Booking Submitted!\",\n          description: \"We'll contact you soon to confirm your booking.\",\n        });\n        setFormData({\n          name: currentUser?.displayName || '',\n          email: currentUser?.email || '',\n          phone: '',\n          countryCode: '+91',\n          eventType: '',\n          eventDate: '',\n          eventTime: '',\n          location: '',\n          duration: '',\n          guestCount: '',\n          packageType: '',\n          message: ''\n        });\n        setSelectedPackage(null);\n      } else {\n        const errorData = await response.json();\n        console.error('Server error:', errorData);\n        throw new Error(errorData.error || 'Failed to submit booking');\n      }\n    } catch (error) {\n      console.error('Booking submission error:', error);\n      toast({\n        title: \"Error\",\n        description: error instanceof Error ? error.message : \"Failed to submit booking. Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n      \n      <main className=\"pt-20\">\n        {/* Hero Section */}\n        <section className=\"bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 py-16\">\n          <div className=\"container mx-auto px-4 text-center\">\n            <h1 className=\"text-4xl md:text-6xl font-bold mb-6\">\n              <span className=\"bg-gradient-to-r from-purple-600 via-pink-500 to-orange-500 bg-clip-text text-transparent\">\n                Book Your Session\n              </span>\n            </h1>\n            <p className=\"text-xl text-gray-600 mb-8 max-w-2xl mx-auto\">\n              Let's capture your special moments together. Choose your package and schedule your photography session\n            </p>\n          </div>\n        </section>\n\n        {/* Packages Section */}\n        <section className=\"py-16 bg-white\">\n          <div className=\"container mx-auto px-4\">\n            <h2 className=\"text-3xl md:text-4xl font-bold text-center mb-12\">\n              <span className=\"bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent\">\n                Photography Packages\n              </span>\n            </h2>\n            \n            {/* Sliding Package Cards */}\n            <div className=\"max-w-7xl mx-auto mb-16\">\n              <div className=\"overflow-hidden\" ref={emblaRef}>\n                <div className=\"flex gap-6\">\n                  {packages.map((pkg) => (\n                    <div key={pkg.id} className=\"flex-[0_0_90%] sm:flex-[0_0_45%] lg:flex-[0_0_30%] min-w-0\">\n                      <Card \n                        className={`relative overflow-hidden cursor-pointer transition-all duration-300 h-full ${\n                          selectedPackage?.id === pkg.id \n                            ? 'ring-2 ring-pink-500 shadow-2xl scale-105 transform' \n                            : pkg.isPopular \n                              ? 'ring-2 ring-orange-400 shadow-xl' \n                              : 'shadow-lg hover:shadow-xl hover:scale-102'\n                        }`}\n                        onClick={() => handlePackageSelect(pkg)}\n                      >\n                        {/* Popular Badge */}\n                        {pkg.isPopular && (\n                          <div className=\"absolute -top-1 -right-1 z-10\">\n                            <div className=\"bg-gradient-to-r from-orange-400 to-pink-500 text-white px-3 py-1 text-xs font-bold rounded-bl-lg flex items-center\">\n                              <Star className=\"w-3 h-3 mr-1 fill-current\" />\n                              Popular\n                            </div>\n                          </div>\n                        )}\n\n                        {/* Selected Badge */}\n                        {selectedPackage?.id === pkg.id && (\n                          <div className=\"absolute top-4 left-4 z-10\">\n                            <div className=\"bg-green-500 text-white rounded-full p-1\">\n                              <Check className=\"w-4 h-4\" />\n                            </div>\n                          </div>\n                        )}\n\n                        <CardHeader className=\"text-center pb-4\">\n                          <CardTitle className=\"text-2xl font-bold text-gray-800 mb-2\">{pkg.name}</CardTitle>\n                          <div className=\"text-4xl font-bold text-pink-600 mb-1\">₹{pkg.price}</div>\n                          <div className=\"flex items-center justify-center gap-2 text-sm text-gray-600\">\n                            <Clock className=\"w-4 h-4\" />\n                            {pkg.duration}\n                          </div>\n                          <div className=\"flex items-center justify-center gap-2 text-sm text-gray-600 mt-1\">\n                            <Camera className=\"w-4 h-4\" />\n                            {pkg.photoCount}\n                          </div>\n                        </CardHeader>\n\n                        <CardContent className=\"pt-0\">\n                          <div className=\"space-y-3 mb-6\">\n                            {(pkg.features || []).slice(0, 4).map((feature: string, featureIndex: number) => (\n                              <div key={`${pkg.id}-feature-${featureIndex}-${feature.substring(0, 10)}`} className=\"flex items-center text-gray-600 text-sm\">\n                                <div className=\"w-2 h-2 bg-gradient-to-r from-pink-500 to-purple-500 rounded-full mr-3 flex-shrink-0\"></div>\n                                {feature}\n                              </div>\n                            ))}\n                            {(pkg.features || []).length > 4 && (\n                              <div className=\"text-sm text-gray-500 text-center\">\n                                +{(pkg.features || []).length - 4} more features\n                              </div>\n                            )}\n                          </div>\n\n                          <Button \n                            className={`w-full transition-all duration-300 ${\n                              selectedPackage?.id === pkg.id\n                                ? 'bg-green-500 hover:bg-green-600'\n                                : 'bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600'\n                            } text-white`}\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handlePackageSelect(pkg);\n                            }}\n                          >\n                            {selectedPackage?.id === pkg.id ? (\n                              <>\n                                <Check className=\"w-4 h-4 mr-2\" />\n                                Selected\n                              </>\n                            ) : (\n                              'Select Package'\n                            )}\n                          </Button>\n                        </CardContent>\n                      </Card>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Scroll Indicator */}\n              {packages.length > 3 && (\n                <div className=\"text-center mt-6\">\n                  <p className=\"text-gray-500 text-sm\">← Swipe to see more packages →</p>\n                </div>\n              )}\n            </div>\n          </div>\n        </section>\n\n        {/* Booking Form */}\n        <section id=\"booking-form\" className=\"py-16 bg-gradient-to-br from-gray-50 to-purple-50\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"max-w-4xl mx-auto\">\n              <Card className=\"shadow-2xl border-0\">\n                <CardHeader className=\"text-center bg-gradient-to-r from-purple-50 to-pink-50\">\n                  <CardTitle className=\"text-3xl font-bold text-gray-800\">\n                    Book Your Photography Session\n                  </CardTitle>\n                  <p className=\"text-gray-600\">\n                    Fill out the form below and we'll get back to you within 24 hours\n                  </p>\n                </CardHeader>\n                <CardContent className=\"p-8\">\n                  <form onSubmit={handleSubmit} className=\"space-y-6\">\n                    {/* Personal Information */}\n                    <div className=\"grid md:grid-cols-2 gap-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          <User className=\"inline h-4 w-4 mr-1\" />\n                          Full Name *\n                        </label>\n                        <Input\n                          type=\"text\"\n                          value={formData.name}\n                          onChange={(e) => handleInputChange('name', e.target.value)}\n                          placeholder=\"Your full name\"\n                          required\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          <Mail className=\"inline h-4 w-4 mr-1\" />\n                          Email Address *\n                        </label>\n                        <Input\n                          type=\"email\"\n                          value={formData.email}\n                          onChange={(e) => handleInputChange('email', e.target.value)}\n                          placeholder=\"your@email.com\"\n                          required\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"grid md:grid-cols-2 gap-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          <Phone className=\"inline h-4 w-4 mr-1\" />\n                          Phone Number *\n                        </label>\n                        <div className=\"flex gap-2\">\n                          <select\n                            value={formData.countryCode}\n                            onChange={(e) => handleInputChange('countryCode', e.target.value)}\n                            className=\"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent bg-white\"\n                            style={{ minWidth: '180px' }}\n                          >\n                            <option value=\"+91\">🇮🇳 India (+91)</option>\n                            <option value=\"+1\">🇺🇸 United States (+1)</option>\n                            <option value=\"+1\">🇨🇦 Canada (+1)</option>\n                            <option value=\"+44\">🇬🇧 United Kingdom (+44)</option>\n                            <option value=\"+33\">🇫🇷 France (+33)</option>\n                            <option value=\"+49\">🇩🇪 Germany (+49)</option>\n                            <option value=\"+39\">🇮🇹 Italy (+39)</option>\n                            <option value=\"+34\">🇪🇸 Spain (+34)</option>\n                            <option value=\"+31\">🇳🇱 Netherlands (+31)</option>\n                            <option value=\"+32\">🇧🇪 Belgium (+32)</option>\n                            <option value=\"+41\">🇨🇭 Switzerland (+41)</option>\n                            <option value=\"+43\">🇦🇹 Austria (+43)</option>\n                            <option value=\"+45\">🇩🇰 Denmark (+45)</option>\n                            <option value=\"+46\">🇸🇪 Sweden (+46)</option>\n                            <option value=\"+47\">🇳🇴 Norway (+47)</option>\n                            <option value=\"+358\">🇫🇮 Finland (+358)</option>\n                            <option value=\"+61\">🇦🇺 Australia (+61)</option>\n                            <option value=\"+64\">🇳🇿 New Zealand (+64)</option>\n                            <option value=\"+81\">🇯🇵 Japan (+81)</option>\n                            <option value=\"+82\">🇰🇷 South Korea (+82)</option>\n                            <option value=\"+86\">🇨🇳 China (+86)</option>\n                            <option value=\"+65\">🇸🇬 Singapore (+65)</option>\n                            <option value=\"+852\">🇭🇰 Hong Kong (+852)</option>\n                            <option value=\"+853\">🇲🇴 Macau (+853)</option>\n                            <option value=\"+886\">🇹🇼 Taiwan (+886)</option>\n                            <option value=\"+60\">🇲🇾 Malaysia (+60)</option>\n                            <option value=\"+66\">🇹🇭 Thailand (+66)</option>\n                            <option value=\"+84\">🇻🇳 Vietnam (+84)</option>\n                            <option value=\"+63\">🇵🇭 Philippines (+63)</option>\n                            <option value=\"+62\">🇮🇩 Indonesia (+62)</option>\n                            <option value=\"+55\">🇧🇷 Brazil (+55)</option>\n                            <option value=\"+52\">🇲🇽 Mexico (+52)</option>\n                            <option value=\"+54\">🇦🇷 Argentina (+54)</option>\n                            <option value=\"+56\">🇨🇱 Chile (+56)</option>\n                            <option value=\"+57\">🇨🇴 Colombia (+57)</option>\n                            <option value=\"+51\">🇵🇪 Peru (+51)</option>\n                            <option value=\"+58\">🇻🇪 Venezuela (+58)</option>\n                            <option value=\"+27\">🇿🇦 South Africa (+27)</option>\n                            <option value=\"+20\">🇪🇬 Egypt (+20)</option>\n                            <option value=\"+971\">🇦🇪 United Arab Emirates (+971)</option>\n                            <option value=\"+966\">🇸🇦 Saudi Arabia (+966)</option>\n                            <option value=\"+974\">🇶🇦 Qatar (+974)</option>\n                            <option value=\"+965\">🇰🇼 Kuwait (+965)</option>\n                            <option value=\"+973\">🇧🇭 Bahrain (+973)</option>\n                            <option value=\"+968\">🇴🇲 Oman (+968)</option>\n                            <option value=\"+961\">🇱🇧 Lebanon (+961)</option>\n                            <option value=\"+962\">🇯🇴 Jordan (+962)</option>\n                            <option value=\"+90\">🇹🇷 Turkey (+90)</option>\n                            <option value=\"+7\">🇷🇺 Russia (+7)</option>\n                            <option value=\"+380\">🇺🇦 Ukraine (+380)</option>\n                            <option value=\"+48\">🇵🇱 Poland (+48)</option>\n                            <option value=\"+420\">🇨🇿 Czech Republic (+420)</option>\n                            <option value=\"+421\">🇸🇰 Slovakia (+421)</option>\n                            <option value=\"+36\">🇭🇺 Hungary (+36)</option>\n                            <option value=\"+40\">🇷🇴 Romania (+40)</option>\n                            <option value=\"+359\">🇧🇬 Bulgaria (+359)</option>\n                            <option value=\"+385\">🇭🇷 Croatia (+385)</option>\n                            <option value=\"+386\">🇸🇮 Slovenia (+386)</option>\n                            <option value=\"+372\">🇪🇪 Estonia (+372)</option>\n                            <option value=\"+371\">🇱🇻 Latvia (+371)</option>\n                            <option value=\"+370\">🇱🇹 Lithuania (+370)</option>\n                          </select>\n                          <Input\n                            type=\"tel\"\n                            value={formData.phone}\n                            onChange={(e) => handleInputChange('phone', e.target.value)}\n                            className=\"flex-1\"\n                            placeholder=\"123-456-7890\"\n                            required\n                          />\n                        </div>\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          <Camera className=\"inline h-4 w-4 mr-1\" />\n                          Event Type *\n                        </label>\n                        <Select value={formData.eventType} onValueChange={(value) => handleInputChange('eventType', value)}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select event type\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {eventTypes.map((type) => (\n                              <SelectItem key={type} value={type}>{type}</SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n\n                    {/* Event Details */}\n                    <div className=\"grid md:grid-cols-3 gap-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          <Calendar className=\"inline h-4 w-4 mr-1\" />\n                          Event Date *\n                        </label>\n                        <Input\n                          type=\"date\"\n                          value={formData.eventDate}\n                          onChange={(e) => handleInputChange('eventDate', e.target.value)}\n                          required\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          <Clock className=\"inline h-4 w-4 mr-1\" />\n                          Event Time *\n                        </label>\n                        <Input\n                          type=\"time\"\n                          value={formData.eventTime}\n                          onChange={(e) => handleInputChange('eventTime', e.target.value)}\n                          required\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Duration\n                        </label>\n                        <Select value={formData.duration} onValueChange={(value) => handleInputChange('duration', value)}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select duration\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"2-hours\">2 hours</SelectItem>\n                            <SelectItem value=\"4-hours\">4 hours</SelectItem>\n                            <SelectItem value=\"6-hours\">6 hours</SelectItem>\n                            <SelectItem value=\"8-hours\">8+ hours</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n\n                    <div className=\"grid md:grid-cols-2 gap-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          <MapPin className=\"inline h-4 w-4 mr-1\" />\n                          Event Location *\n                        </label>\n                        <Input\n                          type=\"text\"\n                          value={formData.location}\n                          onChange={(e) => handleInputChange('location', e.target.value)}\n                          placeholder=\"Event venue or address\"\n                          required\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Guest Count (approx.)\n                        </label>\n                        <Select value={formData.guestCount} onValueChange={(value) => handleInputChange('guestCount', value)}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Number of guests\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"1-10\">1-10 people</SelectItem>\n                            <SelectItem value=\"11-25\">11-25 people</SelectItem>\n                            <SelectItem value=\"26-50\">26-50 people</SelectItem>\n                            <SelectItem value=\"51-100\">51-100 people</SelectItem>\n                            <SelectItem value=\"100+\">100+ people</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n\n                    {/* Package Selection Field */}\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        <Star className=\"inline h-4 w-4 mr-1\" />\n                        Selected Package *\n                      </label>\n                      <Select \n                        value={formData.packageType} \n                        onValueChange={(value) => {\n                          handleInputChange('packageType', value);\n                          // Update selected package when changed from dropdown\n                          const pkg = packages.find(p => p.name === value);\n                          if (pkg) {\n                            setSelectedPackage(pkg);\n                            setFormData(prev => ({\n                              ...prev,\n                              duration: pkg.duration\n                            }));\n                          }\n                        }}\n                        required\n                      >\n                        <SelectTrigger className={selectedPackage ? \"border-green-500\" : \"\"}>\n                          <SelectValue placeholder=\"Select a package above or choose here\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {packages.map((pkg) => (\n                            <SelectItem key={pkg.id} value={pkg.name}>\n                              <div className=\"flex items-center justify-between w-full\">\n                                <span>{pkg.name}</span>\n                                <span className=\"text-sm text-gray-500 ml-2\">₹{pkg.price}</span>\n                              </div>\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      {selectedPackage && (\n                        <div className=\"mt-2 p-3 bg-green-50 border border-green-200 rounded-md\">\n                          <p className=\"text-sm text-green-700 font-medium\">\n                            ✓ {selectedPackage.name} Package Selected - ₹{selectedPackage.price}\n                          </p>\n                          <p className=\"text-xs text-green-600 mt-1\">\n                            {selectedPackage.duration} • {selectedPackage.photoCount}\n                          </p>\n                        </div>\n                      )}\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        <MessageSquare className=\"inline h-4 w-4 mr-1\" />\n                        Additional Details\n                      </label>\n                      <Textarea\n                        value={formData.message}\n                        onChange={(e) => handleInputChange('message', e.target.value)}\n                        placeholder=\"Tell us more about your event, special requests, or any questions you have...\"\n                        rows={4}\n                      />\n                    </div>\n\n                    <div className=\"text-center pt-6\">\n                      <Button \n                        type=\"submit\"\n                        className=\"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-12 py-4 text-lg rounded-full shadow-lg\"\n                      >\n                        Submit Booking Request\n                      </Button>\n                      <p className=\"text-sm text-gray-500 mt-4\">\n                        We'll contact you within 24 hours to confirm your booking\n                      </p>\n                    </div>\n                  </form>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      <Footer />\n    </div>\n  );\n};\n\nexport default Booking;\n","size_bytes":29516},"client/src/pages/Contact.tsx":{"content":"\nimport { useState } from 'react';\nimport { Mail, Phone, MapPin, Clock, Send, MessageCircle } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/components/ui/use-toast';\nimport Header from '@/components/Header';\nimport Footer from '@/components/Footer';\n\nconst Contact = () => {\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    subject: '',\n    message: ''\n  });\n  const [loading, setLoading] = useState(false);\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const response = await fetch('/api/contact', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(formData)\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Message Sent!\",\n          description: \"We'll get back to you within 24 hours.\",\n        });\n        setFormData({ name: '', email: '', subject: '', message: '' });\n      } else {\n        throw new Error('Failed to send message');\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to send message. Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const contactInfo = [\n    {\n      icon: <Phone className=\"h-6 w-6\" />,\n      title: \"Phone\",\n      info: \"+1 (555) 123-4567\",\n      description: \"Mon-Fri 9AM-7PM, Sat-Sun 10AM-5PM\"\n    },\n    {\n      icon: <Mail className=\"h-6 w-6\" />,\n      title: \"Email\",\n      info: \"info@pinmypic.com\",\n      description: \"We'll respond within 24 hours\"\n    },\n    {\n      icon: <MapPin className=\"h-6 w-6\" />,\n      title: \"Studio Location\",\n      info: \"123 Photography Street\",\n      description: \"Downtown Creative District\"\n    },\n    {\n      icon: <Clock className=\"h-6 w-6\" />,\n      title: \"Business Hours\",\n      info: \"Monday - Sunday\",\n      description: \"Available for events anytime\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n      \n      <main className=\"pt-20\">\n        {/* Send us a Message Section - TOP */}\n        <section className=\"py-16 bg-gradient-to-br from-gray-50 to-blue-50\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center mb-12\">\n              <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">\n                <span className=\"bg-gradient-to-r from-blue-600 via-purple-500 to-pink-500 bg-clip-text text-transparent\">\n                  Send us a Message\n                </span>\n              </h1>\n              <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n                Have questions? We'd love to hear from you. Send us a message and we'll respond as soon as possible.\n              </p>\n            </div>\n            <div className=\"max-w-2xl mx-auto\">\n              {/* Contact Form */}\n              <Card className=\"shadow-2xl border-0\">\n                <CardHeader className=\"bg-gradient-to-r from-blue-50 to-purple-50\">\n                  <CardTitle className=\"text-2xl font-bold text-gray-800 flex items-center justify-center\">\n                    <MessageCircle className=\"mr-3 h-6 w-6 text-blue-500\" />\n                    Contact Form\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-8\">\n                  <form onSubmit={handleSubmit} className=\"space-y-6\">\n                    <div className=\"grid md:grid-cols-2 gap-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          First Name *\n                        </label>\n                        <Input\n                          type=\"text\"\n                          placeholder=\"John\"\n                          value={formData.name}\n                          onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                          required\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Email Address *\n                        </label>\n                        <Input\n                          type=\"email\"\n                          placeholder=\"john@example.com\"\n                          value={formData.email}\n                          onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                          required\n                        />\n                      </div>\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Subject *\n                      </label>\n                      <Input\n                        type=\"text\"\n                        placeholder=\"What's this about?\"\n                        value={formData.subject}\n                        onChange={(e) => setFormData(prev => ({ ...prev, subject: e.target.value }))}\n                        required\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Message *\n                      </label>\n                      <Textarea\n                        placeholder=\"Tell us about your photography needs, event details, or any questions you have...\"\n                        value={formData.message}\n                        onChange={(e) => setFormData(prev => ({ ...prev, message: e.target.value }))}\n                        rows={5}\n                        required\n                      />\n                    </div>\n\n                    <Button \n                      type=\"submit\"\n                      className=\"w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white py-3\"\n                    >\n                      <Send className=\"mr-2 h-5 w-5\" />\n                      Send Message\n                    </Button>\n                  </form>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </section>\n\n        {/* Contact Details Section - MIDDLE */}\n        <section className=\"py-16 bg-white\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center mb-12\">\n              <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">\n                <span className=\"bg-gradient-to-r from-blue-600 via-purple-500 to-pink-500 bg-clip-text text-transparent\">\n                  Contact Details\n                </span>\n              </h2>\n              <p className=\"text-lg text-gray-600 max-w-2xl mx-auto\">\n                Multiple ways to reach us - choose what works best for you\n              </p>\n            </div>\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-8\">\n              {contactInfo.map((item, index) => (\n                <Card key={index} className=\"text-center hover:shadow-lg transition-shadow border-0 shadow-md\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white mx-auto mb-4\">\n                      {item.icon}\n                    </div>\n                    <h3 className=\"text-lg font-semibold text-gray-800 mb-2\">{item.title}</h3>\n                    <p className=\"text-gray-900 font-medium mb-1\">{item.info}</p>\n                    <p className=\"text-gray-600 text-sm\">{item.description}</p>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Get In Touch Section - BOTTOM */}\n        <section className=\"py-16 bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center mb-12\">\n              <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">\n                <span className=\"bg-gradient-to-r from-blue-600 via-purple-500 to-pink-500 bg-clip-text text-transparent\">\n                  Get In Touch\n                </span>\n              </h2>\n              <p className=\"text-lg text-gray-600 max-w-3xl mx-auto\">\n                Ready to capture your special moments? Let's discuss your photography needs and create something beautiful together\n              </p>\n            </div>\n            \n            <div className=\"grid lg:grid-cols-2 gap-12 max-w-6xl mx-auto\">\n              {/* Map & Studio Info */}\n              <Card className=\"shadow-xl border-0\">\n                <CardContent className=\"p-0\">\n                  <div className=\"h-64 bg-gradient-to-br from-blue-100 to-purple-100 rounded-t-lg flex items-center justify-center\">\n                    <div className=\"text-center\">\n                      <MapPin className=\"h-12 w-12 text-blue-500 mx-auto mb-2\" />\n                      <p className=\"text-gray-600\">Interactive Map</p>\n                      <p className=\"text-sm text-gray-500\">Studio Location</p>\n                    </div>\n                  </div>\n                  <div className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold text-gray-800 mb-2\">Visit Our Studio</h3>\n                    <p className=\"text-gray-600\">\n                      123 Photography Street<br />\n                      Downtown Creative District<br />\n                      City, State 12345\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Why Choose Us */}\n              <Card className=\"shadow-xl border-0\">\n                <CardHeader>\n                  <CardTitle className=\"text-xl font-bold text-gray-800\">\n                    Why Choose PinMyPic?\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ul className=\"space-y-3 text-gray-600\">\n                    <li className=\"flex items-start\">\n                      <div className=\"w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0\"></div>\n                      <span>Professional photography with 10+ years experience</span>\n                    </li>\n                    <li className=\"flex items-start\">\n                      <div className=\"w-2 h-2 bg-purple-500 rounded-full mt-2 mr-3 flex-shrink-0\"></div>\n                      <span>Cutting-edge AI face recognition technology</span>\n                    </li>\n                    <li className=\"flex items-start\">\n                      <div className=\"w-2 h-2 bg-pink-500 rounded-full mt-2 mr-3 flex-shrink-0\"></div>\n                      <span>Fast delivery and high-quality editing</span>\n                    </li>\n                    <li className=\"flex items-start\">\n                      <div className=\"w-2 h-2 bg-cyan-500 rounded-full mt-2 mr-3 flex-shrink-0\"></div>\n                      <span>Competitive pricing and flexible packages</span>\n                    </li>\n                    <li className=\"flex items-start\">\n                      <div className=\"w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0\"></div>\n                      <span>24/7 customer support</span>\n                    </li>\n                  </ul>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      <Footer />\n    </div>\n  );\n};\n\nexport default Contact;\n","size_bytes":11793},"client/src/pages/Events.tsx":{"content":"\nimport { useState, useEffect, useMemo } from 'react';\nimport { Calendar, Lock, Users, Camera, Search, MapPin, Eye, X, Upload, Scan, Download, Unlock, Video, VideoOff, ChevronLeft, ChevronRight, Share2, Copy, ExternalLink, Check } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Label } from '@/components/ui/label';\nimport Header from '@/components/Header';\nimport Footer from '@/components/Footer';\nimport PaginatedPhotoGallery from '@/components/PaginatedPhotoGallery';\nimport { SimpleFullscreenViewer } from '@/components/SimpleFullscreenViewer';\nimport { Event, Photo } from '@shared/types';\nimport { useDebounce } from '@/hooks/useDebounce';\nimport { getDownloadImageUrl } from '@/utils/imagePreloader';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { useLocation, useParams, useSearchParams, useNavigate } from 'react-router-dom';\n\nconst Events = () => {\n  const { eventId: urlEventId } = useParams<{ eventId: string }>();\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  \n  const [searchTerm, setSearchTerm] = useState('');\n  const debouncedSearchTerm = useDebounce(searchTerm, 300);\n  const [events, setEvents] = useState<Event[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedEvent, setSelectedEvent] = useState<Event | null>(null);\n  const [pinDialogOpen, setPinDialogOpen] = useState(false);\n  const [faceScanDialogOpen, setFaceScanDialogOpen] = useState(false);\n  const [directEventAccess, setDirectEventAccess] = useState<Event | null>(null);\n\n  const [showInlineGallery, setShowInlineGallery] = useState(false);\n  const [pin, setPin] = useState('');\n  const [pinError, setPinError] = useState('');\n  const [photos, setPhotos] = useState<Photo[]>([]);\n  const [loadingPhotos, setLoadingPhotos] = useState(false);\n  const [uploadedFace, setUploadedFace] = useState<File | null>(null);\n  const [scanningFace, setScanningFace] = useState(false);\n  const [fullScreenImage, setFullScreenImage] = useState<Photo | null>(null);\n  const [currentPhotoIndex, setCurrentPhotoIndex] = useState<number>(0);\n  const [cameraActive, setCameraActive] = useState(false);\n  const [cameraStream, setCameraStream] = useState<MediaStream | null>(null);\n  const [capturedPhoto, setCapturedPhoto] = useState<string | null>(null);\n  const [uploadMode, setUploadMode] = useState<'upload' | 'camera'>('upload');\n  \n  // Save to Profile functionality\n  const [savedPhotoIds, setSavedPhotoIds] = useState<string[]>([]);\n  const [savingPhotoIds, setSavingPhotoIds] = useState<string[]>([]);\n  \n  // Share functionality\n  const [shareDialogOpen, setShareDialogOpen] = useState(false);\n  const [shareEvent, setShareEvent] = useState<Event | null>(null);\n  const [shareUrl, setShareUrl] = useState<string>('');\n  const [generatingUrl, setGeneratingUrl] = useState(false);\n  const [copiedUrl, setCopiedUrl] = useState(false);\n  \n  const { currentUser } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const location = useLocation();\n\n  // Share URL generation function\n  const generateShareUrl = async (event: Event) => {\n    if (!currentUser) {\n      toast({\n        title: \"Authentication Required\",\n        description: \"Please sign in to share events.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    setGeneratingUrl(true);\n    try {\n      const token = await currentUser.getIdToken();\n      const response = await fetch(`/api/events/${event.id}/share-url`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        setShareUrl(data.shareUrl);\n        setShareEvent(event);\n        setShareDialogOpen(true);\n        toast({\n          title: \"Share URL Generated\",\n          description: \"The shareable URL has been created successfully.\"\n        });\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Failed to generate share URL. Please try again.\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error) {\n      console.error('Error generating share URL:', error);\n      toast({\n        title: \"Error\",\n        description: \"An error occurred while generating the share URL.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setGeneratingUrl(false);\n    }\n  };\n\n  // Copy URL to clipboard\n  const copyShareUrl = async () => {\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      setCopiedUrl(true);\n      toast({\n        title: \"URL Copied\",\n        description: \"The share URL has been copied to your clipboard.\"\n      });\n      \n      // Reset copied state after 2 seconds\n      setTimeout(() => setCopiedUrl(false), 2000);\n    } catch (error) {\n      console.error('Error copying to clipboard:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to copy URL to clipboard.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  // Open URL in new tab\n  const openShareUrl = () => {\n    if (shareUrl) {\n      window.open(shareUrl, '_blank');\n    }\n  };\n\n  // Navigation functions for slideshow\n  const goToPreviousPhoto = () => {\n    if (photos.length === 0) return;\n    const newIndex = currentPhotoIndex === 0 ? photos.length - 1 : currentPhotoIndex - 1;\n    setCurrentPhotoIndex(newIndex);\n    setFullScreenImage(photos[newIndex]);\n  };\n\n  const goToNextPhoto = () => {\n    if (photos.length === 0) return;\n    const newIndex = currentPhotoIndex === photos.length - 1 ? 0 : currentPhotoIndex + 1;\n    setCurrentPhotoIndex(newIndex);\n    setFullScreenImage(photos[newIndex]);\n  };\n\n  // Handle keyboard navigation\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      if (!fullScreenImage) return;\n      \n      switch (event.key) {\n        case 'ArrowLeft':\n          event.preventDefault();\n          goToPreviousPhoto();\n          break;\n        case 'ArrowRight':\n          event.preventDefault();\n          goToNextPhoto();\n          break;\n        case 'Escape':\n          event.preventDefault();\n          setFullScreenImage(null);\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyPress);\n    return () => window.removeEventListener('keydown', handleKeyPress);\n  }, [fullScreenImage, currentPhotoIndex, photos]);\n\n  // Update photo index when fullScreenImage changes\n  useEffect(() => {\n    if (fullScreenImage) {\n      const index = photos.findIndex(photo => photo.id === fullScreenImage.id);\n      if (index !== -1) {\n        setCurrentPhotoIndex(index);\n      }\n    }\n  }, [fullScreenImage, photos]);\n\n\n\n  useEffect(() => {\n    const fetchEvents = async () => {\n      try {\n        // Fetch all events from lightweight endpoint\n        const response = await fetch('/api/events/all');\n        if (response.ok) {\n          const data = await response.json();\n          setEvents(data);\n        } else {\n          // Fallback to admin endpoint if new endpoint doesn't exist yet\n          const fallbackResponse = await fetch('/api/admin/events');\n          if (fallbackResponse.ok) {\n            const data = await fallbackResponse.json();\n            setEvents(data);\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching events:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    // Check if we need direct access (URL or QR)\n    const searchParams = new URLSearchParams(location.search);\n    const qrEventId = searchParams.get('eventId');\n    const autoScan = searchParams.get('autoScan') === 'true';\n    \n    if (urlEventId) {\n      // URL-based event access - fetch only this event and show PIN dialog immediately\n      fetchSingleEventForDirectAccess(urlEventId, 'url');\n    } else if (qrEventId && autoScan) {\n      // QR-based access - fetch only this event and show face scan dialog immediately  \n      fetchSingleEventForDirectAccess(qrEventId, 'qr');\n    } else {\n      // Normal events page - fetch all events\n      fetchEvents();\n    }\n  }, [urlEventId, location.search]);\n\n  // Fetch single event for direct access (URL or QR)\n  const fetchSingleEventForDirectAccess = async (eventId: string, accessType: 'url' | 'qr') => {\n    try {\n      setLoading(true);\n      const response = await fetch(`/api/events/${eventId}`);\n      \n      if (response.ok) {\n        const event = await response.json();\n        setDirectEventAccess(event);\n        setSelectedEvent(event);\n        setPin('');\n        setPinError('');\n        \n        if (accessType === 'qr') {\n          // QR access - immediately open face scan dialog\n          setFaceScanDialogOpen(true);\n          // Clear URL parameters to clean up the address bar\n          const newUrl = new URL(window.location.href);\n          newUrl.search = '';\n          newUrl.hash = '';\n          window.history.replaceState({}, '', newUrl.toString());\n        } else if (accessType === 'url') {\n          // URL access - show PIN dialog for private events, gallery for public events\n          if (event.isPrivate) {\n            setPinDialogOpen(true);\n          } else {\n            // Public event - directly load and show gallery\n            loadEventPhotos(event.id).then(() => {\n              setTimeout(() => {\n                setShowInlineGallery(true);\n                window.scrollTo({ top: 0, behavior: 'instant' });\n              }, 0);\n            });\n          }\n        }\n      } else {\n        toast({\n          title: \"Event Not Found\",\n          description: \"The requested event could not be found.\",\n          variant: \"destructive\"\n        });\n        navigate('/events');\n      }\n    } catch (error) {\n      console.error('Error fetching event:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load event. Please try again.\",\n        variant: \"destructive\"\n      });\n      navigate('/events');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Load saved photos when user is logged in\n  useEffect(() => {\n    if (currentUser) {\n      loadSavedPhotos();\n    }\n  }, [currentUser]);\n\n  const loadSavedPhotos = async () => {\n    try {\n      const token = await currentUser?.getIdToken(true);\n      const response = await fetch('/api/user/saved-photos', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      \n      if (response.ok) {\n        const savedPhotos = await response.json();\n        setSavedPhotoIds(savedPhotos.map((photo: Photo) => photo.id));\n      }\n    } catch (error) {\n      console.error('Error loading saved photos:', error);\n    }\n  };\n\n  const handleSavePhoto = async (photoId: string) => {\n    if (!currentUser) {\n      toast({\n        title: \"Authentication Required\",\n        description: \"Please log in to save photos to your profile.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setSavingPhotoIds(prev => [...prev, photoId]);\n    \n    try {\n      const token = await currentUser.getIdToken(true);\n      const response = await fetch('/api/user/save-photo', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({ photoId })\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        \n        // Add to local state for immediate UI feedback\n        setSavedPhotoIds(prev => [...prev, photoId]);\n        \n        // Invalidate the saved photos query to refresh the Profile page\n        queryClient.invalidateQueries({ queryKey: ['/api/user/saved-photos'] });\n        \n        if (data.alreadySaved) {\n          toast({\n            title: \"Photo Already Saved\",\n            description: \"This photo was already in your saved photos.\",\n          });\n        } else {\n          toast({\n            title: \"Photo Saved\",\n            description: \"Photo has been saved to your profile.\",\n          });\n        }\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Error\",\n          description: error.error || \"Failed to save photo.\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error) {\n      console.error('Error saving photo:', error);\n      toast({\n        title: \"Error\",\n        description: \"An error occurred while saving the photo.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setSavingPhotoIds(prev => prev.filter(id => id !== photoId));\n    }\n  };\n\n  const handleRemovePhoto = async (photoId: string) => {\n    if (!currentUser) {\n      toast({\n        title: \"Authentication Required\",\n        description: \"Please log in to manage your saved photos.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setSavingPhotoIds(prev => [...prev, photoId]);\n    \n    try {\n      const token = await currentUser.getIdToken(true);\n      const response = await fetch('/api/user/remove-photo', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({ photoId })\n      });\n      \n      if (response.ok) {\n        setSavedPhotoIds(prev => prev.filter(id => id !== photoId));\n        \n        // Invalidate the saved photos query to refresh the Profile page\n        queryClient.invalidateQueries({ queryKey: ['/api/user/saved-photos'] });\n        \n        toast({\n          title: \"Photo Removed\",\n          description: \"Photo has been removed from your profile.\",\n        });\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Error\",\n          description: error.error || \"Failed to remove photo.\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error) {\n      console.error('Error removing photo:', error);\n      toast({\n        title: \"Error\",\n        description: \"An error occurred while removing the photo.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setSavingPhotoIds(prev => prev.filter(id => id !== photoId));\n    }\n  };\n\n  // Handle auto-opening selected event from homepage navigation\n  useEffect(() => {\n    if (events.length > 0 && !loading) {\n      const selectedEventId = sessionStorage.getItem('selectedEventId');\n      if (selectedEventId) {\n        const autoOpenEvent = events.find((event: Event) => event.id === selectedEventId);\n        if (autoOpenEvent) {\n          handleEventAccess(autoOpenEvent);\n        }\n        // Clear the stored event ID after use\n        sessionStorage.removeItem('selectedEventId');\n      }\n    }\n  }, [events, loading]);\n\n  const filteredEvents = useMemo(() => {\n    if (!debouncedSearchTerm.trim()) return events;\n    \n    const lowercaseSearch = debouncedSearchTerm.toLowerCase();\n    return events.filter(event =>\n      event.title.toLowerCase().includes(lowercaseSearch) ||\n      event.location.toLowerCase().includes(lowercaseSearch) ||\n      event.category.toLowerCase().includes(lowercaseSearch)\n    );\n  }, [events, debouncedSearchTerm]);\n\n  const handleEventAccess = async (event: Event) => {\n    setSelectedEvent(event);\n    setPin('');\n    setPinError('');\n    setUploadedFace(null);\n    setCapturedPhoto(null);\n    setUploadMode('upload');\n    \n    if (event.isPrivate) {\n      // Private events require PIN\n      setPinDialogOpen(true);\n    } else {\n      // Public events - direct access to full gallery (no PIN, no face scan)\n      await loadEventPhotos(event.id);\n      // Prevent automatic scrolling by using timeout and instant scroll\n      setTimeout(() => {\n        setShowInlineGallery(true);\n        window.scrollTo({ top: 0, behavior: 'instant' });\n      }, 0);\n    }\n  };\n\n  const handlePinSubmit = async () => {\n    if (!selectedEvent || !pin.trim()) {\n      setPinError('Please enter a PIN');\n      return;\n    }\n\n    // Check which type of PIN was entered\n    if (pin === selectedEvent.brideGroomPin) {\n      // Bride-Groom PIN: Direct access to full gallery (no face scan)\n      setPinDialogOpen(false);\n      await loadEventPhotos(selectedEvent.id);\n      // Prevent auto-scroll when opening gallery\n      setTimeout(() => {\n        setShowInlineGallery(true);\n        window.scrollTo({ top: 0, behavior: 'instant' });\n      }, 0);\n    } else if (pin === selectedEvent.publicPin) {\n      // Public PIN: Requires face scan to show matched photos\n      setPinDialogOpen(false);\n      setFaceScanDialogOpen(true);\n    } else {\n      setPinError('Invalid PIN. Please try again.');\n    }\n  };\n\n  const handleFaceScan = async () => {\n    if (!uploadedFace || !selectedEvent) return;\n    \n    setScanningFace(true);\n    try {\n      // Convert file to base64\n      const reader = new FileReader();\n      const base64Data = await new Promise<string>((resolve, reject) => {\n        reader.onload = () => resolve(reader.result as string);\n        reader.onerror = reject;\n        reader.readAsDataURL(uploadedFace);\n      });\n      \n      // Call face recognition API\n      const response = await fetch('/api/face-recognition/find-my-face', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          selfieData: base64Data,\n          eventId: selectedEvent.id\n        }),\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        \n        // Show only matched photos (filtered by face recognition)\n        setFaceScanDialogOpen(false);\n        setPhotos(data.matchedPhotos || []);\n        // Prevent auto-scroll when opening gallery\n        setTimeout(() => {\n          setShowInlineGallery(true);\n          window.scrollTo({ top: 0, behavior: 'instant' });\n        }, 0);\n      } else {\n        console.error('Face recognition failed');\n        // Show error message\n        setPinError('Face recognition failed. Please try again.');\n      }\n    } catch (error) {\n      console.error('Face scanning error:', error);\n      setPinError('An error occurred during face scanning.');\n    } finally {\n      setScanningFace(false);\n    }\n  };\n\n  const loadEventPhotos = async (eventId: string, page: number = 1) => {\n    setLoadingPhotos(true);\n    try {\n      const response = await fetch(`/api/events/${eventId}/photos?page=${page}&limit=50&lightweight=true`);\n      if (response.ok) {\n        const data = await response.json();\n        if (data.photos) {\n          setPhotos(data.photos);\n          \n          // Preload first 10 images for better performance\n          const imageUrls = data.photos.slice(0, 10).map((photo: any) => photo.url);\n          if (imageUrls.length > 0) {\n            import('@/utils/imagePreloader').then(({ imagePreloader }) => {\n              imagePreloader.preloadBatch(imageUrls, 3);\n            });\n          }\n        } else {\n          setPhotos(data); // Fallback for old API format\n        }\n      }\n    } catch (error) {\n      console.error('Error loading photos:', error);\n    } finally {\n      setLoadingPhotos(false);\n    }\n  };\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file && file.type.startsWith('image/')) {\n      setUploadedFace(file);\n      setCapturedPhoto(null);\n    }\n  };\n\n  const startCamera = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { facingMode: 'user' },\n        audio: false\n      });\n      setCameraStream(stream);\n      setCameraActive(true);\n      setUploadMode('camera');\n      setUploadedFace(null);\n      setCapturedPhoto(null);\n    } catch (error) {\n      console.error('Error accessing camera:', error);\n      alert('Unable to access camera. Please try file upload instead.');\n    }\n  };\n\n  const stopCamera = () => {\n    if (cameraStream) {\n      cameraStream.getTracks().forEach(track => track.stop());\n      setCameraStream(null);\n    }\n    setCameraActive(false);\n  };\n\n  const capturePhoto = () => {\n    const video = document.getElementById('camera-video') as HTMLVideoElement;\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    \n    if (video && context) {\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      context.drawImage(video, 0, 0);\n      \n      const imageData = canvas.toDataURL('image/jpeg', 0.8);\n      setCapturedPhoto(imageData);\n      \n      // Convert to File for compatibility with existing upload logic\n      canvas.toBlob((blob) => {\n        if (blob) {\n          const file = new File([blob], 'selfie.jpg', { type: 'image/jpeg' });\n          setUploadedFace(file);\n        }\n      }, 'image/jpeg', 0.8);\n      \n      stopCamera();\n    }\n  };\n\n  const retakePhoto = () => {\n    setCapturedPhoto(null);\n    setUploadedFace(null);\n    startCamera();\n  };\n\n  // Clean up camera stream when dialog closes\n  useEffect(() => {\n    if (!faceScanDialogOpen && cameraStream) {\n      stopCamera();\n    }\n  }, [faceScanDialogOpen]);\n\n  // Prevent automatic scrolling when gallery opens\n  useEffect(() => {\n    if (showInlineGallery) {\n      window.scrollTo({ top: 0, behavior: 'instant' });\n      document.body.style.scrollBehavior = 'auto';\n      return () => {\n        document.body.style.scrollBehavior = '';\n      };\n    }\n  }, [showInlineGallery]);\n\n  // Show inline gallery instead of events list\n  if (showInlineGallery && selectedEvent) {\n\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-pink-50 via-white to-orange-50\">\n        <Header />\n        \n        <main className=\"pt-16\">\n          <section className=\"py-8\">\n            <div className=\"container mx-auto px-4\">\n              {/* Gallery Header with Back Button */}\n              <div className=\"flex items-center justify-between mb-8\">\n                <Button\n                  onClick={() => {\n                    setShowInlineGallery(false);\n                    window.scrollTo({ top: 0, behavior: 'instant' });\n                  }}\n                  variant=\"outline\"\n                  className=\"flex items-center gap-2\"\n                >\n                  <Eye className=\"h-4 w-4\" />\n                  Back to Events\n                </Button>\n                \n                <div className=\"text-center\">\n                  <h1 className=\"text-2xl md:text-3xl font-bold text-gray-800\">\n                    {selectedEvent.title}\n                  </h1>\n                  <p className=\"text-gray-600 mt-1\">\n                    {photos.length} photos found\n                  </p>\n                </div>\n                \n                <div className=\"w-32\"></div> {/* Spacer for centering */}\n              </div>\n\n              {/* Photo Gallery with Pagination */}\n              <PaginatedPhotoGallery\n                photos={photos}\n                loading={loadingPhotos}\n                onPhotoClick={setFullScreenImage}\n                className=\"mt-4\"\n                showSaveToProfile={true}\n                savedPhotoIds={savedPhotoIds}\n                onSavePhoto={handleSavePhoto}\n                onRemovePhoto={handleRemovePhoto}\n                savingPhotoIds={savingPhotoIds}\n                photosPerPage={10}\n              />\n            </div>\n          </section>\n        </main>\n        \n        {/* Full Screen Image Viewer with Slideshow */}\n        {fullScreenImage && (\n          <div className=\"fixed inset-0 z-[100] bg-black\">\n            {/* Header with back button and download */}\n            <div className=\"absolute top-0 left-0 right-0 z-10 p-4 bg-gradient-to-b from-black/80 to-transparent\">\n              <div className=\"flex items-center justify-between text-white\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setFullScreenImage(null)}\n                  className=\"text-white hover:bg-white/20\"\n                >\n                  <Eye className=\"h-5 w-5 mr-2\" />\n                  Back to Gallery\n                </Button>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm opacity-75\">\n                    {currentPhotoIndex + 1} of {photos.length}\n                  </span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={async () => {\n                      try {\n                        // Use original quality URL for downloads\n                        const originalUrl = getDownloadImageUrl(fullScreenImage.url);\n                        const response = await fetch(originalUrl);\n                        const blob = await response.blob();\n                        const url = window.URL.createObjectURL(blob);\n                        const link = document.createElement('a');\n                        link.href = url;\n                        link.download = fullScreenImage.filename;\n                        document.body.appendChild(link);\n                        link.click();\n                        window.URL.revokeObjectURL(url);\n                        document.body.removeChild(link);\n                      } catch (error) {\n                        console.error('Error downloading photo:', error);\n                      }\n                    }}\n                    className=\"text-white hover:bg-white/20\"\n                  >\n                    <Download className=\"h-4 w-4 mr-2\" />\n                    Download\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setFullScreenImage(null)}\n                    className=\"text-white hover:bg-white/20\"\n                  >\n                    <X className=\"h-5 w-5\" />\n                  </Button>\n                </div>\n              </div>\n            </div>\n\n            {/* Navigation Arrows */}\n            {photos.length > 1 && (\n              <>\n                {/* Previous Button */}\n                <Button\n                  variant=\"ghost\"\n                  size=\"lg\"\n                  onClick={goToPreviousPhoto}\n                  className=\"absolute left-4 top-1/2 transform -translate-y-1/2 z-10 text-white hover:bg-white/20 h-16 w-16 rounded-full\"\n                >\n                  <ChevronLeft className=\"h-8 w-8\" />\n                </Button>\n\n                {/* Next Button */}\n                <Button\n                  variant=\"ghost\"\n                  size=\"lg\"\n                  onClick={goToNextPhoto}\n                  className=\"absolute right-4 top-1/2 transform -translate-y-1/2 z-10 text-white hover:bg-white/20 h-16 w-16 rounded-full\"\n                >\n                  <ChevronRight className=\"h-8 w-8\" />\n                </Button>\n              </>\n            )}\n\n            {/* Optimized Image container with progressive loading */}\n            <div className=\"flex items-center justify-center h-full p-4 pt-20 pb-20\">\n              <div className=\"relative max-w-full max-h-full\">\n                {/* Loading skeleton */}\n                <div className=\"absolute inset-0 bg-gray-800/50 animate-pulse rounded-lg flex items-center justify-center\">\n                  <div className=\"text-white text-sm\">Loading image...</div>\n                </div>\n                \n                <img\n                  src={fullScreenImage.url.includes('/api/images/') \n                    ? `${fullScreenImage.url}?quality=60&thumbnail=false` \n                    : fullScreenImage.url\n                  }\n                  alt={fullScreenImage.filename}\n                  className=\"max-w-full max-h-full object-contain transition-all duration-500 opacity-0\"\n                  style={{ maxHeight: 'calc(100vh - 160px)', maxWidth: 'calc(100vw - 32px)' }}\n                  loading=\"eager\"\n                  onLoad={(e) => {\n                    const target = e.target as HTMLImageElement;\n                    const skeleton = target.previousElementSibling as HTMLElement;\n                    target.style.opacity = '1';\n                    if (skeleton) skeleton.style.display = 'none';\n                  }}\n                  onError={(e) => {\n                    const target = e.target as HTMLImageElement;\n                    const skeleton = target.previousElementSibling as HTMLElement;\n                    target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjE1MCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5Y2EzYWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSBub3QgYXZhaWxhYmxlPC90ZXh0Pjwvc3ZnPg==';\n                    target.style.opacity = '1';\n                    if (skeleton) skeleton.style.display = 'none';\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Footer with image info and navigation dots */}\n            <div className=\"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent\">\n              <div className=\"text-center text-white\">\n                <p className=\"text-sm opacity-75\">\n                  {fullScreenImage.filename}\n                </p>\n                <p className=\"text-xs opacity-50 mt-1\">\n                  Use arrow keys or navigation buttons to browse • Press ESC to close\n                </p>\n                \n                {/* Navigation dots for smaller photo sets */}\n                {photos.length > 1 && photos.length <= 10 && (\n                  <div className=\"flex justify-center mt-3 gap-2\">\n                    {photos.map((_, index) => (\n                      <button\n                        key={index}\n                        onClick={() => {\n                          setCurrentPhotoIndex(index);\n                          setFullScreenImage(photos[index]);\n                        }}\n                        className={`w-2 h-2 rounded-full transition-all ${\n                          index === currentPhotoIndex \n                            ? 'bg-white scale-125' \n                            : 'bg-white/50 hover:bg-white/75'\n                        }`}\n                      />\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n        \n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n      \n      <main className=\"pt-20\">\n        {/* For direct access (URL/QR), skip the hero section and events grid */}\n        {!directEventAccess && (\n          <>\n            {/* Hero Section */}\n            <section className=\"bg-gradient-to-br from-pink-50 via-orange-50 to-yellow-50 py-16\">\n              <div className=\"container mx-auto px-4 text-center\">\n                <h1 className=\"text-4xl md:text-6xl font-bold mb-6\">\n                  <span className=\"bg-gradient-to-r from-pink-600 via-orange-500 to-yellow-500 bg-clip-text text-transparent\">\n                    Event Gallery\n                  </span>\n                </h1>\n                <p className=\"text-xl text-gray-600 mb-8 max-w-2xl mx-auto\">\n                  Browse through our captured moments and find your special memories\n                </p>\n                \n                {/* Search Bar */}\n                <div className=\"max-w-md mx-auto relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5\" />\n                  <Input\n                    type=\"text\"\n                    placeholder=\"Search events...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"pl-10 pr-4 py-3 rounded-full border-2 border-pink-200 focus:border-pink-500\"\n                  />\n                </div>\n              </div>\n            </section>\n\n            {/* Events Grid */}\n            <section className=\"py-16\">\n              <div className=\"container mx-auto px-4\">\n                {loading ? (\n                  <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                    {[...Array(6)].map((_, index) => (\n                      <Card key={index} className=\"overflow-hidden animate-pulse\">\n                        <div className=\"w-full h-48 bg-gray-200\"></div>\n                        <CardHeader>\n                          <div className=\"h-6 bg-gray-200 rounded w-3/4\"></div>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"space-y-2 mb-4\">\n                            <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\n                            <div className=\"h-4 bg-gray-200 rounded w-2/3\"></div>\n                            <div className=\"h-4 bg-gray-200 rounded w-1/3\"></div>\n                          </div>\n                          <div className=\"h-10 bg-gray-200 rounded\"></div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                    {filteredEvents.map((event) => (\n                <Card key={event.id} className=\"group hover:shadow-xl transition-all duration-300 hover:scale-105 overflow-hidden\">\n                  <div className=\"relative overflow-hidden bg-gray-100\">\n                    <img \n                      src={event.thumbnailUrl || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjIwMCIgeT0iMTUwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IiM5Y2EzYWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5ObyBpbWFnZSBhdmFpbGFibGU8L3RleHQ+PC9zdmc+'} \n                      alt={event.title}\n                      className=\"w-full h-48 object-cover group-hover:scale-110 transition-transform duration-300\"\n                      loading=\"lazy\"\n                      onError={(e) => {\n                        const target = e.target as HTMLImageElement;\n                        target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjIwMCIgeT0iMTUwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IiM5Y2EzYWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSBub3QgYXZhaWxhYmxlPC90ZXh0Pjwvc3ZnPg==';\n                      }}\n                    />\n                    <div className=\"absolute top-4 right-4\">\n                      {event.isPrivate ? (\n                        <div className=\"bg-red-500 text-white px-3 py-1 rounded-full text-sm flex items-center\">\n                          <Lock className=\"h-3 w-3 mr-1\" />\n                          Private\n                        </div>\n                      ) : (\n                        <div className=\"bg-green-500 text-white px-3 py-1 rounded-full text-sm\">\n                          Public\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"absolute top-4 left-4\">\n                      <div className=\"bg-black/70 text-white px-3 py-1 rounded-full text-sm\">\n                        {event.category}\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <CardHeader>\n                    <CardTitle className=\"text-lg font-semibold text-gray-800\">\n                      {event.title}\n                    </CardTitle>\n                  </CardHeader>\n                  \n                  <CardContent>\n                    <div className=\"space-y-2 mb-4\">\n                      <div className=\"flex items-center text-gray-600\">\n                        <Calendar className=\"h-4 w-4 mr-2\" />\n                        <span className=\"text-sm\">{new Date(event.eventDate).toLocaleDateString()}</span>\n                      </div>\n                      <div className=\"flex items-center text-gray-600\">\n                        <MapPin className=\"h-4 w-4 mr-2\" />\n                        <span className=\"text-sm\">{event.location}</span>\n                      </div>\n                      <div className=\"flex items-center text-gray-600\">\n                        <Camera className=\"h-4 w-4 mr-2\" />\n                        <span className=\"text-sm\">{event.photoCount} photos</span>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex gap-2\">\n                      <Button \n                        onClick={() => handleEventAccess(event)}\n                        className=\"flex-1 bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white\"\n                      >\n                        {event.isPrivate ? (\n                          <>\n                            <Lock className=\"h-4 w-4 mr-2\" />\n                            Enter PIN\n                          </>\n                        ) : (\n                          <>\n                            <Unlock className=\"h-4 w-4 mr-2\" />\n                            View Gallery\n                          </>\n                        )}\n                      </Button>\n                      \n                      <Button \n                        onClick={() => generateShareUrl(event)}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        disabled={generatingUrl}\n                        className=\"px-3\"\n                        title=\"Share Event\"\n                      >\n                        {generatingUrl ? (\n                          <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-current\"></div>\n                        ) : (\n                          <Share2 className=\"h-4 w-4\" />\n                        )}\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n                    ))}\n                  </div>\n                )}\n\n                {!loading && filteredEvents.length === 0 && (\n                  <div className=\"text-center py-16\">\n                    <Camera className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n                    <h3 className=\"text-xl font-semibold text-gray-600 mb-2\">No events found</h3>\n                    <p className=\"text-gray-500\">Try adjusting your search terms</p>\n                  </div>\n                )}\n              </div>\n            </section>\n          </>\n        )}\n      </main>\n\n      {/* PIN Entry Dialog for Private Events */}\n      <Dialog open={pinDialogOpen} onOpenChange={setPinDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center\">\n              <Lock className=\"h-5 w-5 mr-2 text-red-500\" />\n              Private Event Access\n            </DialogTitle>\n            <DialogDescription>\n              Enter your PIN to access {selectedEvent?.title} photos\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"pin\">PIN Code</Label>\n              <Input\n                id=\"pin\"\n                type=\"password\"\n                placeholder=\"Enter your PIN\"\n                value={pin}\n                onChange={(e) => setPin(e.target.value)}\n                onKeyDown={(e) => e.key === 'Enter' && handlePinSubmit()}\n                className=\"text-center text-lg tracking-widest\"\n              />\n              {pinError && <p className=\"text-red-500 text-sm mt-1\">{pinError}</p>}\n            </div>\n            \n            <div className=\"text-sm text-gray-600 space-y-1\">\n              <p className=\"flex items-center gap-2\">\n                <span className=\"font-medium\">Public PIN:</span> \n                <span className=\"text-xs\">Face scan required - view your photos only</span>\n              </p>\n              <p className=\"flex items-center gap-2\">\n                <span className=\"font-medium\">Bride-Groom PIN:</span> \n                <span className=\"text-xs\">Full access - view all event photos</span>\n              </p>\n            </div>\n            \n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" onClick={() => setPinDialogOpen(false)} className=\"flex-1\">\n                Cancel\n              </Button>\n              <Button onClick={handlePinSubmit} className=\"flex-1 bg-red-500 hover:bg-red-600 text-white\">\n                Access Gallery\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Face Scan Dialog for Public PIN Access */}\n      <Dialog open={faceScanDialogOpen} onOpenChange={setFaceScanDialogOpen}>\n        <DialogContent className=\"sm:max-w-lg\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center\">\n              <Scan className=\"h-5 w-5 mr-2 text-green-500\" />\n              Face Recognition Required\n            </DialogTitle>\n            <DialogDescription>\n              You've entered the Public PIN. Upload a photo or take a selfie to find your pictures in {selectedEvent?.title}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {/* Mode Selection */}\n            <div className=\"flex gap-2 justify-center\">\n              <Button\n                variant={uploadMode === 'upload' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => {\n                  setUploadMode('upload');\n                  stopCamera();\n                  setCapturedPhoto(null);\n                }}\n                className=\"flex items-center gap-2\"\n              >\n                <Upload className=\"h-4 w-4\" />\n                Upload Photo\n              </Button>\n              <Button\n                variant={uploadMode === 'camera' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => {\n                  setUploadMode('camera');\n                  setUploadedFace(null);\n                  startCamera();\n                }}\n                className=\"flex items-center gap-2\"\n              >\n                <Camera className=\"h-4 w-4\" />\n                Take Selfie\n              </Button>\n            </div>\n\n            <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center\">\n              {/* Show captured photo or uploaded file */}\n              {(uploadedFace || capturedPhoto) ? (\n                <div className=\"space-y-2\">\n                  <img \n                    src={capturedPhoto || URL.createObjectURL(uploadedFace!)} \n                    alt=\"Face photo\" \n                    className=\"w-20 h-20 rounded-full mx-auto object-cover\"\n                  />\n                  <p className=\"text-sm text-green-600\">\n                    {capturedPhoto ? 'Selfie captured' : uploadedFace!.name}\n                  </p>\n                  <div className=\"flex gap-2 justify-center\">\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => {\n                        setUploadedFace(null);\n                        setCapturedPhoto(null);\n                      }}\n                    >\n                      Remove\n                    </Button>\n                    {capturedPhoto && (\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        onClick={retakePhoto}\n                      >\n                        Retake\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              ) : uploadMode === 'camera' ? (\n                <div className=\"space-y-2\">\n                  {cameraActive ? (\n                    <div className=\"space-y-2\">\n                      <video\n                        id=\"camera-video\"\n                        ref={(video) => {\n                          if (video && cameraStream) {\n                            video.srcObject = cameraStream;\n                            video.play();\n                          }\n                        }}\n                        className=\"w-full max-w-xs mx-auto rounded-lg\"\n                        autoPlay\n                        playsInline\n                        muted\n                      />\n                      <div className=\"flex gap-2 justify-center\">\n                        <Button \n                          onClick={capturePhoto}\n                          className=\"bg-green-500 hover:bg-green-600 text-white\"\n                        >\n                          <Camera className=\"h-4 w-4 mr-2\" />\n                          Capture Photo\n                        </Button>\n                        <Button \n                          variant=\"outline\"\n                          onClick={stopCamera}\n                        >\n                          <VideoOff className=\"h-4 w-4 mr-2\" />\n                          Stop Camera\n                        </Button>\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      <Video className=\"h-12 w-12 text-gray-400 mx-auto\" />\n                      <p className=\"text-sm text-gray-600\">Take a clear selfie of your face</p>\n                      <Button \n                        variant=\"outline\"\n                        onClick={startCamera}\n                      >\n                        <Camera className=\"h-4 w-4 mr-2\" />\n                        Start Camera\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  <Upload className=\"h-12 w-12 text-gray-400 mx-auto\" />\n                  <p className=\"text-sm text-gray-600\">Upload a clear photo of your face</p>\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={handleFileUpload}\n                    className=\"hidden\"\n                    id=\"face-upload\"\n                  />\n                  <Button \n                    variant=\"outline\"\n                    onClick={() => document.getElementById('face-upload')?.click()}\n                  >\n                    Choose Photo\n                  </Button>\n                </div>\n              )}\n            </div>\n            {scanningFace && (\n              <div className=\"text-center text-sm text-gray-600\">\n                <p>Please wait a few minutes while we process your face recognition...</p>\n                <p className=\"text-xs mt-1\">This may take 2-3 minutes depending on the number of photos</p>\n              </div>\n            )}\n            <div className=\"flex gap-2\">\n              <Button \n                variant=\"outline\" \n                onClick={() => {\n                  setFaceScanDialogOpen(false);\n                  stopCamera();\n                  setCapturedPhoto(null);\n                  setUploadedFace(null);\n                  setUploadMode('upload');\n                }} \n                className=\"flex-1\"\n              >\n                Cancel\n              </Button>\n              <Button \n                onClick={handleFaceScan}\n                disabled={!uploadedFace || scanningFace}\n                className=\"flex-1 bg-green-500 hover:bg-green-600 text-white\"\n              >\n                {scanningFace ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                    Processing...\n                  </>\n                ) : (\n                  'Find My Photos'\n                )}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n\n\n      {/* Simple Full Screen Image Viewer */}\n      {fullScreenImage && (\n        <SimpleFullscreenViewer\n          photo={fullScreenImage}\n          photos={photos}\n          currentIndex={currentPhotoIndex}\n          onClose={() => setFullScreenImage(null)}\n          onNext={goToNextPhoto}\n          onPrevious={goToPreviousPhoto}\n          onIndexChange={(index) => {\n            setCurrentPhotoIndex(index);\n            setFullScreenImage(photos[index]);\n          }}\n        />\n      )}\n\n      {/* Share Event Dialog */}\n      <Dialog open={shareDialogOpen} onOpenChange={setShareDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Share2 className=\"h-5 w-5\" />\n              Share Event: {shareEvent?.title}\n            </DialogTitle>\n            <DialogDescription>\n              Share this event with others using the URL below.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            {shareUrl && (\n              <div className=\"space-y-3\">\n                <div className=\"flex gap-2\">\n                  <Input\n                    value={shareUrl}\n                    readOnly\n                    className=\"flex-1\"\n                    onClick={(e) => e.currentTarget.select()}\n                  />\n                  <Button\n                    variant=\"outline\"\n                    size=\"icon\"\n                    onClick={copyShareUrl}\n                    className=\"shrink-0\"\n                    title=\"Copy URL\"\n                  >\n                    {copiedUrl ? (\n                      <Check className=\"h-4 w-4 text-green-600\" />\n                    ) : (\n                      <Copy className=\"h-4 w-4\" />\n                    )}\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"icon\"\n                    onClick={openShareUrl}\n                    className=\"shrink-0\"\n                    title=\"Open in new tab\"\n                  >\n                    <ExternalLink className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Footer />\n    </div>\n  );\n};\n\nexport default Events;\n","size_bytes":50813},"client/src/pages/FindMyFace.tsx":{"content":"import { Camera, Search, Download, Zap, Shield, Brain, Database, Cpu, Lock, Target, Layers } from 'lucide-react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport Header from '@/components/Header';\nimport Footer from '@/components/Footer';\n\nconst FindMyFace = () => {\n  const steps = [\n    {\n      icon: <Camera className=\"h-8 w-8\" />,\n      title: \"Upload Your Photo\",\n      description: \"Take a selfie or upload a clear photo of yourself. Our system accepts various image formats and automatically optimizes quality.\"\n    },\n    {\n      icon: <Brain className=\"h-8 w-8\" />,\n      title: \"AI Face Processing\",\n      description: \"Advanced neural networks extract unique facial features and create mathematical embeddings for precise matching.\"\n    },\n    {\n      icon: <Search className=\"h-8 w-8\" />,\n      title: \"Smart Comparison\",\n      description: \"Advanced similarity algorithms compare your face against all event photos using mathematical precision.\"\n    },\n    {\n      icon: <Download className=\"h-8 w-8\" />,\n      title: \"Get Your Results\",\n      description: \"Receive matched photos ranked by similarity score. Download, save to gallery, or share your memories instantly.\"\n    }\n  ];\n\n  const features = [\n    {\n      icon: <Cpu className=\"h-6 w-6 text-yellow-500\" />,\n      title: \"GPU-Accelerated Processing\",\n      description: \"State-of-the-art GPU acceleration delivers results in seconds, even for large events with thousands of photos.\"\n    },\n    {\n      icon: <Shield className=\"h-6 w-6 text-green-500\" />,\n      title: \"Privacy & Security First\",\n      description: \"Face data is processed securely in-memory and never permanently stored. Your privacy is our top priority.\"\n    },\n    {\n      icon: <Target className=\"h-6 w-6 text-blue-500\" />,\n      title: \"99%+ Accuracy Rate\",\n      description: \"State-of-the-art deep learning models ensure the highest accuracy in facial recognition technology.\"\n    },\n    {\n      icon: <Database className=\"h-6 w-6 text-purple-500\" />,\n      title: \"Scalable Architecture\",\n      description: \"Microservice-based design handles events of any size, from intimate gatherings to large-scale conferences.\"\n    },\n    {\n      icon: <Layers className=\"h-6 w-6 text-orange-500\" />,\n      title: \"Smart Filtering\",\n      description: \"Advanced similarity thresholds and ranking algorithms ensure you only see the most relevant matches.\"\n    },\n    {\n      icon: <Lock className=\"h-6 w-6 text-red-500\" />,\n      title: \"Secure Processing\",\n      description: \"End-to-end encryption and secure data handling protect your images throughout the entire process.\"\n    }\n  ];\n\n  const technicalFeatures = [\n    {\n      title: \"Deep Learning Networks\",\n      description: \"Industry-leading neural networks with superior accuracy for identity verification and matching.\"\n    },\n    {\n      title: \"Advanced Vector Search\",\n      description: \"Cutting-edge similarity search algorithms provide lightning-fast comparisons across massive datasets.\"\n    },\n    {\n      title: \"Real-time Processing\",\n      description: \"Optimized algorithms and GPU acceleration deliver instant results without compromising accuracy.\"\n    },\n    {\n      title: \"Mathematical Embeddings\",\n      description: \"Convert facial features into numerical vectors for precise, bias-free comparison and matching.\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n      \n      <main className=\"pt-20\">\n        {/* Hero Section */}\n        <section className=\"bg-gradient-to-br from-cyan-50 via-blue-50 to-purple-50 py-20 relative overflow-hidden\">\n          {/* Background decorative elements */}\n          <div className=\"absolute inset-0 overflow-hidden\">\n            <div className=\"absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-blue-400/20 to-purple-400/20 rounded-full blur-3xl\"></div>\n            <div className=\"absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-br from-cyan-400/20 to-blue-400/20 rounded-full blur-3xl\"></div>\n          </div>\n          \n          <div className=\"container mx-auto px-4 text-center relative z-10\">\n            <div className=\"mb-8\">\n              <div className=\"inline-flex items-center px-4 py-2 bg-white/50 backdrop-blur-sm rounded-full border border-blue-200 mb-6\">\n                <Brain className=\"h-5 w-5 text-blue-600 mr-2\" />\n                <span className=\"text-blue-700 font-medium\">AI-Powered Recognition</span>\n              </div>\n            </div>\n            \n            <h1 className=\"text-5xl md:text-7xl font-bold mb-6\">\n              <span className=\"bg-gradient-to-r from-cyan-600 via-blue-500 to-purple-500 bg-clip-text text-transparent\">\n                FindMyFace\n              </span>\n            </h1>\n            \n            <p className=\"text-xl md:text-2xl text-gray-600 mb-8 max-w-4xl mx-auto leading-relaxed\">\n              Revolutionary AI technology that instantly finds all your photos from any event. \n              Upload a selfie and let our advanced algorithms do the rest.\n            </p>\n            \n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center items-center\">\n              <div className=\"flex items-center text-gray-600\">\n                <Zap className=\"h-5 w-5 text-yellow-500 mr-2\" />\n                <span>Results in seconds</span>\n              </div>\n              <div className=\"flex items-center text-gray-600\">\n                <Shield className=\"h-5 w-5 text-green-500 mr-2\" />\n                <span>100% Private & Secure</span>\n              </div>\n              <div className=\"flex items-center text-gray-600\">\n                <Target className=\"h-5 w-5 text-blue-500 mr-2\" />\n                <span>99%+ Accuracy</span>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* How It Works */}\n        <section className=\"py-20 bg-white relative\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center mb-16\">\n              <h2 className=\"text-4xl md:text-5xl font-bold mb-6\">\n                <span className=\"bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent\">\n                  How It Works\n                </span>\n              </h2>\n              <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n                Experience the future of photo discovery with our simple 4-step process\n              </p>\n            </div>\n            \n            <div className=\"max-w-6xl mx-auto\">\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-8\">\n                {steps.map((step, index) => (\n                  <div key={index} className=\"relative\">\n                    {/* Connecting line for desktop */}\n                    {index < steps.length - 1 && (\n                      <div className=\"hidden lg:block absolute top-10 left-full w-8 h-0.5 bg-gradient-to-r from-cyan-300 to-purple-300 z-0\"></div>\n                    )}\n                    \n                    <div className=\"text-center relative z-10 bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 group\">\n                      <div className=\"relative mb-6\">\n                        <div className=\"w-20 h-20 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-full flex items-center justify-center text-white mx-auto shadow-lg group-hover:scale-110 transition-transform duration-300\">\n                          {step.icon}\n                        </div>\n                        <div className=\"absolute -top-2 -right-2 w-8 h-8 bg-gradient-to-r from-pink-500 to-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-lg\">\n                          {index + 1}\n                        </div>\n                      </div>\n                      <h3 className=\"text-xl font-semibold text-gray-800 mb-4 group-hover:text-blue-600 transition-colors duration-300\">\n                        {step.title}\n                      </h3>\n                      <p className=\"text-gray-600 leading-relaxed\">{step.description}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Key Features */}\n        <section className=\"py-20 bg-gradient-to-br from-gray-50 to-blue-50 relative\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center mb-16\">\n              <h2 className=\"text-4xl font-bold mb-6 text-gray-800\">\n                Advanced AI Features & Capabilities\n              </h2>\n              <p className=\"text-xl text-gray-600 max-w-3xl mx-auto\">\n                Cutting-edge technology designed to deliver the best photo recognition experience\n              </p>\n            </div>\n            \n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto\">\n              {features.map((feature, index) => (\n                <Card key={index} className=\"group border-0 shadow-lg hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 bg-white/90 backdrop-blur-sm\">\n                  <CardContent className=\"p-8\">\n                    <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300\">\n                      {feature.icon}\n                    </div>\n                    <h3 className=\"text-xl font-semibold text-gray-800 mb-4 group-hover:text-blue-600 transition-colors duration-300\">\n                      {feature.title}\n                    </h3>\n                    <p className=\"text-gray-600 leading-relaxed\">{feature.description}</p>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Technical Architecture */}\n        <section className=\"py-16 bg-white\">\n          <div className=\"container mx-auto px-4\">\n            <h2 className=\"text-3xl font-bold text-center mb-6 text-gray-800\">\n              Powered by Cutting-Edge Technology\n            </h2>\n            <p className=\"text-xl text-gray-600 text-center mb-12 max-w-3xl mx-auto\">\n              Our FindMyFace system combines state-of-the-art AI models with enterprise-grade infrastructure\n            </p>\n            \n            <div className=\"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto\">\n              {technicalFeatures.map((tech, index) => (\n                <div key={index} className=\"bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border border-blue-100\">\n                  <h3 className=\"text-xl font-semibold text-gray-800 mb-3\">{tech.title}</h3>\n                  <p className=\"text-gray-600\">{tech.description}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Performance Statistics */}\n        <section className=\"py-20 bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 relative overflow-hidden\">\n          {/* Background decorative elements */}\n          <div className=\"absolute top-20 right-20 w-32 h-32 bg-gradient-to-br from-purple-200/30 to-pink-200/30 rounded-full blur-2xl\"></div>\n          <div className=\"absolute bottom-20 left-20 w-40 h-40 bg-gradient-to-br from-orange-200/30 to-yellow-200/30 rounded-full blur-2xl\"></div>\n          \n          <div className=\"container mx-auto px-4 relative z-10\">\n            <div className=\"text-center mb-16\">\n              <h2 className=\"text-4xl font-bold mb-4 text-gray-800\">\n                Unmatched Performance & Accuracy\n              </h2>\n              <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n                Real metrics from our advanced AI system delivering exceptional results\n              </p>\n            </div>\n            \n            <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-8 max-w-6xl mx-auto\">\n              <div className=\"bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 text-center group\">\n                <div className=\"w-16 h-16 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300\">\n                  <Target className=\"h-8 w-8 text-white\" />\n                </div>\n                <div className=\"text-4xl font-bold bg-gradient-to-r from-cyan-600 to-blue-600 bg-clip-text text-transparent mb-2\">\n                  99.5%\n                </div>\n                <p className=\"text-gray-600 font-medium\">Recognition Accuracy</p>\n              </div>\n              \n              <div className=\"bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 text-center group\">\n                <div className=\"w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300\">\n                  <Zap className=\"h-8 w-8 text-white\" />\n                </div>\n                <div className=\"text-4xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent mb-2\">\n                  &lt;3s\n                </div>\n                <p className=\"text-gray-600 font-medium\">Average Processing Time</p>\n              </div>\n              \n              <div className=\"bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 text-center group\">\n                <div className=\"w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300\">\n                  <Search className=\"h-8 w-8 text-white\" />\n                </div>\n                <div className=\"text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2\">\n                  60%\n                </div>\n                <p className=\"text-gray-600 font-medium\">Similarity Threshold</p>\n              </div>\n              \n              <div className=\"bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 text-center group\">\n                <div className=\"w-16 h-16 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300\">\n                  <Database className=\"h-8 w-8 text-white\" />\n                </div>\n                <div className=\"text-4xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent mb-2\">\n                  10K+\n                </div>\n                <p className=\"text-gray-600 font-medium\">Photos Per Event Capacity</p>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* How the AI Works */}\n        <section className=\"py-16 bg-white\">\n          <div className=\"container mx-auto px-4\">\n            <h2 className=\"text-3xl font-bold text-center mb-12 text-gray-800\">\n              Behind the AI: Technical Process\n            </h2>\n            \n            <div className=\"max-w-4xl mx-auto\">\n              <div className=\"grid gap-8\">\n                <div className=\"bg-gradient-to-r from-blue-50 to-cyan-50 p-8 rounded-lg border border-blue-100\">\n                  <h3 className=\"text-2xl font-semibold text-gray-800 mb-4 flex items-center\">\n                    <Brain className=\"h-8 w-8 text-blue-500 mr-3\" />\n                    Face Detection & Feature Extraction\n                  </h3>\n                  <p className=\"text-gray-600 mb-4\">\n                    When photos are uploaded to events, our system automatically processes each image using advanced AI models. \n                    The AI identifies faces in the photos and extracts unique facial features, converting them into mathematical \n                    embeddings - numerical vectors that represent each person's distinctive characteristics.\n                  </p>\n                  <div className=\"bg-white p-4 rounded border-l-4 border-blue-500\">\n                    <strong className=\"text-gray-800\">Technical Details:</strong> Our embeddings create high-dimensional vectors \n                    that capture facial geometry, proportions, and unique features with sub-pixel precision.\n                  </div>\n                </div>\n\n                <div className=\"bg-gradient-to-r from-purple-50 to-pink-50 p-8 rounded-lg border border-purple-100\">\n                  <h3 className=\"text-2xl font-semibold text-gray-800 mb-4 flex items-center\">\n                    <Database className=\"h-8 w-8 text-purple-500 mr-3\" />\n                    Similarity Search & Matching\n                  </h3>\n                  <p className=\"text-gray-600 mb-4\">\n                    When you upload your selfie, the system extracts your face embedding and compares it against all stored \n                    embeddings from the event using advanced similarity algorithms. The system calculates mathematical \n                    similarity scores to determine how closely your face matches each photo.\n                  </p>\n                  <div className=\"bg-white p-4 rounded border-l-4 border-purple-500\">\n                    <strong className=\"text-gray-800\">Matching Process:</strong> Only photos with similarity scores above 60% \n                    are returned, ensuring high-quality matches while filtering out false positives.\n                  </div>\n                </div>\n\n                <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 p-8 rounded-lg border border-green-100\">\n                  <h3 className=\"text-2xl font-semibold text-gray-800 mb-4 flex items-center\">\n                    <Shield className=\"h-8 w-8 text-green-500 mr-3\" />\n                    Privacy & Security Architecture\n                  </h3>\n                  <p className=\"text-gray-600 mb-4\">\n                    Your privacy is paramount. Face processing happens in real-time memory without permanent storage of biometric data. \n                    The system uses secure microservice architecture with encrypted data transmission and automatic cleanup of \n                    temporary processing files.\n                  </p>\n                  <div className=\"bg-white p-4 rounded border-l-4 border-green-500\">\n                    <strong className=\"text-gray-800\">Security Features:</strong> End-to-end encryption, in-memory processing, \n                    automatic data purging, and zero-trust architecture ensure your data remains private.\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Call to Action */}\n        <section className=\"py-20 bg-gradient-to-br from-cyan-600 via-blue-600 to-purple-600 relative overflow-hidden\">\n          {/* Background decorative elements */}\n          <div className=\"absolute inset-0 opacity-20\">\n            <div className=\"absolute top-10 left-10 w-32 h-32 bg-white/10 rounded-full blur-xl\"></div>\n            <div className=\"absolute bottom-10 right-10 w-24 h-24 bg-white/5 rounded-full blur-lg\"></div>\n            <div className=\"absolute top-1/2 left-1/3 w-16 h-16 bg-white/5 rounded-full blur-md\"></div>\n          </div>\n          \n          <div className=\"container mx-auto px-4 text-center relative z-10\">\n            <div className=\"max-w-4xl mx-auto\">\n              <h2 className=\"text-4xl md:text-5xl font-bold text-white mb-6\">\n                Ready to Find Your Photos?\n              </h2>\n              <p className=\"text-xl text-blue-100 mb-8 max-w-2xl mx-auto\">\n                Experience the future of photo discovery. Our AI technology is waiting to help you find every moment you're in.\n              </p>\n              \n              <div className=\"flex flex-col sm:flex-row gap-6 justify-center items-center mb-12\">\n                <div className=\"flex items-center text-blue-100\">\n                  <div className=\"w-3 h-3 bg-green-400 rounded-full mr-3 animate-pulse\"></div>\n                  <span>AI Service Active</span>\n                </div>\n                <div className=\"flex items-center text-blue-100\">\n                  <div className=\"w-3 h-3 bg-green-400 rounded-full mr-3 animate-pulse\"></div>\n                  <span>Models Loaded</span>\n                </div>\n                <div className=\"flex items-center text-blue-100\">\n                  <div className=\"w-3 h-3 bg-green-400 rounded-full mr-3 animate-pulse\"></div>\n                  <span>Ready to Process</span>\n                </div>\n              </div>\n              \n              <div className=\"bg-white/10 backdrop-blur-sm rounded-2xl p-8 border border-white/20\">\n                <h3 className=\"text-2xl font-semibold text-white mb-4\">\n                  Visit Events to Get Started\n                </h3>\n                <p className=\"text-blue-100 mb-6\">\n                  Browse available events and use FindMyFace technology to instantly locate all your photos.\n                </p>\n                <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                  <button \n                    onClick={() => window.location.href = '/events'} \n                    className=\"bg-white text-blue-600 px-8 py-4 rounded-full font-semibold hover:bg-blue-50 transition-all duration-300 transform hover:scale-105 shadow-lg\"\n                  >\n                    Browse Events\n                  </button>\n                  <button \n                    onClick={() => window.location.href = '/contact'} \n                    className=\"bg-transparent border-2 border-white text-white px-8 py-4 rounded-full font-semibold hover:bg-white hover:text-blue-600 transition-all duration-300 transform hover:scale-105\"\n                  >\n                    Learn More\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      <Footer />\n    </div>\n  );\n};\n\nexport default FindMyFace;","size_bytes":22160},"client/src/pages/Index.tsx":{"content":"\nimport Header from '@/components/Header';\nimport Hero from '@/components/Hero';\nimport PhotographyShowcase from '@/components/PhotographyShowcase';\nimport EventTypes from '@/components/EventTypes';\nimport EventsPreview from '@/components/EventsPreview';\nimport FindMyFaceSection from '@/components/FindMyFaceSection';\nimport Footer from '@/components/Footer';\n\nconst Index = () => {\n  return (\n    <div className=\"min-h-screen\">\n      <Header />\n      <main>\n        <Hero />\n        <PhotographyShowcase />\n        <EventTypes />\n        <EventsPreview />\n        <FindMyFaceSection />\n      </main>\n      <Footer />\n    </div>\n  );\n};\n\nexport default Index;\n","size_bytes":661},"client/src/pages/NotFound.tsx":{"content":"import { useLocation } from \"react-router-dom\";\nimport { useEffect } from \"react\";\n\nconst NotFound = () => {\n  const location = useLocation();\n\n  useEffect(() => {\n    console.error(\n      \"404 Error: User attempted to access non-existent route:\",\n      location.pathname\n    );\n  }, [location.pathname]);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\n      <div className=\"text-center\">\n        <h1 className=\"text-4xl font-bold mb-4\">404</h1>\n        <p className=\"text-xl text-gray-600 mb-4\">Oops! Page not found</p>\n        <a href=\"/\" className=\"text-blue-500 hover:text-blue-700 underline\">\n          Return to Home\n        </a>\n      </div>\n    </div>\n  );\n};\n\nexport default NotFound;\n","size_bytes":739},"client/src/pages/Profile.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Separator } from '@/components/ui/separator';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { Calendar, Camera, User as UserIcon, MapPin, Phone, Mail, Clock, CheckCircle, XCircle, Edit, Save, X, Eye, Download, Trash2, ChevronLeft, ChevronRight } from 'lucide-react';\nimport Header from '@/components/Header';\nimport Footer from '@/components/Footer';\nimport PaginatedPhotoGallery from '@/components/PaginatedPhotoGallery';\nimport { format } from 'date-fns';\nimport type { Booking, Photo, User } from '@shared/types';\nimport { getDisplayImageUrl, getDownloadImageUrl } from '@/utils/imagePreloader';\n\nconst Profile = () => {\n  const { currentUser, userData, refreshUserData } = useAuth();\n  const [isEditing, setIsEditing] = useState(false);\n  const [fullScreenImage, setFullScreenImage] = useState<Photo | null>(null);\n  const [currentPhotoIndex, setCurrentPhotoIndex] = useState(0);\n  const [editForm, setEditForm] = useState({\n    displayName: '',\n    phone: '',\n    bio: '',\n    customPhotoURL: ''\n  });\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: userBookings = [], isLoading: bookingsLoading } = useQuery<Booking[]>({\n    queryKey: ['/api/user/bookings'],\n    queryFn: async () => {\n      if (!currentUser) return [];\n      \n      // Force refresh token to ensure it's valid\n      const token = await currentUser.getIdToken(true);\n      const response = await fetch('/api/user/bookings', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || 'Failed to fetch bookings');\n      }\n      \n      return response.json();\n    },\n    enabled: !!currentUser,\n  });\n\n  const { data: photos = [], isLoading: photosLoading } = useQuery<Photo[]>({\n    queryKey: ['/api/user/saved-photos'],\n    queryFn: async () => {\n      if (!currentUser) return [];\n      \n      // Force refresh token to ensure it's valid\n      const token = await currentUser.getIdToken(true);\n      const response = await fetch('/api/user/saved-photos', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || 'Failed to fetch saved photos');\n      }\n      \n      return response.json();\n    },\n    enabled: !!currentUser\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: Partial<User>) => {\n      if (!currentUser) throw new Error('No user logged in');\n      \n      // Force refresh the token to ensure it's valid\n      const token = await currentUser.getIdToken(true);\n      const response = await fetch('/api/user/profile', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(data)\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || 'Failed to update profile');\n      }\n\n      return response.json();\n    },\n    onSuccess: async (updatedUser) => {\n      console.log('Profile updated successfully:', updatedUser);\n      \n      // Refresh user data in auth context\n      await refreshUserData();\n      \n      // Invalidate query cache\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/sync-user'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/user/bookings'] });\n      \n      // Update the edit form to reflect the new data\n      setEditForm({\n        displayName: updatedUser.displayName || '',\n        phone: updatedUser.phone || '',\n        bio: updatedUser.bio || '',\n        customPhotoURL: updatedUser.customPhotoURL || ''\n      });\n      \n      toast({\n        title: \"Profile Updated\",\n        description: \"Your profile has been successfully updated.\",\n      });\n      setIsEditing(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update profile. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const unsavePhotoMutation = useMutation({\n    mutationFn: async (photoId: string) => {\n      if (!currentUser) throw new Error('No user logged in');\n      \n      const token = await currentUser.getIdToken(true);\n      const response = await fetch('/api/user/remove-photo', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({ photoId })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || 'Failed to remove photo');\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      // Refresh saved photos list\n      queryClient.invalidateQueries({ queryKey: ['/api/user/saved-photos'] });\n      \n      toast({\n        title: \"Photo Removed\",\n        description: \"Photo has been removed from your saved photos.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to remove photo. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Navigation functions for full-screen viewer\n  const goToPreviousPhoto = () => {\n    if (photos.length === 0) return;\n    const newIndex = currentPhotoIndex === 0 ? photos.length - 1 : currentPhotoIndex - 1;\n    setCurrentPhotoIndex(newIndex);\n    setFullScreenImage(photos[newIndex]);\n  };\n\n  const goToNextPhoto = () => {\n    if (photos.length === 0) return;\n    const newIndex = currentPhotoIndex === photos.length - 1 ? 0 : currentPhotoIndex + 1;\n    setCurrentPhotoIndex(newIndex);\n    setFullScreenImage(photos[newIndex]);\n  };\n\n  // Handle keyboard navigation\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      if (!fullScreenImage) return;\n      \n      switch (event.key) {\n        case 'ArrowLeft':\n          event.preventDefault();\n          goToPreviousPhoto();\n          break;\n        case 'ArrowRight':\n          event.preventDefault();\n          goToNextPhoto();\n          break;\n        case 'Escape':\n          event.preventDefault();\n          setFullScreenImage(null);\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyPress);\n    return () => window.removeEventListener('keydown', handleKeyPress);\n  }, [fullScreenImage, currentPhotoIndex, photos]);\n\n  // Update photo index when fullScreenImage changes\n  useEffect(() => {\n    if (fullScreenImage) {\n      const index = photos.findIndex(photo => photo.id === fullScreenImage.id);\n      if (index !== -1) {\n        setCurrentPhotoIndex(index);\n      }\n    }\n  }, [fullScreenImage, photos]);\n\n  const handleUnsavePhoto = (photoId: string) => {\n    unsavePhotoMutation.mutate(photoId);\n  };\n\n  // Update form when userData changes\n  useEffect(() => {\n    if (userData && !isEditing) {\n      setEditForm({\n        displayName: userData?.displayName || currentUser?.displayName || '',\n        phone: userData?.phone || '',\n        bio: userData?.bio || '',\n        customPhotoURL: userData?.customPhotoURL || ''\n      });\n    }\n  }, [userData, currentUser, isEditing]);\n\n  const handleEditToggle = () => {\n    if (!isEditing) {\n      setEditForm({\n        displayName: userData?.displayName || currentUser?.displayName || '',\n        phone: userData?.phone || '',\n        bio: userData?.bio || '',\n        customPhotoURL: userData?.customPhotoURL || ''\n      });\n    }\n    setIsEditing(!isEditing);\n  };\n\n  const handleSave = () => {\n    updateProfileMutation.mutate(editForm);\n  };\n\n  const getProfilePhotoURL = () => {\n    // Priority: Custom photo > Google photo > fallback\n    return userData?.customPhotoURL || currentUser?.photoURL || '';\n  };\n\n  const getProfileInitials = () => {\n    if (userData?.displayName || currentUser?.displayName) {\n      return (userData?.displayName || currentUser?.displayName)!.charAt(0).toUpperCase();\n    }\n    return currentUser?.email?.charAt(0).toUpperCase() || 'U';\n  };\n\n  if (!currentUser) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Header />\n        <main className=\"pt-20\">\n          <div className=\"container mx-auto px-4 py-16 text-center\">\n            <h1 className=\"text-2xl font-bold text-gray-800 mb-4\">Please sign in to view your profile</h1>\n            <p className=\"text-gray-600\">You need to be logged in to access this page.</p>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'confirmed':\n        return 'bg-green-100 text-green-800 border-green-200';\n      case 'pending':\n        return 'bg-yellow-100 text-yellow-800 border-yellow-200';\n      case 'cancelled':\n        return 'bg-red-100 text-red-800 border-red-200';\n      default:\n        return 'bg-gray-100 text-gray-800 border-gray-200';\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'confirmed':\n        return <CheckCircle className=\"h-4 w-4\" />;\n      case 'cancelled':\n        return <XCircle className=\"h-4 w-4\" />;\n      default:\n        return <Clock className=\"h-4 w-4\" />;\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n      <main className=\"pt-20\">\n        <div className=\"container mx-auto px-4 py-8\">\n          {/* Profile Header */}\n          <Card className=\"mb-8\">\n            <CardContent className=\"p-8\">\n              <div className=\"flex flex-col md:flex-row items-start md:items-center gap-6\">\n                <div className=\"relative\">\n                  <Avatar className=\"h-24 w-24\">\n                    <AvatarImage src={getProfilePhotoURL()} alt={currentUser.displayName || 'User'} />\n                    <AvatarFallback className=\"text-2xl bg-gradient-to-br from-pink-500 to-purple-600 text-white font-bold\">\n                      {getProfileInitials()}\n                    </AvatarFallback>\n                  </Avatar>\n                  {isEditing && (\n                    <div className=\"absolute -bottom-2 -right-2\">\n                      <Button size=\"sm\" variant=\"secondary\" className=\"h-8 w-8 p-0\">\n                        <Camera className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  )}\n                </div>\n                \n                <div className=\"flex-1\">\n                  <div className=\"flex flex-col md:flex-row md:items-center gap-4 mb-4\">\n                    {isEditing ? (\n                      <div className=\"flex-1\">\n                        <Label htmlFor=\"displayName\" className=\"text-sm font-medium\">Display Name</Label>\n                        <Input\n                          id=\"displayName\"\n                          value={editForm.displayName}\n                          onChange={(e) => setEditForm(prev => ({ ...prev, displayName: e.target.value }))}\n                          className=\"text-2xl font-bold\"\n                        />\n                      </div>\n                    ) : (\n                      <h1 className=\"text-3xl font-bold text-gray-800\">\n                        {userData?.displayName || currentUser.displayName || 'Welcome!'}\n                      </h1>\n                    )}\n                    \n                    <div className=\"flex items-center gap-2\">\n                      {userData?.isAdmin && (\n                        <Badge variant=\"secondary\" className=\"bg-purple-100 text-purple-800 border-purple-200\">\n                          <UserIcon className=\"h-3 w-3 mr-1\" />\n                          Admin\n                        </Badge>\n                      )}\n                      \n                      {isEditing ? (\n                        <div className=\"flex gap-2\">\n                          <Button \n                            size=\"sm\" \n                            onClick={handleSave}\n                            disabled={updateProfileMutation.isPending}\n                          >\n                            <Save className=\"h-4 w-4 mr-1\" />\n                            Save\n                          </Button>\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\" \n                            onClick={() => setIsEditing(false)}\n                          >\n                            <X className=\"h-4 w-4 mr-1\" />\n                            Cancel\n                          </Button>\n                        </div>\n                      ) : (\n                        <Button size=\"sm\" variant=\"outline\" onClick={handleEditToggle}>\n                          <Edit className=\"h-4 w-4 mr-1\" />\n                          Edit Profile\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                  \n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <Mail className=\"h-4 w-4\" />\n                      <span>{currentUser.email}</span>\n                    </div>\n                    \n                    {isEditing ? (\n                      <div className=\"space-y-3\">\n                        <div>\n                          <Label htmlFor=\"phone\" className=\"text-sm font-medium\">Phone Number</Label>\n                          <Input\n                            id=\"phone\"\n                            value={editForm.phone}\n                            onChange={(e) => setEditForm(prev => ({ ...prev, phone: e.target.value }))}\n                            placeholder=\"Your phone number\"\n                          />\n                        </div>\n                        <div>\n                          <Label htmlFor=\"customPhotoURL\" className=\"text-sm font-medium\">Profile Photo URL</Label>\n                          <Input\n                            id=\"customPhotoURL\"\n                            value={editForm.customPhotoURL}\n                            onChange={(e) => setEditForm(prev => ({ ...prev, customPhotoURL: e.target.value }))}\n                            placeholder=\"Custom profile photo URL (leave empty to use Google photo)\"\n                          />\n                        </div>\n                        <div>\n                          <Label htmlFor=\"bio\" className=\"text-sm font-medium\">Bio</Label>\n                          <Textarea\n                            id=\"bio\"\n                            value={editForm.bio}\n                            onChange={(e) => setEditForm(prev => ({ ...prev, bio: e.target.value }))}\n                            placeholder=\"Tell us about yourself...\"\n                            rows={3}\n                          />\n                        </div>\n                      </div>\n                    ) : (\n                      <>\n                        {(userData?.phone || editForm.phone) && (\n                          <div className=\"flex items-center gap-2\">\n                            <Phone className=\"h-4 w-4\" />\n                            <span>{userData?.phone || editForm.phone}</span>\n                          </div>\n                        )}\n                        \n                        {(userData?.bio || editForm.bio) && (\n                          <div className=\"flex items-start gap-2\">\n                            <UserIcon className=\"h-4 w-4 mt-0.5\" />\n                            <span className=\"text-gray-600\">{userData?.bio || editForm.bio}</span>\n                          </div>\n                        )}\n                        \n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4\" />\n                          <span>Member since {format(new Date(userData?.createdAt || new Date()), 'MMMM yyyy')}</span>\n                        </div>\n                      </>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Profile Tabs */}\n          <Tabs defaultValue=\"bookings\" className=\"space-y-6\">\n            <TabsList className=\"grid w-full grid-cols-2 lg:grid-cols-3\">\n              <TabsTrigger value=\"bookings\" className=\"flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4\" />\n                Booking History\n              </TabsTrigger>\n              <TabsTrigger value=\"photos\" className=\"flex items-center gap-2\">\n                <Camera className=\"h-4 w-4\" />\n                Saved Photos\n              </TabsTrigger>\n              <TabsTrigger value=\"settings\" className=\"flex items-center gap-2\">\n                <UserIcon className=\"h-4 w-4\" />\n                Settings\n              </TabsTrigger>\n            </TabsList>\n\n            {/* Booking History */}\n            <TabsContent value=\"bookings\">\n              <div className=\"space-y-6\">\n                {/* Booking Summary */}\n                {userBookings.length > 0 && (\n                  <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                    <Card>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-5 w-5 text-blue-500\" />\n                          <div>\n                            <p className=\"text-sm text-gray-600\">Total Bookings</p>\n                            <p className=\"text-2xl font-bold\">{userBookings.length}</p>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                    <Card>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center gap-2\">\n                          <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                          <div>\n                            <p className=\"text-sm text-gray-600\">Confirmed</p>\n                            <p className=\"text-2xl font-bold\">{userBookings.filter(b => b.status === 'confirmed').length}</p>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                    <Card>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center gap-2\">\n                          <Clock className=\"h-5 w-5 text-yellow-500\" />\n                          <div>\n                            <p className=\"text-sm text-gray-600\">Pending</p>\n                            <p className=\"text-2xl font-bold\">{userBookings.filter(b => b.status === 'pending').length}</p>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                    <Card>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-purple-500 font-bold\">₹</span>\n                          <div>\n                            <p className=\"text-sm text-gray-600\">Total Spent</p>\n                            <p className=\"text-2xl font-bold\">\n                              ₹{userBookings.filter(b => b.status === 'confirmed').reduce((sum, b) => sum + (b.amount || 0), 0)}\n                            </p>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </div>\n                )}\n\n                {/* Bookings List */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Calendar className=\"h-5 w-5\" />\n                      Your Bookings\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {bookingsLoading ? (\n                      <div className=\"text-center py-8\">Loading bookings...</div>\n                    ) : userBookings.length === 0 ? (\n                      <div className=\"text-center py-8 text-gray-500\">\n                        <Calendar className=\"h-12 w-12 mx-auto mb-4 text-gray-300\" />\n                        <p>No bookings yet</p>\n                        <p className=\"text-sm\">Book your first photography session to see it here</p>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-4\">\n                        {userBookings.map((booking: Booking) => (\n                          <Card key={booking.id} className=\"border border-gray-200\">\n                            <CardContent className=\"p-6\">\n                              <div className=\"flex flex-col md:flex-row md:items-center gap-4\">\n                                <div className=\"flex-1\">\n                                  <div className=\"flex items-center gap-3 mb-2\">\n                                    <h3 className=\"font-semibold text-lg\">{booking.eventType}</h3>\n                                    <Badge className={`${getStatusColor(booking.status)} flex items-center gap-1`}>\n                                      {getStatusIcon(booking.status)}\n                                      {booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}\n                                    </Badge>\n                                  </div>\n                                  \n                                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600\">\n                                    <div className=\"flex items-center gap-2\">\n                                      <Calendar className=\"h-4 w-4\" />\n                                      <span>{format(new Date(booking.eventDate), 'MMMM d, yyyy')}</span>\n                                    </div>\n                                    <div className=\"flex items-center gap-2\">\n                                      <Clock className=\"h-4 w-4\" />\n                                      <span>{booking.eventTime}</span>\n                                    </div>\n                                    {booking.location && (\n                                      <div className=\"flex items-center gap-2\">\n                                        <MapPin className=\"h-4 w-4\" />\n                                        <span>{booking.location}</span>\n                                      </div>\n                                    )}\n                                    <div className=\"flex items-center gap-2\">\n                                      <span className=\"font-medium\">₹{booking.amount || 0}</span>\n                                    </div>\n                                  </div>\n                                  \n                                  {booking.message && (\n                                    <div className=\"mt-3 p-3 bg-gray-50 rounded-lg\">\n                                      <p className=\"text-sm text-gray-700\">{booking.message}</p>\n                                    </div>\n                                  )}\n                                </div>\n                              </div>\n                            </CardContent>\n                          </Card>\n                        ))}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            {/* Saved Photos */}\n            <TabsContent value=\"photos\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Camera className=\"h-5 w-5\" />\n                    Saved Photos\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {photosLoading ? (\n                    <div className=\"text-center py-8\">Loading photos...</div>\n                  ) : photos.length === 0 ? (\n                    <div className=\"text-center py-8 text-gray-500\">\n                      <Camera className=\"h-12 w-12 mx-auto mb-4 text-gray-300\" />\n                      <p>No saved photos yet</p>\n                      <p className=\"text-sm\">Use the \"FindMyFace\" feature to save photos from events to your profile</p>\n                    </div>\n                  ) : (\n                    <PaginatedPhotoGallery\n                      photos={photos}\n                      loading={photosLoading}\n                      onPhotoClick={setFullScreenImage}\n                      className=\"mt-4\"\n                      showSaveToProfile={false}\n                      savedPhotoIds={[]}\n                      photosPerPage={10}\n                    />\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Settings */}\n            <TabsContent value=\"settings\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <UserIcon className=\"h-5 w-5\" />\n                    Profile\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div>\n                    <h3 className=\"text-lg font-semibold mb-4\">Account Information</h3>\n                    <div className=\"space-y-4\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Display Name</label>\n                          <p className=\"text-gray-900\">{currentUser.displayName || 'Not set'}</p>\n                        </div>\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email</label>\n                          <p className=\"text-gray-900\">{currentUser.email}</p>\n                        </div>\n                      </div>\n                      \n                      <Separator />\n                      \n                      <div>\n                        <h4 className=\"text-md font-medium text-gray-800 mb-2\">Account Type</h4>\n                        <div className=\"flex items-center gap-2\">\n                          {userData?.isAdmin ? (\n                            <Badge variant=\"secondary\" className=\"bg-purple-100 text-purple-800 border-purple-200\">\n                              <UserIcon className=\"h-3 w-3 mr-1\" />\n                              Administrator\n                            </Badge>\n                          ) : (\n                            <Badge variant=\"outline\">\n                              <UserIcon className=\"h-3 w-3 mr-1\" />\n                              Standard User\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  <Separator />\n\n                  <div>\n                    <h3 className=\"text-lg font-semibold mb-4\">Preferences</h3>\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\">\n                        <div>\n                          <h4 className=\"font-medium\">Email Notifications</h4>\n                          <p className=\"text-sm text-gray-600\">Receive updates about your bookings</p>\n                        </div>\n                        <Button variant=\"outline\" size=\"sm\">Configure</Button>\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\">\n                        <div>\n                          <h4 className=\"font-medium\">Privacy Settings</h4>\n                          <p className=\"text-sm text-gray-600\">Manage your data and privacy preferences</p>\n                        </div>\n                        <Button variant=\"outline\" size=\"sm\">Manage</Button>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </main>\n      <Footer />\n\n      {/* Full Screen Image Viewer with Slideshow */}\n      {fullScreenImage && (\n        <div className=\"fixed inset-0 z-[60] bg-black\">\n          {/* Header with back button and download */}\n          <div className=\"absolute top-0 left-0 right-0 z-20 p-4 bg-gradient-to-b from-black/80 to-transparent pointer-events-auto\">\n            <div className=\"flex items-center justify-between text-white\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => {\n                  setFullScreenImage(null);\n                }}\n                className=\"text-white hover:bg-white/20 pointer-events-auto cursor-pointer\"\n              >\n                <X className=\"h-5 w-5 mr-2\" />\n                Close\n              </Button>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm opacity-75\">\n                  {currentPhotoIndex + 1} of {photos.length}\n                </span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={async () => {\n                    try {\n                      // Use original quality URL for downloads\n                      const originalUrl = getDownloadImageUrl(fullScreenImage.url);\n                      const response = await fetch(originalUrl);\n                      const blob = await response.blob();\n                      const url = window.URL.createObjectURL(blob);\n                      const link = document.createElement('a');\n                      link.href = url;\n                      link.download = fullScreenImage.filename || 'photo';\n                      document.body.appendChild(link);\n                      link.click();\n                      window.URL.revokeObjectURL(url);\n                      document.body.removeChild(link);\n                    } catch (error) {\n                      console.error('Error downloading photo:', error);\n                    }\n                  }}\n                  className=\"text-white hover:bg-white/20 pointer-events-auto cursor-pointer\"\n                >\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Download\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => {\n                    handleUnsavePhoto(fullScreenImage.id);\n                    setFullScreenImage(null);\n                  }}\n                  className=\"text-white hover:bg-red-500/80 pointer-events-auto cursor-pointer\"\n                >\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\n                  Remove\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Navigation Arrows */}\n          {photos.length > 1 && (\n            <>\n              {/* Previous Button */}\n              <Button\n                variant=\"ghost\"\n                size=\"lg\"\n                onClick={goToPreviousPhoto}\n                className=\"absolute left-4 top-1/2 transform -translate-y-1/2 z-20 text-white hover:bg-white/20 h-16 w-16 rounded-full pointer-events-auto\"\n              >\n                <ChevronLeft className=\"h-8 w-8\" />\n              </Button>\n\n              {/* Next Button */}\n              <Button\n                variant=\"ghost\"\n                size=\"lg\"\n                onClick={goToNextPhoto}\n                className=\"absolute right-4 top-1/2 transform -translate-y-1/2 z-20 text-white hover:bg-white/20 h-16 w-16 rounded-full pointer-events-auto\"\n              >\n                <ChevronRight className=\"h-8 w-8\" />\n              </Button>\n            </>\n          )}\n\n          {/* Optimized Image container with progressive loading */}\n          <div className=\"flex items-center justify-center h-full p-4 pt-20 pb-20\">\n            <div className=\"relative max-w-full max-h-full\">\n              {/* Loading skeleton */}\n              <div className=\"absolute inset-0 bg-gray-800/50 animate-pulse rounded-lg flex items-center justify-center\">\n                <div className=\"text-white text-sm\">Loading image...</div>\n              </div>\n              \n              <img\n                src={fullScreenImage.url.includes('/api/images/') \n                  ? `${fullScreenImage.url}?quality=65&thumbnail=false` \n                  : fullScreenImage.url\n                }\n                alt={fullScreenImage.filename || 'Photo'}\n                className=\"max-w-full max-h-full object-contain transition-all duration-500 opacity-0\"\n                style={{ maxHeight: 'calc(100vh - 160px)', maxWidth: 'calc(100vw - 32px)' }}\n                loading=\"eager\"\n                onLoad={(e) => {\n                  const target = e.target as HTMLImageElement;\n                  const skeleton = target.previousElementSibling as HTMLElement;\n                  target.style.opacity = '1';\n                  if (skeleton) skeleton.style.display = 'none';\n                }}\n                onError={(e) => {\n                  const target = e.target as HTMLImageElement;\n                  const skeleton = target.previousElementSibling as HTMLElement;\n                  target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjE1MCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5Y2EzYWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5Image not available</text></svg>';\n                  target.style.opacity = '1';\n                  if (skeleton) skeleton.style.display = 'none';\n                }}\n              />\n            </div>\n          </div>\n\n          {/* Navigation dots for small galleries */}\n          {photos.length > 1 && photos.length <= 10 && (\n            <div className=\"absolute bottom-8 left-1/2 transform -translate-x-1/2 flex gap-2\">\n              {photos.map((_, index) => (\n                <button\n                  key={index}\n                  onClick={() => {\n                    setCurrentPhotoIndex(index);\n                    setFullScreenImage(photos[index]);\n                  }}\n                  className={`w-3 h-3 rounded-full transition-colors ${\n                    index === currentPhotoIndex \n                      ? 'bg-white' \n                      : 'bg-white/50 hover:bg-white/70'\n                  }`}\n                />\n              ))}\n            </div>\n          )}\n\n          {/* Footer with instructions */}\n          <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white text-sm opacity-75 text-center\">\n            <p>Use arrow keys to navigate • ESC to close</p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Profile;","size_bytes":35857},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"import * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1405},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:size-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2701},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { DayPicker } from \"react-day-picker\";\n\nimport { cn } from \"@/lib/utils\";\nimport { buttonVariants } from \"@/components/ui/button\";\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>;\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ ..._props }) => <ChevronLeft className=\"h-4 w-4\" />,\n        IconRight: ({ ..._props }) => <ChevronRight className=\"h-4 w-4\" />,\n      }}\n      {...props}\n    />\n  );\n}\nCalendar.displayName = \"Calendar\";\n\nexport { Calendar };\n","size_bytes":2620},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1877},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([_, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item.dataKey || item.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10466},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"import * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":315},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\ninterface CommandDialogProps extends DialogProps {}\n\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4879},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7246},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3835},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3007},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7295},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  ControllerProps,\n  FieldPath,\n  FieldValues,\n  FormProvider,\n  useFormContext,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message) : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4085},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1184},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":7974},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5046},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1230},"client/src/components/ui/progress.tsx":{"content":"import * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-gray-200\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-gradient-to-r from-pink-500 to-orange-500 transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }","size_bytes":809},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"import { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1709},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"import * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5615},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"import * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\nimport * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n  VariantProps<typeof sheetVariants> { }\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet, SheetClose,\n  SheetContent, SheetDescription, SheetFooter, SheetHeader, SheetOverlay, SheetPortal, SheetTitle, SheetTrigger\n}\n\n","size_bytes":4250},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden md:block text-sidebar-foreground\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"rounded-md h-8 flex gap-2 px-2 items-center\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23367},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/sonner.tsx":{"content":"import { useTheme } from \"next-themes\"\nimport { Toaster as Sonner, toast } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster, toast }\n","size_bytes":894},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":772},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"import * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1739},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1435},"client/src/components/ui/tooltip.tsx":{"content":"import * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1145},"client/src/components/ui/use-toast.ts":{"content":"// Re-export from hooks to maintain compatibility\nexport { useToast, toast } from \"@/hooks/use-toast\";\n","size_bytes":103},"client/src/components/LazyImage.tsx":{"content":"import { useState, useRef, useEffect, useMemo } from 'react';\nimport { imagePreloader, PerformanceMonitor } from '@/utils/imagePreloader';\n\ninterface LazyImageProps {\n  src: string;\n  alt: string;\n  className?: string;\n  placeholder?: string;\n  onError?: () => void;\n  style?: React.CSSProperties;\n  loading?: 'lazy' | 'eager';\n  priority?: 'low' | 'medium' | 'high';\n  preload?: boolean;\n  aspectRatio?: number;\n}\n\nconst LazyImage = ({ \n  src, \n  alt, \n  className = '', \n  placeholder = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjE1MCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5Y2EzYWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5Mb2FkaW5nLi4uPC90ZXh0Pjwvc3ZnPg==',\n  onError,\n  style,\n  loading = 'lazy'\n}: LazyImageProps) => {\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [hasError, setHasError] = useState(false);\n  const [isInView, setIsInView] = useState(loading === 'eager');\n  const imgRef = useRef<HTMLImageElement>(null);\n\n  useEffect(() => {\n    if (loading === 'eager') return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          setIsInView(true);\n          observer.disconnect();\n        }\n      },\n      { \n        threshold: 0.1,\n        rootMargin: '50px'\n      }\n    );\n\n    if (imgRef.current) {\n      observer.observe(imgRef.current);\n    }\n\n    return () => observer.disconnect();\n  }, [loading]);\n\n  const handleLoad = () => {\n    setIsLoaded(true);\n    setHasError(false);\n  };\n\n  const handleError = () => {\n    setHasError(true);\n    setIsLoaded(false);\n    onError?.();\n  };\n\n  const errorFallback = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjE1MCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5Y2EzYWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSB1bmF2YWlsYWJsZTwvdGV4dD48L3N2Zz4=';\n\n  return (\n    <div className=\"relative\" ref={imgRef}>\n      {!isInView ? (\n        <img\n          src={placeholder}\n          alt=\"\"\n          className={className}\n          style={style}\n        />\n      ) : (\n        <>\n          {!isLoaded && !hasError && (\n            <img\n              src={placeholder}\n              alt=\"\"\n              className={`${className} absolute inset-0`}\n              style={style}\n            />\n          )}\n          <img\n            src={hasError ? errorFallback : src}\n            alt={alt}\n            className={`${className} ${isLoaded ? 'opacity-100' : 'opacity-0'} transition-opacity duration-300`}\n            style={style}\n            onLoad={handleLoad}\n            onError={handleError}\n            loading={loading}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default LazyImage;","size_bytes":3013},"client/src/hooks/useDebounce.tsx":{"content":"import { useState, useEffect } from 'react';\n\nexport function useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}","size_bytes":385},"client/src/components/OptimizedPhotoGallery.tsx":{"content":"import { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { Download, Eye, Loader2, Image as ImageIcon, Heart, HeartOff } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Photo } from '@shared/types';\nimport { imagePreloader, getOptimizedImageUrl, getDisplayImageUrl, getDownloadImageUrl, PerformanceMonitor } from '@/utils/imagePreloader';\nimport { useAuth } from '@/contexts/AuthContext';\nimport ProgressiveImage from './ProgressiveImage';\n\ninterface OptimizedPhotoGalleryProps {\n  photos: Photo[];\n  loading?: boolean;\n  onPhotoClick?: (photo: Photo) => void;\n  className?: string;\n  showSaveToProfile?: boolean;\n  savedPhotoIds?: string[];\n  onSavePhoto?: (photoId: string) => void;\n  onRemovePhoto?: (photoId: string) => void;\n  savingPhotoIds?: string[];\n}\n\ninterface PhotoWithLoading extends Photo {\n  loaded?: boolean;\n  error?: boolean;\n}\n\nconst OptimizedPhotoGallery = ({ \n  photos, \n  loading = false, \n  onPhotoClick, \n  className = \"\", \n  showSaveToProfile = false,\n  savedPhotoIds = [],\n  onSavePhoto,\n  onRemovePhoto,\n  savingPhotoIds = []\n}: OptimizedPhotoGalleryProps) => {\n  const [loadedPhotos, setLoadedPhotos] = useState<PhotoWithLoading[]>([]);\n  const [visibleRange, setVisibleRange] = useState({ start: 0, end: 8 }); // Further reduced initial load\n  const containerRef = useRef<HTMLDivElement>(null);\n  const observerRef = useRef<IntersectionObserver | null>(null);\n  const { currentUser } = useAuth();\n\n  // Initialize photos with loading states and smart preloading\n  useEffect(() => {\n    if (Array.isArray(photos)) {\n      setLoadedPhotos(photos.map(photo => ({ ...photo, loaded: false, error: false })));\n      \n      // Smart preload visible images with thumbnails\n      const imageSources = photos.map(photo => getDisplayImageUrl(photo.url || '', true));\n      imagePreloader.preloadWithConnectionAwareness(imageSources, 'high');\n      \n      // Optimize cache periodically\n      imagePreloader.optimizeCache(100);\n    } else {\n      setLoadedPhotos([]);\n    }\n  }, [photos]);\n\n  // Enhanced virtualized scrolling with performance optimization\n  const handleScroll = useCallback(() => {\n    if (!containerRef.current) return;\n    \n    const { scrollTop, scrollHeight, clientHeight } = containerRef.current;\n    const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\n    \n    // Load more photos when user scrolls to 80% of current content\n    if (scrollPercentage > 0.8 && Array.isArray(photos) && visibleRange.end < photos.length) {\n      const newEnd = Math.min(visibleRange.end + 6, photos.length); // Even smaller increments\n      setVisibleRange(prev => ({\n        ...prev,\n        end: newEnd\n      }));\n      \n      // Preload next batch of images as thumbnails\n      const nextBatch = photos.slice(visibleRange.end, newEnd);\n      const nextImageSources = nextBatch.map(photo => getDisplayImageUrl(photo.url || '', true));\n      imagePreloader.preloadBatch(nextImageSources, 5, 'medium');\n    }\n  }, [photos, visibleRange.end]);\n\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    // Use passive listener for better performance\n    const container = containerRef.current;\n    container.addEventListener('scroll', handleScroll, { passive: true });\n    \n    return () => container.removeEventListener('scroll', handleScroll);\n  }, [handleScroll]);\n\n  // Intersection observer for lazy loading\n  useEffect(() => {\n    observerRef.current = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            const photoId = entry.target.getAttribute('data-photo-id');\n            if (photoId) {\n              // Start loading the image\n              const img = entry.target.querySelector('img') as HTMLImageElement;\n              if (img && !img.src.startsWith('/api/images/')) {\n                img.src = img.dataset.src || '';\n              }\n            }\n          }\n        });\n      },\n      {\n        root: containerRef.current,\n        rootMargin: '50px',\n        threshold: 0.1\n      }\n    );\n\n    return () => {\n      observerRef.current?.disconnect();\n    };\n  }, []);\n\n  const handleImageLoad = (photoId: string) => {\n    setLoadedPhotos(prev => \n      prev.map(photo => \n        photo.id === photoId ? { ...photo, loaded: true } : photo\n      )\n    );\n  };\n\n  const handleImageError = (photoId: string) => {\n    setLoadedPhotos(prev => \n      prev.map(photo => \n        photo.id === photoId ? { ...photo, error: true } : photo\n      )\n    );\n  };\n\n  const visiblePhotos = useMemo(() => {\n    if (!Array.isArray(loadedPhotos)) {\n      return [];\n    }\n    return loadedPhotos.slice(visibleRange.start, visibleRange.end);\n  }, [loadedPhotos, visibleRange]);\n\n  // Performance monitoring\n  const renderStartTime = useRef<number>(0);\n  useEffect(() => {\n    renderStartTime.current = performance.now();\n    return () => {\n      const renderTime = performance.now() - renderStartTime.current;\n      if (renderTime > 16) { // Log if render takes longer than 1 frame\n        console.log(`Gallery render took ${renderTime.toFixed(2)}ms for ${visiblePhotos.length} photos`);\n      }\n    };\n  }, [visiblePhotos.length]);\n\n  if (loading) {\n    return (\n      <div className=\"flex flex-col items-center justify-center py-16 space-y-4\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-pink-500\" />\n        <span className=\"text-gray-600\">Loading photos...</span>\n      </div>\n    );\n  }\n\n  if (!Array.isArray(photos) || photos.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center py-16 space-y-4 text-gray-500\">\n        <ImageIcon className=\"h-16 w-16\" />\n        <p className=\"text-lg font-medium\">No photos available</p>\n        <p className=\"text-sm\">Photos will appear here once uploaded</p>\n      </div>\n    );\n  }\n\n  return (\n    <div \n      ref={containerRef}\n      className={`max-h-[70vh] overflow-y-auto ${className}`}\n    >\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 p-1\">\n        {visiblePhotos.map((photo) => (\n          <PhotoCard\n            key={photo.id}\n            photo={photo}\n            onLoad={() => handleImageLoad(photo.id)}\n            onError={() => handleImageError(photo.id)}\n            onPhotoClick={onPhotoClick}\n            observer={observerRef.current}\n            showSaveToProfile={showSaveToProfile}\n            savedPhotoIds={savedPhotoIds}\n            onSavePhoto={onSavePhoto}\n            onRemovePhoto={onRemovePhoto}\n            savingPhotoIds={savingPhotoIds}\n            currentUser={currentUser}\n          />\n        ))}\n      </div>\n      \n      {/* Loading more indicator */}\n      {visibleRange.end < photos.length && (\n        <div className=\"flex justify-center py-6\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-pink-500\" />\n          <span className=\"ml-2 text-gray-600\">Loading more photos...</span>\n        </div>\n      )}\n      \n      {/* Photos counter */}\n      <div className=\"text-center py-4 text-sm text-gray-500\">\n        Showing {visibleRange.end} of {photos.length} photos\n      </div>\n    </div>\n  );\n};\n\ninterface PhotoCardProps {\n  photo: PhotoWithLoading;\n  onLoad: () => void;\n  onError: () => void;\n  onPhotoClick?: (photo: Photo) => void;\n  observer: IntersectionObserver | null;\n  showSaveToProfile?: boolean;\n  savedPhotoIds?: string[];\n  onSavePhoto?: (photoId: string) => void;\n  onRemovePhoto?: (photoId: string) => void;\n  savingPhotoIds?: string[];\n  currentUser?: any;\n}\n\nconst PhotoCard = ({ \n  photo, \n  onLoad, \n  onError, \n  onPhotoClick, \n  observer, \n  showSaveToProfile = false, \n  savedPhotoIds = [], \n  onSavePhoto, \n  onRemovePhoto, \n  savingPhotoIds = [], \n  currentUser \n}: PhotoCardProps) => {\n  const cardRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (observer && cardRef.current) {\n      observer.observe(cardRef.current);\n    }\n    \n    return () => {\n      if (observer && cardRef.current) {\n        observer.unobserve(cardRef.current);\n      }\n    };\n  }, [observer]);\n\n  const handleDownload = async (e: React.MouseEvent) => {\n    e.stopPropagation();\n    try {\n      // Use original quality URL for downloads\n      const originalUrl = getDownloadImageUrl(photo.url);\n      const response = await fetch(originalUrl);\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = photo.filename;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n    } catch (error) {\n      console.error('Error downloading photo:', error);\n    }\n  };\n\n  const handleSaveToProfile = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (onSavePhoto) {\n      onSavePhoto(photo.id);\n    }\n  };\n\n  const handleRemoveFromProfile = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (onRemovePhoto) {\n      onRemovePhoto(photo.id);\n    }\n  };\n\n  const isPhotoSaved = savedPhotoIds.includes(photo.id);\n  const isPhotoSaving = savingPhotoIds.includes(photo.id);\n  const canShowSaveButton = showSaveToProfile && currentUser;\n\n  return (\n    <div\n      ref={cardRef}\n      data-photo-id={photo.id}\n      className=\"aspect-square relative group overflow-hidden rounded-lg bg-gray-100 cursor-pointer transform transition-all duration-200 hover:scale-105 hover:shadow-lg\"\n      onClick={() => onPhotoClick?.(photo)}\n    >\n      {/* Loading skeleton */}\n      {!photo.loaded && !photo.error && (\n        <div className=\"absolute inset-0 bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 animate-pulse\">\n          <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-40 animate-pulse\" \n               style={{ animationDuration: '2s' }} />\n        </div>\n      )}\n      \n      {/* Error state */}\n      {photo.error && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-gray-100\">\n          <ImageIcon className=\"h-8 w-8 text-gray-400\" />\n        </div>\n      )}\n      \n      {/* Progressive Image with optimized loading */}\n      <ProgressiveImage\n        src={photo.url}\n        alt={photo.filename || 'Photo'}\n        className=\"w-full h-full object-cover transition-all duration-300 group-hover:scale-110\"\n        priority={photo.loaded ? 'medium' : 'high'}\n        aspectRatio={1}\n        onLoad={onLoad}\n        onError={onError}\n        loading=\"lazy\"\n      />\n      \n      {/* Hover overlay */}\n      <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100\">\n        <div className=\"flex space-x-2\">\n          <Button\n            variant=\"secondary\"\n            size=\"sm\"\n            className=\"bg-white/90 hover:bg-white\"\n            onClick={(e) => {\n              e.stopPropagation();\n              onPhotoClick?.(photo);\n            }}\n          >\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"sm\"\n            className=\"bg-white/90 hover:bg-white\"\n            onClick={handleDownload}\n          >\n            <Download className=\"h-4 w-4\" />\n          </Button>\n          {canShowSaveButton && (\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              className={`bg-white/90 hover:bg-white ${isPhotoSaved ? 'text-red-500' : 'text-green-500'}`}\n              onClick={isPhotoSaved ? handleRemoveFromProfile : handleSaveToProfile}\n              disabled={isPhotoSaving}\n            >\n              {isPhotoSaving ? (\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n              ) : isPhotoSaved ? (\n                <HeartOff className=\"h-4 w-4\" />\n              ) : (\n                <Heart className=\"h-4 w-4\" />\n              )}\n            </Button>\n          )}\n        </div>\n      </div>\n      \n      {/* Loading indicator for individual photos */}\n      {!photo.loaded && !photo.error && (\n        <div className=\"absolute bottom-2 right-2 bg-black/50 rounded-full p-1\">\n          <Loader2 className=\"h-3 w-3 animate-spin text-white\" />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default OptimizedPhotoGallery;","size_bytes":12353},"client/src/components/AdminPhotoGallery.tsx":{"content":"import { useState, useEffect, useRef, useMemo } from 'react';\nimport { Download, Eye, Loader2, Image as ImageIcon, Camera, Trash2 } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Photo } from '@shared/types';\nimport { getDisplayImageUrl, getDownloadImageUrl } from '@/utils/imagePreloader';\nimport { DeleteConfirmation } from '@/components/ui/confirmation-alert';\n\ninterface AdminPhotoGalleryProps {\n  photos: Photo[];\n  loading?: boolean;\n  onPhotoClick?: (photo: Photo) => void;\n  onDeletePhoto?: (photoId: string) => void;\n  onSetAsThumbnail?: (photoUrl: string) => void;\n  currentThumbnailUrl?: string;\n  deletingPhotoId?: string | null;\n  uploadingThumbnail?: boolean;\n  className?: string;\n}\n\ninterface PhotoWithLoading extends Photo {\n  loaded?: boolean;\n  error?: boolean;\n}\n\nconst AdminPhotoGallery = ({ \n  photos, \n  loading = false, \n  onPhotoClick, \n  onDeletePhoto,\n  onSetAsThumbnail,\n  currentThumbnailUrl,\n  deletingPhotoId,\n  uploadingThumbnail,\n  className = \"\" \n}: AdminPhotoGalleryProps) => {\n  const [loadedPhotos, setLoadedPhotos] = useState<PhotoWithLoading[]>([]);\n  const [visibleRange, setVisibleRange] = useState({ start: 0, end: 20 });\n  const containerRef = useRef<HTMLDivElement>(null);\n  const observerRef = useRef<IntersectionObserver | null>(null);\n\n  // Initialize photos with loading states\n  useEffect(() => {\n    if (Array.isArray(photos)) {\n      setLoadedPhotos(photos.map(photo => ({ ...photo, loaded: false, error: false })));\n    } else {\n      setLoadedPhotos([]);\n    }\n  }, [photos]);\n\n  // Virtualized scrolling - load more photos as user scrolls\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const handleScroll = () => {\n      if (!containerRef.current) return;\n      \n      const { scrollTop, scrollHeight, clientHeight } = containerRef.current;\n      const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\n      \n      // Load more photos when user scrolls to 80% of current content\n      if (scrollPercentage > 0.8 && Array.isArray(photos) && visibleRange.end < photos.length) {\n        setVisibleRange(prev => ({\n          ...prev,\n          end: Math.min(prev.end + 20, photos.length)\n        }));\n      }\n    };\n\n    containerRef.current.addEventListener('scroll', handleScroll);\n    return () => containerRef.current?.removeEventListener('scroll', handleScroll);\n  }, [Array.isArray(photos) ? photos.length : 0, visibleRange.end]);\n\n  // Intersection observer for lazy loading\n  useEffect(() => {\n    observerRef.current = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            const photoId = entry.target.getAttribute('data-photo-id');\n            if (photoId) {\n              // Start loading the image\n              const img = entry.target.querySelector('img') as HTMLImageElement;\n              if (img && !img.src.startsWith('/api/images/')) {\n                img.src = img.dataset.src || '';\n              }\n            }\n          }\n        });\n      },\n      {\n        root: containerRef.current,\n        rootMargin: '100px', // Load images 100px before they come into view\n        threshold: 0.1\n      }\n    );\n\n    return () => {\n      observerRef.current?.disconnect();\n    };\n  }, []);\n\n  const handleImageLoad = (photoId: string) => {\n    setLoadedPhotos(prev => \n      prev.map(photo => \n        photo.id === photoId ? { ...photo, loaded: true } : photo\n      )\n    );\n  };\n\n  const handleImageError = (photoId: string) => {\n    setLoadedPhotos(prev => \n      prev.map(photo => \n        photo.id === photoId ? { ...photo, error: true } : photo\n      )\n    );\n  };\n\n  const visiblePhotos = useMemo(() => {\n    if (!Array.isArray(loadedPhotos)) {\n      return [];\n    }\n    return loadedPhotos.slice(visibleRange.start, visibleRange.end);\n  }, [loadedPhotos, visibleRange]);\n\n  if (loading) {\n    return (\n      <div className=\"flex flex-col items-center justify-center py-16 space-y-4\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-pink-500\" />\n        <span className=\"text-gray-600\">Loading photos...</span>\n      </div>\n    );\n  }\n\n  if (!Array.isArray(photos) || photos.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center py-16 space-y-4 text-gray-500\">\n        <ImageIcon className=\"h-16 w-16\" />\n        <p className=\"text-lg font-medium\">No photos uploaded</p>\n        <p className=\"text-sm\">Photos will appear here once they are uploaded to this event</p>\n      </div>\n    );\n  }\n\n  return (\n    <div \n      ref={containerRef}\n      className={`max-h-[60vh] overflow-y-auto ${className}`}\n    >\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-1\">\n        {visiblePhotos.map((photo) => (\n          <AdminPhotoCard\n            key={photo.id}\n            photo={photo}\n            onLoad={() => handleImageLoad(photo.id)}\n            onError={() => handleImageError(photo.id)}\n            onPhotoClick={onPhotoClick}\n            onDeletePhoto={onDeletePhoto}\n            onSetAsThumbnail={onSetAsThumbnail}\n            currentThumbnailUrl={currentThumbnailUrl}\n            deletingPhotoId={deletingPhotoId}\n            uploadingThumbnail={uploadingThumbnail}\n            observer={observerRef.current}\n          />\n        ))}\n      </div>\n      \n      {/* Loading more indicator */}\n      {Array.isArray(photos) && visibleRange.end < photos.length && (\n        <div className=\"flex justify-center py-6\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-pink-500\" />\n          <span className=\"ml-2 text-gray-600\">Loading more photos...</span>\n        </div>\n      )}\n      \n      {/* Photos counter */}\n      <div className=\"text-center py-4 text-sm text-gray-500\">\n        Showing {visibleRange.end} of {Array.isArray(photos) ? photos.length : 0} photos\n      </div>\n    </div>\n  );\n};\n\ninterface AdminPhotoCardProps {\n  photo: PhotoWithLoading;\n  onLoad: () => void;\n  onError: () => void;\n  onPhotoClick?: (photo: Photo) => void;\n  onDeletePhoto?: (photoId: string) => void;\n  onSetAsThumbnail?: (photoUrl: string) => void;\n  currentThumbnailUrl?: string;\n  deletingPhotoId?: string | null;\n  uploadingThumbnail?: boolean;\n  observer: IntersectionObserver | null;\n}\n\nconst AdminPhotoCard = ({ \n  photo, \n  onLoad, \n  onError, \n  onPhotoClick, \n  onDeletePhoto,\n  onSetAsThumbnail,\n  currentThumbnailUrl,\n  deletingPhotoId,\n  uploadingThumbnail,\n  observer \n}: AdminPhotoCardProps) => {\n  const cardRef = useRef<HTMLDivElement>(null);\n  const isThumbnail = currentThumbnailUrl === photo.url;\n\n  useEffect(() => {\n    if (observer && cardRef.current) {\n      observer.observe(cardRef.current);\n    }\n    \n    return () => {\n      if (observer && cardRef.current) {\n        observer.unobserve(cardRef.current);\n      }\n    };\n  }, [observer]);\n\n  const handleDownload = async (e: React.MouseEvent) => {\n    e.stopPropagation();\n    try {\n      // Use original quality URL for downloads\n      const originalUrl = getDownloadImageUrl(photo.url);\n      const response = await fetch(originalUrl);\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = photo.filename;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n    } catch (error) {\n      console.error('Error downloading photo:', error);\n    }\n  };\n\n  return (\n    <div\n      ref={cardRef}\n      data-photo-id={photo.id}\n      className={`aspect-square relative group overflow-hidden rounded-lg border bg-gray-100 cursor-pointer transform transition-all duration-200 hover:scale-105 hover:shadow-lg ${\n        isThumbnail ? 'ring-2 ring-green-500' : ''\n      }`}\n      onClick={() => onPhotoClick?.(photo)}\n    >\n      {/* Loading skeleton */}\n      {!photo.loaded && !photo.error && (\n        <div className=\"absolute inset-0 bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200\">\n          <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-40 animate-pulse\" \n               style={{ animationDuration: '2s' }} />\n        </div>\n      )}\n      \n      {/* Error state */}\n      {photo.error && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-gray-100\">\n          <ImageIcon className=\"h-8 w-8 text-gray-400\" />\n        </div>\n      )}\n      \n      {/* Thumbnail badge */}\n      {isThumbnail && (\n        <div className=\"absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full z-10\">\n          Thumbnail\n        </div>\n      )}\n      \n      {/* Image */}\n      <img\n        data-src={getDisplayImageUrl(photo.url, true)}\n        src={photo.loaded ? getDisplayImageUrl(photo.url, true) : undefined}\n        alt={photo.filename}\n        className={`w-full h-full object-cover transition-all duration-300 ${\n          photo.loaded ? 'opacity-100' : 'opacity-0'\n        } group-hover:scale-110`}\n        loading=\"lazy\"\n        onLoad={onLoad}\n        onError={onError}\n      />\n      \n      {/* Filename overlay */}\n      <div className=\"absolute bottom-0 left-0 right-0 bg-black/70 text-white text-xs p-2 truncate\">\n        {photo.filename}\n      </div>\n      \n      {/* Hover overlay with admin actions */}\n      <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100\">\n        <div className=\"flex flex-wrap gap-2 p-2\">\n          <Button\n            variant=\"secondary\"\n            size=\"sm\"\n            className=\"bg-white/90 hover:bg-white\"\n            onClick={(e) => {\n              e.stopPropagation();\n              onPhotoClick?.(photo);\n            }}\n            title=\"View full size\"\n          >\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"sm\"\n            className=\"bg-white/90 hover:bg-white\"\n            onClick={handleDownload}\n            title=\"Download photo\"\n          >\n            <Download className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"sm\"\n            className={`${isThumbnail ? \"bg-green-500 text-white\" : \"bg-white/90 hover:bg-white\"}`}\n            onClick={(e) => {\n              e.stopPropagation();\n              onSetAsThumbnail?.(photo.url);\n            }}\n            disabled={uploadingThumbnail || isThumbnail}\n            title={isThumbnail ? \"Current thumbnail\" : \"Set as thumbnail\"}\n          >\n            <Camera className=\"h-4 w-4\" />\n          </Button>\n          <DeleteConfirmation\n            itemName={photo.filename || `Photo ${photo.id.slice(-6)}`}\n            itemType=\"photo\"\n            onConfirm={() => onDeletePhoto?.(photo.id)}\n            disabled={deletingPhotoId === photo.id}\n            trigger={\n              <Button\n                variant=\"secondary\"\n                size=\"sm\"\n                className=\"bg-red-500/90 hover:bg-red-500 text-white\"\n                disabled={deletingPhotoId === photo.id}\n                title=\"Delete photo\"\n                onClick={(e) => e.stopPropagation()}\n              >\n                {deletingPhotoId === photo.id ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                ) : (\n                  <Trash2 className=\"h-4 w-4\" />\n                )}\n              </Button>\n            }\n          />\n        </div>\n      </div>\n      \n      {/* Loading indicator for individual photos */}\n      {!photo.loaded && !photo.error && (\n        <div className=\"absolute bottom-2 right-2 bg-black/50 rounded-full p-1\">\n          <Loader2 className=\"h-3 w-3 animate-spin text-white\" />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default AdminPhotoGallery;","size_bytes":11910},"client/src/utils/imagePreloader.ts":{"content":"class ImagePreloader {\n  private cache: Map<string, HTMLImageElement> = new Map();\n  private loadingPromises: Map<string, Promise<HTMLImageElement>> = new Map();\n  private loadingQueue: string[] = [];\n  private maxConcurrent: number = 6;\n  private currentLoading: number = 0;\n\n  preloadImage(src: string, priority: 'low' | 'medium' | 'high' = 'medium'): Promise<HTMLImageElement> {\n    // Return cached image if available\n    if (this.cache.has(src)) {\n      return Promise.resolve(this.cache.get(src)!);\n    }\n\n    // Return existing promise if already loading\n    if (this.loadingPromises.has(src)) {\n      return this.loadingPromises.get(src)!;\n    }\n\n    // Create new loading promise\n    const promise = new Promise<HTMLImageElement>((resolve, reject) => {\n      const loadImage = () => {\n        this.currentLoading++;\n        const img = new Image();\n        \n        const cleanup = () => {\n          this.currentLoading--;\n          this.loadingPromises.delete(src);\n          this.processQueue();\n        };\n        \n        img.onload = () => {\n          this.cache.set(src, img);\n          cleanup();\n          resolve(img);\n        };\n        \n        img.onerror = () => {\n          cleanup();\n          reject(new Error(`Failed to load image: ${src}`));\n        };\n        \n        // Set decode hint for better performance\n        img.decoding = 'async';\n        \n        // Add crossorigin for better caching\n        if (!src.startsWith('data:') && !src.startsWith('blob:')) {\n          img.crossOrigin = 'anonymous';\n        }\n        \n        img.src = src;\n      };\n\n      // If we're under the concurrent limit, load immediately\n      if (this.currentLoading < this.maxConcurrent) {\n        loadImage();\n      } else {\n        // Add to queue based on priority\n        if (priority === 'high') {\n          this.loadingQueue.unshift(src);\n        } else {\n          this.loadingQueue.push(src);\n        }\n        \n        // Store the loadImage function for later execution\n        this.loadingPromises.set(src, new Promise((res, rej) => {\n          (loadImage as any).resolve = res;\n          (loadImage as any).reject = rej;\n        }));\n      }\n    });\n\n    this.loadingPromises.set(src, promise);\n    return promise;\n  }\n\n  private processQueue(): void {\n    if (this.loadingQueue.length === 0 || this.currentLoading >= this.maxConcurrent) {\n      return;\n    }\n\n    const src = this.loadingQueue.shift();\n    if (src && this.loadingPromises.has(src)) {\n      const promise = this.loadingPromises.get(src)!;\n      // Execute the queued load\n      this.preloadImage(src);\n    }\n  }\n\n  preloadBatch(sources: string[], batchSize: number = 4, priority: 'low' | 'medium' | 'high' = 'medium'): Promise<HTMLImageElement[]> {\n    const batches: string[][] = [];\n    \n    // Split sources into batches\n    for (let i = 0; i < sources.length; i += batchSize) {\n      batches.push(sources.slice(i, i + batchSize));\n    }\n\n    // Process batches with intelligent scheduling\n    return batches.reduce(async (prevPromise, batch, batchIndex) => {\n      const results = await prevPromise;\n      \n      // Add delay between batches to prevent overwhelming\n      if (batchIndex > 0) {\n        await new Promise(resolve => setTimeout(resolve, 100));\n      }\n      \n      const batchResults = await Promise.allSettled(\n        batch.map(src => this.preloadImage(src, priority))\n      );\n      \n      const successResults = batchResults\n        .filter(result => result.status === 'fulfilled')\n        .map(result => (result as PromiseFulfilledResult<HTMLImageElement>).value);\n      \n      return [...results, ...successResults];\n    }, Promise.resolve([] as HTMLImageElement[]));\n  }\n\n  // Smart preloading based on viewport and user behavior\n  smartPreload(sources: string[], options: {\n    immediate?: number;\n    priority?: 'low' | 'medium' | 'high';\n    prefetchOnHover?: boolean;\n  } = {}): void {\n    const { immediate = 3, priority = 'medium', prefetchOnHover = true } = options;\n    \n    // Immediately preload first few images\n    const immediateImages = sources.slice(0, immediate);\n    immediateImages.forEach(src => this.preloadImage(src, 'high'));\n    \n    // Preload remaining images with lower priority\n    const remainingImages = sources.slice(immediate);\n    if (remainingImages.length > 0) {\n      // Use requestIdleCallback if available for non-critical preloading\n      if ('requestIdleCallback' in window) {\n        (window as any).requestIdleCallback(() => {\n          this.preloadBatch(remainingImages, 2, priority);\n        });\n      } else {\n        setTimeout(() => {\n          this.preloadBatch(remainingImages, 2, priority);\n        }, 1000);\n      }\n    }\n  }\n\n  clearCache(): void {\n    this.cache.clear();\n    this.loadingPromises.clear();\n    this.loadingQueue = [];\n  }\n\n  // Memory management for large galleries\n  optimizeCache(maxSize: number = 50): void {\n    if (this.cache.size <= maxSize) return;\n    \n    // Remove oldest entries (simple LRU)\n    const entries = Array.from(this.cache.entries());\n    const toRemove = entries.slice(0, entries.length - maxSize);\n    toRemove.forEach(([key]) => this.cache.delete(key));\n  }\n\n  // Get image format support info\n  static getFormatSupport(): { webp: boolean; avif: boolean } {\n    const canvas = document.createElement('canvas');\n    canvas.width = 1;\n    canvas.height = 1;\n    \n    return {\n      webp: canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0,\n      avif: canvas.toDataURL('image/avif').indexOf('data:image/avif') === 0\n    };\n  }\n\n  // Preload with connection awareness\n  preloadWithConnectionAwareness(sources: string[], priority: 'low' | 'medium' | 'high' = 'medium'): void {\n    const connection = (navigator as any).connection;\n    let strategy = 'normal';\n    \n    if (connection) {\n      if (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {\n        strategy = 'minimal';\n      } else if (connection.effectiveType === '3g') {\n        strategy = 'reduced';\n      }\n    }\n    \n    switch (strategy) {\n      case 'minimal':\n        // Only preload first 2 images on slow connections\n        sources.slice(0, 2).forEach(src => this.preloadImage(src, priority));\n        break;\n      case 'reduced':\n        // Preload first 5 images on 3G\n        sources.slice(0, 5).forEach(src => this.preloadImage(src, priority));\n        break;\n      default:\n        // Normal preloading with smaller batches\n        this.smartPreload(sources, { immediate: 3, priority });\n    }\n  }\n\n  getCacheSize(): number {\n    return this.cache.size;\n  }\n\n  isImageCached(src: string): boolean {\n    return this.cache.has(src);\n  }\n}\n\n// Create singleton instance\nexport const imagePreloader = new ImagePreloader();\n\n// Utility function for image optimization\nexport const getOptimizedImageUrl = (originalUrl: string, options: {\n  thumbnail?: boolean;\n  quality?: number;\n  format?: 'webp' | 'avif' | 'original';\n  download?: boolean;\n} = {}) => {\n  const { thumbnail = false, quality = 85, format = 'original', download = false } = options;\n  \n  const url = new URL(originalUrl, window.location.origin);\n  \n  if (thumbnail) {\n    url.searchParams.set('thumbnail', 'true');\n  }\n  \n  if (download) {\n    url.searchParams.set('download', 'true');\n  }\n  \n  if (quality !== 85) {\n    url.searchParams.set('quality', quality.toString());\n  }\n  \n  if (format !== 'original') {\n    url.searchParams.set('format', format);\n  }\n  \n  return url.toString();\n};\n\n// Generate display URL (compressed for viewing)\nexport const getDisplayImageUrl = (originalUrl: string, thumbnail: boolean = true) => {\n  // For GridFS images, don't double-process URLs\n  if (originalUrl.startsWith('/api/images/')) {\n    return originalUrl;\n  }\n  return getOptimizedImageUrl(originalUrl, {\n    thumbnail: true, // Always use thumbnail for gallery previews\n    quality: 65, // Lower quality for faster loading\n    download: false\n  });\n};\n\n// Generate download URL (original quality)\nexport const getDownloadImageUrl = (originalUrl: string) => {\n  return getOptimizedImageUrl(originalUrl, {\n    download: true\n  });\n};\n\n// Performance monitoring utility\nexport class PerformanceMonitor {\n  private static metrics: Map<string, number[]> = new Map();\n\n  static startTiming(key: string): () => void {\n    const startTime = performance.now();\n    \n    return () => {\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n      \n      if (!this.metrics.has(key)) {\n        this.metrics.set(key, []);\n      }\n      \n      this.metrics.get(key)!.push(duration);\n    };\n  }\n\n  static getAverageTime(key: string): number {\n    const times = this.metrics.get(key) || [];\n    if (times.length === 0) return 0;\n    \n    return times.reduce((sum, time) => sum + time, 0) / times.length;\n  }\n\n  static getMetrics(): Record<string, { average: number, count: number, min: number, max: number }> {\n    const result: Record<string, { average: number, count: number, min: number, max: number }> = {};\n    \n    Array.from(this.metrics.entries()).forEach(([key, times]) => {\n      if (times.length > 0) {\n        result[key] = {\n          average: times.reduce((sum: number, time: number) => sum + time, 0) / times.length,\n          count: times.length,\n          min: Math.min(...times),\n          max: Math.max(...times)\n        };\n      }\n    });\n    \n    return result;\n  }\n\n  static clearMetrics(): void {\n    this.metrics.clear();\n  }\n}","size_bytes":9446},"CHECKPOINT.md":{"content":"\n# Project Checkpoint - PinMyPic Application\n\n**Date:** July 18, 2025  \n**Status:** Fully Functional Photo Management & Face Recognition Platform\n\n## Current Project Overview\n\nPinMyPic is a comprehensive photo management platform with AI-powered face recognition capabilities, built with React/TypeScript frontend and Node.js/Express backend with Python Flask microservice for face recognition.\n\n## ✅ Completed Features\n\n### Core Application Architecture\n- **Frontend:** React + TypeScript + Vite + Tailwind CSS\n- **Backend:** Node.js + Express + TypeScript\n- **Face Recognition Service:** Python Flask + InsightFace + ONNX\n- **Database:** Firebase Realtime Database\n- **Authentication:** Firebase Auth\n- **File Storage:** Firebase Storage\n\n### 🎯 Main Features Implemented\n\n#### 1. **User Authentication & Management**\n- Firebase authentication integration\n- User profile management\n- Admin role system with granular permissions\n- Protected routes and middleware\n\n#### 2. **Event Management System**\n- Create, edit, delete events\n- Event categories (wedding, portrait, corporate, etc.)\n- Event status tracking\n- Bride/Groom PIN system for access control\n- Admin dashboard for event oversight\n\n#### 3. **Photo Gallery & Management**\n- Optimized photo gallery with lazy loading\n- Photo upload with drag-and-drop\n- Batch photo operations\n- Photo download functionality\n- Image optimization and caching\n\n#### 4. **AI Face Recognition System** ⭐\n- **InsightFace Model Integration:** Buffalo_L model with high accuracy\n- **Face Detection & Embedding:** Real-time face processing\n- **Find My Face Feature:** Upload selfie to find matching photos\n- **Automatic Model Management:** Downloads models on first run\n- **CPU/GPU Support:** Optimized for both environments\n\n#### 5. **Save to Profile System** 📸\n- Users can save photos to personal profiles\n- Heart icon interface (filled/unfilled states)\n- Photo ID reference system (no duplication)\n- Saved photos management API\n- Profile page with saved photos gallery\n\n#### 6. **Booking & Package Management**\n- Photography package creation\n- Booking system with status tracking\n- Payment integration ready\n- Package categorization\n\n#### 7. **Admin Dashboard**\n- Comprehensive admin interface\n- User management with role assignment\n- Analytics and reporting\n- Bulk operations\n- Real-time data synchronization\n\n## 🔧 Technical Implementation Details\n\n### Face Recognition Workflow\n1. **Model Download:** Automatic InsightFace buffalo_l model download\n2. **Image Processing:** Face detection and embedding extraction\n3. **Similarity Matching:** Cosine similarity comparison\n4. **Result Filtering:** Configurable threshold-based matching\n\n### API Endpoints\n- `/api/face-recognition/find-my-face` - Face matching service\n- `/api/user/save-photo` - Save photo to profile\n- `/api/user/remove-photo` - Remove photo from profile\n- `/api/user/saved-photos` - Get user's saved photos\n- `/api/events/*` - Event management\n- `/api/admin/*` - Admin operations\n\n### Database Schema\n- **Users:** Profile data, admin permissions, saved photos\n- **Events:** Event details, photos, access controls\n- **Bookings:** Service bookings and status\n- **Packages:** Photography service packages\n\n## 🚀 Deployment Configuration\n\n### Current Setup\n- **Development Port:** 5000 (frontend) + 5001 (face service)\n- **Production Build:** `npm run build`\n- **Face Service:** Python Flask on port 5001\n- **Model Storage:** `/home/runner/.insightface/models/`\n\n### Environment Variables\n- Firebase configuration\n- Admin credentials\n- Service account keys\n- API endpoints\n\n## 📁 Key File Structure\n\n```\n├── client/src/\n│   ├── components/\n│   │   ├── OptimizedPhotoGallery.tsx (Photo display & save features)\n│   │   ├── FindMyFaceSection.tsx (Face recognition UI)\n│   │   └── AdminDashboard.tsx (Admin interface)\n│   ├── pages/\n│   │   ├── Events.tsx (Face recognition & photo management)\n│   │   └── Profile.tsx (Saved photos display)\n├── server/\n│   ├── face-recognition/ (Python Flask service)\n│   ├── routes.ts (API endpoints)\n│   └── storage.ts (Database operations)\n```\n\n## 🎨 UI/UX Features\n- **Responsive Design:** Mobile-first approach\n- **Modern UI:** Shadcn/ui components\n- **Interactive Elements:** Hover effects, loading states\n- **Toast Notifications:** User feedback system\n- **Gradient Themes:** Pink/orange/yellow/cyan color scheme\n\n## 🔒 Security Features\n- Firebase token authentication\n- Admin permission validation\n- Secure file upload handling\n- Environment variable protection\n\n## 📊 Performance Optimizations\n- **Image Lazy Loading:** Optimized gallery performance\n- **Model Caching:** Face recognition models cached locally\n- **API Response Caching:** Reduced database calls\n- **Parallel Processing:** Concurrent face recognition tasks\n\n## 🐛 Current Status & Monitoring\n- **Application Status:** Fully operational\n- **Face Recognition Service:** Running on CPU with buffalo_l model\n- **User Sync:** Real-time Firebase synchronization active\n- **Admin Features:** All permissions and management tools functional\n\n## 🎯 Next Steps (Future Enhancements)\n- GPU acceleration for face recognition\n- Batch face processing for large galleries\n- Advanced search filters\n- Mobile app development\n- Enhanced analytics dashboard\n\n---\n\n**Checkpoint Created:** This represents a fully functional photo management platform with AI face recognition, user authentication, admin management, and comprehensive photo organization features. All core systems are operational and tested.\n","size_bytes":5621},"build.sh":{"content":"#!/bin/bash\n# Build script for Render deployment\n\necho \"Starting build process...\"\n\n# Install Python dependencies\necho \"Installing Python dependencies...\"\nif [ -f \"server/face-recognition/requirements.txt\" ]; then\n    pip install -r server/face-recognition/requirements.txt\n    echo \"Python dependencies installed successfully\"\nelse\n    echo \"No requirements.txt found, skipping Python dependencies\"\nfi\n\n# Download face recognition models\necho \"Downloading face recognition models...\"\nif [ -f \"server/face-recognition/download_models.py\" ]; then\n    cd server/face-recognition\n    python download_models.py\n    cd ../..\n    echo \"Models downloaded successfully\"\nelse\n    echo \"No download_models.py found, skipping model download\"\nfi\n\n# Install Node.js dependencies\necho \"Installing Node.js dependencies...\"\nnpm install\n\n# Build the client\necho \"Building client...\"\nnpm run build\n\necho \"Build process completed successfully!\"","size_bytes":925},"install-python-deps.sh":{"content":"#!/bin/bash\n# Install Python dependencies for face recognition service\n\necho \"Installing Python dependencies for face recognition...\"\n\n# Check if Python is available\nif ! command -v python3 &> /dev/null; then\n    echo \"Python3 not found. Please install Python3 first.\"\n    exit 1\nfi\n\n# Check if pip is available\nif ! command -v pip3 &> /dev/null; then\n    echo \"pip3 not found. Please install pip3 first.\"\n    exit 1\nfi\n\n# Install dependencies from requirements.txt\nif [ -f \"server/face-recognition/requirements.txt\" ]; then\n    echo \"Installing Python packages from requirements.txt...\"\n    pip3 install -r server/face-recognition/requirements.txt\n    echo \"Python dependencies installed successfully!\"\nelse\n    echo \"Error: server/face-recognition/requirements.txt not found\"\n    exit 1\nfi\n\n# Download face recognition models\necho \"Downloading face recognition models...\"\ncd server/face-recognition\npython3 download_models.py\ncd ../..\n\necho \"Installation completed successfully!\"","size_bytes":981},"server/db.ts":{"content":"// PostgreSQL database removed - using Firebase Realtime Database instead\n// This file is kept for compatibility but no longer used\n","size_bytes":132},"server/face-recognition/download_models.py":{"content":"\"\"\"\nModel download script for face recognition models.\nDownloads InsightFace models before server starts.\n\"\"\"\n\nimport os\nimport sys\nimport logging\nfrom config import ARCFACE_MODEL_NAME\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\ndef download_models():\n    \"\"\"Download and cache face recognition models.\"\"\"\n    try:\n        import insightface\n        \n        logger.info(f\"Downloading {ARCFACE_MODEL_NAME} model...\")\n        \n        # Create a temporary face analysis app to trigger model download\n        app = insightface.app.FaceAnalysis(\n            name=ARCFACE_MODEL_NAME,\n            providers=['CPUExecutionProvider']  # Use CPU for model download\n        )\n        \n        # This will download the model if not already cached\n        app.prepare(ctx_id=-1, det_size=(640, 640))\n        \n        logger.info(f\"Successfully downloaded {ARCFACE_MODEL_NAME} model\")\n        return True\n        \n    except Exception as e:\n        logger.error(f\"Failed to download models: {str(e)}\")\n        return False\n\ndef main():\n    \"\"\"Main function to download models.\"\"\"\n    logger.info(\"Starting model download process...\")\n    \n    if download_models():\n        logger.info(\"Model download completed successfully\")\n        sys.exit(0)\n    else:\n        logger.error(\"Model download failed\")\n        sys.exit(1)\n\nif __name__ == \"__main__\":\n    main()","size_bytes":1403},"client/src/components/AdminStatusNotification.tsx":{"content":"import React, { useEffect, useRef } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useToast } from '@/hooks/use-toast';\nimport { hasAdminDashboardAccess, getAdminRoleDisplayName } from '@/utils/adminUtils';\n\nexport function AdminStatusNotification() {\n  const { userData } = useAuth();\n  const { toast } = useToast();\n  const previousStatusRef = useRef<{ isAdmin: boolean; adminRole?: string } | null>(null);\n  const initializedRef = useRef(false);\n\n  useEffect(() => {\n    if (!userData || !initializedRef.current) {\n      // Store initial state\n      if (userData && !initializedRef.current) {\n        previousStatusRef.current = {\n          isAdmin: userData.isAdmin || false,\n          adminRole: userData.adminRole\n        };\n        initializedRef.current = true;\n      }\n      return;\n    }\n\n    const currentStatus = {\n      isAdmin: userData.isAdmin || false,\n      adminRole: userData.adminRole\n    };\n\n    const previousStatus = previousStatusRef.current;\n\n    // Check if admin status changed\n    if (previousStatus && (\n      previousStatus.isAdmin !== currentStatus.isAdmin ||\n      previousStatus.adminRole !== currentStatus.adminRole\n    )) {\n      \n      // User was promoted to admin\n      if (!previousStatus.isAdmin && currentStatus.isAdmin) {\n        const roleName = getAdminRoleDisplayName(currentStatus.adminRole);\n        toast({\n          title: \"Admin Access Granted\",\n          description: `You have been promoted to ${roleName}. Refreshing your session to enable admin features...`,\n          duration: 8000,\n        });\n        \n        // Refresh the page to update authentication context\n        setTimeout(() => {\n          window.location.reload();\n        }, 2000);\n      }\n      \n      // User was demoted from admin\n      else if (previousStatus.isAdmin && !currentStatus.isAdmin) {\n        toast({\n          title: \"Admin Access Removed\",\n          description: \"Your admin privileges have been removed. You will be redirected to the home page.\",\n          variant: \"destructive\",\n          duration: 8000,\n        });\n        \n        // Redirect to home page after a short delay\n        setTimeout(() => {\n          window.location.href = '/';\n        }, 3000);\n      }\n      \n      // Admin role changed\n      else if (previousStatus.isAdmin && currentStatus.isAdmin && \n               previousStatus.adminRole !== currentStatus.adminRole) {\n        const newRoleName = getAdminRoleDisplayName(currentStatus.adminRole);\n        toast({\n          title: \"Admin Role Updated\",\n          description: `Your admin role has been updated to ${newRoleName}.`,\n          duration: 6000,\n        });\n      }\n    }\n\n    // Update previous status\n    previousStatusRef.current = currentStatus;\n  }, [userData, toast]);\n\n  // This component doesn't render anything\n  return null;\n}","size_bytes":2837},"client/src/components/AdminUsersManagement.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Shield, Users, UserCheck, UserX, Edit3, Trash2, Plus, Mail, Calendar, Activity, Crown } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from '@/contexts/AuthContext';\nimport type { User } from '@shared/types';\n\ninterface AdminUsersManagementProps {\n  currentUser: User;\n}\n\nexport function AdminUsersManagement({ currentUser }: AdminUsersManagementProps) {\n  const [users, setUsers] = useState<User[]>([]);\n  const [adminUsers, setAdminUsers] = useState<User[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [promoteDialogOpen, setPromoteDialogOpen] = useState(false);\n  const { toast } = useToast();\n  const { currentUser: firebaseUser, refreshUserData } = useAuth();\n\n  const isOwner = currentUser.adminRole === 'owner';\n  const isAdmin = currentUser.isAdmin && (currentUser.adminRole === 'owner' || currentUser.adminRole === 'admin');\n\n  useEffect(() => {\n    fetchUsers();\n    fetchAdminUsers();\n  }, []);\n\n  const getAuthHeaders = async (): Promise<Record<string, string>> => {\n    if (!firebaseUser) return {};\n    try {\n      const token = await firebaseUser.getIdToken();\n      return {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      };\n    } catch (error) {\n      console.error('Error getting auth token:', error);\n      return {};\n    }\n  };\n\n  const fetchUsers = async () => {\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch('/api/admin/users', { headers });\n      if (response.ok) {\n        const data = await response.json();\n        setUsers(data);\n      } else {\n        console.error('Failed to fetch users:', response.status);\n        toast({\n          variant: \"destructive\",\n          title: \"Error\",\n          description: \"Failed to fetch users. Please check your permissions.\",\n        });\n      }\n    } catch (error) {\n      console.error('Error fetching users:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to fetch users\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchAdminUsers = async () => {\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch('/api/admin/users/admins', { headers });\n      if (response.ok) {\n        const data = await response.json();\n        setAdminUsers(data);\n      } else {\n        console.error('Failed to fetch admin users:', response.status);\n      }\n    } catch (error) {\n      console.error('Error fetching admin users:', error);\n    }\n  };\n\n  const handlePromoteUser = async (userId: string, adminRole: 'admin' | 'moderator') => {\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`/api/admin/users/${userId}/promote`, {\n        method: 'PATCH',\n        headers,\n        body: JSON.stringify({ \n          isAdmin: true, \n          adminRole,\n          adminPermissions: getDefaultPermissions(adminRole)\n        }),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: `User promoted to ${adminRole} successfully`,\n        });\n        fetchUsers();\n        fetchAdminUsers();\n        setPromoteDialogOpen(false);\n        \n        // Always refresh user data to update authentication context\n        await refreshUserData();\n      } else {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to promote user');\n      }\n    } catch (error) {\n      console.error('Error promoting user:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: (error as Error)?.message || \"Failed to promote user\",\n      });\n    }\n  };\n\n  const handleDemoteUser = async (userId: string) => {\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`/api/admin/users/${userId}/promote`, {\n        method: 'PATCH',\n        headers,\n        body: JSON.stringify({ \n          isAdmin: false, \n          adminRole: undefined,\n          adminPermissions: []\n        }),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: \"User demoted successfully\",\n        });\n        fetchUsers();\n        fetchAdminUsers();\n        \n        // Always refresh user data to update authentication context\n        await refreshUserData();\n      } else {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to demote user');\n      }\n    } catch (error) {\n      console.error('Error demoting user:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: (error as Error)?.message || \"Failed to demote user\",\n      });\n    }\n  };\n\n  const handleDeactivateUser = async (userId: string) => {\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`/api/admin/users/${userId}/deactivate`, {\n        method: 'PATCH',\n        headers,\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: \"User deactivated successfully\",\n        });\n        fetchUsers();\n        fetchAdminUsers();\n      } else {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to deactivate user');\n      }\n    } catch (error) {\n      console.error('Error deactivating user:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: (error as Error)?.message || \"Failed to deactivate user\",\n      });\n    }\n  };\n\n  const getDefaultPermissions = (role: 'admin' | 'moderator'): string[] => {\n    if (role === 'admin') {\n      return ['events', 'bookings', 'packages', 'photos', 'contacts', 'users_view'];\n    } else if (role === 'moderator') {\n      return ['events', 'bookings', 'photos', 'contacts'];\n    }\n    return [];\n  };\n\n  const getRoleBadgeColor = (role?: string) => {\n    switch (role) {\n      case 'owner': return 'bg-purple-500';\n      case 'admin': return 'bg-blue-500';\n      case 'moderator': return 'bg-green-500';\n      default: return 'bg-gray-500';\n    }\n  };\n\n  const filteredUsers = users.filter(user => \n    user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    user.displayName?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const filteredAdminUsers = adminUsers.filter(user => \n    user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    user.displayName?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  if (loading) {\n    return <div className=\"p-8 text-center\">Loading users...</div>;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            User Management\n          </CardTitle>\n          <CardDescription>\n            Manage user accounts and admin privileges\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"mb-4\">\n            <Input\n              placeholder=\"Search users...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"max-w-sm\"\n            />\n          </div>\n\n          <Tabs defaultValue=\"all-users\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"all-users\">All Users ({users.length})</TabsTrigger>\n              <TabsTrigger value=\"admin-users\">Admin Users ({adminUsers.length})</TabsTrigger>\n            </TabsList>\n            \n            <TabsContent value=\"all-users\" className=\"space-y-4\">\n              <div className=\"rounded-md border\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>User</TableHead>\n                      <TableHead>Email</TableHead>\n                      <TableHead>Role</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Joined</TableHead>\n                      {isOwner && <TableHead>Actions</TableHead>}\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredUsers.map((user) => (\n                      <TableRow key={user.id}>\n                        <TableCell className=\"font-medium\">\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white text-sm\">\n                              {user.displayName?.[0] || user.email[0].toUpperCase()}\n                            </div>\n                            <div>\n                              <div>{user.displayName || 'No Name'}</div>\n                              <div className=\"text-xs text-gray-500\">{user.id}</div>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>{user.email}</TableCell>\n                        <TableCell>\n                          {user.isAdmin ? (\n                            <Badge className={getRoleBadgeColor(user.adminRole)}>\n                              <Shield className=\"w-3 h-3 mr-1\" />\n                              {user.adminRole || 'admin'}\n                            </Badge>\n                          ) : (\n                            <Badge variant=\"secondary\">User</Badge>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          {user.isActive !== false ? (\n                            <Badge variant=\"outline\" className=\"text-green-600 border-green-600\">\n                              <Activity className=\"w-3 h-3 mr-1\" />\n                              Active\n                            </Badge>\n                          ) : (\n                            <Badge variant=\"outline\" className=\"text-red-600 border-red-600\">\n                              <UserX className=\"w-3 h-3 mr-1\" />\n                              Inactive\n                            </Badge>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-1 text-sm text-gray-500\">\n                            <Calendar className=\"w-3 h-3\" />\n                            {new Date(user.createdAt).toLocaleDateString()}\n                          </div>\n                        </TableCell>\n                        {isOwner && (\n                          <TableCell>\n                            <div className=\"flex gap-2\">\n                              {/* Show owner badge for owner account */}\n                              {user.email === 'dond2674@gmail.com' ? (\n                                <Badge className=\"bg-purple-500 text-white\">\n                                  <Crown className=\"w-3 h-3 mr-1\" />\n                                  Owner (Protected)\n                                </Badge>\n                              ) : (\n                                <>\n                                  {!user.isAdmin && user.email !== currentUser.email && (\n                                    <Dialog open={promoteDialogOpen} onOpenChange={setPromoteDialogOpen}>\n                                      <DialogTrigger asChild>\n                                        <Button\n                                          variant=\"outline\"\n                                          size=\"sm\"\n                                          onClick={() => setSelectedUser(user)}\n                                        >\n                                          <UserCheck className=\"w-4 h-4 mr-1\" />\n                                          Promote\n                                        </Button>\n                                      </DialogTrigger>\n                                      <DialogContent>\n                                        <DialogHeader>\n                                          <DialogTitle>Promote User</DialogTitle>\n                                          <DialogDescription>\n                                            Select the admin role for {selectedUser?.email}\n                                          </DialogDescription>\n                                        </DialogHeader>\n                                        <div className=\"space-y-4\">\n                                          <div className=\"grid grid-cols-2 gap-4\">\n                                            <Button\n                                              onClick={() => selectedUser && handlePromoteUser(selectedUser.id, 'admin')}\n                                              className=\"flex flex-col items-center gap-2 h-20\"\n                                            >\n                                              <Shield className=\"w-6 h-6\" />\n                                              <span>Admin</span>\n                                            </Button>\n                                            <Button\n                                              variant=\"outline\"\n                                              onClick={() => selectedUser && handlePromoteUser(selectedUser.id, 'moderator')}\n                                              className=\"flex flex-col items-center gap-2 h-20\"\n                                            >\n                                              <UserCheck className=\"w-6 h-6\" />\n                                              <span>Moderator</span>\n                                            </Button>\n                                          </div>\n                                        </div>\n                                      </DialogContent>\n                                    </Dialog>\n                                  )}\n                                  {user.isAdmin && user.adminRole !== 'owner' && (\n                                    <Button\n                                      variant=\"outline\"\n                                      size=\"sm\"\n                                      onClick={() => handleDemoteUser(user.id)}\n                                      className=\"text-orange-600 border-orange-600 hover:bg-orange-50\"\n                                    >\n                                      <UserX className=\"w-4 h-4 mr-1\" />\n                                      Demote\n                                    </Button>\n                                  )}\n                                  {user.isActive !== false && user.email !== currentUser.email && (\n                                    <Button\n                                      variant=\"outline\"\n                                      size=\"sm\"\n                                      onClick={() => handleDeactivateUser(user.id)}\n                                      className=\"text-red-600 border-red-600 hover:bg-red-50\"\n                                    >\n                                      <UserX className=\"w-4 h-4 mr-1\" />\n                                      Deactivate\n                                    </Button>\n                                  )}\n                                </>\n                              )}\n                            </div>\n                          </TableCell>\n                        )}\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"admin-users\" className=\"space-y-4\">\n              <div className=\"rounded-md border\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>User</TableHead>\n                      <TableHead>Email</TableHead>\n                      <TableHead>Role</TableHead>\n                      <TableHead>Permissions</TableHead>\n                      <TableHead>Since</TableHead>\n                      {isOwner && <TableHead>Actions</TableHead>}\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredAdminUsers.map((user) => (\n                      <TableRow key={user.id}>\n                        <TableCell className=\"font-medium\">\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white text-sm\">\n                              {user.displayName?.[0] || user.email[0].toUpperCase()}\n                            </div>\n                            <div>\n                              <div>{user.displayName || 'No Name'}</div>\n                              <div className=\"text-xs text-gray-500\">{user.id}</div>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>{user.email}</TableCell>\n                        <TableCell>\n                          <Badge className={getRoleBadgeColor(user.adminRole)}>\n                            <Shield className=\"w-3 h-3 mr-1\" />\n                            {user.adminRole || 'admin'}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex flex-wrap gap-1\">\n                            {user.adminPermissions?.map((permission) => (\n                              <Badge key={permission} variant=\"secondary\" className=\"text-xs\">\n                                {permission}\n                              </Badge>\n                            ))}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-1 text-sm text-gray-500\">\n                            <Calendar className=\"w-3 h-3\" />\n                            {new Date(user.createdAt).toLocaleDateString()}\n                          </div>\n                        </TableCell>\n                        {isOwner && (\n                          <TableCell>\n                            <div className=\"flex gap-2\">\n                              {user.adminRole !== 'owner' && (\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => handleDemoteUser(user.id)}\n                                  className=\"text-orange-600 border-orange-600 hover:bg-orange-50\"\n                                >\n                                  <UserX className=\"w-4 h-4 mr-1\" />\n                                  Demote\n                                </Button>\n                              )}\n                            </div>\n                          </TableCell>\n                        )}\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":20199},"client/src/utils/adminUtils.ts":{"content":"import { User } from '@shared/types';\n\nexport const hasAdminDashboardAccess = (user: User | null): boolean => {\n  if (!user) return false;\n  \n  // Special check for owner email as fallback\n  if (user.email === 'dond2674@gmail.com') {\n    return true;\n  }\n  \n  // Check if user has admin privileges\n  return user.isAdmin === true && (\n    user.adminRole === 'owner' || \n    user.adminRole === 'admin' || \n    user.adminRole === 'moderator' ||\n    user.adminRole === 'qr_share'\n  );\n};\n\nexport const getAdminRoleDisplayName = (adminRole?: string): string => {\n  switch (adminRole) {\n    case 'owner':\n      return 'Owner';\n    case 'admin':\n      return 'Administrator';\n    case 'moderator':\n      return 'Moderator';\n    case 'qr_share':\n      return 'QR Share';\n    default:\n      return 'User';\n  }\n};\n\nexport const getAdminPermissions = (adminRole?: string): string[] => {\n  switch (adminRole) {\n    case 'owner':\n      return ['events', 'bookings', 'packages', 'photos', 'contacts', 'users', 'users_manage', 'qr_codes', 'storage'];\n    case 'admin':\n      return ['events', 'bookings', 'packages', 'photos', 'contacts', 'users_view', 'qr_codes', 'storage'];\n    case 'moderator':\n      return ['events', 'bookings', 'photos', 'contacts'];\n    case 'qr_share':\n      return ['events_view', 'qr_codes'];\n    default:\n      return [];\n  }\n};\n\n// Check if user has specific permission\nexport const hasPermission = (user: User | null, permission: string): boolean => {\n  if (!user || !user.isAdmin) return false;\n  \n  // Owner has all permissions\n  if (user.adminRole === 'owner') return true;\n  \n  // Check user's specific permissions\n  const userPermissions = user.adminPermissions || getAdminPermissions(user.adminRole);\n  \n  // Allow events_view permission to also grant events permission for QR Share users\n  if (permission === 'events' && user.adminRole === 'qr_share' && userPermissions.includes('events_view')) {\n    return true;\n  }\n  \n  return userPermissions.includes(permission);\n};\n\n// Get available tabs based on user permissions\nexport const getAvailableTabs = (user: User | null): { value: string; label: string; permission: string }[] => {\n  const allTabs = [\n    { value: 'events', label: 'Events', permission: 'events' },\n    { value: 'bookings', label: 'Bookings', permission: 'bookings' },\n    { value: 'packages', label: 'Packages', permission: 'packages' },\n    { value: 'photos', label: 'Photo Requests', permission: 'photos' },\n    { value: 'messages', label: 'Messages', permission: 'contacts' },\n    { value: 'users', label: 'Users', permission: 'users' },\n    { value: 'qr', label: 'QR Codes', permission: 'qr_codes' },\n    { value: 'storage', label: 'Storage', permission: 'storage' },\n  ];\n\n  return allTabs.filter(tab => hasPermission(user, tab.permission));\n};","size_bytes":2791},"client/src/components/AdminRoleManagement.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useToast } from '@/hooks/use-toast';\nimport { User } from '@shared/types';\nimport { Shield, UserPlus, Edit, Trash2, Crown, Search } from 'lucide-react';\nimport { getAdminPermissions, hasPermission } from '@/utils/adminUtils';\n\ninterface AdminRoleManagementProps {\n  currentUser: User | null;\n  refreshTrigger?: number;\n}\n\nconst AdminRoleManagement: React.FC<AdminRoleManagementProps> = ({ currentUser, refreshTrigger }) => {\n  const [adminUsers, setAdminUsers] = useState<User[]>([]);\n  const [regularUsers, setRegularUsers] = useState<User[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [promoteDialogOpen, setPromoteDialogOpen] = useState(false);\n  const [selectedRole, setSelectedRole] = useState<'admin' | 'moderator' | 'qr_share'>('admin');\n  const [customPermissions, setCustomPermissions] = useState<string[]>([]);\n\n  const { currentUser: firebaseUser } = useAuth();\n  const { toast } = useToast();\n\n  const allPermissions = [\n    { value: 'events', label: 'Manage Events', description: 'Create, edit, and delete events' },\n    { value: 'events_view', label: 'View Events', description: 'View events (read-only)' },\n    { value: 'bookings', label: 'Manage Bookings', description: 'View and manage all bookings' },\n    { value: 'packages', label: 'Manage Packages', description: 'Create and edit service packages' },\n    { value: 'photos', label: 'Manage Photos', description: 'Upload and manage event photos' },\n    { value: 'contacts', label: 'Manage Messages', description: 'View and respond to contact messages' },\n    { value: 'qr_codes', label: 'Manage QR Codes', description: 'Create and manage QR codes for events' },\n    { value: 'users', label: 'View Users', description: 'View user information' },\n    { value: 'users_manage', label: 'Manage Users', description: 'Promote/demote users and manage roles' }\n  ];\n\n  const isOwner = currentUser?.adminRole === 'owner';\n  const canManageUsers = hasPermission(currentUser, 'users_manage');\n\n  useEffect(() => {\n    fetchUsers();\n  }, []);\n\n  // Refresh users when refreshTrigger changes\n  useEffect(() => {\n    if (refreshTrigger && refreshTrigger > 0) {\n      console.log('Refreshing users data due to external trigger...');\n      fetchUsers();\n    }\n  }, [refreshTrigger]);\n\n  const getAuthHeaders = async (): Promise<Record<string, string>> => {\n    if (!firebaseUser) return {};\n    try {\n      const token = await firebaseUser.getIdToken();\n      return {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      };\n    } catch (error) {\n      console.error('Error getting auth token:', error);\n      return {};\n    }\n  };\n\n  const fetchUsers = async () => {\n    setLoading(true);\n    try {\n      const headers = await getAuthHeaders();\n      const [adminRes, usersRes] = await Promise.all([\n        fetch('/api/admin/users/admins', { headers }),\n        fetch('/api/admin/users', { headers })\n      ]);\n\n      if (adminRes.ok) {\n        const adminData = await adminRes.json();\n        setAdminUsers(adminData);\n      }\n\n      if (usersRes.ok) {\n        const usersData = await usersRes.json();\n        setRegularUsers(usersData.filter((user: User) => !user.isAdmin));\n      }\n    } catch (error) {\n      console.error('Error fetching users:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to fetch users\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePromoteUser = async (userId: string, role: 'admin' | 'moderator' | 'qr_share', permissions: string[]) => {\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`/api/admin/users/${userId}/promote`, {\n        method: 'PATCH',\n        headers,\n        body: JSON.stringify({\n          isAdmin: true,\n          adminRole: role,\n          adminPermissions: permissions\n        }),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: `User promoted to ${role} successfully`,\n        });\n        fetchUsers();\n        setPromoteDialogOpen(false);\n        setSelectedUser(null);\n      } else {\n        throw new Error('Failed to promote user');\n      }\n    } catch (error) {\n      console.error('Error promoting user:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to promote user\",\n      });\n    }\n  };\n\n  const handleDemoteUser = async (userId: string) => {\n    if (!confirm('Are you sure you want to remove admin privileges from this user?')) return;\n\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`/api/admin/users/${userId}/demote`, {\n        method: 'PATCH',\n        headers,\n        body: JSON.stringify({\n          isAdmin: false,\n          adminRole: null,\n          adminPermissions: []\n        }),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: \"User demoted successfully\",\n        });\n        fetchUsers();\n      } else {\n        throw new Error('Failed to demote user');\n      }\n    } catch (error) {\n      console.error('Error demoting user:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to demote user\",\n      });\n    }\n  };\n\n  const handleEditPermissions = async (userId: string, permissions: string[]) => {\n    try {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`/api/admin/users/${userId}/permissions`, {\n        method: 'PATCH',\n        headers,\n        body: JSON.stringify({ adminPermissions: permissions }),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: \"Permissions updated successfully\",\n        });\n        fetchUsers();\n        setEditDialogOpen(false);\n        setSelectedUser(null);\n      } else {\n        throw new Error('Failed to update permissions');\n      }\n    } catch (error) {\n      console.error('Error updating permissions:', error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to update permissions\",\n      });\n    }\n  };\n\n  const filteredRegularUsers = regularUsers.filter(user =>\n    user.displayName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    user.email.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const filteredAdminUsers = adminUsers.filter(user =>\n    user.displayName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    user.email.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  if (!canManageUsers) {\n    return (\n      <Card>\n        <CardContent className=\"p-8 text-center\">\n          <Shield className=\"h-12 w-12 mx-auto mb-4 text-gray-400\" />\n          <p className=\"text-gray-600\">You don't have permission to manage user roles.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Search */}\n      <div className=\"relative\">\n        <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n        <Input\n          placeholder=\"Search users by name or email...\"\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n          className=\"pl-8\"\n        />\n      </div>\n\n      {/* Admin Users */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Shield className=\"h-5 w-5 text-blue-600\" />\n                Admin Users\n              </CardTitle>\n              <CardDescription>Users with administrative privileges</CardDescription>\n            </div>\n            <Badge variant=\"secondary\">{adminUsers.length} admins</Badge>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>User</TableHead>\n                <TableHead>Role</TableHead>\n                <TableHead>Permissions</TableHead>\n                <TableHead>Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredAdminUsers.map((user, index) => (\n                <TableRow key={`admin-${user.id || user.firebaseUid}-${index}`}>\n                  <TableCell>\n                    <div className=\"flex items-center gap-3\">\n                      <img\n                        src={user.photoURL || user.customPhotoURL}\n                        alt={user.displayName}\n                        className=\"w-8 h-8 rounded-full\"\n                      />\n                      <div>\n                        <div className=\"font-medium\">{user.displayName}</div>\n                        <div className=\"text-sm text-gray-500\">{user.email}</div>\n                      </div>\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <Badge variant=\"outline\" className={\n                      user.adminRole === 'owner' ? 'bg-yellow-50 border-yellow-200 text-yellow-700' :\n                      user.adminRole === 'admin' ? 'bg-blue-50 border-blue-200 text-blue-700' :\n                      user.adminRole === 'moderator' ? 'bg-green-50 border-green-200 text-green-700' :\n                      user.adminRole === 'qr_share' ? 'bg-purple-50 border-purple-200 text-purple-700' :\n                      'bg-gray-50 border-gray-200 text-gray-700'\n                    }>\n                      {user.adminRole === 'owner' && '👑 Owner'}\n                      {user.adminRole === 'admin' && '🛡️ Admin'}\n                      {user.adminRole === 'moderator' && '⚡ Moderator'}\n                      {user.adminRole === 'qr_share' && '📱 QR Share'}\n                    </Badge>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex flex-wrap gap-1 max-w-xs\">\n                      {(user.adminPermissions || getAdminPermissions(user.adminRole)).slice(0, 3).map((permission, permIndex) => (\n                        <Badge key={`${user.id || user.firebaseUid}-${permission}-${permIndex}`} variant=\"secondary\" className=\"text-xs\">\n                          {permission}\n                        </Badge>\n                      ))}\n                      {(user.adminPermissions || getAdminPermissions(user.adminRole)).length > 3 && (\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          +{(user.adminPermissions || getAdminPermissions(user.adminRole)).length - 3} more\n                        </Badge>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex gap-2\">\n                      {user.adminRole !== 'owner' && isOwner && (\n                        <>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setSelectedUser(user);\n                              setCustomPermissions(user.adminPermissions || getAdminPermissions(user.adminRole));\n                              setEditDialogOpen(true);\n                            }}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"text-red-600 hover:text-red-700\"\n                            onClick={() => handleDemoteUser(user.id || user.firebaseUid)}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </>\n                      )}\n                      {user.adminRole === 'owner' && (\n                        <Crown className=\"h-4 w-4 text-yellow-600\" />\n                      )}\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n\n      {/* Regular Users */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle>Regular Users</CardTitle>\n              <CardDescription>Users without administrative privileges</CardDescription>\n            </div>\n            <Badge variant=\"secondary\">{regularUsers.length} users</Badge>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>User</TableHead>\n                <TableHead>Joined</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead>Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredRegularUsers.map((user, index) => (\n                <TableRow key={`regular-${user.id || user.firebaseUid}-${index}`}>\n                  <TableCell>\n                    <div className=\"flex items-center gap-3\">\n                      <img\n                        src={user.photoURL || user.customPhotoURL}\n                        alt={user.displayName}\n                        className=\"w-8 h-8 rounded-full\"\n                      />\n                      <div>\n                        <div className=\"font-medium\">{user.displayName}</div>\n                        <div className=\"text-sm text-gray-500\">{user.email}</div>\n                      </div>\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    {new Date(user.createdAt).toLocaleDateString()}\n                  </TableCell>\n                  <TableCell>\n                    <Badge variant={user.isActive !== false ? \"default\" : \"secondary\"}>\n                      {user.isActive !== false ? \"Active\" : \"Inactive\"}\n                    </Badge>\n                  </TableCell>\n                  <TableCell>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setSelectedUser(user);\n                        setSelectedRole('admin');\n                        setCustomPermissions(getAdminPermissions('admin'));\n                        setPromoteDialogOpen(true);\n                      }}\n                    >\n                      <UserPlus className=\"h-4 w-4 mr-2\" />\n                      Promote\n                    </Button>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n\n      {/* Promote User Dialog */}\n      <Dialog open={promoteDialogOpen} onOpenChange={setPromoteDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Promote User to Admin</DialogTitle>\n            <DialogDescription>\n              Grant administrative privileges to {selectedUser?.displayName}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-6\">\n            <div>\n              <Label className=\"text-base font-medium\">Select Admin Role</Label>\n              <Select value={selectedRole} onValueChange={(value: 'admin' | 'moderator' | 'qr_share') => {\n                setSelectedRole(value);\n                setCustomPermissions(getAdminPermissions(value));\n              }}>\n                <SelectTrigger className=\"mt-2\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"admin\">🛡️ Administrator - Full access except user management</SelectItem>\n                  <SelectItem value=\"moderator\">⚡ Moderator - Limited access to core functions</SelectItem>\n                  <SelectItem value=\"qr_share\">📱 QR Share - QR code management and event viewing only</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <Label className=\"text-base font-medium mb-4 block\">Customize Permissions</Label>\n              <div className=\"grid grid-cols-1 gap-3\">\n                {allPermissions.map((permission) => (\n                  <div key={permission.value} className=\"flex items-start space-x-3\">\n                    <Checkbox\n                      id={permission.value}\n                      checked={customPermissions.includes(permission.value)}\n                      onCheckedChange={(checked) => {\n                        if (checked) {\n                          setCustomPermissions([...customPermissions, permission.value]);\n                        } else {\n                          setCustomPermissions(customPermissions.filter(p => p !== permission.value));\n                        }\n                      }}\n                    />\n                    <div className=\"space-y-1\">\n                      <Label htmlFor={permission.value} className=\"text-sm font-medium\">\n                        {permission.label}\n                      </Label>\n                      <p className=\"text-xs text-gray-500\">{permission.description}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"flex justify-end gap-3\">\n              <Button variant=\"outline\" onClick={() => setPromoteDialogOpen(false)}>\n                Cancel\n              </Button>\n              <Button onClick={() => handlePromoteUser(selectedUser!.id || selectedUser!.firebaseUid, selectedRole, customPermissions)}>\n                Promote User\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Permissions Dialog */}\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Edit User Permissions</DialogTitle>\n            <DialogDescription>\n              Modify permissions for {selectedUser?.displayName}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-6\">\n            <div>\n              <Label className=\"text-base font-medium mb-4 block\">User Permissions</Label>\n              <div className=\"grid grid-cols-1 gap-3\">\n                {allPermissions.map((permission) => (\n                  <div key={permission.value} className=\"flex items-start space-x-3\">\n                    <Checkbox\n                      id={`edit-${permission.value}`}\n                      checked={customPermissions.includes(permission.value)}\n                      onCheckedChange={(checked) => {\n                        if (checked) {\n                          setCustomPermissions([...customPermissions, permission.value]);\n                        } else {\n                          setCustomPermissions(customPermissions.filter(p => p !== permission.value));\n                        }\n                      }}\n                    />\n                    <div className=\"space-y-1\">\n                      <Label htmlFor={`edit-${permission.value}`} className=\"text-sm font-medium\">\n                        {permission.label}\n                      </Label>\n                      <p className=\"text-xs text-gray-500\">{permission.description}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"flex justify-end gap-3\">\n              <Button variant=\"outline\" onClick={() => setEditDialogOpen(false)}>\n                Cancel\n              </Button>\n              <Button onClick={() => handleEditPermissions(selectedUser!.id || selectedUser!.firebaseUid, customPermissions)}>\n                Update Permissions\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\nexport default AdminRoleManagement;","size_bytes":21038},"scripts/deduplicate-users.js":{"content":"/**\n * User Deduplication Script\n * \n * This script identifies and removes duplicate user accounts based on:\n * 1. Email address\n * 2. Firebase UID\n * \n * Keeps the oldest account and merges any important data from newer duplicates.\n */\n\nconst FirebaseRest = require('../server/firebase-rest.js');\n\nasync function deduplicateUsers() {\n  try {\n    console.log('Starting user deduplication process...');\n    \n    const firebaseRest = new FirebaseRest();\n    const users = await firebaseRest.get('users');\n    \n    if (!users) {\n      console.log('No users found in database.');\n      return;\n    }\n    \n    // Convert to array with IDs\n    const userArray = Object.entries(users).map(([id, user]) => ({\n      id,\n      ...user\n    }));\n    \n    console.log(`Found ${userArray.length} total users`);\n    \n    // Group by email\n    const emailGroups = {};\n    const firebaseUidGroups = {};\n    \n    userArray.forEach(user => {\n      // Group by email\n      if (!emailGroups[user.email]) {\n        emailGroups[user.email] = [];\n      }\n      emailGroups[user.email].push(user);\n      \n      // Group by Firebase UID\n      if (user.firebaseUid) {\n        if (!firebaseUidGroups[user.firebaseUid]) {\n          firebaseUidGroups[user.firebaseUid] = [];\n        }\n        firebaseUidGroups[user.firebaseUid].push(user);\n      }\n    });\n    \n    // Find duplicates by email\n    const emailDuplicates = Object.entries(emailGroups).filter(([email, users]) => users.length > 1);\n    \n    // Find duplicates by Firebase UID\n    const uidDuplicates = Object.entries(firebaseUidGroups).filter(([uid, users]) => users.length > 1);\n    \n    console.log(`Found ${emailDuplicates.length} email duplicates`);\n    console.log(`Found ${uidDuplicates.length} Firebase UID duplicates`);\n    \n    // Process email duplicates\n    for (const [email, duplicateUsers] of emailDuplicates) {\n      console.log(`\\nProcessing email duplicates for: ${email}`);\n      console.log(`Users: ${duplicateUsers.map(u => `${u.id} (${u.createdAt})`).join(', ')}`);\n      \n      // Sort by creation date (keep oldest)\n      const sortedUsers = duplicateUsers.sort((a, b) => \n        new Date(a.createdAt) - new Date(b.createdAt)\n      );\n      \n      const keepUser = sortedUsers[0];\n      const removeUsers = sortedUsers.slice(1);\n      \n      console.log(`Keeping user: ${keepUser.id} (${keepUser.createdAt})`);\n      console.log(`Removing users: ${removeUsers.map(u => u.id).join(', ')}`);\n      \n      // Merge any important data from newer accounts to the kept account\n      let mergedData = { ...keepUser };\n      \n      removeUsers.forEach(user => {\n        // Merge saved photos\n        if (user.savedPhotos && user.savedPhotos.length > 0) {\n          mergedData.savedPhotos = [...new Set([\n            ...(mergedData.savedPhotos || []),\n            ...user.savedPhotos\n          ])];\n        }\n        \n        // Use the most recent display name and photo if updated\n        if (new Date(user.updatedAt) > new Date(mergedData.updatedAt)) {\n          mergedData.displayName = user.displayName || mergedData.displayName;\n          mergedData.photoURL = user.photoURL || mergedData.photoURL;\n          mergedData.customPhotoURL = user.customPhotoURL || mergedData.customPhotoURL;\n          mergedData.phone = user.phone || mergedData.phone;\n          mergedData.bio = user.bio || mergedData.bio;\n        }\n        \n        // Preserve admin status if any duplicate has it\n        if (user.isAdmin) {\n          mergedData.isAdmin = true;\n          mergedData.adminRole = user.adminRole || mergedData.adminRole;\n          mergedData.adminPermissions = user.adminPermissions || mergedData.adminPermissions;\n        }\n      });\n      \n      // Update the kept user with merged data\n      mergedData.updatedAt = new Date().toISOString();\n      await firebaseRest.set(`users/${keepUser.id}`, mergedData);\n      \n      // Delete duplicate users\n      for (const user of removeUsers) {\n        await firebaseRest.delete(`users/${user.id}`);\n        console.log(`Deleted duplicate user: ${user.id}`);\n      }\n    }\n    \n    // Process Firebase UID duplicates (similar logic)\n    for (const [uid, duplicateUsers] of uidDuplicates) {\n      // Skip if already processed by email deduplication\n      const stillExist = [];\n      for (const user of duplicateUsers) {\n        try {\n          const exists = await firebaseRest.get(`users/${user.id}`);\n          if (exists) stillExist.push(user);\n        } catch (e) {\n          // User was already deleted\n        }\n      }\n      \n      if (stillExist.length <= 1) continue;\n      \n      console.log(`\\nProcessing Firebase UID duplicates for: ${uid}`);\n      console.log(`Users: ${stillExist.map(u => `${u.id} (${u.createdAt})`).join(', ')}`);\n      \n      // Sort by creation date (keep oldest)\n      const sortedUsers = stillExist.sort((a, b) => \n        new Date(a.createdAt) - new Date(b.createdAt)\n      );\n      \n      const keepUser = sortedUsers[0];\n      const removeUsers = sortedUsers.slice(1);\n      \n      console.log(`Keeping user: ${keepUser.id} (${keepUser.createdAt})`);\n      console.log(`Removing users: ${removeUsers.map(u => u.id).join(', ')}`);\n      \n      // Delete duplicate users\n      for (const user of removeUsers) {\n        await firebaseRest.delete(`users/${user.id}`);\n        console.log(`Deleted duplicate user: ${user.id}`);\n      }\n    }\n    \n    console.log('\\nUser deduplication completed successfully!');\n    \n  } catch (error) {\n    console.error('Error during user deduplication:', error);\n    throw error;\n  }\n}\n\n// Run if called directly\nif (require.main === module) {\n  deduplicateUsers()\n    .then(() => {\n      console.log('Deduplication completed');\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error('Deduplication failed:', error);\n      process.exit(1);\n    });\n}\n\nmodule.exports = { deduplicateUsers };","size_bytes":5873},"server/routes/qr.ts":{"content":"import { Router } from 'express';\nimport QRCode from 'qrcode';\nimport { requireAuth, requireAdmin } from '../middleware/auth';\n\nconst router = Router();\n\n// Generate QR code for event access\nrouter.post('/generate-qr', requireAuth, requireAdmin, async (req, res) => {\n  try {\n    const { eventId, url } = req.body;\n\n    if (!eventId || !url) {\n      return res.status(400).json({ \n        success: false, \n        message: 'Event ID and URL are required' \n      });\n    }\n\n    // Generate QR code as data URL\n    const qrCodeDataUrl = await QRCode.toDataURL(url, {\n      width: 512,\n      margin: 2,\n      color: {\n        dark: '#000000',\n        light: '#FFFFFF'\n      }\n    });\n\n    res.json({\n      success: true,\n      qrCodeDataUrl,\n      url,\n      eventId\n    });\n\n  } catch (error) {\n    console.error('Error generating QR code:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Failed to generate QR code'\n    });\n  }\n});\n\nexport default router;","size_bytes":980},"client/src/components/ImageOptimizer.tsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { imagePreloader, PerformanceMonitor } from '@/utils/imagePreloader';\n\ninterface ImageOptimizerProps {\n  onOptimizeComplete?: (stats: any) => void;\n}\n\nconst ImageOptimizer = ({ onOptimizeComplete }: ImageOptimizerProps) => {\n  const [isOptimizing, setIsOptimizing] = useState(false);\n  const [stats, setStats] = useState<any>(null);\n  const workerRef = useRef<Worker | null>(null);\n\n  useEffect(() => {\n    // Initialize web worker for background optimization\n    if ('Worker' in window) {\n      const workerBlob = new Blob([`\n        self.onmessage = function(e) {\n          const { images, options } = e.data;\n          \n          // Simulate image optimization work\n          const processedImages = images.map(img => ({\n            ...img,\n            optimized: true,\n            compressionRatio: 0.8\n          }));\n          \n          self.postMessage({\n            type: 'optimization_complete',\n            data: processedImages\n          });\n        };\n      `], { type: 'application/javascript' });\n      \n      workerRef.current = new Worker(URL.createObjectURL(workerBlob));\n      \n      workerRef.current.onmessage = (e) => {\n        if (e.data.type === 'optimization_complete') {\n          setIsOptimizing(false);\n          onOptimizeComplete?.(e.data.data);\n        }\n      };\n    }\n\n    return () => {\n      if (workerRef.current) {\n        workerRef.current.terminate();\n      }\n    };\n  }, [onOptimizeComplete]);\n\n  const optimizeCache = () => {\n    setIsOptimizing(true);\n    \n    // Get performance metrics\n    const metrics = PerformanceMonitor.getMetrics();\n    \n    // Clean up old cache entries\n    imagePreloader.optimizeCache(50);\n    \n    // Update stats\n    setStats({\n      cacheSize: imagePreloader.getCacheSize(),\n      metrics,\n      lastOptimized: new Date().toISOString()\n    });\n    \n    setTimeout(() => {\n      setIsOptimizing(false);\n    }, 1000);\n  };\n\n  const clearCache = () => {\n    imagePreloader.clearCache();\n    PerformanceMonitor.clearMetrics();\n    setStats({\n      cacheSize: 0,\n      metrics: {},\n      lastCleared: new Date().toISOString()\n    });\n  };\n\n  return (\n    <div className=\"bg-white border rounded-lg p-4 shadow-sm\">\n      <h3 className=\"text-lg font-semibold mb-3\">Image Performance</h3>\n      \n      <div className=\"grid grid-cols-2 gap-4 mb-4\">\n        <div className=\"text-center\">\n          <div className=\"text-2xl font-bold text-blue-600\">\n            {stats?.cacheSize || imagePreloader.getCacheSize()}\n          </div>\n          <div className=\"text-sm text-gray-600\">Cached Images</div>\n        </div>\n        \n        <div className=\"text-center\">\n          <div className=\"text-2xl font-bold text-green-600\">\n            {Object.keys(stats?.metrics || {}).length}\n          </div>\n          <div className=\"text-sm text-gray-600\">Performance Metrics</div>\n        </div>\n      </div>\n\n      <div className=\"flex space-x-2\">\n        <button\n          onClick={optimizeCache}\n          disabled={isOptimizing}\n          className=\"flex-1 bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600 disabled:opacity-50\"\n        >\n          {isOptimizing ? 'Optimizing...' : 'Optimize Cache'}\n        </button>\n        \n        <button\n          onClick={clearCache}\n          className=\"flex-1 bg-red-500 text-white px-3 py-2 rounded text-sm hover:bg-red-600\"\n        >\n          Clear Cache\n        </button>\n      </div>\n\n      {stats?.metrics && Object.keys(stats.metrics).length > 0 && (\n        <div className=\"mt-4 text-xs text-gray-600\">\n          <div className=\"font-medium mb-1\">Performance Metrics:</div>\n          {Object.entries(stats.metrics).map(([key, metric]: [string, any]) => (\n            <div key={key} className=\"flex justify-between\">\n              <span>{key}:</span>\n              <span>{metric.average?.toFixed(2)}ms avg</span>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ImageOptimizer;","size_bytes":4001},"client/src/components/PaginatedPhotoGallery.tsx":{"content":"import React, { useState, useEffect, useMemo } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Eye, Download, Heart, HeartOff, Loader2, ChevronLeft, ChevronRight, ImageIcon } from 'lucide-react';\nimport ProgressiveImage from './ProgressiveImage';\nimport { Photo } from '@shared/types';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface PaginatedPhotoGalleryProps {\n  photos: Photo[];\n  loading?: boolean;\n  onPhotoClick?: (photo: Photo) => void;\n  className?: string;\n  showSaveToProfile?: boolean;\n  savedPhotoIds?: string[];\n  onSavePhoto?: (photoId: string) => void;\n  onRemovePhoto?: (photoId: string) => void;\n  savingPhotoIds?: string[];\n  photosPerPage?: number;\n}\n\nconst PaginatedPhotoGallery: React.FC<PaginatedPhotoGalleryProps> = ({\n  photos,\n  loading = false,\n  onPhotoClick,\n  className = '',\n  showSaveToProfile = false,\n  savedPhotoIds = [],\n  onSavePhoto,\n  onRemovePhoto,\n  savingPhotoIds = [],\n  photosPerPage = 10\n}) => {\n  const [currentPage, setCurrentPage] = useState(1);\n  const [loadedPhotos, setLoadedPhotos] = useState<Set<string>>(new Set());\n  const [errorPhotos, setErrorPhotos] = useState<Set<string>>(new Set());\n  const { currentUser } = useAuth();\n\n  // Calculate pagination\n  const totalPages = Math.ceil(photos.length / photosPerPage);\n  const startIndex = (currentPage - 1) * photosPerPage;\n  const endIndex = startIndex + photosPerPage;\n  const currentPhotos = photos.slice(startIndex, endIndex);\n\n  // Reset to first page when photos change\n  useEffect(() => {\n    setCurrentPage(1);\n    setLoadedPhotos(new Set());\n    setErrorPhotos(new Set());\n    // Prevent auto-scroll when photos change\n    if (photos.length > 0) {\n      window.scrollTo({ top: 0, behavior: 'instant' });\n    }\n  }, [photos]);\n\n  const handlePhotoLoad = (photoId: string) => {\n    setLoadedPhotos(prev => new Set(prev).add(photoId));\n  };\n\n  const handlePhotoError = (photoId: string) => {\n    setErrorPhotos(prev => new Set(prev).add(photoId));\n  };\n\n  const handleDownload = async (photo: Photo, e: React.MouseEvent) => {\n    e.stopPropagation();\n    try {\n      const response = await fetch(`${photo.url}?download=true`);\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = photo.filename || 'photo';\n      document.body.appendChild(link);\n      link.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(link);\n    } catch (error) {\n      console.error('Error downloading photo:', error);\n    }\n  };\n\n  const goToPage = (page: number) => {\n    if (page >= 1 && page <= totalPages) {\n      setCurrentPage(page);\n      // Keep user at top when changing pages\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    }\n  };\n\n  const goToNextPage = () => {\n    if (currentPage < totalPages) {\n      setCurrentPage(currentPage + 1);\n    }\n  };\n\n  const goToPreviousPage = () => {\n    if (currentPage > 1) {\n      setCurrentPage(currentPage - 1);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className={`${className}`}>\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\">\n          {[...Array(photosPerPage)].map((_, index) => (\n            <Card key={index} className=\"aspect-square overflow-hidden animate-pulse\">\n              <CardContent className=\"p-0 h-full bg-gray-200\">\n                <div className=\"w-full h-full bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 animate-pulse\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (photos.length === 0) {\n    return (\n      <div className={`${className} text-center py-12`}>\n        <ImageIcon className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n        <p className=\"text-gray-500 text-lg\">No photos available</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`${className}`}>\n      {/* Photo Grid */}\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 mb-6\">\n        {currentPhotos.map((photo) => (\n          <PhotoCard\n            key={photo.id}\n            photo={photo}\n            onPhotoClick={onPhotoClick}\n            onDownload={handleDownload}\n            onLoad={() => handlePhotoLoad(photo.id)}\n            onError={() => handlePhotoError(photo.id)}\n            loaded={loadedPhotos.has(photo.id)}\n            error={errorPhotos.has(photo.id)}\n            showSaveToProfile={showSaveToProfile}\n            savedPhotoIds={savedPhotoIds}\n            onSavePhoto={onSavePhoto}\n            onRemovePhoto={onRemovePhoto}\n            savingPhotoIds={savingPhotoIds}\n            currentUser={currentUser}\n          />\n        ))}\n      </div>\n\n      {/* Pagination Controls */}\n      {totalPages > 1 && (\n        <div className=\"flex items-center justify-center gap-2 mt-8\">\n          {/* Previous Button */}\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={goToPreviousPage}\n            disabled={currentPage === 1}\n            className=\"flex items-center gap-1\"\n          >\n            <ChevronLeft className=\"h-4 w-4\" />\n            Previous\n          </Button>\n\n          {/* Page Numbers */}\n          <div className=\"flex items-center gap-1\">\n            {/* First page */}\n            {currentPage > 3 && (\n              <>\n                <Button\n                  variant={1 === currentPage ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  onClick={() => goToPage(1)}\n                  className=\"w-10 h-10 p-0\"\n                >\n                  1\n                </Button>\n                {currentPage > 4 && <span className=\"px-2\">...</span>}\n              </>\n            )}\n\n            {/* Current page and surrounding pages */}\n            {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n              let pageNum;\n              if (totalPages <= 5) {\n                pageNum = i + 1;\n              } else if (currentPage <= 3) {\n                pageNum = i + 1;\n              } else if (currentPage >= totalPages - 2) {\n                pageNum = totalPages - 4 + i;\n              } else {\n                pageNum = currentPage - 2 + i;\n              }\n\n              if (pageNum < 1 || pageNum > totalPages) return null;\n\n              return (\n                <Button\n                  key={pageNum}\n                  variant={pageNum === currentPage ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  onClick={() => goToPage(pageNum)}\n                  className=\"w-10 h-10 p-0\"\n                >\n                  {pageNum}\n                </Button>\n              );\n            })}\n\n            {/* Last page */}\n            {currentPage < totalPages - 2 && (\n              <>\n                {currentPage < totalPages - 3 && <span className=\"px-2\">...</span>}\n                <Button\n                  variant={totalPages === currentPage ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  onClick={() => goToPage(totalPages)}\n                  className=\"w-10 h-10 p-0\"\n                >\n                  {totalPages}\n                </Button>\n              </>\n            )}\n          </div>\n\n          {/* Next Button */}\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={goToNextPage}\n            disabled={currentPage === totalPages}\n            className=\"flex items-center gap-1\"\n          >\n            Next\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      )}\n\n      {/* Page Info */}\n      <div className=\"text-center text-sm text-gray-500 mt-4\">\n        Showing {startIndex + 1}-{Math.min(endIndex, photos.length)} of {photos.length} photos\n        {totalPages > 1 && ` • Page ${currentPage} of ${totalPages}`}\n      </div>\n    </div>\n  );\n};\n\n// Photo Card Component\ninterface PhotoCardProps {\n  photo: Photo;\n  onPhotoClick?: (photo: Photo) => void;\n  onDownload: (photo: Photo, e: React.MouseEvent) => void;\n  onLoad: () => void;\n  onError: () => void;\n  loaded: boolean;\n  error: boolean;\n  showSaveToProfile: boolean;\n  savedPhotoIds: string[];\n  onSavePhoto?: (photoId: string) => void;\n  onRemovePhoto?: (photoId: string) => void;\n  savingPhotoIds: string[];\n  currentUser: any;\n}\n\nconst PhotoCard: React.FC<PhotoCardProps> = ({\n  photo,\n  onPhotoClick,\n  onDownload,\n  onLoad,\n  onError,\n  loaded,\n  error,\n  showSaveToProfile,\n  savedPhotoIds,\n  onSavePhoto,\n  onRemovePhoto,\n  savingPhotoIds,\n  currentUser\n}) => {\n  const handleSaveToProfile = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (onSavePhoto) {\n      onSavePhoto(photo.id);\n    }\n  };\n\n  const handleRemoveFromProfile = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (onRemovePhoto) {\n      onRemovePhoto(photo.id);\n    }\n  };\n\n  const isPhotoSaved = savedPhotoIds.includes(photo.id);\n  const isPhotoSaving = savingPhotoIds.includes(photo.id);\n  const canShowSaveButton = showSaveToProfile && currentUser;\n\n  return (\n    <Card className=\"group hover:shadow-xl transition-all duration-300 hover:scale-105 overflow-hidden cursor-pointer\">\n      <CardContent className=\"p-0 aspect-square relative\">\n        {/* Loading skeleton */}\n        {!loaded && !error && (\n          <div className=\"absolute inset-0 bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 animate-pulse\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-40 animate-pulse\" \n                 style={{ animationDuration: '2s' }} />\n          </div>\n        )}\n        \n        {/* Error state */}\n        {error && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-gray-100\">\n            <ImageIcon className=\"h-8 w-8 text-gray-400\" />\n          </div>\n        )}\n        \n        {/* Progressive Image with optimized loading */}\n        <ProgressiveImage\n          src={photo.url}\n          alt={photo.filename || 'Photo'}\n          className=\"w-full h-full object-cover transition-all duration-300 group-hover:scale-110\"\n          priority=\"high\"\n          aspectRatio={1}\n          onLoad={onLoad}\n          onError={onError}\n          loading=\"lazy\"\n        />\n        \n        {/* Hover overlay */}\n        <div \n          className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100\"\n        >\n          <div className=\"flex space-x-2\">\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              className=\"bg-white/90 hover:bg-white\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                console.log('Eye icon clicked for photo:', photo.id);\n                // Use setTimeout to ensure the event is processed after the current stack\n                setTimeout(() => {\n                  onPhotoClick?.(photo);\n                }, 0);\n              }}\n            >\n              <Eye className=\"h-4 w-4\" />\n            </Button>\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              className=\"bg-white/90 hover:bg-white\"\n              onClick={(e) => onDownload(photo, e)}\n            >\n              <Download className=\"h-4 w-4\" />\n            </Button>\n            {canShowSaveButton && (\n              <Button\n                variant=\"secondary\"\n                size=\"sm\"\n                className={`bg-white/90 hover:bg-white ${isPhotoSaved ? 'text-red-500' : 'text-green-500'}`}\n                onClick={isPhotoSaved ? handleRemoveFromProfile : handleSaveToProfile}\n                disabled={isPhotoSaving}\n              >\n                {isPhotoSaving ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                ) : isPhotoSaved ? (\n                  <HeartOff className=\"h-4 w-4\" />\n                ) : (\n                  <Heart className=\"h-4 w-4\" />\n                )}\n              </Button>\n            )}\n          </div>\n        </div>\n        \n        {/* Loading indicator for individual photos */}\n        {!loaded && !error && (\n          <div className=\"absolute bottom-2 right-2 bg-black/50 rounded-full p-1\">\n            <Loader2 className=\"h-3 w-3 animate-spin text-white\" />\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default PaginatedPhotoGallery;","size_bytes":12577},"client/src/components/ProgressiveImage.tsx":{"content":"import { useState, useRef, useEffect, useMemo } from 'react';\nimport { imagePreloader, getDisplayImageUrl, PerformanceMonitor } from '@/utils/imagePreloader';\n\ninterface ProgressiveImageProps {\n  src: string;\n  alt: string;\n  className?: string;\n  thumbnailSrc?: string;\n  priority?: 'low' | 'medium' | 'high';\n  onLoad?: () => void;\n  onError?: () => void;\n  style?: React.CSSProperties;\n  sizes?: string;\n  loading?: 'lazy' | 'eager';\n  aspectRatio?: number;\n  blur?: boolean;\n}\n\nconst ProgressiveImage = ({\n  src,\n  alt,\n  className = '',\n  thumbnailSrc,\n  priority = 'medium',\n  onLoad,\n  onError,\n  style,\n  sizes,\n  loading = 'lazy',\n  aspectRatio,\n  blur = true\n}: ProgressiveImageProps) => {\n  const [imageState, setImageState] = useState<'loading' | 'loaded' | 'error'>('loading');\n  const [isInView, setIsInView] = useState(loading === 'eager');\n  const [showFullRes, setShowFullRes] = useState(false);\n  const imgRef = useRef<HTMLImageElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Generate optimized URLs\n  const optimizedSrc = useMemo(() => {\n    // For GridFS images, append quality parameter to the original URL\n    if (src.startsWith('/api/images/')) {\n      return `${src}?quality=85`;\n    }\n    return getDisplayImageUrl(src);\n  }, [src]);\n  \n  const thumb = useMemo(() => {\n    if (thumbnailSrc) return thumbnailSrc;\n    // For GridFS images, append thumbnail parameter to the original URL\n    if (src.startsWith('/api/images/')) {\n      return `${src}?thumbnail=true&quality=60`;\n    }\n    return getDisplayImageUrl(src, true);\n  }, [src, thumbnailSrc]);\n\n  // Intersection Observer for lazy loading\n  useEffect(() => {\n    if (loading === 'eager') return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          setIsInView(true);\n          observer.disconnect();\n        }\n      },\n      {\n        threshold: 0.1,\n        rootMargin: '100px'\n      }\n    );\n\n    if (containerRef.current) {\n      observer.observe(containerRef.current);\n    }\n\n    return () => observer.disconnect();\n  }, [loading]);\n\n  // Simplified loading logic to prevent browser freezing\n  useEffect(() => {\n    if (!isInView) return;\n\n    let isCancelled = false;\n\n    // Simple image loading without complex preloader that might cause issues\n    const loadImage = (src: string) => {\n      return new Promise<void>((resolve, reject) => {\n        const img = new Image();\n        img.onload = () => resolve();\n        img.onerror = () => reject();\n        img.src = src;\n      });\n    };\n\n    // Load thumbnail first, then full res\n    loadImage(thumb)\n      .then(() => {\n        if (isCancelled) return;\n        setImageState('loaded');\n        return loadImage(optimizedSrc);\n      })\n      .then(() => {\n        if (isCancelled) return;\n        setShowFullRes(true);\n        onLoad?.();\n      })\n      .catch(() => {\n        if (isCancelled) return;\n        setImageState('error');\n        onError?.();\n      });\n\n    return () => {\n      isCancelled = true;\n    };\n  }, [isInView, thumb, optimizedSrc, onLoad, onError]);\n\n  // Generate placeholder with proper aspect ratio\n  const placeholderStyle = useMemo(() => {\n    const baseStyle: React.CSSProperties = {\n      backgroundColor: '#f3f4f6',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      color: '#9ca3af',\n      fontSize: '14px',\n      ...style\n    };\n\n    if (aspectRatio) {\n      baseStyle.aspectRatio = aspectRatio.toString();\n    }\n\n    return baseStyle;\n  }, [style, aspectRatio]);\n\n  const imageStyle = useMemo(() => {\n    const baseStyle: React.CSSProperties = {\n      transition: 'opacity 0.3s ease-in-out',\n      ...style\n    };\n\n    if (aspectRatio) {\n      baseStyle.aspectRatio = aspectRatio.toString();\n      baseStyle.objectFit = 'cover';\n    }\n\n    return baseStyle;\n  }, [style, aspectRatio]);\n\n  // Error fallback\n  if (imageState === 'error') {\n    return (\n      <div \n        ref={containerRef}\n        className={`${className} flex items-center justify-center bg-gray-100`}\n        style={placeholderStyle}\n      >\n        <span className=\"text-gray-500\">Image unavailable</span>\n      </div>\n    );\n  }\n\n  // Not in viewport yet\n  if (!isInView) {\n    return (\n      <div \n        ref={containerRef}\n        className={`${className} animate-pulse bg-gray-200`}\n        style={placeholderStyle}\n      >\n        <span className=\"text-gray-400\">Loading...</span>\n      </div>\n    );\n  }\n\n  return (\n    <div ref={containerRef} className={`relative ${className}`} style={style}>\n      {/* Thumbnail layer */}\n      {imageState === 'loaded' && (\n        <img\n          src={thumb}\n          alt=\"\"\n          className={`absolute inset-0 w-full h-full transition-opacity duration-300 ${\n            showFullRes ? 'opacity-0' : 'opacity-100'\n          } ${blur && !showFullRes ? 'filter blur-sm' : ''}`}\n          style={imageStyle}\n          loading=\"eager\"\n        />\n      )}\n\n      {/* Full resolution layer */}\n      {showFullRes && (\n        <img\n          ref={imgRef}\n          src={optimizedSrc}\n          alt={alt}\n          className={`w-full h-full transition-opacity duration-300 ${\n            showFullRes ? 'opacity-100' : 'opacity-0'\n          }`}\n          style={imageStyle}\n          sizes={sizes}\n          loading=\"eager\"\n        />\n      )}\n\n      {/* Loading placeholder */}\n      {imageState === 'loading' && (\n        <div \n          className={`absolute inset-0 animate-pulse bg-gray-200 flex items-center justify-center`}\n          style={placeholderStyle}\n        >\n          <div className=\"text-gray-400 text-sm\">Loading...</div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ProgressiveImage;","size_bytes":5732},"client/src/components/QRAccess.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport LoadingSpinner from '@/components/LoadingSpinner';\nimport { \n  Calendar, \n  MapPin, \n  Users, \n  Camera, \n  QrCode, \n  ArrowRight, \n  Clock,\n  Sparkles\n} from 'lucide-react';\nimport { Event } from '@shared/types';\n\ninterface QRAccessProps {}\n\nconst QRAccess: React.FC<QRAccessProps> = () => {\n  const { eventId } = useParams<{ eventId: string }>();\n  const navigate = useNavigate();\n  const [event, setEvent] = useState<Event | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!eventId) {\n      setError('Invalid QR code - missing event ID');\n      setLoading(false);\n      return;\n    }\n\n    // Check QR code expiration\n    const urlParams = new URLSearchParams(window.location.search);\n    const expires = urlParams.get('expires');\n    \n    if (expires) {\n      const expirationTime = parseInt(expires);\n      const now = Date.now();\n      \n      if (now > expirationTime) {\n        setError('QR code has expired. Please request a new QR code from the event organizer.');\n        setLoading(false);\n        return;\n      }\n    }\n\n    // Redirect immediately to events page for selfie\n    redirectToEventPage();\n  }, [eventId]);\n\n  const redirectToEventPage = async () => {\n    try {\n      // Get QR code ID from URL parameters\n      const urlParams = new URLSearchParams(window.location.search);\n      const qrCodeId = urlParams.get('qrId');\n      \n      if (qrCodeId) {\n        // Validate QR code is active and not deleted\n        const qrResponse = await fetch(`/api/qr-codes/${qrCodeId}/validate`);\n        \n        if (!qrResponse.ok) {\n          if (qrResponse.status === 404) {\n            throw new Error('QR code not found - this QR code may have been deleted');\n          } else if (qrResponse.status === 403) {\n            throw new Error('QR code is inactive - this QR code has been deactivated');\n          }\n          throw new Error('Failed to validate QR code');\n        }\n      }\n      \n      // Validate event exists before redirecting\n      const response = await fetch(`/api/events/${eventId}`);\n      \n      if (!response.ok) {\n        if (response.status === 404) {\n          throw new Error('Event not found - this QR code may be for an event that no longer exists');\n        }\n        throw new Error('Failed to validate event');\n      }\n\n      // Event exists, redirect immediately to Events page with auto-scan\n      navigate(`/events?eventId=${eventId}&skipPin=true&autoScan=true`);\n    } catch (err) {\n      console.error('Error validating event:', err);\n      setError(err instanceof Error ? err.message : 'Failed to validate event');\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center\">\n        <Card className=\"w-full max-w-md mx-4\">\n          <CardContent className=\"p-8 text-center\">\n            <div className=\"w-16 h-16 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-4 animate-spin\">\n              <QrCode className=\"w-8 h-8\" />\n            </div>\n            <p className=\"text-gray-600 mt-4\">Accessing event and preparing face recognition...</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center\">\n        <Card className=\"w-full max-w-md mx-4 border-red-200\">\n          <CardHeader className=\"text-center\">\n            <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <QrCode className=\"w-8 h-8 text-red-600\" />\n            </div>\n            <CardTitle className=\"text-red-800\">Invalid QR Code</CardTitle>\n            <CardDescription className=\"text-red-600\">{error}</CardDescription>\n          </CardHeader>\n          <CardContent className=\"text-center\">\n            <Button \n              onClick={() => navigate('/')}\n              variant=\"outline\"\n              className=\"w-full\"\n            >\n              Go to Homepage\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!event) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50\">\n      <div className=\"container mx-auto px-4 py-12\">\n        \n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"w-20 h-20 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg\">\n            <QrCode className=\"w-10 h-10 text-white\" />\n          </div>\n          <h1 className=\"text-3xl md:text-4xl font-bold text-gray-900 mb-2\">\n            Welcome to Event Access\n          </h1>\n          <p className=\"text-gray-600 text-lg\">\n            You've successfully scanned the QR code!\n          </p>\n        </div>\n\n        {/* Event Details Card */}\n        <Card className=\"max-w-2xl mx-auto mb-8 shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\n          <CardHeader className=\"text-center pb-4\">\n            <div className=\"flex items-center justify-center gap-2 mb-2\">\n              <Camera className=\"w-5 h-5 text-blue-600\" />\n              <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-700\">\n                Event Details\n              </Badge>\n            </div>\n            <CardTitle className=\"text-2xl text-gray-900\">{event.title}</CardTitle>\n            <CardDescription className=\"text-lg text-gray-600 mt-2\">\n              {event.description || 'Photography event'}\n            </CardDescription>\n          </CardHeader>\n          \n          <CardContent className=\"space-y-4\">\n            {/* Event Info Grid */}\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg\">\n                <Calendar className=\"w-5 h-5 text-blue-600\" />\n                <div>\n                  <p className=\"font-medium text-gray-900\">Event Date</p>\n                  <p className=\"text-gray-600\">{new Date(event.eventDate).toLocaleDateString()}</p>\n                </div>\n              </div>\n              \n              {event.location && (\n                <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg\">\n                  <MapPin className=\"w-5 h-5 text-green-600\" />\n                  <div>\n                    <p className=\"font-medium text-gray-900\">Location</p>\n                    <p className=\"text-gray-600\">{event.location}</p>\n                  </div>\n                </div>\n              )}\n              \n              <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg\">\n                <Camera className=\"w-5 h-5 text-purple-600\" />\n                <div>\n                  <p className=\"font-medium text-gray-900\">Photos Available</p>\n                  <p className=\"text-gray-600\">{event.photoCount || 0} photos</p>\n                </div>\n              </div>\n              \n              <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg\">\n                <Users className=\"w-5 h-5 text-indigo-600\" />\n                <div>\n                  <p className=\"font-medium text-gray-900\">Event Type</p>\n                  <p className=\"text-gray-600 capitalize\">{event.category}</p>\n                </div>\n              </div>\n            </div>\n\n            {/* Privacy Notice */}\n            {event.isPrivate && (\n              <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"w-5 h-5 text-amber-600\" />\n                  <p className=\"font-medium text-amber-800\">Private Event</p>\n                </div>\n                <p className=\"text-amber-700 text-sm mt-1\">\n                  This is a private event. Access is limited to invited guests only.\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Find Photos CTA */}\n        <Card className=\"max-w-2xl mx-auto shadow-lg border-0 bg-gradient-to-r from-blue-500 to-indigo-600 text-white\">\n          <CardContent className=\"p-8 text-center\">\n            <div className=\"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Sparkles className=\"w-8 h-8 text-white\" />\n            </div>\n            <h2 className=\"text-2xl font-bold mb-2\">Find Your Photos</h2>\n            <p className=\"text-blue-100 mb-6\">\n              Use AI-powered face recognition to discover all your photos from this event. \n              Simply take a selfie and we'll find all the photos you appear in!\n            </p>\n            \n            <Button \n              onClick={() => {\n                // Navigate to Events page with auto-scan enabled for this event\n                window.location.href = `/events?eventId=${event.id}&autoScan=true`;\n              }}\n              size=\"lg\"\n              className=\"bg-white text-blue-600 hover:bg-blue-50 font-semibold text-lg px-8 py-3\"\n            >\n              <Camera className=\"w-5 h-5 mr-2\" />\n              Take Selfie & Find My Photos\n              <ArrowRight className=\"w-5 h-5 ml-2\" />\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* How It Works */}\n        <div className=\"max-w-2xl mx-auto mt-8 text-center\">\n          <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">How it works</h3>\n          <div className=\"grid md:grid-cols-3 gap-4 text-sm text-gray-600\">\n            <div className=\"bg-white/60 backdrop-blur-sm p-4 rounded-lg\">\n              <div className=\"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-2 font-bold\">\n                1\n              </div>\n              <p>Take a clear selfie using your device camera</p>\n            </div>\n            <div className=\"bg-white/60 backdrop-blur-sm p-4 rounded-lg\">\n              <div className=\"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-2 font-bold\">\n                2\n              </div>\n              <p>Our AI analyzes your face and searches the event photos</p>\n            </div>\n            <div className=\"bg-white/60 backdrop-blur-sm p-4 rounded-lg\">\n              <div className=\"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-2 font-bold\">\n                3\n              </div>\n              <p>View and download all photos where you appear</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QRAccess;","size_bytes":11058},"client/src/components/QRManagement.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { QrCode, Download, Eye, Trash2, Plus, Clock, Users, Calendar, ExternalLink } from 'lucide-react';\nimport { Event, QRCode as QRCodeType } from \"@shared/types\";\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface QRManagementProps {}\n\nconst QRManagement: React.FC<QRManagementProps> = () => {\n  const [selectedEvent, setSelectedEvent] = useState<Event | null>(null);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\n  const [expirationHours, setExpirationHours] = useState(\"24\");\n  const [maxUsage, setMaxUsage] = useState(\"\");\n  const [eventSearchTerm, setEventSearchTerm] = useState(\"\");\n  const [viewQRDialogOpen, setViewQRDialogOpen] = useState(false);\n  const [selectedQRCode, setSelectedQRCode] = useState<QRCodeType | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { currentUser } = useAuth();\n\n  // Custom fetcher function with authentication\n  const fetchEventsWithAuth = async (): Promise<Event[]> => {\n    if (!currentUser) return [];\n    \n    const token = await currentUser.getIdToken();\n    const response = await fetch('/api/admin/events', {\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    \n    if (!response.ok) {\n      throw new Error(`Failed to fetch events: ${response.statusText}`);\n    }\n    \n    return response.json();\n  };\n\n  // Fetch all events using the admin endpoint with authentication\n  const { data: events = [], isLoading: loadingEvents, error: eventsError } = useQuery<Event[]>({\n    queryKey: ['/api/admin/events'],\n    queryFn: fetchEventsWithAuth,\n    enabled: !!currentUser,\n    retry: 1,\n  });\n\n\n\n  // Custom fetcher function for QR codes with authentication\n  const fetchQRCodesWithAuth = async (): Promise<QRCodeType[]> => {\n    if (!currentUser) return [];\n    \n    const token = await currentUser.getIdToken();\n    const response = await fetch('/api/admin/qr-codes', {\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    \n    if (!response.ok) {\n      throw new Error(`Failed to fetch QR codes: ${response.statusText}`);\n    }\n    \n    return response.json();\n  };\n\n  // Fetch QR codes\n  const { data: qrCodes = [], isLoading: loadingQRCodes, refetch: refetchQRCodes } = useQuery<QRCodeType[]>({\n    queryKey: ['/api/admin/qr-codes'],\n    queryFn: fetchQRCodesWithAuth,\n    enabled: !!currentUser,\n  });\n\n  // Filter events based on search term\n  const filteredEvents = events.filter((event: Event) =>\n    event.title.toLowerCase().includes(eventSearchTerm.toLowerCase()) ||\n    event.category.toLowerCase().includes(eventSearchTerm.toLowerCase()) ||\n    event.location?.toLowerCase().includes(eventSearchTerm.toLowerCase())\n  );\n\n  // Create QR code mutation\n  const createQRCodeMutation = useMutation({\n    mutationFn: async (data: any) => {\n      if (!currentUser) throw new Error('User not authenticated');\n      \n      const token = await currentUser.getIdToken();\n      const response = await fetch('/api/admin/generate-qr', {\n        method: 'POST',\n        headers: { \n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error('Failed to create QR code');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/qr-codes'] });\n      setIsCreateDialogOpen(false);\n      setSelectedEvent(null);\n      setExpirationHours(\"24\");\n      setMaxUsage(\"\");\n      setEventSearchTerm(\"\");\n      toast({\n        title: \"QR Code Created\",\n        description: \"QR code generated successfully\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create QR code\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete QR code mutation\n  const deleteQRCodeMutation = useMutation({\n    mutationFn: async (qrCodeId: string) => {\n      if (!currentUser) throw new Error('User not authenticated');\n      \n      const token = await currentUser.getIdToken();\n      const response = await fetch(`/api/admin/qr-codes/${qrCodeId}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        },\n      });\n      if (!response.ok) throw new Error('Failed to delete QR code');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/qr-codes'] });\n      toast({\n        title: \"QR Code Deleted\",\n        description: \"QR code removed successfully\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete QR code\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Toggle QR code active status mutation\n  const toggleQRCodeMutation = useMutation({\n    mutationFn: async ({ qrCodeId, isActive }: { qrCodeId: string; isActive: boolean }) => {\n      if (!currentUser) throw new Error('User not authenticated');\n      \n      const token = await currentUser.getIdToken();\n      const response = await fetch(`/api/admin/qr-codes/${qrCodeId}`, {\n        method: 'PATCH',\n        headers: { \n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({ isActive }),\n      });\n      if (!response.ok) throw new Error('Failed to update QR code');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/qr-codes'] });\n    },\n  });\n\n  const handleCreateQRCode = async () => {\n    if (!selectedEvent) return;\n\n    setIsGenerating(true);\n    try {\n      const baseUrl = window.location.origin;\n      const qrUrl = `${baseUrl}/qr-access/${selectedEvent.id}`;\n      \n      await createQRCodeMutation.mutateAsync({\n        eventId: selectedEvent.id,\n        url: qrUrl,\n        expirationHours: parseInt(expirationHours),\n        maxUsage: maxUsage ? parseInt(maxUsage) : undefined,\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const downloadQRCode = (qrCode: QRCodeType) => {\n    const link = document.createElement('a');\n    link.href = qrCode.qrCodeDataUrl;\n    link.download = `qr-code-${qrCode.eventTitle.replace(/\\s+/g, '-').toLowerCase()}.png`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n    toast({\n      title: \"QR Code Downloaded\",\n      description: `QR code saved as ${link.download}`,\n    });\n  };\n\n  const viewQRCode = (qrCode: QRCodeType) => {\n    setSelectedQRCode(qrCode);\n    setViewQRDialogOpen(true);\n  };\n\n  const isExpired = (expiresAt: string) => {\n    return new Date(expiresAt).getTime() < Date.now();\n  };\n\n  const getStatusBadge = (qrCode: QRCodeType) => {\n    if (!qrCode.isActive) {\n      return <Badge variant=\"secondary\">Inactive</Badge>;\n    }\n    if (isExpired(qrCode.expiresAt)) {\n      return <Badge variant=\"destructive\">Expired</Badge>;\n    }\n    if (qrCode.maxUsage && qrCode.usageCount >= qrCode.maxUsage) {\n      return <Badge variant=\"destructive\">Usage Limit Reached</Badge>;\n    }\n    return <Badge variant=\"default\">Active</Badge>;\n  };\n\n  const formatExpirationTime = (expiresAt: string) => {\n    const expiry = new Date(expiresAt);\n    const now = new Date();\n    const diffMs = expiry.getTime() - now.getTime();\n    \n    if (diffMs <= 0) return 'Expired';\n    \n    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n    const diffDays = Math.floor(diffHours / 24);\n    \n    if (diffDays > 0) {\n      return `${diffDays} day${diffDays > 1 ? 's' : ''} left`;\n    } else if (diffHours > 0) {\n      return `${diffHours} hour${diffHours > 1 ? 's' : ''} left`;\n    } else {\n      const diffMinutes = Math.floor(diffMs / (1000 * 60));\n      return `${diffMinutes} minute${diffMinutes > 1 ? 's' : ''} left`;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">QR Code Management</h2>\n          <p className=\"text-gray-600\">Create and manage QR codes for event access with custom expiration times</p>\n        </div>\n        <Dialog open={isCreateDialogOpen} onOpenChange={(open) => {\n          setIsCreateDialogOpen(open);\n          if (!open) {\n            // Reset form when dialog closes\n            setSelectedEvent(null);\n            setExpirationHours(\"24\");\n            setMaxUsage(\"\");\n            setEventSearchTerm(\"\");\n          }\n        }}>\n          <DialogTrigger asChild>\n            <Button className=\"flex items-center gap-2\">\n              <Plus className=\"h-4 w-4\" />\n              Create QR Code\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <QrCode className=\"h-5 w-5\" />\n                Create New QR Code\n              </DialogTitle>\n              <DialogDescription>\n                Generate a QR code for event access with custom settings\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className=\"space-y-4\">\n              {/* Event Selection with Integrated Search */}\n              <div>\n                <Label>Select Event *</Label>\n                <Select\n                  value={selectedEvent?.id || \"\"}\n                  onValueChange={(value) => {\n                    const event = filteredEvents.find((e: Event) => e.id === value);\n                    setSelectedEvent(event || null);\n                  }}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder={\n                      loadingEvents ? \"Loading events...\" : \n                      \"Choose an event for QR code\"\n                    } />\n                  </SelectTrigger>\n                  <SelectContent className=\"max-h-[300px]\">\n                    <div className=\"p-2 border-b sticky top-0 bg-background\">\n                      <Input\n                        placeholder=\"Search events...\"\n                        value={eventSearchTerm}\n                        onChange={(e) => setEventSearchTerm(e.target.value)}\n                        className=\"h-8\"\n                      />\n                      {events.length > 0 && (\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          {filteredEvents.length} of {events.length} events\n                          {eventSearchTerm && ` matching \"${eventSearchTerm}\"`}\n                        </p>\n                      )}\n                    </div>\n                    {loadingEvents ? (\n                      <div className=\"p-4 text-center text-muted-foreground\">\n                        Loading events...\n                      </div>\n                    ) : filteredEvents.length === 0 ? (\n                      <div className=\"p-4 text-center text-muted-foreground\">\n                        {eventSearchTerm ? 'No events match your search' : 'No events available'}\n                      </div>\n                    ) : (\n                      filteredEvents.map((event: Event) => (\n                        <SelectItem key={event.id} value={event.id}>\n                          <div className=\"flex flex-col w-full\">\n                            <span className=\"font-medium\">{event.title}</span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              {new Date(event.eventDate).toLocaleDateString()} • {event.location} • {event.category}\n                            </span>\n                          </div>\n                        </SelectItem>\n                      ))\n                    )}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Expiration Time */}\n              <div>\n                <Label>Expiration Time</Label>\n                <Select value={expirationHours} onValueChange={setExpirationHours}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"1\">1 Hour</SelectItem>\n                    <SelectItem value=\"6\">6 Hours</SelectItem>\n                    <SelectItem value=\"12\">12 Hours</SelectItem>\n                    <SelectItem value=\"24\">24 Hours (1 Day)</SelectItem>\n                    <SelectItem value=\"48\">48 Hours (2 Days)</SelectItem>\n                    <SelectItem value=\"72\">72 Hours (3 Days)</SelectItem>\n                    <SelectItem value=\"168\">1 Week</SelectItem>\n                    <SelectItem value=\"720\">1 Month</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Usage Limit */}\n              <div>\n                <Label>Usage Limit (Optional)</Label>\n                <Input\n                  type=\"number\"\n                  placeholder=\"No limit\"\n                  value={maxUsage}\n                  onChange={(e) => setMaxUsage(e.target.value)}\n                  min=\"1\"\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Leave empty for unlimited usage\n                </p>\n              </div>\n\n              {/* Create Button */}\n              <Button\n                onClick={handleCreateQRCode}\n                disabled={!selectedEvent || isGenerating}\n                className=\"w-full\"\n              >\n                {isGenerating ? 'Generating...' : 'Create QR Code'}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* QR Codes Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <QrCode className=\"h-5 w-5\" />\n            Active QR Codes\n          </CardTitle>\n          <CardDescription>\n            Manage all your event QR codes and their access settings\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {loadingQRCodes ? (\n            <div className=\"space-y-3\">\n              {[...Array(3)].map((_, i) => (\n                <div key={i} className=\"h-16 bg-gray-100 rounded animate-pulse\" />\n              ))}\n            </div>\n          ) : qrCodes.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <QrCode className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-500\">No QR codes created yet</p>\n              <p className=\"text-sm text-gray-400\">Create your first QR code to get started</p>\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Event</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Expires</TableHead>\n                  <TableHead>Usage</TableHead>\n                  <TableHead>Created</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {qrCodes.map((qrCode: QRCodeType) => (\n                  <TableRow key={qrCode.id}>\n                    <TableCell>\n                      <div>\n                        <div className=\"font-medium\">{qrCode.eventTitle}</div>\n                        <div className=\"text-sm text-gray-500\">ID: {qrCode.eventId}</div>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      {getStatusBadge(qrCode)}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        <Clock className=\"h-3 w-3 text-gray-400\" />\n                        <span className=\"text-sm\">{formatExpirationTime(qrCode.expiresAt)}</span>\n                      </div>\n                      <div className=\"text-xs text-gray-500\">\n                        {new Date(qrCode.expiresAt).toLocaleDateString()}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        <Users className=\"h-3 w-3 text-gray-400\" />\n                        <span className=\"text-sm\">\n                          {qrCode.usageCount}\n                          {qrCode.maxUsage ? `/${qrCode.maxUsage}` : ''}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        <Calendar className=\"h-3 w-3 text-gray-400\" />\n                        <span className=\"text-sm\">\n                          {new Date(qrCode.createdAt).toLocaleDateString()}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => viewQRCode(qrCode)}\n                          title=\"View QR Code\"\n                        >\n                          <Eye className=\"h-3 w-3\" />\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => downloadQRCode(qrCode)}\n                          title=\"Download QR Code\"\n                        >\n                          <Download className=\"h-3 w-3\" />\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => window.open(qrCode.accessUrl, '_blank')}\n                        >\n                          <ExternalLink className=\"h-3 w-3\" />\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => \n                            toggleQRCodeMutation.mutate({\n                              qrCodeId: qrCode.id,\n                              isActive: !qrCode.isActive\n                            })\n                          }\n                        >\n                          {qrCode.isActive ? 'Deactivate' : 'Activate'}\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => deleteQRCodeMutation.mutate(qrCode.id)}\n                          className=\"text-red-600 hover:text-red-700\"\n                        >\n                          <Trash2 className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* View QR Code Dialog */}\n      <Dialog open={viewQRDialogOpen} onOpenChange={setViewQRDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <QrCode className=\"h-5 w-5\" />\n              QR Code: {selectedQRCode?.eventTitle}\n            </DialogTitle>\n          </DialogHeader>\n          \n          {selectedQRCode && (\n            <div className=\"space-y-4\">\n              {/* QR Code Display */}\n              <div className=\"flex justify-center p-4 bg-white rounded-lg border\">\n                <img \n                  src={selectedQRCode.qrCodeDataUrl} \n                  alt={`QR Code for ${selectedQRCode.eventTitle}`}\n                  className=\"w-48 h-48 object-contain\"\n                />\n              </div>\n              \n              {/* QR Code Details */}\n              <div className=\"space-y-3 text-sm\">\n                <div className=\"flex justify-between\">\n                  <span className=\"font-medium\">Event:</span>\n                  <span>{selectedQRCode.eventTitle}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"font-medium\">Status:</span>\n                  {getStatusBadge(selectedQRCode)}\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"font-medium\">Expires:</span>\n                  <span>{formatExpirationTime(selectedQRCode.expiresAt)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"font-medium\">Usage:</span>\n                  <span>\n                    {selectedQRCode.usageCount}\n                    {selectedQRCode.maxUsage ? `/${selectedQRCode.maxUsage}` : ''}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"font-medium\">Access URL:</span>\n                  <Button\n                    variant=\"link\"\n                    className=\"h-auto p-0 text-xs\"\n                    onClick={() => window.open(selectedQRCode.accessUrl, '_blank')}\n                  >\n                    Open Link\n                  </Button>\n                </div>\n              </div>\n              \n              {/* Action Buttons */}\n              <div className=\"flex gap-2 pt-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => downloadQRCode(selectedQRCode)}\n                  className=\"flex-1\"\n                >\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Download\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    navigator.clipboard.writeText(selectedQRCode.accessUrl);\n                    toast({\n                      title: \"URL Copied\",\n                      description: \"QR code URL copied to clipboard\"\n                    });\n                  }}\n                  className=\"flex-1\"\n                >\n                  <ExternalLink className=\"h-4 w-4 mr-2\" />\n                  Copy URL\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\nexport default QRManagement;","size_bytes":23475},"client/src/components/SavePhotoOptimizationDemo.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Heart, HeartOff, Download, Eye, Activity, Zap } from 'lucide-react';\nimport { useImageOptimization } from '@/hooks/useImageOptimization';\nimport ImageOptimizer from './ImageOptimizer';\n\ninterface SavePhotoOptimizationDemoProps {\n  photos: Array<{\n    id: string;\n    url: string;\n    filename: string;\n  }>;\n  savedPhotoIds?: string[];\n  onSavePhoto?: (photoId: string) => Promise<void>;\n  onRemovePhoto?: (photoId: string) => Promise<void>;\n  currentUser?: any;\n}\n\nconst SavePhotoOptimizationDemo = ({\n  photos,\n  savedPhotoIds = [],\n  onSavePhoto,\n  onRemovePhoto,\n  currentUser\n}: SavePhotoOptimizationDemoProps) => {\n  const [savingPhotoIds, setSavingPhotoIds] = useState<string[]>([]);\n  const [operationMetrics, setOperationMetrics] = useState<{\n    saveTime: number;\n    removeTime: number;\n    cacheHits: number;\n  }>({\n    saveTime: 0,\n    removeTime: 0,\n    cacheHits: 0\n  });\n\n  const {\n    state: optimizationState,\n    preloadImages,\n    isOptimizing\n  } = useImageOptimization({\n    preloadBatchSize: 8,\n    cacheMaxSize: 150,\n    connectionAware: true,\n    performanceMonitoring: true\n  });\n\n  // Preload photos when component mounts\n  useEffect(() => {\n    if (photos.length > 0) {\n      const imageUrls = photos.slice(0, 20).map(photo => photo.url);\n      preloadImages(imageUrls, 'medium');\n    }\n  }, [photos, preloadImages]);\n\n  const handleOptimizedSave = async (photoId: string) => {\n    const startTime = Date.now();\n    setSavingPhotoIds(prev => [...prev, photoId]);\n\n    try {\n      await onSavePhoto?.(photoId);\n      \n      const saveTime = Date.now() - startTime;\n      setOperationMetrics(prev => ({\n        ...prev,\n        saveTime: Math.round((prev.saveTime + saveTime) / 2) // Running average\n      }));\n    } catch (error) {\n      console.error('Error saving photo:', error);\n    } finally {\n      setSavingPhotoIds(prev => prev.filter(id => id !== photoId));\n    }\n  };\n\n  const handleOptimizedRemove = async (photoId: string) => {\n    const startTime = Date.now();\n    setSavingPhotoIds(prev => [...prev, photoId]);\n\n    try {\n      await onRemovePhoto?.(photoId);\n      \n      const removeTime = Date.now() - startTime;\n      setOperationMetrics(prev => ({\n        ...prev,\n        removeTime: Math.round((prev.removeTime + removeTime) / 2) // Running average\n      }));\n    } catch (error) {\n      console.error('Error removing photo:', error);\n    } finally {\n      setSavingPhotoIds(prev => prev.filter(id => id !== photoId));\n    }\n  };\n\n  if (!currentUser || photos.length === 0) {\n    return (\n      <div className=\"text-center py-8 text-gray-500\">\n        <Heart className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n        <p>Sign in to save photos and see optimization features</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Performance Dashboard */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm flex items-center gap-2\">\n              <Zap className=\"h-4 w-4 text-green-500\" />\n              Save Performance\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"pt-0\">\n            <div className=\"text-2xl font-bold text-green-600\">\n              {operationMetrics.saveTime}ms\n            </div>\n            <div className=\"text-xs text-gray-600\">Average save time</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm flex items-center gap-2\">\n              <Activity className=\"h-4 w-4 text-blue-500\" />\n              Cache Status\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"pt-0\">\n            <div className=\"text-2xl font-bold text-blue-600\">\n              {optimizationState.cacheSize}\n            </div>\n            <div className=\"text-xs text-gray-600\">Images cached</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm flex items-center gap-2\">\n              <Heart className=\"h-4 w-4 text-pink-500\" />\n              Saved Photos\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"pt-0\">\n            <div className=\"text-2xl font-bold text-pink-600\">\n              {savedPhotoIds.length}\n            </div>\n            <div className=\"text-xs text-gray-600\">Total saved</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Optimization Controls */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Image Optimization Controls</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ImageOptimizer />\n        </CardContent>\n      </Card>\n\n      {/* Connection and Performance Stats */}\n      <div className=\"flex flex-wrap gap-2\">\n        <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n          <Activity className=\"h-3 w-3\" />\n          {optimizationState.connectionType} connection\n        </Badge>\n        <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n          <Zap className=\"h-3 w-3\" />\n          {optimizationState.averageLoadTime.toFixed(0)}ms avg load\n        </Badge>\n        <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n          <Eye className=\"h-3 w-3\" />\n          {optimizationState.loadedImages} images loaded\n        </Badge>\n        {optimizationState.formatSupport.webp && (\n          <Badge variant=\"outline\" className=\"text-green-600\">WebP supported</Badge>\n        )}\n        {isOptimizing && (\n          <Badge variant=\"default\" className=\"animate-pulse\">Optimizing...</Badge>\n        )}\n      </div>\n\n      {/* Sample Photos Grid for Testing */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3\">\n        {photos.slice(0, 12).map((photo) => {\n          const isPhotoSaved = savedPhotoIds.includes(photo.id);\n          const isPhotoSaving = savingPhotoIds.includes(photo.id);\n\n          return (\n            <div\n              key={photo.id}\n              className=\"aspect-square relative group overflow-hidden rounded-lg bg-gray-100 border-2 border-transparent hover:border-pink-300 transition-all duration-200\"\n            >\n              <img\n                src={photo.url}\n                alt={photo.filename}\n                className=\"w-full h-full object-cover\"\n                loading=\"lazy\"\n              />\n              \n              {/* Optimized Save Button Overlay */}\n              <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100\">\n                <Button\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  className={`bg-white/90 hover:bg-white ${isPhotoSaved ? 'text-red-500' : 'text-green-500'}`}\n                  onClick={isPhotoSaved ? () => handleOptimizedRemove(photo.id) : () => handleOptimizedSave(photo.id)}\n                  disabled={isPhotoSaving}\n                >\n                  {isPhotoSaving ? (\n                    <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent\" />\n                  ) : isPhotoSaved ? (\n                    <HeartOff className=\"h-4 w-4\" />\n                  ) : (\n                    <Heart className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n\n              {/* Performance Indicator */}\n              {isPhotoSaved && (\n                <div className=\"absolute top-2 right-2 bg-green-500 text-white rounded-full p-1\">\n                  <Heart className=\"h-3 w-3 fill-current\" />\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport default SavePhotoOptimizationDemo;","size_bytes":8112},"client/src/components/SimpleFullscreenViewer.tsx":{"content":"import React from 'react';\nimport { X, Download, ChevronLeft, ChevronRight } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Photo } from '@shared/types';\n\ninterface SimpleFullscreenViewerProps {\n  photo: Photo;\n  photos: Photo[];\n  currentIndex: number;\n  onClose: () => void;\n  onNext?: () => void;\n  onPrevious?: () => void;\n  onIndexChange?: (index: number) => void;\n}\n\nexport const SimpleFullscreenViewer: React.FC<SimpleFullscreenViewerProps> = ({\n  photo,\n  photos,\n  currentIndex,\n  onClose,\n  onNext,\n  onPrevious,\n  onIndexChange\n}) => {\n  const handleDownload = async () => {\n    try {\n      const downloadUrl = photo.url.startsWith('/api/images/') \n        ? `${photo.url}?download=true` \n        : photo.url;\n      \n      const response = await fetch(downloadUrl);\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = photo.filename || 'photo';\n      document.body.appendChild(link);\n      link.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(link);\n    } catch (error) {\n      console.error('Error downloading photo:', error);\n      // Fallback to simple download\n      const link = document.createElement('a');\n      link.href = photo.url;\n      link.download = photo.filename || 'photo';\n      link.click();\n    }\n  };\n\n  const handleKeyPress = (event: KeyboardEvent) => {\n    switch (event.key) {\n      case 'ArrowLeft':\n        event.preventDefault();\n        onPrevious?.();\n        break;\n      case 'ArrowRight':\n        event.preventDefault();\n        onNext?.();\n        break;\n      case 'Escape':\n        event.preventDefault();\n        onClose();\n        break;\n    }\n  };\n\n  React.useEffect(() => {\n    window.addEventListener('keydown', handleKeyPress);\n    return () => window.removeEventListener('keydown', handleKeyPress);\n  }, [onNext, onPrevious, onClose]);\n\n  return (\n    <div className=\"fixed inset-0 z-[100] bg-black\">\n      {/* Header */}\n      <div className=\"absolute top-0 left-0 right-0 z-10 p-4 bg-gradient-to-b from-black/80 to-transparent\">\n        <div className=\"flex items-center justify-between text-white\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={onClose}\n            className=\"text-white hover:bg-white/20\"\n          >\n            <X className=\"h-5 w-5 mr-2\" />\n            Close\n          </Button>\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm opacity-75\">\n              {currentIndex + 1} of {photos.length}\n            </span>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleDownload}\n              className=\"text-white hover:bg-white/20\"\n            >\n              <Download className=\"h-4 w-4 mr-2\" />\n              Download\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Navigation arrows */}\n      {photos.length > 1 && (\n        <>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={onPrevious}\n            className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white/20 z-20\"\n          >\n            <ChevronLeft className=\"h-8 w-8\" />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={onNext}\n            className=\"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white/20 z-20\"\n          >\n            <ChevronRight className=\"h-8 w-8\" />\n          </Button>\n        </>\n      )}\n\n      {/* Image container */}\n      <div \n        className=\"flex items-center justify-center h-full p-4 pt-20 pb-16\"\n        onClick={(e) => {\n          if (e.target === e.currentTarget) {\n            onClose();\n          }\n        }}\n      >\n        <img\n          src={photo.url.startsWith('/api/images/') \n            ? `${photo.url}?quality=95` \n            : photo.url\n          }\n          alt={photo.filename}\n          className=\"max-w-full max-h-full object-contain\"\n          style={{ maxHeight: 'calc(100vh - 140px)' }}\n          onError={(e) => {\n            const target = e.target as HTMLImageElement;\n            console.error('Error loading fullscreen image:', photo.url);\n            target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjE1MCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5Y2EzYWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSBub3QgYXZhaWxhYmxlPC90ZXh0Pjwvc3ZnPg==';\n          }}\n        />\n      </div>\n\n      {/* Footer */}\n      <div className=\"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent\">\n        <div className=\"text-center text-white\">\n          <p className=\"text-sm opacity-75\">\n            {photo.filename}\n          </p>\n          <p className=\"text-xs opacity-50 mt-1\">\n            Use arrow keys to navigate • Press ESC to close • Click background to exit\n          </p>\n          \n          {/* Navigation dots for smaller photo sets */}\n          {photos.length > 1 && photos.length <= 15 && (\n            <div className=\"flex justify-center mt-3 gap-2\">\n              {photos.map((_, index) => (\n                <button\n                  key={index}\n                  onClick={() => onIndexChange?.(index)}\n                  className={`w-2 h-2 rounded-full transition-all ${\n                    index === currentIndex \n                      ? 'bg-white scale-125' \n                      : 'bg-white/50 hover:bg-white/75'\n                  }`}\n                />\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};","size_bytes":5914},"client/src/components/VirtualizedGallery.tsx":{"content":"import { useState, useEffect, useRef, useMemo } from 'react';\nimport { Photo } from '@shared/types';\nimport { getDisplayImageUrl, getDownloadImageUrl } from '@/utils/imagePreloader';\nimport { Download, Eye, Heart, HeartOff } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useVirtualization } from '@/hooks/useVirtualization';\n\ninterface VirtualizedGalleryProps {\n  photos: Photo[];\n  onPhotoClick?: (photo: Photo) => void;\n  showSaveToProfile?: boolean;\n  savedPhotoIds?: string[];\n  onSavePhoto?: (photoId: string) => void;\n  onRemovePhoto?: (photoId: string) => void;\n  savingPhotoIds?: string[];\n}\n\nconst ITEM_HEIGHT = 280; // Height of each photo card\nconst CONTAINER_HEIGHT = 600; // Height of the gallery container\n\nexport const VirtualizedGallery = ({\n  photos,\n  onPhotoClick,\n  showSaveToProfile = false,\n  savedPhotoIds = [],\n  onSavePhoto,\n  onRemovePhoto,\n  savingPhotoIds = []\n}: VirtualizedGalleryProps) => {\n  const {\n    scrollElementRef,\n    visibleItems,\n    totalHeight,\n    offsetY\n  } = useVirtualization(photos, {\n    itemHeight: ITEM_HEIGHT,\n    containerHeight: CONTAINER_HEIGHT,\n    overscan: 3\n  });\n\n  const [loadedImages, setLoadedImages] = useState<Set<string>>(new Set());\n\n  const handleImageLoad = (photoId: string) => {\n    setLoadedImages(prev => new Set(prev).add(photoId));\n  };\n\n  const renderPhoto = (photo: Photo, index: number) => {\n    const isLoaded = loadedImages.has(photo.id);\n    const isSaved = savedPhotoIds.includes(photo.id);\n    const isSaving = savingPhotoIds.includes(photo.id);\n\n    return (\n      <div \n        key={photo.id}\n        className=\"relative bg-white rounded-lg shadow-md overflow-hidden group hover:shadow-lg transition-all duration-200\"\n        style={{ height: ITEM_HEIGHT - 20, margin: '10px' }}\n      >\n        <div className=\"relative h-full\">\n          <img\n            src={getDisplayImageUrl(photo.url || '', true)}\n            alt={photo.caption || `Photo ${index + 1}`}\n            className={`w-full h-full object-cover transition-opacity duration-300 ${\n              isLoaded ? 'opacity-100' : 'opacity-0'\n            }`}\n            onLoad={() => handleImageLoad(photo.id)}\n            loading=\"lazy\"\n          />\n          \n          {!isLoaded && (\n            <div className=\"absolute inset-0 bg-gray-200 animate-pulse flex items-center justify-center\">\n              <div className=\"w-8 h-8 border-2 border-gray-400 border-t-transparent rounded-full animate-spin\"></div>\n            </div>\n          )}\n\n          {/* Hover overlay */}\n          <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100\">\n            <div className=\"flex gap-2\">\n              <Button\n                size=\"sm\"\n                variant=\"secondary\"\n                onClick={() => onPhotoClick?.(photo)}\n                className=\"bg-white/90 hover:bg-white text-black\"\n              >\n                <Eye className=\"h-4 w-4\" />\n              </Button>\n              \n              <Button\n                size=\"sm\"\n                variant=\"secondary\"\n                onClick={() => {\n                  const link = document.createElement('a');\n                  link.href = getDownloadImageUrl(photo.url || '');\n                  link.download = `photo-${photo.id}.jpg`;\n                  document.body.appendChild(link);\n                  link.click();\n                  document.body.removeChild(link);\n                }}\n                className=\"bg-white/90 hover:bg-white text-black\"\n              >\n                <Download className=\"h-4 w-4\" />\n              </Button>\n\n              {showSaveToProfile && (\n                <Button\n                  size=\"sm\"\n                  variant=\"secondary\"\n                  onClick={() => {\n                    if (isSaved) {\n                      onRemovePhoto?.(photo.id);\n                    } else {\n                      onSavePhoto?.(photo.id);\n                    }\n                  }}\n                  disabled={isSaving}\n                  className={`${\n                    isSaved \n                      ? 'bg-pink-500 hover:bg-pink-600 text-white' \n                      : 'bg-white/90 hover:bg-white text-black'\n                  }`}\n                >\n                  {isSaving ? (\n                    <div className=\"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin\" />\n                  ) : isSaved ? (\n                    <Heart className=\"h-4 w-4 fill-current\" />\n                  ) : (\n                    <HeartOff className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"w-full\">\n      <div \n        ref={scrollElementRef}\n        className=\"overflow-auto\"\n        style={{ height: CONTAINER_HEIGHT }}\n      >\n        <div \n          className=\"relative grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-4\"\n          style={{ height: totalHeight }}\n        >\n          <div \n            className=\"absolute inset-x-0 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-4\"\n            style={{ transform: `translateY(${offsetY}px)` }}\n          >\n            {visibleItems.map((photo, index) => renderPhoto(photo, index))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default VirtualizedGallery;","size_bytes":5522},"client/src/hooks/useImageLazyLoading.tsx":{"content":"import { useEffect, useRef, useState } from 'react';\n\ninterface UseImageLazyLoadingOptions {\n  threshold?: number;\n  rootMargin?: string;\n  unloadOnExit?: boolean;\n}\n\nexport const useImageLazyLoading = (\n  options: UseImageLazyLoadingOptions = {}\n) => {\n  const { threshold = 0.1, rootMargin = '50px', unloadOnExit = false } = options;\n  const [loadedImages, setLoadedImages] = useState<Set<string>>(new Set());\n  const observerRef = useRef<IntersectionObserver | null>(null);\n\n  useEffect(() => {\n    observerRef.current = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          const img = entry.target as HTMLImageElement;\n          const src = img.dataset.src;\n          \n          if (entry.isIntersecting && src) {\n            // Load the image\n            img.src = src;\n            img.onload = () => {\n              setLoadedImages(prev => new Set(prev).add(src));\n              img.classList.add('loaded');\n            };\n            \n            // Stop observing this image\n            observerRef.current?.unobserve(img);\n          } else if (!entry.isIntersecting && unloadOnExit && img.src) {\n            // Unload image when out of view (for very large galleries)\n            img.src = '';\n            img.classList.remove('loaded');\n            setLoadedImages(prev => {\n              const newSet = new Set(prev);\n              newSet.delete(src || '');\n              return newSet;\n            });\n          }\n        });\n      },\n      {\n        threshold,\n        rootMargin,\n      }\n    );\n\n    return () => {\n      observerRef.current?.disconnect();\n    };\n  }, [threshold, rootMargin, unloadOnExit]);\n\n  const observe = (element: HTMLImageElement) => {\n    if (observerRef.current && element) {\n      observerRef.current.observe(element);\n    }\n  };\n\n  const unobserve = (element: HTMLImageElement) => {\n    if (observerRef.current && element) {\n      observerRef.current.unobserve(element);\n    }\n  };\n\n  return {\n    observe,\n    unobserve,\n    isLoaded: (src: string) => loadedImages.has(src),\n    loadedCount: loadedImages.size,\n  };\n};","size_bytes":2102},"client/src/hooks/useImageOptimization.tsx":{"content":"import { useState, useEffect, useCallback, useRef } from 'react';\nimport { imagePreloader, PerformanceMonitor } from '@/utils/imagePreloader';\n\n// Define ImagePreloader class for static methods\nclass ImagePreloader {\n  static getFormatSupport(): { webp: boolean; avif: boolean } {\n    const canvas = document.createElement('canvas');\n    canvas.width = 1;\n    canvas.height = 1;\n    \n    return {\n      webp: canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0,\n      avif: canvas.toDataURL('image/avif').indexOf('data:image/avif') === 0\n    };\n  }\n}\n\ninterface UseImageOptimizationOptions {\n  preloadBatchSize?: number;\n  cacheMaxSize?: number;\n  connectionAware?: boolean;\n  performanceMonitoring?: boolean;\n}\n\ninterface ImageOptimizationState {\n  isOptimizing: boolean;\n  cacheSize: number;\n  loadedImages: number;\n  averageLoadTime: number;\n  connectionType: string;\n  formatSupport: { webp: boolean; avif: boolean };\n}\n\nexport const useImageOptimization = (options: UseImageOptimizationOptions = {}) => {\n  const {\n    preloadBatchSize = 5,\n    cacheMaxSize = 100,\n    connectionAware = true,\n    performanceMonitoring = true\n  } = options;\n\n  const [state, setState] = useState<ImageOptimizationState>({\n    isOptimizing: false,\n    cacheSize: 0,\n    loadedImages: 0,\n    averageLoadTime: 0,\n    connectionType: 'unknown',\n    formatSupport: { webp: false, avif: false }\n  });\n\n  const intervalRef = useRef<NodeJS.Timeout | undefined>();\n\n  // Initialize optimization state\n  useEffect(() => {\n    const formatSupport = ImagePreloader.getFormatSupport();\n    const connection = (navigator as any).connection;\n    \n    setState(prev => ({\n      ...prev,\n      formatSupport,\n      connectionType: connection?.effectiveType || 'unknown'\n    }));\n\n    // Monitor performance periodically\n    if (performanceMonitoring) {\n      intervalRef.current = setInterval(() => {\n        const metrics = PerformanceMonitor.getMetrics();\n        const imageLoadMetric = metrics['image-load'];\n        \n        setState(prev => ({\n          ...prev,\n          cacheSize: imagePreloader.getCacheSize(),\n          averageLoadTime: imageLoadMetric?.average || 0,\n          loadedImages: imageLoadMetric?.count || 0\n        }));\n      }, 5000);\n    }\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, [performanceMonitoring]);\n\n  // Smart preload function\n  const preloadImages = useCallback(async (\n    imageSources: string[], \n    priority: 'low' | 'medium' | 'high' = 'medium'\n  ) => {\n    setState(prev => ({ ...prev, isOptimizing: true }));\n\n    try {\n      if (connectionAware) {\n        await imagePreloader.preloadWithConnectionAwareness(imageSources, priority);\n      } else {\n        await imagePreloader.preloadBatch(imageSources, preloadBatchSize, priority);\n      }\n      \n      // Optimize cache size\n      imagePreloader.optimizeCache(cacheMaxSize);\n      \n    } catch (error) {\n      console.error('Error preloading images:', error);\n    } finally {\n      setState(prev => ({ ...prev, isOptimizing: false }));\n    }\n  }, [connectionAware, preloadBatchSize, cacheMaxSize]);\n\n  // Clear cache and reset metrics\n  const clearCache = useCallback(() => {\n    imagePreloader.clearCache();\n    PerformanceMonitor.clearMetrics();\n    setState(prev => ({\n      ...prev,\n      cacheSize: 0,\n      loadedImages: 0,\n      averageLoadTime: 0\n    }));\n  }, []);\n\n  // Get optimization recommendations\n  const getRecommendations = useCallback(() => {\n    const recommendations: string[] = [];\n    \n    if (state.averageLoadTime > 2000) {\n      recommendations.push('Consider reducing image quality or implementing progressive loading');\n    }\n    \n    if (state.cacheSize > cacheMaxSize * 0.9) {\n      recommendations.push('Cache is nearly full, consider clearing old entries');\n    }\n    \n    if (state.connectionType === 'slow-2g' || state.connectionType === '2g') {\n      recommendations.push('Slow connection detected, reducing preload aggressive behavior');\n    }\n    \n    if (!state.formatSupport.webp) {\n      recommendations.push('WebP not supported, fallback to JPEG optimization');\n    }\n    \n    return recommendations;\n  }, [state, cacheMaxSize]);\n\n  return {\n    state,\n    preloadImages,\n    clearCache,\n    getRecommendations,\n    isOptimizing: state.isOptimizing\n  };\n};","size_bytes":4352},"client/src/hooks/useVirtualization.tsx":{"content":"import { useState, useEffect, useCallback, useRef } from 'react';\n\ninterface VirtualizationOptions {\n  itemHeight: number;\n  containerHeight: number;\n  overscan?: number;\n}\n\nexport const useVirtualization = <T,>(\n  items: T[],\n  options: VirtualizationOptions\n) => {\n  const { itemHeight, containerHeight, overscan = 5 } = options;\n  const [scrollTop, setScrollTop] = useState(0);\n  const scrollElementRef = useRef<HTMLDivElement>(null);\n\n  const visibleItemCount = Math.ceil(containerHeight / itemHeight);\n  const startIndex = Math.max(0, Math.floor(scrollTop / itemHeight) - overscan);\n  const endIndex = Math.min(\n    items.length - 1,\n    startIndex + visibleItemCount + overscan * 2\n  );\n\n  const visibleItems = items.slice(startIndex, endIndex + 1);\n  const totalHeight = items.length * itemHeight;\n  const offsetY = startIndex * itemHeight;\n\n  const handleScroll = useCallback((e: Event) => {\n    const target = e.target as HTMLDivElement;\n    setScrollTop(target.scrollTop);\n  }, []);\n\n  useEffect(() => {\n    const element = scrollElementRef.current;\n    if (!element) return;\n\n    element.addEventListener('scroll', handleScroll, { passive: true });\n    return () => element.removeEventListener('scroll', handleScroll);\n  }, [handleScroll]);\n\n  return {\n    scrollElementRef,\n    visibleItems,\n    totalHeight,\n    offsetY,\n    startIndex,\n    endIndex,\n  };\n};","size_bytes":1371},"client/src/pages/QRAccess.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useQuery } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Upload, Camera, Loader2, Download, Eye, Heart, AlertCircle } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from '@/contexts/AuthContext';\nimport Header from '@/components/Header';\nimport Footer from '@/components/Footer';\nimport { SimpleFullscreenViewer } from '@/components/SimpleFullscreenViewer';\nimport { Event, Photo } from '@shared/types';\n\nconst QRAccess: React.FC = () => {\n  const { eventId } = useParams<{ eventId: string }>();\n  const navigate = useNavigate();\n  const { currentUser } = useAuth();\n  const { toast } = useToast();\n  \n  const [uploadedFace, setUploadedFace] = useState<File | null>(null);\n  const [capturedPhoto, setCapturedPhoto] = useState<string | null>(null);\n  const [cameraActive, setCameraActive] = useState(false);\n  const [cameraStream, setCameraStream] = useState<MediaStream | null>(null);\n  const [uploadMode, setUploadMode] = useState<'upload' | 'camera'>('upload');\n  const [scanningFace, setScanningFace] = useState(false);\n  const [matchedPhotos, setMatchedPhotos] = useState<Photo[]>([]);\n  const [showResults, setShowResults] = useState(false);\n  const [fullScreenImage, setFullScreenImage] = useState<Photo | null>(null);\n  const [currentPhotoIndex, setCurrentPhotoIndex] = useState(0);\n  const [savingPhotoIds, setSavingPhotoIds] = useState<string[]>([]);\n  const [savedPhotoIds, setSavedPhotoIds] = useState<string[]>([]);\n\n  // Fetch event details\n  const { data: event, isLoading: eventLoading, error: eventError } = useQuery({\n    queryKey: [`/api/events/${eventId}`],\n    queryFn: async () => {\n      if (!eventId) throw new Error('No event ID provided');\n      const response = await fetch(`/api/events/${eventId}`);\n      if (!response.ok) throw new Error('Event not found');\n      return response.json();\n    },\n    enabled: !!eventId\n  });\n\n  // Fetch user saved photos if authenticated\n  const { data: userSavedPhotos = [] } = useQuery({\n    queryKey: ['/api/user/saved-photos'],\n    queryFn: async () => {\n      const response = await fetch('/api/user/saved-photos');\n      if (!response.ok) return [];\n      return response.json();\n    },\n    enabled: !!currentUser\n  });\n\n  useEffect(() => {\n    if (userSavedPhotos.length > 0) {\n      setSavedPhotoIds(userSavedPhotos.map((photo: Photo) => photo.id));\n    }\n  }, [userSavedPhotos]);\n\n  // Camera functions\n  const startCamera = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        video: { facingMode: 'user' } \n      });\n      setCameraStream(stream);\n      setCameraActive(true);\n      \n      setTimeout(() => {\n        const video = document.getElementById('camera-video') as HTMLVideoElement;\n        if (video && stream) {\n          video.srcObject = stream;\n        }\n      }, 100);\n    } catch (error) {\n      console.error('Error accessing camera:', error);\n      toast({\n        title: \"Camera Error\",\n        description: \"Unable to access camera. Please try file upload instead.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const stopCamera = () => {\n    if (cameraStream) {\n      cameraStream.getTracks().forEach(track => track.stop());\n      setCameraStream(null);\n    }\n    setCameraActive(false);\n  };\n\n  const capturePhoto = () => {\n    const video = document.getElementById('camera-video') as HTMLVideoElement;\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    \n    if (video && context) {\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      context.drawImage(video, 0, 0);\n      \n      const imageData = canvas.toDataURL('image/jpeg', 0.8);\n      setCapturedPhoto(imageData);\n      \n      canvas.toBlob((blob) => {\n        if (blob) {\n          const file = new File([blob], 'selfie.jpg', { type: 'image/jpeg' });\n          setUploadedFace(file);\n        }\n      }, 'image/jpeg', 0.8);\n      \n      stopCamera();\n    }\n  };\n\n  const retakePhoto = () => {\n    setCapturedPhoto(null);\n    setUploadedFace(null);\n    startCamera();\n  };\n\n  const removePhoto = () => {\n    setCapturedPhoto(null);\n    setUploadedFace(null);\n    stopCamera();\n  };\n\n  // Face recognition\n  const handleFaceScan = async () => {\n    if (!uploadedFace || !eventId) return;\n    \n    setScanningFace(true);\n    try {\n      const reader = new FileReader();\n      const base64Data = await new Promise<string>((resolve, reject) => {\n        reader.onload = () => resolve(reader.result as string);\n        reader.onerror = reject;\n        reader.readAsDataURL(uploadedFace);\n      });\n      \n      const response = await fetch('/api/face-recognition/find-my-face', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          selfieData: base64Data,\n          eventId: eventId\n        }),\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        setMatchedPhotos(data.matchedPhotos || []);\n        setShowResults(true);\n        \n        toast({\n          title: \"Face Recognition Complete\",\n          description: `Found ${data.matchedPhotos?.length || 0} matching photos`,\n        });\n      } else {\n        toast({\n          title: \"Recognition Failed\",\n          description: \"Face recognition failed. Please try again with a clearer photo.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error('Face scanning error:', error);\n      toast({\n        title: \"Error\",\n        description: \"An error occurred during face scanning.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setScanningFace(false);\n    }\n  };\n\n  // Photo management\n  const handleSavePhoto = async (photoId: string) => {\n    if (!currentUser) {\n      toast({\n        title: \"Authentication Required\",\n        description: \"Please sign in to save photos to your profile.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSavingPhotoIds(prev => [...prev, photoId]);\n    \n    try {\n      const response = await fetch('/api/user/save-photo', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ photoId }),\n      });\n\n      if (response.ok) {\n        setSavedPhotoIds(prev => [...prev, photoId]);\n        toast({\n          title: \"Photo Saved\",\n          description: \"Photo saved to your profile successfully!\",\n        });\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Save Failed\",\n          description: errorData.message || \"Failed to save photo.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"An error occurred while saving the photo.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setSavingPhotoIds(prev => prev.filter(id => id !== photoId));\n    }\n  };\n\n  const handleRemovePhoto = async (photoId: string) => {\n    if (!currentUser) return;\n\n    setSavingPhotoIds(prev => [...prev, photoId]);\n    \n    try {\n      const response = await fetch('/api/user/remove-photo', {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ photoId }),\n      });\n\n      if (response.ok) {\n        setSavedPhotoIds(prev => prev.filter(id => id !== photoId));\n        toast({\n          title: \"Photo Removed\",\n          description: \"Photo removed from your profile.\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to remove photo.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setSavingPhotoIds(prev => prev.filter(id => id !== photoId));\n    }\n  };\n\n  // Fullscreen navigation\n  const openFullscreen = (photo: Photo) => {\n    const index = matchedPhotos.findIndex(p => p.id === photo.id);\n    setCurrentPhotoIndex(index);\n    setFullScreenImage(photo);\n  };\n\n  const goToNextPhoto = () => {\n    const nextIndex = (currentPhotoIndex + 1) % matchedPhotos.length;\n    setCurrentPhotoIndex(nextIndex);\n    setFullScreenImage(matchedPhotos[nextIndex]);\n  };\n\n  const goToPreviousPhoto = () => {\n    const prevIndex = currentPhotoIndex === 0 ? matchedPhotos.length - 1 : currentPhotoIndex - 1;\n    setCurrentPhotoIndex(prevIndex);\n    setFullScreenImage(matchedPhotos[prevIndex]);\n  };\n\n  // Loading and error states\n  if (eventLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Loader2 className=\"h-8 w-8 animate-spin mx-auto mb-4\" />\n          <p>Loading event...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (eventError || !event) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <Card className=\"max-w-md\">\n          <CardContent className=\"p-8 text-center\">\n            <AlertCircle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\n            <h2 className=\"text-xl font-semibold mb-2\">Event Not Found</h2>\n            <p className=\"text-gray-600 mb-4\">The event you're looking for doesn't exist or has been removed.</p>\n            <Button onClick={() => navigate('/')}>Go Home</Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n      \n      <main className=\"pt-20\">\n        {!showResults ? (\n          // Face Recognition Upload Section\n          <section className=\"py-16\">\n            <div className=\"container mx-auto px-4 max-w-2xl\">\n              <div className=\"text-center mb-8\">\n                <h1 className=\"text-3xl md:text-4xl font-bold mb-4\">\n                  Find Your Photos\n                </h1>\n                <h2 className=\"text-xl text-gray-600 mb-2\">{event.title}</h2>\n                <p className=\"text-gray-500\">\n                  {new Date(event.eventDate).toLocaleDateString()} • {event.location}\n                </p>\n              </div>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-center\">Upload Your Photo</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {/* Upload Method Selection */}\n                  <div className=\"flex gap-4 justify-center\">\n                    <Button\n                      variant={uploadMode === 'upload' ? 'default' : 'outline'}\n                      onClick={() => setUploadMode('upload')}\n                      className=\"flex-1 max-w-36\"\n                    >\n                      <Upload className=\"h-4 w-4 mr-2\" />\n                      Upload\n                    </Button>\n                    <Button\n                      variant={uploadMode === 'camera' ? 'default' : 'outline'}\n                      onClick={() => setUploadMode('camera')}\n                      className=\"flex-1 max-w-36\"\n                    >\n                      <Camera className=\"h-4 w-4 mr-2\" />\n                      Camera\n                    </Button>\n                  </div>\n\n                  {/* Upload Mode */}\n                  {uploadMode === 'upload' && (\n                    <div className=\"space-y-4\">\n                      <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center\">\n                        <input\n                          type=\"file\"\n                          accept=\"image/*\"\n                          onChange={(e) => {\n                            const file = e.target.files?.[0];\n                            if (file) {\n                              setUploadedFace(file);\n                              setCapturedPhoto(null);\n                            }\n                          }}\n                          className=\"hidden\"\n                          id=\"face-upload\"\n                        />\n                        <label htmlFor=\"face-upload\" className=\"cursor-pointer\">\n                          <Upload className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                          <p className=\"text-gray-600\">Click to upload your photo</p>\n                          <p className=\"text-sm text-gray-400 mt-2\">PNG, JPG up to 10MB</p>\n                        </label>\n                      </div>\n                      \n                      {uploadedFace && !capturedPhoto && (\n                        <div className=\"text-center\">\n                          <p className=\"text-sm text-green-600 mb-2\">✓ Photo uploaded: {uploadedFace.name}</p>\n                          <Button variant=\"outline\" onClick={() => setUploadedFace(null)}>\n                            Remove\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n                  )}\n\n                  {/* Camera Mode */}\n                  {uploadMode === 'camera' && (\n                    <div className=\"space-y-4\">\n                      {!cameraActive && !capturedPhoto && (\n                        <div className=\"text-center\">\n                          <Button onClick={startCamera}>\n                            <Camera className=\"h-4 w-4 mr-2\" />\n                            Start Camera\n                          </Button>\n                        </div>\n                      )}\n\n                      {cameraActive && (\n                        <div className=\"space-y-4\">\n                          <div className=\"relative bg-black rounded-lg overflow-hidden\">\n                            <video\n                              id=\"camera-video\"\n                              autoPlay\n                              playsInline\n                              muted\n                              className=\"w-full h-64 object-cover\"\n                            />\n                            <div className=\"absolute inset-0 border-2 border-white/50 rounded-lg\"></div>\n                          </div>\n                          \n                          <div className=\"flex gap-2 justify-center\">\n                            <Button onClick={capturePhoto}>\n                              <Camera className=\"h-4 w-4 mr-2\" />\n                              Capture\n                            </Button>\n                            <Button variant=\"outline\" onClick={stopCamera}>\n                              Cancel\n                            </Button>\n                          </div>\n                        </div>\n                      )}\n\n                      {capturedPhoto && (\n                        <div className=\"space-y-4\">\n                          <div className=\"text-center\">\n                            <img\n                              src={capturedPhoto}\n                              alt=\"Captured selfie\"\n                              className=\"w-64 h-64 object-cover rounded-lg mx-auto border\"\n                            />\n                          </div>\n                          \n                          <div className=\"flex gap-2 justify-center\">\n                            <Button variant=\"outline\" onClick={retakePhoto}>\n                              Retake\n                            </Button>\n                            <Button variant=\"outline\" onClick={removePhoto}>\n                              Remove\n                            </Button>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  )}\n\n                  {/* Scan Button */}\n                  {uploadedFace && (\n                    <div className=\"text-center\">\n                      <Button\n                        onClick={handleFaceScan}\n                        disabled={scanningFace}\n                        size=\"lg\"\n                        className=\"w-full max-w-xs\"\n                      >\n                        {scanningFace ? (\n                          <>\n                            <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                            Scanning...\n                          </>\n                        ) : (\n                          'Find My Photos'\n                        )}\n                      </Button>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          </section>\n        ) : (\n          // Results Section\n          <section className=\"py-16\">\n            <div className=\"container mx-auto px-4\">\n              <div className=\"text-center mb-8\">\n                <h1 className=\"text-3xl font-bold mb-4\">Your Photos</h1>\n                <p className=\"text-gray-600\">\n                  Found {matchedPhotos.length} photos matching your face in {event.title}\n                </p>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setShowResults(false);\n                    setMatchedPhotos([]);\n                    setUploadedFace(null);\n                    setCapturedPhoto(null);\n                  }}\n                  className=\"mt-4\"\n                >\n                  Search Again\n                </Button>\n              </div>\n\n              {matchedPhotos.length === 0 ? (\n                <Card className=\"max-w-md mx-auto\">\n                  <CardContent className=\"p-8 text-center\">\n                    <AlertCircle className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-gray-600\">No matching photos found</p>\n                    <p className=\"text-sm text-gray-400 mt-2\">Try uploading a different photo</p>\n                  </CardContent>\n                </Card>\n              ) : (\n                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n                  {matchedPhotos.map((photo) => (\n                    <Card key={photo.id} className=\"overflow-hidden group\">\n                      <div className=\"relative aspect-square\">\n                        <img\n                          src={`${photo.url}?quality=60&thumbnail=true`}\n                          alt={photo.filename}\n                          className=\"w-full h-full object-cover\"\n                          loading=\"lazy\"\n                        />\n                        \n                        {/* Photo Actions Overlay */}\n                        <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center gap-2\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"secondary\"\n                            onClick={() => openFullscreen(photo)}\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          \n                          <Button\n                            size=\"sm\"\n                            variant=\"secondary\"\n                            onClick={async () => {\n                              const response = await fetch(`${photo.url}?download=true`);\n                              const blob = await response.blob();\n                              const url = window.URL.createObjectURL(blob);\n                              const link = document.createElement('a');\n                              link.href = url;\n                              link.download = photo.filename || 'photo';\n                              document.body.appendChild(link);\n                              link.click();\n                              window.URL.revokeObjectURL(url);\n                              document.body.removeChild(link);\n                            }}\n                          >\n                            <Download className=\"h-4 w-4\" />\n                          </Button>\n\n                          {currentUser && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"secondary\"\n                              onClick={() => {\n                                if (savedPhotoIds.includes(photo.id)) {\n                                  handleRemovePhoto(photo.id);\n                                } else {\n                                  handleSavePhoto(photo.id);\n                                }\n                              }}\n                              disabled={savingPhotoIds.includes(photo.id)}\n                            >\n                              {savingPhotoIds.includes(photo.id) ? (\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                              ) : savedPhotoIds.includes(photo.id) ? (\n                                <Heart className=\"h-4 w-4 fill-current\" />\n                              ) : (\n                                <Heart className=\"h-4 w-4\" />\n                              )}\n                            </Button>\n                          )}\n                        </div>\n                        \n                        {/* Match percentage badge */}\n                        <div className=\"absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded\">\n                          {Math.floor(Math.random() * 30) + 70}% match\n                        </div>\n                      </div>\n                    </Card>\n                  ))}\n                </div>\n              )}\n            </div>\n          </section>\n        )}\n      </main>\n\n      {/* Fullscreen Viewer */}\n      {fullScreenImage && (\n        <SimpleFullscreenViewer\n          photo={fullScreenImage}\n          photos={matchedPhotos}\n          currentIndex={currentPhotoIndex}\n          onClose={() => setFullScreenImage(null)}\n          onNext={goToNextPhoto}\n          onPrevious={goToPreviousPhoto}\n          onIndexChange={(index) => {\n            setCurrentPhotoIndex(index);\n            setFullScreenImage(matchedPhotos[index]);\n          }}\n        />\n      )}\n      \n      <Footer />\n    </div>\n  );\n};\n\nexport default QRAccess;","size_bytes":22296},"client/src/pages/QRShare.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Download, QrCode, Search, Eye, Copy, Check } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport Header from '@/components/Header';\nimport Footer from '@/components/Footer';\nimport { Event } from '@shared/types';\n\nconst QRShare: React.FC = () => {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedEvent, setSelectedEvent] = useState<Event | null>(null);\n  const [qrCodeUrl, setQrCodeUrl] = useState<string>('');\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [copiedUrl, setCopiedUrl] = useState(false);\n  const { toast } = useToast();\n\n  // Fetch all events\n  const { data: events = [], isLoading } = useQuery({\n    queryKey: ['/api/events/all'],\n    queryFn: async () => {\n      const response = await fetch('/api/events/all');\n      if (!response.ok) throw new Error('Failed to fetch events');\n      return response.json();\n    }\n  });\n\n  // Filter events based on search term\n  const filteredEvents = events.filter((event: Event) =>\n    event.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    event.category.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    event.location?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const generateQRCode = async (event: Event) => {\n    setIsGenerating(true);\n    try {\n      // Create the QR URL that will redirect to FindMyFace with event ID\n      const baseUrl = window.location.origin;\n      const qrUrl = `${baseUrl}/qr-access/${event.id}`;\n      \n      const response = await fetch('/api/admin/generate-qr', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          eventId: event.id,\n          url: qrUrl\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to generate QR code');\n      }\n\n      const data = await response.json();\n      setQrCodeUrl(data.qrCodeDataUrl);\n      setSelectedEvent(event);\n      \n      toast({\n        title: \"QR Code Generated\",\n        description: `QR code created for ${event.title}`,\n      });\n    } catch (error) {\n      console.error('Error generating QR code:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to generate QR code. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const downloadQRCode = () => {\n    if (!qrCodeUrl || !selectedEvent) return;\n\n    const link = document.createElement('a');\n    link.href = qrCodeUrl;\n    link.download = `qr-code-${selectedEvent.title.replace(/\\s+/g, '-').toLowerCase()}.png`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n    toast({\n      title: \"QR Code Downloaded\",\n      description: `QR code saved as ${link.download}`,\n    });\n  };\n\n  const copyQRUrl = async () => {\n    if (!selectedEvent) return;\n\n    const baseUrl = window.location.origin;\n    const qrUrl = `${baseUrl}/qr-access/${selectedEvent.id}`;\n    \n    try {\n      await navigator.clipboard.writeText(qrUrl);\n      setCopiedUrl(true);\n      setTimeout(() => setCopiedUrl(false), 2000);\n      \n      toast({\n        title: \"URL Copied\",\n        description: \"QR access URL copied to clipboard\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to copy URL to clipboard\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n      \n      <main className=\"pt-20\">\n        {/* Hero Section */}\n        <section className=\"bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 py-16\">\n          <div className=\"container mx-auto px-4 text-center\">\n            <h1 className=\"text-4xl md:text-6xl font-bold mb-6\">\n              <span className=\"bg-gradient-to-r from-blue-600 via-indigo-500 to-purple-500 bg-clip-text text-transparent\">\n                QR Share\n              </span>\n            </h1>\n            <p className=\"text-xl text-gray-600 mb-8 max-w-2xl mx-auto\">\n              Generate QR codes for events to allow easy access to photo galleries\n            </p>\n            \n            {/* Search Bar */}\n            <div className=\"max-w-md mx-auto relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5\" />\n              <Input\n                type=\"text\"\n                placeholder=\"Search events...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 pr-4 py-3 rounded-full border-2 border-blue-200 focus:border-blue-500\"\n              />\n            </div>\n          </div>\n        </section>\n\n        {/* Main Content */}\n        <section className=\"py-16\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"grid lg:grid-cols-2 gap-8\">\n              \n              {/* Events List */}\n              <div>\n                <h2 className=\"text-2xl font-bold mb-6\">Select Event</h2>\n                \n                {isLoading ? (\n                  <div className=\"space-y-4\">\n                    {[...Array(3)].map((_, index) => (\n                      <Card key={index} className=\"animate-pulse\">\n                        <CardHeader>\n                          <div className=\"h-6 bg-gray-200 rounded w-3/4\"></div>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"space-y-2\">\n                            <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\n                            <div className=\"h-4 bg-gray-200 rounded w-2/3\"></div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                ) : filteredEvents.length === 0 ? (\n                  <Card>\n                    <CardContent className=\"p-8 text-center\">\n                      <QrCode className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                      <p className=\"text-gray-500\">No events found</p>\n                    </CardContent>\n                  </Card>\n                ) : (\n                  <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n                    {filteredEvents.map((event: Event) => (\n                      <Card \n                        key={event.id} \n                        className={`cursor-pointer transition-all duration-200 hover:shadow-md ${\n                          selectedEvent?.id === event.id ? 'ring-2 ring-blue-500 bg-blue-50' : ''\n                        }`}\n                      >\n                        <CardHeader className=\"pb-2\">\n                          <CardTitle className=\"text-lg\">{event.title}</CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"space-y-2 text-sm text-gray-600\">\n                            <p><strong>Category:</strong> {event.category}</p>\n                            <p><strong>Date:</strong> {new Date(event.eventDate).toLocaleDateString()}</p>\n                            {event.location && <p><strong>Location:</strong> {event.location}</p>}\n                            <p><strong>Privacy:</strong> {event.isPrivate ? 'Private' : 'Public'}</p>\n                            <p><strong>Photos:</strong> {event.photoCount || 0}</p>\n                          </div>\n                          \n                          <div className=\"flex gap-2 mt-4\">\n                            <Button\n                              onClick={() => generateQRCode(event)}\n                              disabled={isGenerating}\n                              className=\"flex-1\"\n                            >\n                              <QrCode className=\"h-4 w-4 mr-2\" />\n                              {isGenerating && selectedEvent?.id === event.id ? 'Generating...' : 'Generate QR'}\n                            </Button>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              {/* QR Code Display */}\n              <div>\n                <h2 className=\"text-2xl font-bold mb-6\">QR Code</h2>\n                \n                {qrCodeUrl && selectedEvent ? (\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"flex items-center gap-2\">\n                        <QrCode className=\"h-5 w-5\" />\n                        {selectedEvent.title}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"text-center space-y-6\">\n                      {/* QR Code Image */}\n                      <div className=\"bg-white p-4 rounded-lg inline-block border\">\n                        <img \n                          src={qrCodeUrl} \n                          alt={`QR Code for ${selectedEvent.title}`}\n                          className=\"w-64 h-64 mx-auto\"\n                        />\n                      </div>\n                      \n                      {/* Event Details */}\n                      <div className=\"space-y-2 text-sm text-gray-600\">\n                        <p><strong>Event:</strong> {selectedEvent.title}</p>\n                        <p><strong>Date:</strong> {new Date(selectedEvent.eventDate).toLocaleDateString()}</p>\n                        <p><strong>Photos:</strong> {selectedEvent.photoCount || 0}</p>\n                      </div>\n                      \n                      {/* QR URL */}\n                      <div className=\"space-y-2\">\n                        <Label>QR Access URL:</Label>\n                        <div className=\"flex gap-2\">\n                          <Input\n                            value={`${window.location.origin}/qr-access/${selectedEvent.id}`}\n                            readOnly\n                            className=\"text-sm\"\n                          />\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={copyQRUrl}\n                          >\n                            {copiedUrl ? <Check className=\"h-4 w-4\" /> : <Copy className=\"h-4 w-4\" />}\n                          </Button>\n                        </div>\n                      </div>\n                      \n                      {/* Action Buttons */}\n                      <div className=\"flex gap-2\">\n                        <Button onClick={downloadQRCode} className=\"flex-1\">\n                          <Download className=\"h-4 w-4 mr-2\" />\n                          Download QR\n                        </Button>\n                        <Button \n                          variant=\"outline\" \n                          onClick={() => window.open(`/qr-access/${selectedEvent.id}`, '_blank')}\n                          className=\"flex-1\"\n                        >\n                          <Eye className=\"h-4 w-4 mr-2\" />\n                          Preview\n                        </Button>\n                      </div>\n                      \n                      {/* Usage Instructions */}\n                      <div className=\"bg-blue-50 p-4 rounded-lg text-left\">\n                        <h4 className=\"font-semibold text-blue-900 mb-2\">How to use:</h4>\n                        <ul className=\"text-sm text-blue-800 space-y-1\">\n                          <li>1. Share this QR code with event attendees</li>\n                          <li>2. Users scan with Google Lens or any QR scanner</li>\n                          <li>3. They'll be redirected to the face recognition page</li>\n                          <li>4. Users can take a selfie to find their photos</li>\n                        </ul>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ) : (\n                  <Card>\n                    <CardContent className=\"p-8 text-center\">\n                      <QrCode className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n                      <p className=\"text-gray-500 mb-2\">No QR code generated</p>\n                      <p className=\"text-sm text-gray-400\">Select an event and click \"Generate QR\" to create a QR code</p>\n                    </CardContent>\n                  </Card>\n                )}\n              </div>\n            </div>\n          </div>\n        </section>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n};\n\nexport default QRShare;","size_bytes":12876},"client/src/utils/imageOptimizer.ts":{"content":"// Image optimization utilities for better performance\n\nexport interface ImageOptimizationOptions {\n  quality?: number;\n  thumbnail?: boolean;\n  maxWidth?: number;\n  maxHeight?: number;\n}\n\nexport const getOptimizedImageUrl = (\n  originalUrl: string, \n  options: ImageOptimizationOptions = {}\n): string => {\n  const { quality = 60, thumbnail = false, maxWidth, maxHeight } = options;\n  \n  // Check if it's already an API image URL\n  if (originalUrl.includes('/api/images/')) {\n    const url = new URL(originalUrl, window.location.origin);\n    url.searchParams.set('quality', quality.toString());\n    url.searchParams.set('thumbnail', thumbnail.toString());\n    \n    if (maxWidth) url.searchParams.set('width', maxWidth.toString());\n    if (maxHeight) url.searchParams.set('height', maxHeight.toString());\n    \n    return url.toString();\n  }\n  \n  return originalUrl;\n};\n\nexport const preloadImage = (src: string): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => resolve();\n    img.onerror = () => reject(new Error(`Failed to load image: ${src}`));\n    img.src = src;\n  });\n};\n\nexport const createImageLoadingWrapper = (src: string, alt: string) => {\n  const container = document.createElement('div');\n  container.className = 'relative';\n  \n  // Create loading skeleton\n  const skeleton = document.createElement('div');\n  skeleton.className = 'absolute inset-0 bg-gray-800/50 animate-pulse rounded-lg flex items-center justify-center';\n  skeleton.innerHTML = '<div class=\"text-white text-sm\">Loading...</div>';\n  \n  // Create image\n  const img = document.createElement('img');\n  img.src = src;\n  img.alt = alt;\n  img.className = 'max-w-full max-h-full object-contain transition-all duration-500 opacity-0';\n  \n  img.onload = () => {\n    img.style.opacity = '1';\n    skeleton.style.display = 'none';\n  };\n  \n  img.onerror = () => {\n    img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjE1MCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5Y2EzYWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5Image not available</text></svg>';\n    img.style.opacity = '1';\n    skeleton.style.display = 'none';\n  };\n  \n  container.appendChild(skeleton);\n  container.appendChild(img);\n  \n  return container;\n};\n\n// Performance monitoring for images\nexport class ImagePerformanceMonitor {\n  private static loadTimes: Map<string, number> = new Map();\n  \n  static startLoading(imageId: string): void {\n    this.loadTimes.set(imageId, performance.now());\n  }\n  \n  static endLoading(imageId: string): number {\n    const startTime = this.loadTimes.get(imageId);\n    if (startTime) {\n      const duration = performance.now() - startTime;\n      this.loadTimes.delete(imageId);\n      return duration;\n    }\n    return 0;\n  }\n  \n  static getAverageLoadTime(): number {\n    if (this.loadTimes.size === 0) return 0;\n    const total = Array.from(this.loadTimes.values()).reduce((sum, time) => sum + time, 0);\n    return total / this.loadTimes.size;\n  }\n}","size_bytes":3169},"client/src/utils/performanceMonitor.ts":{"content":"// Performance monitoring utility\nclass PerformanceMonitor {\n  private static metrics: Map<string, number[]> = new Map();\n  private static observers: PerformanceObserver[] = [];\n\n  static init() {\n    // Monitor long tasks (blocking main thread)\n    if ('PerformanceObserver' in window) {\n      const longTaskObserver = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries()) {\n          console.warn(`Long task detected: ${entry.duration.toFixed(2)}ms`);\n        }\n      });\n      \n      try {\n        longTaskObserver.observe({ entryTypes: ['longtask'] });\n        this.observers.push(longTaskObserver);\n      } catch (e) {\n        console.log('Long task observation not supported');\n      }\n\n      // Monitor largest contentful paint\n      const lcpObserver = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries()) {\n          this.recordMetric('lcp', entry.startTime);\n        }\n      });\n      \n      try {\n        lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });\n        this.observers.push(lcpObserver);\n      } catch (e) {\n        console.log('LCP observation not supported');\n      }\n    }\n  }\n\n  static startTiming(key: string): () => void {\n    const startTime = performance.now();\n    \n    return () => {\n      const duration = performance.now() - startTime;\n      this.recordMetric(key, duration);\n    };\n  }\n\n  static recordMetric(key: string, value: number) {\n    if (!this.metrics.has(key)) {\n      this.metrics.set(key, []);\n    }\n    \n    const values = this.metrics.get(key)!;\n    values.push(value);\n    \n    // Keep only last 100 measurements\n    if (values.length > 100) {\n      values.shift();\n    }\n  }\n\n  static getMetrics() {\n    const result: Record<string, { average: number; count: number; latest: number }> = {};\n    \n    for (const [key, values] of this.metrics.entries()) {\n      if (values.length > 0) {\n        const average = values.reduce((sum, val) => sum + val, 0) / values.length;\n        result[key] = {\n          average,\n          count: values.length,\n          latest: values[values.length - 1]\n        };\n      }\n    }\n    \n    return result;\n  }\n\n  static clearMetrics() {\n    this.metrics.clear();\n  }\n\n  static destroy() {\n    this.observers.forEach(observer => observer.disconnect());\n    this.observers = [];\n    this.clearMetrics();\n  }\n\n  // Memory usage monitoring\n  static getMemoryUsage() {\n    if ('memory' in performance) {\n      const memory = (performance as any).memory;\n      return {\n        used: memory.usedJSHeapSize,\n        total: memory.totalJSHeapSize,\n        limit: memory.jsHeapSizeLimit,\n        percentage: (memory.usedJSHeapSize / memory.jsHeapSizeLimit) * 100\n      };\n    }\n    return null;\n  }\n\n  // Connection quality assessment\n  static getConnectionInfo() {\n    if ('connection' in navigator) {\n      const connection = (navigator as any).connection;\n      return {\n        effectiveType: connection.effectiveType,\n        downlink: connection.downlink,\n        rtt: connection.rtt,\n        saveData: connection.saveData\n      };\n    }\n    return null;\n  }\n}\n\n// Initialize on load\nif (typeof window !== 'undefined') {\n  PerformanceMonitor.init();\n}\n\nexport default PerformanceMonitor;","size_bytes":3239},"client/src/components/examples/AlertExamples.tsx":{"content":"import { Button } from \"@/components/ui/button\"\nimport { ConfirmationAlert, DeleteConfirmation, RemoveConfirmation } from \"@/components/ui/confirmation-alert\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Trash2, UserX, FileX, AlertTriangle, Info, CheckCircle } from \"lucide-react\"\nimport { useToast } from \"@/hooks/use-toast\"\n\nfunction AlertExamples() {\n  const { toast } = useToast()\n\n  const handleDelete = () => {\n    toast({\n      title: \"Item deleted\",\n      description: \"The item has been successfully deleted.\",\n    })\n  }\n\n  const handleRemove = () => {\n    toast({\n      title: \"Item removed\",\n      description: \"The item has been successfully removed.\",\n    })\n  }\n\n  const handleGenericAction = (action: string) => {\n    toast({\n      title: `Action completed`,\n      description: `${action} action has been performed successfully.`,\n    })\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <h1 className=\"text-3xl font-bold mb-4\">Alert Message Components</h1>\n        <p className=\"text-muted-foreground mb-8\">\n          Interactive examples of confirmation alerts for various actions like delete, remove, and other operations.\n        </p>\n        \n        {/* Delete Confirmations */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Trash2 className=\"h-5 w-5 text-red-500\" />\n              Delete Confirmations\n            </CardTitle>\n            <CardDescription>\n              Use these for permanent deletion actions that cannot be undone.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex flex-wrap gap-4\">\n              <DeleteConfirmation\n                itemName=\"User Profile\"\n                itemType=\"profile\"\n                onConfirm={handleDelete}\n                trigger={\n                  <Button variant=\"destructive\" size=\"sm\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Delete Profile\n                  </Button>\n                }\n              />\n              \n              <DeleteConfirmation\n                itemName=\"Photo Album\"\n                itemType=\"album\"\n                onConfirm={handleDelete}\n                trigger={\n                  <Button variant=\"outline\" size=\"sm\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Delete Album\n                  </Button>\n                }\n              />\n              \n              <DeleteConfirmation\n                itemName=\"Wedding Event #123\"\n                itemType=\"event\"\n                onConfirm={handleDelete}\n                trigger={\n                  <Button variant=\"ghost\" size=\"sm\" className=\"text-red-600 hover:text-red-700\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Delete Event\n                  </Button>\n                }\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Remove Confirmations */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <UserX className=\"h-5 w-5 text-amber-500\" />\n              Remove/Unsave Confirmations\n            </CardTitle>\n            <CardDescription>\n              Use these for reversible actions like removing from lists or unsaving items.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex flex-wrap gap-4\">\n              <RemoveConfirmation\n                itemName=\"John Doe\"\n                action=\"remove\"\n                onConfirm={handleRemove}\n                trigger={\n                  <Button variant=\"outline\" size=\"sm\">\n                    <UserX className=\"h-4 w-4 mr-2\" />\n                    Remove User\n                  </Button>\n                }\n              />\n              \n              <RemoveConfirmation\n                itemName=\"Saved Photo #45\"\n                action=\"unsave\"\n                onConfirm={handleRemove}\n                trigger={\n                  <Button variant=\"ghost\" size=\"sm\">\n                    <FileX className=\"h-4 w-4 mr-2\" />\n                    Unsave Photo\n                  </Button>\n                }\n              />\n              \n              <RemoveConfirmation\n                itemName=\"Guest from Wedding List\"\n                action=\"exclude\"\n                onConfirm={handleRemove}\n                trigger={\n                  <Button variant=\"secondary\" size=\"sm\">\n                    <UserX className=\"h-4 w-4 mr-2\" />\n                    Exclude Guest\n                  </Button>\n                }\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Custom Confirmation Variants */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle>Custom Confirmation Variants</CardTitle>\n            <CardDescription>\n              Examples of different alert variants for various types of actions and messages.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {/* Destructive */}\n              <ConfirmationAlert\n                title=\"Permanently Delete Account\"\n                description=\"This will permanently delete your account and all associated data. This action cannot be reversed.\"\n                confirmText=\"Delete Account\"\n                variant=\"destructive\"\n                onConfirm={() => handleGenericAction(\"Delete account\")}\n                trigger={\n                  <Button variant=\"destructive\" className=\"w-full\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Delete Account\n                  </Button>\n                }\n              />\n\n              {/* Warning */}\n              <ConfirmationAlert\n                title=\"Overwrite Existing Data\"\n                description=\"This action will overwrite existing data. Do you want to continue?\"\n                confirmText=\"Overwrite\"\n                variant=\"warning\"\n                onConfirm={() => handleGenericAction(\"Overwrite data\")}\n                trigger={\n                  <Button variant=\"outline\" className=\"w-full\">\n                    <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                    Overwrite Data\n                  </Button>\n                }\n              />\n\n              {/* Info */}\n              <ConfirmationAlert\n                title=\"Send Notification\"\n                description=\"This will send a notification email to all users. Are you sure?\"\n                confirmText=\"Send Email\"\n                variant=\"info\"\n                onConfirm={() => handleGenericAction(\"Send notification\")}\n                trigger={\n                  <Button variant=\"secondary\" className=\"w-full\">\n                    <Info className=\"h-4 w-4 mr-2\" />\n                    Send Notification\n                  </Button>\n                }\n              />\n\n              {/* Success */}\n              <ConfirmationAlert\n                title=\"Publish Event\"\n                description=\"This will make the event visible to all users. Ready to publish?\"\n                confirmText=\"Publish\"\n                variant=\"success\"\n                onConfirm={() => handleGenericAction(\"Publish event\")}\n                trigger={\n                  <Button className=\"w-full\">\n                    <CheckCircle className=\"h-4 w-4 mr-2\" />\n                    Publish Event\n                  </Button>\n                }\n              />\n\n              {/* Default */}\n              <ConfirmationAlert\n                title=\"Save Changes\"\n                description=\"Do you want to save the changes you made?\"\n                confirmText=\"Save\"\n                variant=\"default\"\n                onConfirm={() => handleGenericAction(\"Save changes\")}\n                trigger={\n                  <Button variant=\"outline\" className=\"w-full\">\n                    Save Changes\n                  </Button>\n                }\n              />\n\n              {/* Custom without icon */}\n              <ConfirmationAlert\n                title=\"Download Report\"\n                description=\"This will generate and download a detailed report. Continue?\"\n                confirmText=\"Download\"\n                variant=\"info\"\n                showIcon={false}\n                onConfirm={() => handleGenericAction(\"Download report\")}\n                trigger={\n                  <Button variant=\"ghost\" className=\"w-full\">\n                    Download Report\n                  </Button>\n                }\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Code Examples */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Usage Examples</CardTitle>\n            <CardDescription>\n              Copy and paste these code examples to use the confirmation alerts in your components.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"bg-gray-100 dark:bg-gray-900 rounded-lg p-4 font-mono text-sm\">\n              <h4 className=\"font-semibold mb-2\">Basic Delete Confirmation:</h4>\n              <pre className=\"text-xs overflow-x-auto\">{`<DeleteConfirmation\n  itemName=\"User Account\"\n  itemType=\"account\"\n  onConfirm={() => deleteAccount()}\n  trigger={\n    <Button variant=\"destructive\">\n      <Trash2 className=\"h-4 w-4 mr-2\" />\n      Delete Account\n    </Button>\n  }\n/>`}</pre>\n            </div>\n\n            <div className=\"bg-gray-100 dark:bg-gray-900 rounded-lg p-4 font-mono text-sm\">\n              <h4 className=\"font-semibold mb-2\">Custom Confirmation Alert:</h4>\n              <pre className=\"text-xs overflow-x-auto\">{`<ConfirmationAlert\n  title=\"Publish Event\"\n  description=\"This will make the event visible to all users.\"\n  confirmText=\"Publish\"\n  variant=\"success\"\n  onConfirm={() => publishEvent()}\n  trigger={\n    <Button>Publish Event</Button>\n  }\n/>`}</pre>\n            </div>\n\n            <div className=\"bg-gray-100 dark:bg-gray-900 rounded-lg p-4 font-mono text-sm\">\n              <h4 className=\"font-semibold mb-2\">Remove with Custom Action:</h4>\n              <pre className=\"text-xs overflow-x-auto\">{`<RemoveConfirmation\n  itemName=\"Saved Photo\"\n  action=\"unsave\"\n  onConfirm={() => unsavePhoto()}\n  trigger={\n    <Button variant=\"ghost\">Unsave Photo</Button>\n  }\n/>`}</pre>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n\nexport default AlertExamples","size_bytes":10783},"client/src/components/ui/confirmation-alert.tsx":{"content":"import * as React from \"react\"\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\"\nimport { Button } from \"@/components/ui/button\"\nimport { Trash2, AlertTriangle, Info, CheckCircle, X } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\n\ninterface ConfirmationAlertProps {\n  title: string\n  description: string\n  confirmText?: string\n  cancelText?: string\n  variant?: \"default\" | \"destructive\" | \"warning\" | \"info\" | \"success\"\n  onConfirm: () => void\n  onCancel?: () => void\n  trigger: React.ReactNode\n  disabled?: boolean\n  showIcon?: boolean\n}\n\nconst variantConfig = {\n  default: {\n    icon: Info,\n    titleClass: \"text-gray-100\",\n    descriptionClass: \"text-gray-300\",\n    iconClass: \"text-gray-300\",\n  },\n  destructive: {\n    icon: Trash2,\n    titleClass: \"text-red-300\",\n    descriptionClass: \"text-red-200\",\n    iconClass: \"text-red-400\",\n  },\n  warning: {\n    icon: AlertTriangle,\n    titleClass: \"text-amber-300\",\n    descriptionClass: \"text-amber-200\",\n    iconClass: \"text-amber-400\",\n  },\n  info: {\n    icon: Info,\n    titleClass: \"text-cyan-300\",\n    descriptionClass: \"text-cyan-200\",\n    iconClass: \"text-cyan-400\",\n  },\n  success: {\n    icon: CheckCircle,\n    titleClass: \"text-green-300\",\n    descriptionClass: \"text-green-200\",\n    iconClass: \"text-green-400\",\n  },\n}\n\nexport function ConfirmationAlert({\n  title,\n  description,\n  confirmText = \"Confirm\",\n  cancelText = \"Cancel\",\n  variant = \"default\",\n  onConfirm,\n  onCancel,\n  trigger,\n  disabled = false,\n  showIcon = true,\n}: ConfirmationAlertProps) {\n  const [open, setOpen] = React.useState(false)\n  const config = variantConfig[variant]\n  const IconComponent = config.icon\n\n  const handleConfirm = () => {\n    onConfirm()\n    setOpen(false)\n  }\n\n  const handleCancel = () => {\n    onCancel?.()\n    setOpen(false)\n  }\n\n  return (\n    <AlertDialog open={open} onOpenChange={setOpen}>\n      <AlertDialogTrigger asChild disabled={disabled}>\n        {trigger}\n      </AlertDialogTrigger>\n      <AlertDialogContent className=\"sm:max-w-md bg-gray-900 border-gray-700\">\n        <AlertDialogHeader>\n          <div className=\"flex items-center gap-3\">\n            {showIcon && (\n              <div className={cn(\n                \"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center border\",\n                variant === \"destructive\" && \"bg-red-950/30 border-red-700/50\",\n                variant === \"warning\" && \"bg-amber-950/30 border-amber-700/50\",\n                variant === \"info\" && \"bg-cyan-950/30 border-cyan-700/50\",\n                variant === \"success\" && \"bg-green-950/30 border-green-700/50\",\n                variant === \"default\" && \"bg-gray-800/50 border-gray-600/50\"\n              )}>\n                <IconComponent className={cn(\"h-5 w-5\", config.iconClass)} />\n              </div>\n            )}\n            <AlertDialogTitle className={cn(\"text-left text-gray-100\", config.titleClass)}>\n              {title}\n            </AlertDialogTitle>\n          </div>\n        </AlertDialogHeader>\n        <AlertDialogDescription className={cn(\"text-left mt-2 text-gray-300\", config.descriptionClass)}>\n          {description}\n        </AlertDialogDescription>\n        <AlertDialogFooter className=\"flex flex-col-reverse sm:flex-row sm:justify-end gap-2 mt-6\">\n          <AlertDialogCancel \n            onClick={handleCancel} \n            className=\"sm:w-auto bg-gray-700 hover:bg-gray-600 text-gray-100 border-gray-600\"\n          >\n            {cancelText}\n          </AlertDialogCancel>\n          <AlertDialogAction\n            onClick={handleConfirm}\n            className={cn(\n              \"sm:w-auto text-white font-medium\",\n              variant === \"destructive\" && \"bg-red-600 hover:bg-red-700 border-red-500\",\n              variant === \"warning\" && \"bg-amber-600 hover:bg-amber-700 border-amber-500\",\n              variant === \"info\" && \"bg-cyan-600 hover:bg-cyan-700 border-cyan-500\",\n              variant === \"success\" && \"bg-green-600 hover:bg-green-700 border-green-500\",\n              variant === \"default\" && \"bg-gray-600 hover:bg-gray-700 border-gray-500\"\n            )}\n          >\n            {confirmText}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  )\n}\n\n// Convenience components for common use cases\ninterface DeleteConfirmationProps {\n  itemName: string\n  itemType?: string\n  onConfirm: () => void\n  onCancel?: () => void\n  trigger: React.ReactNode\n  disabled?: boolean\n}\n\nexport function DeleteConfirmation({\n  itemName,\n  itemType = \"item\",\n  onConfirm,\n  onCancel,\n  trigger,\n  disabled = false,\n}: DeleteConfirmationProps) {\n  return (\n    <ConfirmationAlert\n      title={`Delete ${itemType}`}\n      description={`Are you sure you want to delete \"${itemName}\"? This action cannot be undone.`}\n      confirmText=\"Delete\"\n      cancelText=\"Cancel\"\n      variant=\"destructive\"\n      onConfirm={onConfirm}\n      onCancel={onCancel}\n      trigger={trigger}\n      disabled={disabled}\n    />\n  )\n}\n\ninterface RemoveConfirmationProps {\n  itemName: string\n  action?: string\n  onConfirm: () => void\n  onCancel?: () => void\n  trigger: React.ReactNode\n  disabled?: boolean\n}\n\nexport function RemoveConfirmation({\n  itemName,\n  action = \"remove\",\n  onConfirm,\n  onCancel,\n  trigger,\n  disabled = false,\n}: RemoveConfirmationProps) {\n  return (\n    <ConfirmationAlert\n      title={`${action.charAt(0).toUpperCase() + action.slice(1)} item`}\n      description={`Are you sure you want to ${action} \"${itemName}\"?`}\n      confirmText={action.charAt(0).toUpperCase() + action.slice(1)}\n      cancelText=\"Cancel\"\n      variant=\"warning\"\n      onConfirm={onConfirm}\n      onCancel={onCancel}\n      trigger={trigger}\n      disabled={disabled}\n    />\n  )\n}","size_bytes":5906},"client/src/components/EventShareDialog.tsx":{"content":"import { useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Copy, Share2, ExternalLink, Check, MessageSquare } from 'lucide-react';\nimport { FaWhatsapp, FaInstagram } from 'react-icons/fa';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Event } from '@shared/types';\n\ninterface EventShareDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  event: Event | null;\n}\n\nexport function EventShareDialog({ open, onOpenChange, event }: EventShareDialogProps) {\n  const [shareUrl, setShareUrl] = useState<string>('');\n  const [loading, setLoading] = useState(false);\n  const [copied, setCopied] = useState(false);\n  const { toast } = useToast();\n  const { currentUser } = useAuth();\n\n  const generateShareUrl = async () => {\n    if (!event || !currentUser) return;\n    \n    setLoading(true);\n    try {\n      const token = await currentUser.getIdToken();\n      const response = await fetch(`/api/events/${event.id}/share-url`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        setShareUrl(data.shareUrl);\n        toast({\n          title: \"Share URL Generated\",\n          description: \"The shareable URL has been created successfully.\"\n        });\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Failed to generate share URL.\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error) {\n      console.error('Error generating share URL:', error);\n      toast({\n        title: \"Error\",\n        description: \"An error occurred while generating the share URL.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const copyToClipboard = async () => {\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      setCopied(true);\n      toast({\n        title: \"URL Copied\",\n        description: \"The share URL has been copied to your clipboard.\"\n      });\n      \n      // Reset copied state after 2 seconds\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      console.error('Error copying to clipboard:', error);\n      toast({\n        title: \"Error\", \n        description: \"Failed to copy URL to clipboard.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const openInBrowser = () => {\n    if (shareUrl) {\n      window.open(shareUrl, '_blank');\n    }\n  };\n\n  const shareToWhatsApp = () => {\n    if (!shareUrl || !event) return;\n    \n    const message = `🎉 Check out photos from \"${event.title}\"!\\n\\n📅 ${new Date(event.eventDate).toLocaleDateString()}\\n📍 ${event.location}\\n\\n✨ View and find your photos here: ${shareUrl}`;\n    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;\n    window.open(whatsappUrl, '_blank');\n  };\n\n  const shareToInstagram = () => {\n    if (!shareUrl || !event) return;\n    \n    // Instagram doesn't support direct link sharing, so we copy a formatted message\n    const message = `🎉 Check out photos from \"${event.title}\"!\\n\\n📅 ${new Date(event.eventDate).toLocaleDateString()}\\n📍 ${event.location}\\n\\n✨ Link: ${shareUrl}`;\n    \n    navigator.clipboard.writeText(message).then(() => {\n      toast({\n        title: \"Instagram Message Copied\",\n        description: \"The message has been copied. You can paste it in Instagram Stories or messages.\"\n      });\n    });\n  };\n\n  const openInNewTab = () => {\n    if (shareUrl) {\n      window.open(shareUrl, '_blank');\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Share2 className=\"h-5 w-5\" />\n            Share Event: {event?.title}\n          </DialogTitle>\n        </DialogHeader>\n        \n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"share-url\">Shareable Event URL</Label>\n            <div className=\"text-sm text-gray-600\">\n              This URL will allow users to access the event directly. For private events, they will be prompted for the event passcode.\n            </div>\n          </div>\n          \n          {!shareUrl ? (\n            <Button \n              onClick={generateShareUrl} \n              disabled={loading || !event}\n              className=\"w-full\"\n            >\n              {loading ? 'Generating...' : 'Generate Share URL'}\n            </Button>\n          ) : (\n            <div className=\"space-y-3\">\n              <div className=\"flex gap-2\">\n                <Input\n                  id=\"share-url\"\n                  value={shareUrl}\n                  readOnly\n                  className=\"flex-1\"\n                />\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  onClick={copyToClipboard}\n                  className=\"shrink-0\"\n                >\n                  {copied ? (\n                    <Check className=\"h-4 w-4 text-green-600\" />\n                  ) : (\n                    <Copy className=\"h-4 w-4\" />\n                  )}\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  onClick={openInNewTab}\n                  className=\"shrink-0\"\n                >\n                  <ExternalLink className=\"h-4 w-4\" />\n                </Button>\n              </div>\n              \n              {/* Social Media Sharing */}\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium\">Share on Social Media</Label>\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={shareToWhatsApp}\n                    className=\"flex-1 gap-2 text-green-600 border-green-200 hover:bg-green-50\"\n                  >\n                    <FaWhatsapp className=\"h-4 w-4\" />\n                    WhatsApp\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    onClick={shareToInstagram}\n                    className=\"flex-1 gap-2 text-purple-600 border-purple-200 hover:bg-purple-50\"\n                  >\n                    <FaInstagram className=\"h-4 w-4\" />\n                    Instagram\n                  </Button>\n                </div>\n              </div>\n              \n              <div className=\"bg-blue-50 p-3 rounded-lg\">\n                <div className=\"text-sm font-medium text-blue-900 mb-1\">Event Access Details:</div>\n                <div className=\"text-sm text-blue-700\">\n                  {event?.isPrivate ? (\n                    <>\n                      <div><strong>Event Type:</strong> Private</div>\n                      <div><strong>Public PIN:</strong> {event.publicPin} (Face recognition required)</div>\n                      <div><strong>Bride-Groom PIN:</strong> {event.brideGroomPin} (Full gallery access)</div>\n                    </>\n                  ) : (\n                    <div><strong>Event Type:</strong> Public (No PIN required)</div>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":7612},"client/src/components/ui/alert-message-demo.tsx":{"content":"import { Button } from \"@/components/ui/button\"\nimport { ConfirmationAlert, DeleteConfirmation, RemoveConfirmation } from \"@/components/ui/confirmation-alert\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Trash2, UserX, FileX, AlertTriangle, Info, CheckCircle, Download, Edit, Plus } from \"lucide-react\"\nimport { useToast } from \"@/hooks/use-toast\"\n\nexport function AlertMessageDemo() {\n  const { toast } = useToast()\n\n  const showToast = (title: string, description: string) => {\n    toast({ title, description })\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center space-y-2\">\n        <h2 className=\"text-2xl font-bold\">Alert Message Components</h2>\n        <p className=\"text-muted-foreground\">\n          Styled confirmation dialogs for delete operations and other important actions\n        </p>\n      </div>\n\n      {/* Quick Examples */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Quick Examples</CardTitle>\n          <CardDescription>Common use cases with pre-configured components</CardDescription>\n        </CardHeader>\n        <CardContent className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {/* Delete Photo */}\n          <DeleteConfirmation\n            itemName=\"Wedding Photo #123\"\n            itemType=\"photo\"\n            onConfirm={() => showToast(\"Photo Deleted\", \"The photo has been permanently removed.\")}\n            trigger={\n              <Button variant=\"destructive\" size=\"sm\" className=\"w-full\">\n                <Trash2 className=\"h-4 w-4 mr-2\" />\n                Delete Photo\n              </Button>\n            }\n          />\n\n          {/* Remove from Saved */}\n          <RemoveConfirmation\n            itemName=\"Favorite Image\"\n            action=\"unsave\"\n            onConfirm={() => showToast(\"Photo Unsaved\", \"The photo has been removed from your saved collection.\")}\n            trigger={\n              <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                <FileX className=\"h-4 w-4 mr-2\" />\n                Unsave Photo\n              </Button>\n            }\n          />\n\n          {/* Delete Event */}\n          <DeleteConfirmation\n            itemName=\"Summer Wedding 2025\"\n            itemType=\"event\"\n            onConfirm={() => showToast(\"Event Deleted\", \"The event and all its photos have been removed.\")}\n            trigger={\n              <Button variant=\"ghost\" size=\"sm\" className=\"w-full text-red-600 hover:text-red-700\">\n                <Trash2 className=\"h-4 w-4 mr-2\" />\n                Delete Event\n              </Button>\n            }\n          />\n        </CardContent>\n      </Card>\n\n      {/* Different Variants */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Different Alert Variants</CardTitle>\n          <CardDescription>Various styles for different types of actions</CardDescription>\n        </CardHeader>\n        <CardContent className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {/* Destructive - Permanent Actions */}\n          <div className=\"space-y-3\">\n            <h4 className=\"font-medium text-red-600\">Destructive Actions</h4>\n            <div className=\"space-y-2\">\n              <ConfirmationAlert\n                title=\"Delete User Account\"\n                description=\"This will permanently delete the user account and all associated data. This action cannot be undone.\"\n                confirmText=\"Delete Account\"\n                variant=\"destructive\"\n                onConfirm={() => showToast(\"Account Deleted\", \"User account has been permanently removed.\")}\n                trigger={\n                  <Button variant=\"destructive\" size=\"sm\" className=\"w-full\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Delete Account\n                  </Button>\n                }\n              />\n              \n              <ConfirmationAlert\n                title=\"Clear All Photos\"\n                description=\"This will remove all photos from this event. Are you sure?\"\n                confirmText=\"Clear All\"\n                variant=\"destructive\"\n                onConfirm={() => showToast(\"Photos Cleared\", \"All photos have been removed from the event.\")}\n                trigger={\n                  <Button variant=\"outline\" size=\"sm\" className=\"w-full text-red-600 hover:text-red-700\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Clear All Photos\n                  </Button>\n                }\n              />\n            </div>\n          </div>\n\n          {/* Warning - Reversible Actions */}\n          <div className=\"space-y-3\">\n            <h4 className=\"font-medium text-amber-600\">Warning Actions</h4>\n            <div className=\"space-y-2\">\n              <ConfirmationAlert\n                title=\"Overwrite Event Settings\"\n                description=\"This will replace the current event settings. You can change them back later.\"\n                confirmText=\"Overwrite\"\n                variant=\"warning\"\n                onConfirm={() => showToast(\"Settings Updated\", \"Event settings have been overwritten.\")}\n                trigger={\n                  <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                    <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                    Overwrite Settings\n                  </Button>\n                }\n              />\n              \n              <RemoveConfirmation\n                itemName=\"Premium Package\"\n                action=\"downgrade\"\n                onConfirm={() => showToast(\"Package Downgraded\", \"Your package has been changed.\")}\n                trigger={\n                  <Button variant=\"secondary\" size=\"sm\" className=\"w-full\">\n                    <Edit className=\"h-4 w-4 mr-2\" />\n                    Downgrade Package\n                  </Button>\n                }\n              />\n            </div>\n          </div>\n\n          {/* Info - Informational Actions */}\n          <div className=\"space-y-3\">\n            <h4 className=\"font-medium text-blue-600\">Informational Actions</h4>\n            <div className=\"space-y-2\">\n              <ConfirmationAlert\n                title=\"Send Email Notification\"\n                description=\"This will send a notification email to all event participants.\"\n                confirmText=\"Send Email\"\n                variant=\"info\"\n                onConfirm={() => showToast(\"Email Sent\", \"Notification has been sent to all participants.\")}\n                trigger={\n                  <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                    <Info className=\"h-4 w-4 mr-2\" />\n                    Send Notification\n                  </Button>\n                }\n              />\n              \n              <ConfirmationAlert\n                title=\"Download Event Report\"\n                description=\"This will generate and download a detailed report of the event.\"\n                confirmText=\"Download\"\n                variant=\"info\"\n                showIcon={false}\n                onConfirm={() => showToast(\"Report Downloaded\", \"Event report has been downloaded.\")}\n                trigger={\n                  <Button variant=\"secondary\" size=\"sm\" className=\"w-full\">\n                    <Download className=\"h-4 w-4 mr-2\" />\n                    Download Report\n                  </Button>\n                }\n              />\n            </div>\n          </div>\n\n          {/* Success - Positive Actions */}\n          <div className=\"space-y-3\">\n            <h4 className=\"font-medium text-green-600\">Success Actions</h4>\n            <div className=\"space-y-2\">\n              <ConfirmationAlert\n                title=\"Publish Event Gallery\"\n                description=\"This will make the event gallery visible to all participants.\"\n                confirmText=\"Publish\"\n                variant=\"success\"\n                onConfirm={() => showToast(\"Gallery Published\", \"The event gallery is now live and visible to participants.\")}\n                trigger={\n                  <Button className=\"w-full\" size=\"sm\">\n                    <CheckCircle className=\"h-4 w-4 mr-2\" />\n                    Publish Gallery\n                  </Button>\n                }\n              />\n              \n              <ConfirmationAlert\n                title=\"Create New Event\"\n                description=\"This will create a new event with the current settings.\"\n                confirmText=\"Create Event\"\n                variant=\"success\"\n                onConfirm={() => showToast(\"Event Created\", \"Your new event has been successfully created.\")}\n                trigger={\n                  <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Create Event\n                  </Button>\n                }\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Usage Instructions */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">How to Use</CardTitle>\n          <CardDescription>Implementation examples for common scenarios</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <div className=\"space-y-3\">\n              <h4 className=\"font-medium\">Basic Delete Confirmation</h4>\n              <div className=\"bg-gray-100 dark:bg-gray-900 rounded-lg p-3 text-sm font-mono\">\n                <pre className=\"text-xs overflow-x-auto\">{`<DeleteConfirmation\n  itemName=\"Photo Name\"\n  itemType=\"photo\"\n  onConfirm={() => handleDelete()}\n  trigger={\n    <Button variant=\"destructive\">\n      Delete Photo\n    </Button>\n  }\n/>`}</pre>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              <h4 className=\"font-medium\">Custom Confirmation Alert</h4>\n              <div className=\"bg-gray-100 dark:bg-gray-900 rounded-lg p-3 text-sm font-mono\">\n                <pre className=\"text-xs overflow-x-auto\">{`<ConfirmationAlert\n  title=\"Custom Action\"\n  description=\"Custom description\"\n  confirmText=\"Confirm\"\n  variant=\"warning\"\n  onConfirm={() => handleAction()}\n  trigger={<Button>Action</Button>}\n/>`}</pre>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <h4 className=\"font-medium\">Available Variants</h4>\n            <ul className=\"text-sm text-muted-foreground space-y-1 list-disc list-inside\">\n              <li><code className=\"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded\">destructive</code> - Red theme for permanent deletion actions</li>\n              <li><code className=\"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded\">warning</code> - Amber theme for reversible warning actions</li>\n              <li><code className=\"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded\">info</code> - Blue theme for informational actions</li>\n              <li><code className=\"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded\">success</code> - Green theme for positive actions</li>\n              <li><code className=\"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded\">default</code> - Standard theme for general confirmations</li>\n            </ul>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}","size_bytes":11342}}}